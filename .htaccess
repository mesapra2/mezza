# .htaccess - Coloque na RAIZ do site (/public_html)

# ===== CORS PARA ARQUIVOS EST√ÅTICOS =====
<IfModule mod_headers.c>
    # Permite acesso de qualquer origem
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Max-Age "3600"
</IfModule>

# ===== DETEC√á√ÉO DE BOTS E META TAGS DIN√ÇMICAS =====
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Trata as requisi√ß√µes OPTIONS (CORS preflight)
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]

    # ========================================
    # ü§ñ DETEC√á√ÉO DE BOTS (WhatsApp, Facebook, Twitter, LinkedIn)
    # ========================================
    # Se for um bot E a URL for /event/ID
    RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit|WhatsApp|Twitterbot|LinkedInBot|Slackbot|TelegramBot|SkypeUriPreview|Google-PageRenderer) [NC]
    RewriteCond %{REQUEST_URI} ^/event/([0-9]+)/?$
    RewriteRule ^event/([0-9]+)/?$ /meta-proxy.php?event_id=$1 [L,QSA]

    # Se for um bot E a URL for raiz ou qualquer outra
    RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit|WhatsApp|Twitterbot|LinkedInBot|Slackbot|TelegramBot|SkypeUriPreview|Google-PageRenderer) [NC]
    RewriteCond %{REQUEST_URI} ^/$
    RewriteRule ^$ /meta-proxy.php [L,QSA]

    # ========================================
    # ü§ñ EXCLUS√ïES ESPEC√çFICAS - ARQUIVOS ESPECIAIS
    # ========================================
    # robots.txt deve ser servido como arquivo de texto
    RewriteCond %{REQUEST_URI} ^/robots\.txt$ [NC]
    RewriteRule ^robots\.txt$ robots.txt [L]
    
    # sitemap.xml deve ser servido como XML
    RewriteCond %{REQUEST_URI} ^/sitemap\.xml$ [NC]
    RewriteRule ^sitemap\.xml$ sitemap.xml [L]

    # ========================================
    # üë§ USU√ÅRIOS NORMAIS - FALLBACK REACT SPA
    # ========================================
    # Se a requisi√ß√£o N√ÉO for para um arquivo real...
    RewriteCond %{REQUEST_FILENAME} !-f
    # E tamb√©m N√ÉO for para um diret√≥rio real...
    RewriteCond %{REQUEST_FILENAME} !-d
    # E N√ÉO for robots.txt ou sitemap.xml...
    RewriteCond %{REQUEST_URI} !^/robots\.txt$ [NC]
    RewriteCond %{REQUEST_URI} !^/sitemap\.xml$ [NC]
    # Ent√£o, reescreva a requisi√ß√£o para o index.html
    RewriteRule ^ index.html [L]
</IfModule>

# ===== ARQUIVOS CSV E LOG - ACESSO DIRETO =====
<FilesMatch "\.(csv|log)$">
    # Permite leitura de todos
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
    
    # Force tipo de conte√∫do como texto
    <IfModule mod_headers.c>
        Header set Content-Type "text/plain; charset=utf-8"
        Header set Access-Control-Allow-Origin "*"
    </IfModule>
</FilesMatch>

# ===== ARQUIVOS PHP =====
<FilesMatch "\.php$">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
    
    <IfModule mod_headers.c>
        Header set Access-Control-Allow-Origin "*"
    </IfModule>
</FilesMatch>

# ===== PERMISS√ïES ESPEC√çFICAS =====
<Files "leads.csv">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    ForceType text/plain
</Files>

<Files "sms_envio.log">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    ForceType text/plain
</Files>

<Files "send_sms.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
</Files>

<Files "meta-proxy.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
</Files>

# ===== SEGURAN√áA =====
# Impede listagem de diret√≥rios
Options -Indexes

# Protege arquivos ocultos
<FilesMatch "^\.">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order deny,allow
        Deny from all
    </IfModule>
</FilesMatch>

# Protege composer e vendor
<FilesMatch "(composer\.(json|lock)|package\.json)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order deny,allow
        Deny from all
    </IfModule>
</FilesMatch>

<IfModule mod_dir.c>
    DirectoryIndex index.html index.php
</IfModule>

# ===== CONFIGURA√á√ÉO ESPEC√çFICA PARA ROBOTS.TXT =====
<Files "robots.txt">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
    
    # Force tipo de conte√∫do como texto simples
    <IfModule mod_headers.c>
        Header set Content-Type "text/plain; charset=utf-8"
        Header unset Cache-Control
        Header set Cache-Control "public, max-age=86400"
    </IfModule>
    
    # Force MIME type
    ForceType text/plain
</Files>

# ===== CONFIGURA√á√ÉO ESPEC√çFICA PARA SITEMAP.XML =====
<Files "sitemap.xml">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
    
    # Force tipo de conte√∫do como XML
    <IfModule mod_headers.c>
        Header set Content-Type "application/xml; charset=utf-8"
        Header unset Cache-Control
        Header set Cache-Control "public, max-age=86400"
    </IfModule>
    
    # Force MIME type
    ForceType application/xml
</Files>

# ===== MIME TYPES =====
<IfModule mod_mime.c>
    AddType text/plain .csv
    AddType text/plain .log
    AddType text/plain .txt
    AddType application/xml .xml
</IfModule>