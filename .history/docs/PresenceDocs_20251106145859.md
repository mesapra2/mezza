A presenÃ§a do usuÃ¡rio que Ã© a bolinha verde indicando se ele tÃ¡ online ou nÃ£o, e feita por 

PresenceService.ts â†’ src/services/
usePresence.js â†’ src/hooks/
Avatar.jsx (atualizado) 
AuthContext.jsx

# ğŸ—ï¸ Arquitetura - Sistema de PresenÃ§a Online

## ğŸ“Š VisÃ£o Geral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SUPABASE                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“Š Tabela: user_presence                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ user_id  â”‚ status  â”‚ last_seen  â”‚ updated_at  â”‚   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚    â”‚
â”‚  â”‚  â”‚ abc123   â”‚ online  â”‚ 14:58:30   â”‚ 14:58:30    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ def456   â”‚ away    â”‚ 14:55:00   â”‚ 14:55:00    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ ghi789   â”‚ offline â”‚ 14:30:00   â”‚ 14:30:00    â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â”‚ Realtime Sync (WebSocket)       â”‚
â”‚                              â–¼                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REACT APPLICATION                           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ” AuthContext.jsx                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ useCurrentUserPresence(user?.id)                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â†“ Inicia tracking automaticamente ao logar      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âš™ï¸  PresenceService.ts                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ startTracking()    - Inicia monitoramento   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ stopTracking()     - Para monitoramento     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ updatePresence()   - Atualiza status        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ subscribeToPresence() - Ouve mudanÃ§as       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚                                                â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ Heartbeat â±ï¸  (1 min)                         â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ Activity Detection ğŸ–±ï¸ (mousemove, click...)   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ Exit Handlers ğŸšª (beforeunload, pagehide)     â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸª usePresence.js (Hooks)                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ usePresence(userId)                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â†’ Para 1 usuÃ¡rio especÃ­fico                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ useMultiplePresence([userId1, userId2, ...])  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â†’ Para mÃºltiplos usuÃ¡rios (otimizado)         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ useCurrentUserPresence(userId)                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â†’ Para iniciar tracking do prÃ³prio usuÃ¡rio    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ‘¤ Avatar.jsx                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  <Avatar                                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    url={user.avatar_url}                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    name={user.name}                              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    userId={user.id}  â† ID do usuÃ¡rio            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    showPresence={true}  â† Habilitar bolinha     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  />                                              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  ğŸŸ¢ Online  (verde)   - Ativo agora             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  ğŸŸ¡ Away    (amarelo) - Inativo 2-5min          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  âš« Offline (cinza)   - Desconectado >5min      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Fluxo de Dados

### 1. Login do UsuÃ¡rio
```
User Login
   â”‚
   â–¼
AuthContext detecta user.id
   â”‚
   â–¼
useCurrentUserPresence(user.id)
   â”‚
   â–¼
PresenceService.startTracking(user.id)
   â”‚
   â”œâ”€â–º INSERT/UPDATE user_presence (status: 'online')
   â”œâ”€â–º Inicia Heartbeat (1 min)
   â”œâ”€â–º Monitora atividade (mousemove, click, etc.)
   â””â”€â–º Configura handlers de saÃ­da
```

### 2. AtualizaÃ§Ã£o de PresenÃ§a
```
Heartbeat Timer (1 min)
   â”‚
   â–¼
PresenceService.updatePresence()
   â”‚
   â–¼
UPSERT user_presence SET last_seen = NOW()
   â”‚
   â–¼
Supabase Realtime broadcast
   â”‚
   â–¼
Todos os clientes inscritos recebem update
   â”‚
   â–¼
usePresence hook atualiza estado local
   â”‚
   â–¼
Avatar re-renderiza com nova cor
```

### 3. DetecÃ§Ã£o de Inatividade (Server-side)
```
Cron Job (cada 1 minuto)
   â”‚
   â”œâ”€â–º mark_inactive_users_away()
   â”‚   â””â”€â–º UPDATE status = 'away' WHERE last_seen < NOW() - 2min
   â”‚
   â””â”€â–º mark_inactive_users_offline()
       â””â”€â–º UPDATE status = 'offline' WHERE last_seen < NOW() - 5min
```

### 4. SaÃ­da do UsuÃ¡rio
```
User fecha tab/navegador
   â”‚
   â–¼
beforeunload / pagehide event
   â”‚
   â–¼
PresenceService.updatePresence(status: 'offline')
   â”‚
   â–¼
navigator.sendBeacon() â†’ Supabase
   â”‚
   â–¼
UPDATE user_presence SET status = 'offline'
```

## ğŸ“¦ Estrutura de Arquivos no Projeto

```
mesapra2/
â”‚
â”œâ”€â”€ ğŸ“ supabase/
â”‚   â””â”€â”€ 01_supabase_presence_setup.sql  â† Executar no SQL Editor
â”‚
â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ services/
â”‚   â”‚   â””â”€â”€ PresenceService.ts          â† Service principal
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ hooks/
â”‚   â”‚   â””â”€â”€ usePresence.js              â† Hooks React
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ contexts/
â”‚   â”‚   â””â”€â”€ AuthContext.jsx             â† Adicionar useCurrentUserPresence
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ features/shared/components/profile/
â”‚       â””â”€â”€ Avatar.jsx                  â† Substituir arquivo existente
â”‚
â””â”€â”€ ğŸ“ docs/
    â”œâ”€â”€ README.md                        â† VisÃ£o geral
    â”œâ”€â”€ GUIA_INSTALACAO.md              â† Guia passo a passo
    â”œâ”€â”€ Usage_Examples.jsx              â† Exemplos de uso
    â””â”€â”€ AuthContext_Integration_Example.jsx
```

## ğŸ”Œ ConexÃµes entre Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     App.jsx / Main.jsx                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              <AuthProvider>                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  useCurrentUserPresence(user?.id) â† tracking   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  <Router>                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â”œâ”€â”€ /chat       â†’ ChatPage                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â”œâ”€â”€ /people     â†’ PeoplePage                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â”€ /profile    â†’ ProfilePage               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatPage    â”‚      â”‚  PeoplePage  â”‚     â”‚ ProfilePage  â”‚
â”‚              â”‚      â”‚              â”‚     â”‚              â”‚
â”‚  <Avatar     â”‚      â”‚  <Avatar     â”‚     â”‚  <Avatar     â”‚
â”‚   userId={} />â”‚     â”‚   userId={} />â”‚    â”‚   userId={} />â”‚
â”‚      â”‚       â”‚      â”‚      â”‚       â”‚     â”‚      â”‚       â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚              â”‚                     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  usePresence()  â”‚
                            â”‚                 â”‚
                            â”‚  subscribes to  â”‚
                            â”‚  Supabase       â”‚
                            â”‚  Realtime       â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Uso TÃ­pico

### Chat/Mensagens
```jsx
import Avatar from '@/components/Avatar';

<Avatar 
  userId={otherUser.id}
  url={otherUser.avatar}
  name={otherUser.name}
  showPresence={true}
/>
```

### Lista de Participantes (Otimizado)
```jsx
import { useMultiplePresence } from '@/hooks/usePresence';

const userIds = participants.map(p => p.user_id);
const { getStatus } = useMultiplePresence(userIds);

participants.map(p => (
  <Avatar 
    userId={p.user_id}
    showPresence={true}
  />
))
```

## ğŸ• Timeline de Status

```
0 min          2 min          5 min          10 min
  â”‚              â”‚              â”‚               â”‚
  ğŸŸ¢ Online      ğŸŸ¡ Away        âš« Offline      âš« Offline
  â†‘              â†‘              â†‘
  â”‚              â”‚              â”‚
  Ativo agora    Sem atividade  Desconectado
                 por 2-5min     hÃ¡ >5min
```

## ğŸ“¡ Realtime Subscription

```
Component Mount
   â”‚
   â–¼
usePresence(userId)
   â”‚
   â”œâ”€â–º Busca presenÃ§a inicial (fetch)
   â”‚   SELECT * FROM user_presence WHERE user_id = ?
   â”‚
   â””â”€â–º Inscreve em mudanÃ§as (subscribe)
       supabase.channel()
         .on('postgres_changes', { table: 'user_presence' })
         .subscribe()
           â”‚
           â–¼
       Qualquer UPDATE na tabela
           â”‚
           â–¼
       Callback executado
           â”‚
           â–¼
       Estado atualizado
           â”‚
           â–¼
       Avatar re-renderiza com nova cor
```

## ğŸ”’ SeguranÃ§a (RLS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Row Level Security Policies                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  âœ“ SELECT: Todos podem ver presenÃ§a de todos       â”‚
â”‚    (necessÃ¡rio para mostrar status)                 â”‚
â”‚                                                      â”‚
â”‚  âœ“ INSERT: Apenas prÃ³prio user_id                  â”‚
â”‚    (auth.uid() = user_id)                           â”‚
â”‚                                                      â”‚
â”‚  âœ“ UPDATE: Apenas prÃ³prio user_id                  â”‚
â”‚    (auth.uid() = user_id)                           â”‚
â”‚                                                      â”‚
â”‚  âœ“ DELETE: Apenas prÃ³prio user_id                  â”‚
â”‚    (auth.uid() = user_id)                           â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Esta arquitetura garante:**
- âš¡ AtualizaÃ§Ãµes em tempo real
- ğŸ”’ SeguranÃ§a atravÃ©s de RLS
- ğŸš€ Performance otimizada
- ğŸ“± ExperiÃªncia consistente
- ğŸ¯ FÃ¡cil manutenÃ§Ã£o