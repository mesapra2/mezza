// src/utils/chatAvailability.js

/**
 * Determina se o chat do evento deve estar disponÃ­vel
 * 
 * REGRAS:
 * - Eventos INSTITUCIONAIS: Chat liberado desde o primeiro aprovado
 * - Outros tipos (crusher, particular, normal): Chat sÃ³ apÃ³s evento "fechar" (vagas completas)
 * 
 * @param {Object} event - Objeto do evento com propriedades: event_type, status, vagas, approvedCount
 * @param {boolean} isCreator - Se o usuÃ¡rio Ã© o criador do evento
 * @param {boolean} isApprovedParticipant - Se o usuÃ¡rio Ã© participante aprovado
 * @returns {Object} { available: boolean, reason: string }
 */
export const isChatAvailable = (event, isCreator, isApprovedParticipant) => {
  // Criador sempre tem acesso ao chat
  if (isCreator) {
    return { available: true, reason: 'VocÃª Ã© o criador do evento' };
  }

  // UsuÃ¡rio precisa ser participante aprovado
  if (!isApprovedParticipant) {
    return { available: false, reason: 'VocÃª nÃ£o estÃ¡ aprovado neste evento' };
  }

  // Evento cancelado ou concluÃ­do
  if (['Cancelado', 'ConcluÃ­do'].includes(event.status)) {
    return { available: true, reason: 'Chat em modo leitura' };
  }

  // â­ REGRA ESPECIAL: Eventos INSTITUCIONAIS
  if (event.event_type === 'institucional') {
    // Chat disponÃ­vel desde o primeiro aprovado
    const hasApprovedParticipants = event.approvedCount > 0;
    
    if (hasApprovedParticipants) {
      return { 
        available: true, 
        reason: 'Chat liberado para interaÃ§Ã£o entre participantes' 
      };
    }
    
    return { 
      available: false, 
      reason: 'Aguardando primeiro participante aprovado' 
    };
  }

  // ðŸ”’ REGRA PADRÃƒO: Outros tipos de evento (crusher, particular, normal)
  // Chat sÃ³ disponÃ­vel quando evento estÃ¡ "fechado" (vagas completas ou confirmado)
  const isEventClosed = event.approvedCount >= event.vagas || event.status === 'Confirmado';

  if (isEventClosed) {
    return { 
      available: true, 
      reason: 'Evento confirmado - chat liberado' 
    };
  }

  return { 
    available: false, 
    reason: `Chat serÃ¡ liberado quando o evento fechar (${event.approvedCount}/${event.vagas} vagas preenchidas)` 
  };
};

/**
 * Verifica se deve mostrar o botÃ£o de chat (mesmo que desabilitado)
 * O botÃ£o aparece para criador e participantes aprovados
 */
export const shouldShowChatButton = (isCreator, isApprovedParticipant) => {
  return isCreator || isApprovedParticipant;
};