{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\authService.test.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\authService.test.ts"],"sourcesContent":["/* eslint-env jest */\r\n\r\n// ✅ CORREÇÃO 1: Mudar para 'import' padrão do ES Modules\r\nimport axios from 'axios';\r\nimport { describe, it, expect, jest, beforeEach } from '@jest/globals';\r\n\r\n// ✅ CORREÇÃO 2: Mockar o 'axios' ANTES de importar o serviço\r\njest.mock('axios');\r\nconst mockedAxios = axios as jest.Mocked<typeof axios>;\r\n\r\n// ✅ CORREÇÃO 3: Importar as FUNÇÕES NOMEADAS diretamente, não o 'default'\r\nimport {\r\n  sendVerificationCode,\r\n  verifyPhone,\r\n  resendVerificationCode,\r\n  verifyCode,\r\n  resendCode\r\n} from './authService';\r\n\r\ndescribe('AuthService', () => {\r\n  const mockUserId = 'user-123';\r\n  const mockPhone = '+5561999999999';\r\n  const mockCode = '123456';\r\n\r\n  beforeEach(() => {\r\n    // Limpa todos os mocks antes de cada teste\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('sendVerificationCode', () => {\r\n    it('deve enviar código de verificação com sucesso', async () => {\r\n      const mockResponse = {\r\n        data: {\r\n          success: true,\r\n          message: 'Código enviado com sucesso'\r\n        }\r\n      };\r\n\r\n      // Usar mockImplementationOnce para retornar a Promise\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.resolve(mockResponse as any));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      const result = await sendVerificationCode({\r\n        userId: mockUserId,\r\n        phone: mockPhone\r\n      });\r\n\r\n      expect(mockedAxios.post).toHaveBeenCalledWith(\r\n        expect.stringContaining('/sms/send-code'),\r\n        { userId: mockUserId, phone: mockPhone }\r\n      );\r\n      expect(result).toEqual(mockResponse.data);\r\n    });\r\n\r\n    it('deve lançar erro quando falhar ao enviar código', async () => {\r\n      const mockError = {\r\n        response: {\r\n          data: {\r\n            message: 'Número de telefone inválido'\r\n          }\r\n        }\r\n      };\r\n\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.reject(mockError));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      await expect(\r\n        sendVerificationCode({\r\n          userId: mockUserId,\r\n          phone: mockPhone\r\n        })\r\n      ).rejects.toThrow('Número de telefone inválido');\r\n    });\r\n\r\n    it('deve lançar erro genérico quando não houver mensagem específica', async () => {\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.reject(new Error('Network error')));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      await expect(\r\n        sendVerificationCode({\r\n          userId: mockUserId,\r\n          phone: mockPhone\r\n        })\r\n      ).rejects.toThrow('Erro ao enviar código');\r\n    });\r\n  });\r\n\r\n  describe('verifyPhone', () => {\r\n    it('deve verificar código com sucesso', async () => {\r\n      const mockResponse = {\r\n        data: {\r\n          success: true,\r\n          message: 'Telefone verificado com sucesso'\r\n        }\r\n      };\r\n\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.resolve(mockResponse as any));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      const result = await verifyPhone({\r\n        userId: mockUserId,\r\n        code: mockCode\r\n      });\r\n\r\n      expect(mockedAxios.post).toHaveBeenCalledWith(\r\n        expect.stringContaining('/sms/verify-code'),\r\n        { userId: mockUserId, code: mockCode }\r\n      );\r\n      expect(result).toEqual(mockResponse.data);\r\n    });\r\n\r\n    it('deve lançar erro quando código for inválido', async () => {\r\n      const mockError = {\r\n        response: {\r\n          data: {\r\n            message: 'Código expirado'\r\n          }\r\n        }\r\n      };\r\n\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.reject(mockError));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      await expect(\r\n        verifyPhone({\r\n          userId: mockUserId,\r\n          code: mockCode\r\n        })\r\n      ).rejects.toThrow('Código expirado');\r\n    });\r\n\r\n    it('deve lançar erro genérico quando não houver mensagem específica', async () => {\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.reject(new Error('Network error')));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      await expect(\r\n        verifyPhone({\r\n          userId: mockUserId,\r\n          code: mockCode\r\n        })\r\n      ).rejects.toThrow('Código inválido');\r\n    });\r\n  });\r\n\r\n  describe('resendVerificationCode', () => {\r\n    it('deve reenviar código com sucesso', async () => {\r\n      const mockResponse = {\r\n        data: {\r\n          success: true,\r\n          message: 'Código reenviado com sucesso'\r\n        }\r\n      };\r\n\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.resolve(mockResponse as any));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      const result = await resendVerificationCode({\r\n        userId: mockUserId,\r\n        phone: mockPhone\r\n      });\r\n\r\n      expect(mockedAxios.post).toHaveBeenCalledWith(\r\n        expect.stringContaining('/sms/resend-code'),\r\n        { userId: mockUserId, phone: mockPhone }\r\n      );\r\n      expect(result).toEqual(mockResponse.data);\r\n    });\r\n\r\n    it('deve lançar erro quando falhar ao reenviar código', async () => {\r\n      const mockError = {\r\n        response: {\r\n          data: {\r\n            message: 'Limite de tentativas excedido'\r\n          }\r\n        }\r\n      };\r\n\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.reject(mockError));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      await expect(\r\n        resendVerificationCode({\r\n          userId: mockUserId,\r\n          phone: mockPhone\r\n        })\r\n      ).rejects.toThrow('Limite de tentativas excedido');\r\n    });\r\n  });\r\n\r\n  describe('Métodos de compatibilidade', () => {\r\n    it('verifyCode deve chamar verifyPhone', async () => {\r\n      const mockResponse = {\r\n        data: {\r\n          success: true\r\n        }\r\n      };\r\n\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.resolve(mockResponse as any));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      const result = await verifyCode({\r\n        userId: mockUserId,\r\n        code: mockCode\r\n      });\r\n\r\n      expect(mockedAxios.post).toHaveBeenCalledWith(\r\n        expect.stringContaining('/sms/verify-code'),\r\n        { userId: mockUserId, code: mockCode }\r\n      );\r\n      expect(result).toEqual(mockResponse.data);\r\n    });\r\n\r\n    it('resendCode deve chamar resendVerificationCode', async () => {\r\n      const mockResponse = {\r\n        data: {\r\n          success: true\r\n        }\r\n      };\r\n\r\n      mockedAxios.post.mockImplementationOnce(() => Promise.resolve(mockResponse as any));\r\n\r\n      // ✅ CORREÇÃO 4: Chamar a função importada DIRETAMENTE\r\n      const result = await resendCode({\r\n        userId: mockUserId,\r\n        phone: mockPhone\r\n      });\r\n\r\n      expect(mockedAxios.post).toHaveBeenCalledWith(\r\n        expect.stringContaining('/sms/resend-code'),\r\n        { userId: mockUserId, phone: mockPhone }\r\n      );\r\n      expect(result).toEqual(mockResponse.data);\r\n    });\r\n  });\r\n});\r\n\r\n"],"version":3}