ccf8ecea7243699c2fce3448297edc34
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateCNPJComplete = exports.checkCNPJExists = exports.isValidCNPJ = exports.isValidCNPJFormat = exports.cleanCNPJ = exports.formatCNPJ = void 0;
// src/utils/validateCNPJ.js
const supabaseClient_1 = require("@/lib/supabaseClient");
/**
 * Valida o formato do CNPJ (XX.XXX.XXX/XXXX-XX)
 */
const formatCNPJ = (value) => {
    // Remove tudo que não é número
    const numbers = value.replace(/\D/g, '');
    // Aplica a máscara
    if (numbers.length <= 2)
        return numbers;
    if (numbers.length <= 5)
        return `${numbers.slice(0, 2)}.${numbers.slice(2)}`;
    if (numbers.length <= 8)
        return `${numbers.slice(0, 2)}.${numbers.slice(2, 5)}.${numbers.slice(5)}`;
    if (numbers.length <= 12)
        return `${numbers.slice(0, 2)}.${numbers.slice(2, 5)}.${numbers.slice(5, 8)}/${numbers.slice(8)}`;
    return `${numbers.slice(0, 2)}.${numbers.slice(2, 5)}.${numbers.slice(5, 8)}/${numbers.slice(8, 12)}-${numbers.slice(12, 14)}`;
};
exports.formatCNPJ = formatCNPJ;
/**
 * Remove formatação do CNPJ
 */
const cleanCNPJ = (cnpj) => {
    return cnpj.replace(/\D/g, '');
};
exports.cleanCNPJ = cleanCNPJ;
/**
 * Valida se o CNPJ está no formato correto
 */
const isValidCNPJFormat = (cnpj) => {
    const cleaned = (0, exports.cleanCNPJ)(cnpj);
    return cleaned.length === 14;
};
exports.isValidCNPJFormat = isValidCNPJFormat;
/**
 * Valida o dígito verificador do CNPJ (algoritmo oficial)
 */
const isValidCNPJ = (cnpj) => {
    const cleaned = (0, exports.cleanCNPJ)(cnpj);
    if (cleaned.length !== 14)
        return false;
    // Verifica se todos os dígitos são iguais
    if (/^(\d)\1+$/.test(cleaned))
        return false;
    // Validação do primeiro dígito
    let sum = 0;
    let weight = 5;
    for (let i = 0; i < 12; i++) {
        sum += parseInt(cleaned[i]) * weight;
        weight = weight === 2 ? 9 : weight - 1;
    }
    let digit1 = sum % 11 < 2 ? 0 : 11 - (sum % 11);
    if (parseInt(cleaned[12]) !== digit1)
        return false;
    // Validação do segundo dígito
    sum = 0;
    weight = 6;
    for (let i = 0; i < 13; i++) {
        sum += parseInt(cleaned[i]) * weight;
        weight = weight === 2 ? 9 : weight - 1;
    }
    let digit2 = sum % 11 < 2 ? 0 : 11 - (sum % 11);
    return parseInt(cleaned[13]) === digit2;
};
exports.isValidCNPJ = isValidCNPJ;
/**
 * Verifica se o CNPJ já existe no banco de dados
 */
const checkCNPJExists = async (cnpj) => {
    try {
        const cleaned = (0, exports.cleanCNPJ)(cnpj);
        const { data, error } = await supabaseClient_1.supabase
            .from('partners')
            .select('id, name')
            .eq('cnpj', cleaned)
            .maybeSingle();
        if (error && error.code !== 'PGRST116') {
            console.error('Erro ao verificar CNPJ:', error);
            return { exists: false, error: error.message };
        }
        return {
            exists: data !== null,
            partner: data,
            error: null
        };
    }
    catch (error) {
        console.error('Erro ao verificar CNPJ:', error);
        return { exists: false, error: error.message };
    }
};
exports.checkCNPJExists = checkCNPJExists;
/**
 * Validação completa do CNPJ (formato + BD)
 */
const validateCNPJComplete = async (cnpj) => {
    // 1. Verifica formato
    if (!(0, exports.isValidCNPJFormat)(cnpj)) {
        return {
            valid: false,
            error: 'CNPJ deve ter 14 dígitos'
        };
    }
    // 2. Valida dígito verificador
    if (!(0, exports.isValidCNPJ)(cnpj)) {
        return {
            valid: false,
            error: 'CNPJ inválido'
        };
    }
    // 3. Verifica se já existe no BD
    const { exists, partner, error } = await (0, exports.checkCNPJExists)(cnpj);
    if (error) {
        return {
            valid: false,
            error: 'Erro ao verificar CNPJ no banco de dados'
        };
    }
    if (exists) {
        return {
            valid: false,
            error: `Este CNPJ já está cadastrado para ${partner.name}`
        };
    }
    return {
        valid: true,
        error: null
    };
};
exports.validateCNPJComplete = validateCNPJComplete;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFx1dGlsc1xcdmFsaWRhdGVDTlBKLmpzIiwibWFwcGluZ3MiOiI7OztBQUFBLDRCQUE0QjtBQUM1Qix5REFBZ0Q7QUFFaEQ7O0dBRUc7QUFDSSxNQUFNLFVBQVUsR0FBRyxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQ2xDLCtCQUErQjtJQUMvQixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztJQUV6QyxtQkFBbUI7SUFDbkIsSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUM7UUFBRSxPQUFPLE9BQU8sQ0FBQztJQUN4QyxJQUFJLE9BQU8sQ0FBQyxNQUFNLElBQUksQ0FBQztRQUFFLE9BQU8sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0UsSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUM7UUFBRSxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ3BHLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxFQUFFO1FBQUUsT0FBTyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUM1SCxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztBQUNqSSxDQUFDLENBQUM7QUFWVyxRQUFBLFVBQVUsY0FVckI7QUFFRjs7R0FFRztBQUNJLE1BQU0sU0FBUyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUU7SUFDaEMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztBQUNqQyxDQUFDLENBQUM7QUFGVyxRQUFBLFNBQVMsYUFFcEI7QUFFRjs7R0FFRztBQUNJLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRTtJQUN4QyxNQUFNLE9BQU8sR0FBRyxJQUFBLGlCQUFTLEVBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsT0FBTyxPQUFPLENBQUMsTUFBTSxLQUFLLEVBQUUsQ0FBQztBQUMvQixDQUFDLENBQUM7QUFIVyxRQUFBLGlCQUFpQixxQkFHNUI7QUFFRjs7R0FFRztBQUNJLE1BQU0sV0FBVyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUU7SUFDbEMsTUFBTSxPQUFPLEdBQUcsSUFBQSxpQkFBUyxFQUFDLElBQUksQ0FBQyxDQUFDO0lBRWhDLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxFQUFFO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFFeEMsMENBQTBDO0lBQzFDLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUU1QywrQkFBK0I7SUFDL0IsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ1osSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzVCLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDO1FBQ3JDLE1BQU0sR0FBRyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUNELElBQUksTUFBTSxHQUFHLEdBQUcsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUVoRCxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxNQUFNO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFFbkQsOEJBQThCO0lBQzlCLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDUixNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ1gsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzVCLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDO1FBQ3JDLE1BQU0sR0FBRyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUNELElBQUksTUFBTSxHQUFHLEdBQUcsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUVoRCxPQUFPLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxNQUFNLENBQUM7QUFDMUMsQ0FBQyxDQUFDO0FBN0JXLFFBQUEsV0FBVyxlQTZCdEI7QUFFRjs7R0FFRztBQUNJLE1BQU0sZUFBZSxHQUFHLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRTtJQUM1QyxJQUFJLENBQUM7UUFDSCxNQUFNLE9BQU8sR0FBRyxJQUFBLGlCQUFTLEVBQUMsSUFBSSxDQUFDLENBQUM7UUFFaEMsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxNQUFNLHlCQUFRO2FBQ25DLElBQUksQ0FBQyxVQUFVLENBQUM7YUFDaEIsTUFBTSxDQUFDLFVBQVUsQ0FBQzthQUNsQixFQUFFLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQzthQUNuQixXQUFXLEVBQUUsQ0FBQztRQUVqQixJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFVBQVUsRUFBRSxDQUFDO1lBQ3ZDLE9BQU8sQ0FBQyxLQUFLLENBQUMseUJBQXlCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDaEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqRCxDQUFDO1FBRUQsT0FBTztZQUNMLE1BQU0sRUFBRSxJQUFJLEtBQUssSUFBSTtZQUNyQixPQUFPLEVBQUUsSUFBSTtZQUNiLEtBQUssRUFBRSxJQUFJO1NBQ1osQ0FBQztJQUNKLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNoRCxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2pELENBQUM7QUFDSCxDQUFDLENBQUM7QUF4QlcsUUFBQSxlQUFlLG1CQXdCMUI7QUFFRjs7R0FFRztBQUNJLE1BQU0sb0JBQW9CLEdBQUcsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFO0lBQ2pELHNCQUFzQjtJQUN0QixJQUFJLENBQUMsSUFBQSx5QkFBaUIsRUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQzdCLE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSztZQUNaLEtBQUssRUFBRSwwQkFBMEI7U0FDbEMsQ0FBQztJQUNKLENBQUM7SUFFRCwrQkFBK0I7SUFDL0IsSUFBSSxDQUFDLElBQUEsbUJBQVcsRUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3ZCLE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSztZQUNaLEtBQUssRUFBRSxlQUFlO1NBQ3ZCLENBQUM7SUFDSixDQUFDO0lBRUQsaUNBQWlDO0lBQ2pDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLE1BQU0sSUFBQSx1QkFBZSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBRS9ELElBQUksS0FBSyxFQUFFLENBQUM7UUFDVixPQUFPO1lBQ0wsS0FBSyxFQUFFLEtBQUs7WUFDWixLQUFLLEVBQUUsMENBQTBDO1NBQ2xELENBQUM7SUFDSixDQUFDO0lBRUQsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUNYLE9BQU87WUFDTCxLQUFLLEVBQUUsS0FBSztZQUNaLEtBQUssRUFBRSxxQ0FBcUMsT0FBTyxDQUFDLElBQUksRUFBRTtTQUMzRCxDQUFDO0lBQ0osQ0FBQztJQUVELE9BQU87UUFDTCxLQUFLLEVBQUUsSUFBSTtRQUNYLEtBQUssRUFBRSxJQUFJO0tBQ1osQ0FBQztBQUNKLENBQUMsQ0FBQztBQXRDVyxRQUFBLG9CQUFvQix3QkFzQy9CIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcdXRpbHNcXHZhbGlkYXRlQ05QSi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvdXRpbHMvdmFsaWRhdGVDTlBKLmpzXHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnQC9saWIvc3VwYWJhc2VDbGllbnQnO1xyXG5cclxuLyoqXHJcbiAqIFZhbGlkYSBvIGZvcm1hdG8gZG8gQ05QSiAoWFguWFhYLlhYWC9YWFhYLVhYKVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGZvcm1hdENOUEogPSAodmFsdWUpID0+IHtcclxuICAvLyBSZW1vdmUgdHVkbyBxdWUgbsOjbyDDqSBuw7ptZXJvXHJcbiAgY29uc3QgbnVtYmVycyA9IHZhbHVlLnJlcGxhY2UoL1xcRC9nLCAnJyk7XHJcbiAgXHJcbiAgLy8gQXBsaWNhIGEgbcOhc2NhcmFcclxuICBpZiAobnVtYmVycy5sZW5ndGggPD0gMikgcmV0dXJuIG51bWJlcnM7XHJcbiAgaWYgKG51bWJlcnMubGVuZ3RoIDw9IDUpIHJldHVybiBgJHtudW1iZXJzLnNsaWNlKDAsIDIpfS4ke251bWJlcnMuc2xpY2UoMil9YDtcclxuICBpZiAobnVtYmVycy5sZW5ndGggPD0gOCkgcmV0dXJuIGAke251bWJlcnMuc2xpY2UoMCwgMil9LiR7bnVtYmVycy5zbGljZSgyLCA1KX0uJHtudW1iZXJzLnNsaWNlKDUpfWA7XHJcbiAgaWYgKG51bWJlcnMubGVuZ3RoIDw9IDEyKSByZXR1cm4gYCR7bnVtYmVycy5zbGljZSgwLCAyKX0uJHtudW1iZXJzLnNsaWNlKDIsIDUpfS4ke251bWJlcnMuc2xpY2UoNSwgOCl9LyR7bnVtYmVycy5zbGljZSg4KX1gO1xyXG4gIHJldHVybiBgJHtudW1iZXJzLnNsaWNlKDAsIDIpfS4ke251bWJlcnMuc2xpY2UoMiwgNSl9LiR7bnVtYmVycy5zbGljZSg1LCA4KX0vJHtudW1iZXJzLnNsaWNlKDgsIDEyKX0tJHtudW1iZXJzLnNsaWNlKDEyLCAxNCl9YDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZW1vdmUgZm9ybWF0YcOnw6NvIGRvIENOUEpcclxuICovXHJcbmV4cG9ydCBjb25zdCBjbGVhbkNOUEogPSAoY25waikgPT4ge1xyXG4gIHJldHVybiBjbnBqLnJlcGxhY2UoL1xcRC9nLCAnJyk7XHJcbn07XHJcblxyXG4vKipcclxuICogVmFsaWRhIHNlIG8gQ05QSiBlc3TDoSBubyBmb3JtYXRvIGNvcnJldG9cclxuICovXHJcbmV4cG9ydCBjb25zdCBpc1ZhbGlkQ05QSkZvcm1hdCA9IChjbnBqKSA9PiB7XHJcbiAgY29uc3QgY2xlYW5lZCA9IGNsZWFuQ05QSihjbnBqKTtcclxuICByZXR1cm4gY2xlYW5lZC5sZW5ndGggPT09IDE0O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFZhbGlkYSBvIGTDrWdpdG8gdmVyaWZpY2Fkb3IgZG8gQ05QSiAoYWxnb3JpdG1vIG9maWNpYWwpXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNWYWxpZENOUEogPSAoY25waikgPT4ge1xyXG4gIGNvbnN0IGNsZWFuZWQgPSBjbGVhbkNOUEooY25waik7XHJcbiAgXHJcbiAgaWYgKGNsZWFuZWQubGVuZ3RoICE9PSAxNCkgcmV0dXJuIGZhbHNlO1xyXG4gIFxyXG4gIC8vIFZlcmlmaWNhIHNlIHRvZG9zIG9zIGTDrWdpdG9zIHPDo28gaWd1YWlzXHJcbiAgaWYgKC9eKFxcZClcXDErJC8udGVzdChjbGVhbmVkKSkgcmV0dXJuIGZhbHNlO1xyXG4gIFxyXG4gIC8vIFZhbGlkYcOnw6NvIGRvIHByaW1laXJvIGTDrWdpdG9cclxuICBsZXQgc3VtID0gMDtcclxuICBsZXQgd2VpZ2h0ID0gNTtcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IDEyOyBpKyspIHtcclxuICAgIHN1bSArPSBwYXJzZUludChjbGVhbmVkW2ldKSAqIHdlaWdodDtcclxuICAgIHdlaWdodCA9IHdlaWdodCA9PT0gMiA/IDkgOiB3ZWlnaHQgLSAxO1xyXG4gIH1cclxuICBsZXQgZGlnaXQxID0gc3VtICUgMTEgPCAyID8gMCA6IDExIC0gKHN1bSAlIDExKTtcclxuICBcclxuICBpZiAocGFyc2VJbnQoY2xlYW5lZFsxMl0pICE9PSBkaWdpdDEpIHJldHVybiBmYWxzZTtcclxuICBcclxuICAvLyBWYWxpZGHDp8OjbyBkbyBzZWd1bmRvIGTDrWdpdG9cclxuICBzdW0gPSAwO1xyXG4gIHdlaWdodCA9IDY7XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMzsgaSsrKSB7XHJcbiAgICBzdW0gKz0gcGFyc2VJbnQoY2xlYW5lZFtpXSkgKiB3ZWlnaHQ7XHJcbiAgICB3ZWlnaHQgPSB3ZWlnaHQgPT09IDIgPyA5IDogd2VpZ2h0IC0gMTtcclxuICB9XHJcbiAgbGV0IGRpZ2l0MiA9IHN1bSAlIDExIDwgMiA/IDAgOiAxMSAtIChzdW0gJSAxMSk7XHJcbiAgXHJcbiAgcmV0dXJuIHBhcnNlSW50KGNsZWFuZWRbMTNdKSA9PT0gZGlnaXQyO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFZlcmlmaWNhIHNlIG8gQ05QSiBqw6EgZXhpc3RlIG5vIGJhbmNvIGRlIGRhZG9zXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgY2hlY2tDTlBKRXhpc3RzID0gYXN5bmMgKGNucGopID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgY2xlYW5lZCA9IGNsZWFuQ05QSihjbnBqKTtcclxuICAgIFxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3BhcnRuZXJzJylcclxuICAgICAgLnNlbGVjdCgnaWQsIG5hbWUnKVxyXG4gICAgICAuZXEoJ2NucGonLCBjbGVhbmVkKVxyXG4gICAgICAubWF5YmVTaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yICYmIGVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyB2ZXJpZmljYXIgQ05QSjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IGV4aXN0czogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGV4aXN0czogZGF0YSAhPT0gbnVsbCxcclxuICAgICAgcGFydG5lcjogZGF0YSxcclxuICAgICAgZXJyb3I6IG51bGxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gdmVyaWZpY2FyIENOUEo6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHsgZXhpc3RzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogVmFsaWRhw6fDo28gY29tcGxldGEgZG8gQ05QSiAoZm9ybWF0byArIEJEKVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlQ05QSkNvbXBsZXRlID0gYXN5bmMgKGNucGopID0+IHtcclxuICAvLyAxLiBWZXJpZmljYSBmb3JtYXRvXHJcbiAgaWYgKCFpc1ZhbGlkQ05QSkZvcm1hdChjbnBqKSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdmFsaWQ6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ0NOUEogZGV2ZSB0ZXIgMTQgZMOtZ2l0b3MnXHJcbiAgICB9O1xyXG4gIH1cclxuICBcclxuICAvLyAyLiBWYWxpZGEgZMOtZ2l0byB2ZXJpZmljYWRvclxyXG4gIGlmICghaXNWYWxpZENOUEooY25waikpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdDTlBKIGludsOhbGlkbydcclxuICAgIH07XHJcbiAgfVxyXG4gIFxyXG4gIC8vIDMuIFZlcmlmaWNhIHNlIGrDoSBleGlzdGUgbm8gQkRcclxuICBjb25zdCB7IGV4aXN0cywgcGFydG5lciwgZXJyb3IgfSA9IGF3YWl0IGNoZWNrQ05QSkV4aXN0cyhjbnBqKTtcclxuICBcclxuICBpZiAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdFcnJvIGFvIHZlcmlmaWNhciBDTlBKIG5vIGJhbmNvIGRlIGRhZG9zJ1xyXG4gICAgfTtcclxuICB9XHJcbiAgXHJcbiAgaWYgKGV4aXN0cykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdmFsaWQ6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogYEVzdGUgQ05QSiBqw6EgZXN0w6EgY2FkYXN0cmFkbyBwYXJhICR7cGFydG5lci5uYW1lfWBcclxuICAgIH07XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiB7XHJcbiAgICB2YWxpZDogdHJ1ZSxcclxuICAgIGVycm9yOiBudWxsXHJcbiAgfTtcclxufTsiXSwidmVyc2lvbiI6M30=