{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\utils\\validateCNPJ.js","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\utils\\validateCNPJ.js"],"sourcesContent":["// src/utils/validateCNPJ.js\r\nimport { supabase } from '@/lib/supabaseClient';\r\n\r\n/**\r\n * Valida o formato do CNPJ (XX.XXX.XXX/XXXX-XX)\r\n */\r\nexport const formatCNPJ = (value) => {\r\n  // Remove tudo que não é número\r\n  const numbers = value.replace(/\\D/g, '');\r\n  \r\n  // Aplica a máscara\r\n  if (numbers.length <= 2) return numbers;\r\n  if (numbers.length <= 5) return `${numbers.slice(0, 2)}.${numbers.slice(2)}`;\r\n  if (numbers.length <= 8) return `${numbers.slice(0, 2)}.${numbers.slice(2, 5)}.${numbers.slice(5)}`;\r\n  if (numbers.length <= 12) return `${numbers.slice(0, 2)}.${numbers.slice(2, 5)}.${numbers.slice(5, 8)}/${numbers.slice(8)}`;\r\n  return `${numbers.slice(0, 2)}.${numbers.slice(2, 5)}.${numbers.slice(5, 8)}/${numbers.slice(8, 12)}-${numbers.slice(12, 14)}`;\r\n};\r\n\r\n/**\r\n * Remove formatação do CNPJ\r\n */\r\nexport const cleanCNPJ = (cnpj) => {\r\n  return cnpj.replace(/\\D/g, '');\r\n};\r\n\r\n/**\r\n * Valida se o CNPJ está no formato correto\r\n */\r\nexport const isValidCNPJFormat = (cnpj) => {\r\n  const cleaned = cleanCNPJ(cnpj);\r\n  return cleaned.length === 14;\r\n};\r\n\r\n/**\r\n * Valida o dígito verificador do CNPJ (algoritmo oficial)\r\n */\r\nexport const isValidCNPJ = (cnpj) => {\r\n  const cleaned = cleanCNPJ(cnpj);\r\n  \r\n  if (cleaned.length !== 14) return false;\r\n  \r\n  // Verifica se todos os dígitos são iguais\r\n  if (/^(\\d)\\1+$/.test(cleaned)) return false;\r\n  \r\n  // Validação do primeiro dígito\r\n  let sum = 0;\r\n  let weight = 5;\r\n  for (let i = 0; i < 12; i++) {\r\n    sum += parseInt(cleaned[i]) * weight;\r\n    weight = weight === 2 ? 9 : weight - 1;\r\n  }\r\n  let digit1 = sum % 11 < 2 ? 0 : 11 - (sum % 11);\r\n  \r\n  if (parseInt(cleaned[12]) !== digit1) return false;\r\n  \r\n  // Validação do segundo dígito\r\n  sum = 0;\r\n  weight = 6;\r\n  for (let i = 0; i < 13; i++) {\r\n    sum += parseInt(cleaned[i]) * weight;\r\n    weight = weight === 2 ? 9 : weight - 1;\r\n  }\r\n  let digit2 = sum % 11 < 2 ? 0 : 11 - (sum % 11);\r\n  \r\n  return parseInt(cleaned[13]) === digit2;\r\n};\r\n\r\n/**\r\n * Verifica se o CNPJ já existe no banco de dados\r\n */\r\nexport const checkCNPJExists = async (cnpj) => {\r\n  try {\r\n    const cleaned = cleanCNPJ(cnpj);\r\n    \r\n    const { data, error } = await supabase\r\n      .from('partners')\r\n      .select('id, name')\r\n      .eq('cnpj', cleaned)\r\n      .maybeSingle();\r\n    \r\n    if (error && error.code !== 'PGRST116') {\r\n      console.error('Erro ao verificar CNPJ:', error);\r\n      return { exists: false, error: error.message };\r\n    }\r\n    \r\n    return {\r\n      exists: data !== null,\r\n      partner: data,\r\n      error: null\r\n    };\r\n  } catch (error) {\r\n    console.error('Erro ao verificar CNPJ:', error);\r\n    return { exists: false, error: error.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Validação completa do CNPJ (formato + BD)\r\n */\r\nexport const validateCNPJComplete = async (cnpj) => {\r\n  // 1. Verifica formato\r\n  if (!isValidCNPJFormat(cnpj)) {\r\n    return {\r\n      valid: false,\r\n      error: 'CNPJ deve ter 14 dígitos'\r\n    };\r\n  }\r\n  \r\n  // 2. Valida dígito verificador\r\n  if (!isValidCNPJ(cnpj)) {\r\n    return {\r\n      valid: false,\r\n      error: 'CNPJ inválido'\r\n    };\r\n  }\r\n  \r\n  // 3. Verifica se já existe no BD\r\n  const { exists, partner, error } = await checkCNPJExists(cnpj);\r\n  \r\n  if (error) {\r\n    return {\r\n      valid: false,\r\n      error: 'Erro ao verificar CNPJ no banco de dados'\r\n    };\r\n  }\r\n  \r\n  if (exists) {\r\n    return {\r\n      valid: false,\r\n      error: `Este CNPJ já está cadastrado para ${partner.name}`\r\n    };\r\n  }\r\n  \r\n  return {\r\n    valid: true,\r\n    error: null\r\n  };\r\n};"],"version":3}