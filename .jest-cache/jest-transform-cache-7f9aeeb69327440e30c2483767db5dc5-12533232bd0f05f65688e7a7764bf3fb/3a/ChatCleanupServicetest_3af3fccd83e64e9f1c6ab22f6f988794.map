{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\ChatCleanupService.test.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\ChatCleanupService.test.ts"],"sourcesContent":["/* eslint-env jest */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// @ts-nocheck\r\nimport { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';\r\n\r\n// Mock do supabase\r\njest.mock('@/lib/supabaseClient', () => ({\r\n  supabase: {\r\n    from: jest.fn(),\r\n  },\r\n}));\r\n\r\ndescribe('ChatCleanupService', () => {\r\n  let ChatCleanupService: any;\r\n  let supabase: any;\r\n\r\n  beforeAll(async () => {\r\n    const supabaseModule = await import('@/lib/supabaseClient');\r\n    supabase = supabaseModule.supabase;\r\n\r\n    const serviceModule = await import('./ChatCleanupService');\r\n    ChatCleanupService = serviceModule.default;\r\n  });\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    jest.spyOn(console, 'log').mockImplementation(() => {});\r\n    jest.spyOn(console, 'error').mockImplementation(() => {});\r\n    jest.spyOn(console, 'warn').mockImplementation(() => {});\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.restoreAllMocks();\r\n  });\r\n\r\n  describe('cleanupOldMessages', () => {\r\n    it('deve retornar 0 quando não há eventos antigos', async () => {\r\n      const mockFrom = jest.fn().mockReturnValue({\r\n        select: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockReturnValue({\r\n            lt: jest.fn().mockResolvedValue({\r\n              data: [],\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        }),\r\n      });\r\n\r\n      supabase.from = mockFrom;\r\n\r\n      const result = await ChatCleanupService.cleanupOldMessages();\r\n\r\n      expect(result.deleted).toBe(0);\r\n      expect(result.error).toBeUndefined();\r\n      expect(mockFrom).toHaveBeenCalledWith('events');\r\n    });\r\n\r\n    it('deve deletar mensagens de eventos antigos', async () => {\r\n      const mockEvents = [\r\n        { id: 'event-1', status: 'Concluído', updated_at: '2023-01-01' },\r\n        { id: 'event-2', status: 'Concluído', updated_at: '2023-01-02' },\r\n      ];\r\n\r\n      const mockMessages1 = [\r\n        { id: 'msg-1' },\r\n        { id: 'msg-2' },\r\n      ];\r\n\r\n      const mockMessages2 = [\r\n        { id: 'msg-3' },\r\n      ];\r\n\r\n      const mockFromEvents = jest.fn().mockReturnValue({\r\n        select: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockReturnValue({\r\n            lt: jest.fn().mockResolvedValue({\r\n              data: mockEvents,\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        }),\r\n      });\r\n\r\n      const mockFromMessages = jest.fn()\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockResolvedValue({\r\n              data: mockMessages1,\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        })\r\n        .mockReturnValueOnce({\r\n          delete: jest.fn().mockReturnValue({\r\n            in: jest.fn().mockResolvedValue({\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        })\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockResolvedValue({\r\n              data: mockMessages2,\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        })\r\n        .mockReturnValueOnce({\r\n          delete: jest.fn().mockReturnValue({\r\n            in: jest.fn().mockResolvedValue({\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        });\r\n\r\n      supabase.from = jest.fn((table: string) => {\r\n        if (table === 'events') {\r\n          return mockFromEvents(table);\r\n        }\r\n        return mockFromMessages(table);\r\n      });\r\n\r\n      const result = await ChatCleanupService.cleanupOldMessages();\r\n\r\n      expect(result.deleted).toBe(3);\r\n      expect(result.error).toBeUndefined();\r\n    });\r\n\r\n    it('deve tratar erro ao buscar eventos', async () => {\r\n      const mockFrom = jest.fn().mockReturnValue({\r\n        select: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockReturnValue({\r\n            lt: jest.fn().mockResolvedValue({\r\n              data: null,\r\n              error: { message: 'Database error' },\r\n            } as any),\r\n          }),\r\n        }),\r\n      });\r\n\r\n      supabase.from = mockFrom;\r\n\r\n      const result = await ChatCleanupService.cleanupOldMessages();\r\n\r\n      expect(result.deleted).toBe(0);\r\n      expect(result.error).toBeDefined();\r\n    });\r\n\r\n    it('deve continuar se houver erro ao deletar mensagens de um evento', async () => {\r\n      const mockEvents = [\r\n        { id: 'event-1', status: 'Concluído', updated_at: '2023-01-01' },\r\n        { id: 'event-2', status: 'Concluído', updated_at: '2023-01-02' },\r\n      ];\r\n\r\n      const mockMessages = [{ id: 'msg-1' }];\r\n\r\n      const mockFromEvents = jest.fn().mockReturnValue({\r\n        select: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockReturnValue({\r\n            lt: jest.fn().mockResolvedValue({\r\n              data: mockEvents,\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        }),\r\n      });\r\n\r\n      const mockFromMessages = jest.fn()\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockResolvedValue({\r\n              data: mockMessages,\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        })\r\n        .mockReturnValueOnce({\r\n          delete: jest.fn().mockReturnValue({\r\n            in: jest.fn().mockResolvedValue({\r\n              error: { message: 'Delete failed' },\r\n            } as any),\r\n          }),\r\n        })\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockResolvedValue({\r\n              data: mockMessages,\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        })\r\n        .mockReturnValueOnce({\r\n          delete: jest.fn().mockReturnValue({\r\n            in: jest.fn().mockResolvedValue({\r\n              error: null,\r\n            } as any),\r\n          }),\r\n        });\r\n\r\n      supabase.from = jest.fn((table: string) => {\r\n        if (table === 'events') {\r\n          return mockFromEvents(table);\r\n        }\r\n        return mockFromMessages(table);\r\n      });\r\n\r\n      const result = await ChatCleanupService.cleanupOldMessages();\r\n\r\n      expect(result.deleted).toBe(1);\r\n    });\r\n  });\r\n\r\n  describe('startAutoCleanup', () => {\r\n    it('deve iniciar limpeza automática e retornar intervalId', () => {\r\n      jest.spyOn(ChatCleanupService, 'cleanupOldMessages').mockResolvedValue({ deleted: 0 });\r\n      jest.useFakeTimers();\r\n\r\n      const intervalId = ChatCleanupService.startAutoCleanup();\r\n\r\n      expect(intervalId).toBeDefined();\r\n      expect(typeof intervalId).toBe('number');\r\n\r\n      jest.advanceTimersByTime(24 * 60 * 60 * 1000);\r\n\r\n      ChatCleanupService.stopAutoCleanup(intervalId);\r\n      jest.useRealTimers();\r\n    });\r\n  });\r\n\r\n  describe('stopAutoCleanup', () => {\r\n    it('deve parar a limpeza automática', () => {\r\n      jest.useFakeTimers();\r\n      const clearIntervalSpy = jest.spyOn(global, 'clearInterval');\r\n\r\n      const intervalId = 123;\r\n      ChatCleanupService.stopAutoCleanup(intervalId);\r\n\r\n      expect(clearIntervalSpy).toHaveBeenCalledWith(intervalId);\r\n\r\n      jest.useRealTimers();\r\n    });\r\n  });\r\n\r\n  describe('forceCleanup', () => {\r\n    it('deve executar limpeza imediata', async () => {\r\n      const cleanupSpy = jest.spyOn(ChatCleanupService, 'cleanupOldMessages')\r\n        .mockResolvedValue({ deleted: 5 });\r\n\r\n      const result = await ChatCleanupService.forceCleanup();\r\n\r\n      expect(cleanupSpy).toHaveBeenCalled();\r\n      expect(result.deleted).toBe(5);\r\n    });\r\n  });\r\n});"],"version":3}