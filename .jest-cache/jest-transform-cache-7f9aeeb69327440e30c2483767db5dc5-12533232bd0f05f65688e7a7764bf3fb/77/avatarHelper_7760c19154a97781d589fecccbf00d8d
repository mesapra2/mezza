f156302dccccebd0e112caba8b2b8eeb
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPartnerGalleryUrls = exports.getPartnerAvatarUrl = exports.getProfileAvatarUrl = exports.getAvatarUrl = void 0;
// src/utils/avatarHelper.js
const supabaseClient_1 = require("@/lib/supabaseClient");
/**
 * Processa avatar_url do Supabase Storage ou retorna fallback
 * @param {string} avatarUrl - URL do avatar (pode ser path do storage ou URL completa)
 * @param {string} name - Nome para fallback (username ou full_name)
 * @param {number} size - Tamanho do avatar fallback (padrÃ£o: 40)
 * @returns {string} URL processada do avatar
 */
const getAvatarUrl = (avatarUrl, name = 'U', size = 40) => {
    // Se nÃ£o tem avatar_url, retorna fallback do UI Avatars
    if (!avatarUrl) {
        return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8b5cf6&color=fff&size=${size}`;
    }
    // âœ… CORREÃ‡ÃƒO 1: Limpar URL (remover espaÃ§os/quebras)
    const cleanUrl = avatarUrl.trim();
    // âœ… CORREÃ‡ÃƒO 2: Se jÃ¡ Ã© URL completa (http/https), adiciona timestamp e retorna
    if (cleanUrl.startsWith('http://') || cleanUrl.startsWith('https://')) {
        // Adicionar timestamp para quebrar cache
        const separator = cleanUrl.includes('?') ? '&' : '?';
        return `${cleanUrl}${separator}t=${Date.now()}`;
    }
    // âœ… CORREÃ‡ÃƒO 3: Detectar bucket correto baseado no path
    let bucketName = 'avatars'; // padrÃ£o
    if (cleanUrl.includes('partner-avatars/') || cleanUrl.startsWith('partner-avatars/')) {
        bucketName = 'partner-avatars';
    }
    else if (cleanUrl.includes('partner-photos/') || cleanUrl.startsWith('partner-photos/')) {
        bucketName = 'partner-photos';
    }
    else if (cleanUrl.includes('photos/') || cleanUrl.startsWith('photos/')) {
        bucketName = 'photos';
    }
    else if (cleanUrl.includes('event-photos/') || cleanUrl.startsWith('event-photos/')) {
        bucketName = 'event-photos';
    }
    // âœ… CORREÃ‡ÃƒO 4: Tentar construir URL com tratamento de erro
    try {
        const { data } = supabaseClient_1.supabase.storage
            .from(bucketName)
            .getPublicUrl(cleanUrl);
        // Adiciona timestamp para evitar cache
        return `${data.publicUrl}?t=${Date.now()}`;
    }
    catch (error) {
        console.error('Erro ao construir URL do avatar:', error, { avatarUrl, bucketName });
        // Retornar fallback em caso de erro
        return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8b5cf6&color=fff&size=${size}`;
    }
};
exports.getAvatarUrl = getAvatarUrl;
/**
 * Processa avatar de um perfil completo (objeto com avatar_url, username, full_name)
 * @param {Object} profile - Objeto do perfil com avatar_url, username, full_name
 * @param {number} size - Tamanho do avatar fallback
 * @returns {string} URL processada do avatar
 */
const getProfileAvatarUrl = (profile, size = 40) => {
    const name = profile?.username || profile?.full_name || profile?.name || 'U';
    return (0, exports.getAvatarUrl)(profile?.avatar_url, name, size);
};
exports.getProfileAvatarUrl = getProfileAvatarUrl;
/**
 * ðŸ†• Processa avatar de um PARTNER
 * @param {Object} partner - Objeto do partner com avatar_url, name
 * @param {number} size - Tamanho do avatar fallback
 * @returns {string} URL processada do avatar
 */
const getPartnerAvatarUrl = (partner, size = 40) => {
    if (!partner) {
        return `https://ui-avatars.com/api/?name=Partner&background=8b5cf6&color=fff&size=${size}`;
    }
    const name = partner.name || 'Partner';
    // Se tem avatar_url definido, usa ele
    if (partner.avatar_url) {
        return (0, exports.getAvatarUrl)(partner.avatar_url, name, size);
    }
    // Se nÃ£o tem avatar_url mas tem photos (LEGADO), usa a primeira foto
    if (partner.photos && Array.isArray(partner.photos) && partner.photos.length > 0) {
        return (0, exports.getAvatarUrl)(partner.photos[0], name, size);
    }
    // Se nÃ£o tem nada, retorna fallback
    return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8b5cf6&color=fff&size=${size}`;
};
exports.getPartnerAvatarUrl = getPartnerAvatarUrl;
/**
 * ðŸ†• Processa galeria de fotos de um PARTNER
 * @param {Object} partner - Objeto do partner com gallery_photos
 * @returns {Array<string>} Array de URLs processadas
 */
const getPartnerGalleryUrls = (partner) => {
    if (!partner)
        return [];
    // Nova estrutura: gallery_photos
    if (partner.gallery_photos && Array.isArray(partner.gallery_photos) && partner.gallery_photos.length > 0) {
        return partner.gallery_photos.map(photo => (0, exports.getAvatarUrl)(photo, partner.name || 'Photo', 400));
    }
    // LEGADO: Se ainda usa 'photos', pega todas menos a primeira (que Ã© o avatar)
    if (partner.photos && Array.isArray(partner.photos) && partner.photos.length > 1) {
        return partner.photos.slice(1).map(photo => (0, exports.getAvatarUrl)(photo, partner.name || 'Photo', 400));
    }
    return [];
};
exports.getPartnerGalleryUrls = getPartnerGalleryUrls;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFx1dGlsc1xcYXZhdGFySGVscGVyLmpzIiwibWFwcGluZ3MiOiI7OztBQUFBLDRCQUE0QjtBQUM1Qix5REFBZ0Q7QUFFaEQ7Ozs7OztHQU1HO0FBQ0ksTUFBTSxZQUFZLEdBQUcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxHQUFHLEdBQUcsRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFLEVBQUU7SUFDL0Qsd0RBQXdEO0lBQ3hELElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNmLE9BQU8sb0NBQW9DLGtCQUFrQixDQUFDLElBQUksQ0FBQyxxQ0FBcUMsSUFBSSxFQUFFLENBQUM7SUFDakgsQ0FBQztJQUVELHFEQUFxRDtJQUNyRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7SUFFbEMsZ0ZBQWdGO0lBQ2hGLElBQUksUUFBUSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7UUFDdEUseUNBQXlDO1FBQ3pDLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQ3JELE9BQU8sR0FBRyxRQUFRLEdBQUcsU0FBUyxLQUFLLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQ2xELENBQUM7SUFFRCx3REFBd0Q7SUFDeEQsSUFBSSxVQUFVLEdBQUcsU0FBUyxDQUFDLENBQUMsU0FBUztJQUVyQyxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FBQztRQUNyRixVQUFVLEdBQUcsaUJBQWlCLENBQUM7SUFDakMsQ0FBQztTQUFNLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLFFBQVEsQ0FB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QUFPO1FBQUUsT0FBTyxFQUFFLENBQUM7SUFFeEIsaUNBQWlDO0lBQ2pDLElBQUksT0FBTyxDQUFDLGNBQWMsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxPQUFPLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUN6RyxPQUFPLE9BQU8sQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBQSxvQkFBWSxFQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2hHLENBQUM7SUFFRCw4RUFBOEU7SUFDOUUsSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQ2pGLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBQSxvQkFBWSxFQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2pHLENBQUM7SUFFRCxPQUFPLEVBQUUsQ0FBQztBQUNaLENBQUMsQ0FBQztBQWRXLFFBQUEscUJBQXFCLHlCQWNoQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXHV0aWxzXFxhdmF0YXJIZWxwZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3V0aWxzL2F2YXRhckhlbHBlci5qc1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJ0AvbGliL3N1cGFiYXNlQ2xpZW50JztcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzYSBhdmF0YXJfdXJsIGRvIFN1cGFiYXNlIFN0b3JhZ2Ugb3UgcmV0b3JuYSBmYWxsYmFja1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gYXZhdGFyVXJsIC0gVVJMIGRvIGF2YXRhciAocG9kZSBzZXIgcGF0aCBkbyBzdG9yYWdlIG91IFVSTCBjb21wbGV0YSlcclxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBOb21lIHBhcmEgZmFsbGJhY2sgKHVzZXJuYW1lIG91IGZ1bGxfbmFtZSlcclxuICogQHBhcmFtIHtudW1iZXJ9IHNpemUgLSBUYW1hbmhvIGRvIGF2YXRhciBmYWxsYmFjayAocGFkcsOjbzogNDApXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFVSTCBwcm9jZXNzYWRhIGRvIGF2YXRhclxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldEF2YXRhclVybCA9IChhdmF0YXJVcmwsIG5hbWUgPSAnVScsIHNpemUgPSA0MCkgPT4ge1xyXG4gIC8vIFNlIG7Do28gdGVtIGF2YXRhcl91cmwsIHJldG9ybmEgZmFsbGJhY2sgZG8gVUkgQXZhdGFyc1xyXG4gIGlmICghYXZhdGFyVXJsKSB7XHJcbiAgICByZXR1cm4gYGh0dHBzOi8vdWktYXZhdGFycy5jb20vYXBpLz9uYW1lPSR7ZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpfSZiYWNrZ3JvdW5kPThiNWNmNiZjb2xvcj1mZmYmc2l6ZT0ke3NpemV9YDtcclxuICB9XHJcblxyXG4gIC8vIOKchSBDT1JSRcOHw4NPIDE6IExpbXBhciBVUkwgKHJlbW92ZXIgZXNwYcOnb3MvcXVlYnJhcylcclxuICBjb25zdCBjbGVhblVybCA9IGF2YXRhclVybC50cmltKCk7XHJcblxyXG4gIC8vIOKchSBDT1JSRcOHw4NPIDI6IFNlIGrDoSDDqSBVUkwgY29tcGxldGEgKGh0dHAvaHR0cHMpLCBhZGljaW9uYSB0aW1lc3RhbXAgZSByZXRvcm5hXHJcbiAgaWYgKGNsZWFuVXJsLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBjbGVhblVybC5zdGFydHNXaXRoKCdodHRwczovLycpKSB7XHJcbiAgICAvLyBBZGljaW9uYXIgdGltZXN0YW1wIHBhcmEgcXVlYnJhciBjYWNoZVxyXG4gICAgY29uc3Qgc2VwYXJhdG9yID0gY2xlYW5VcmwuaW5jbHVkZXMoJz8nKSA/ICcmJyA6ICc/JztcclxuICAgIHJldHVybiBgJHtjbGVhblVybH0ke3NlcGFyYXRvcn10PSR7RGF0ZS5ub3coKX1gO1xyXG4gIH1cclxuXHJcbiAgLy8g4pyFIENPUlJFw4fDg08gMzogRGV0ZWN0YXIgYnVja2V0IGNvcnJldG8gYmFzZWFkbyBubyBwYXRoXHJcbiAgbGV0IGJ1Y2tldE5hbWUgPSAnYXZhdGFycyc7IC8vIHBhZHLDo29cclxuICBcclxuICBpZiAoY2xlYW5VcmwuaW5jbHVkZXMoJ3BhcnRuZXItYXZhdGFycy8nKSB8fCBjbGVhblVybC5zdGFydHNXaXRoKCdwYXJ0bmVyLWF2YXRhcnMvJykpIHtcclxuICAgIGJ1Y2tldE5hbWUgPSAncGFydG5lci1hdmF0YXJzJztcclxuICB9IGVsc2UgaWYgKGNsZWFuVXJsLmluY2x1ZGVzKCdwYXJ0bmVyLXBob3Rvcy8nKSB8fCBjbGVhblVybC5zdGFydHNXaXRoKCdwYXJ0bmVyLXBob3Rvcy8nKSkge1xyXG4gICAgYnVja2V0TmFtZSA9ICdwYXJ0bmVyLXBob3Rvcyc7XHJcbiAgfSBlbHNlIGlmIChjbGVhblVybC5pbmNsdWRlcygncGhvdG9zLycpIHx8IGNsZWFuVXJsLnN0YXJ0c1dpdGgoJ3Bob3Rvcy8nKSkge1xyXG4gICAgYnVja2V0TmFtZSA9ICdwaG90b3MnO1xyXG4gIH0gZWxzZSBpZiAoY2xlYW5VcmwuaW5jbHVkZXMoJ2V2ZW50LXBob3Rvcy8nKSB8fCBjbGVhblVybC5zdGFydHNXaXRoKCdldmVudC1waG90b3MvJykpIHtcclxuICAgIGJ1Y2tldE5hbWUgPSAnZXZlbnQtcGhvdG9zJztcclxuICB9XHJcblxyXG4gIC8vIOKchSBDT1JSRcOHw4NPIDQ6IFRlbnRhciBjb25zdHJ1aXIgVVJMIGNvbSB0cmF0YW1lbnRvIGRlIGVycm9cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKGJ1Y2tldE5hbWUpXHJcbiAgICAgIC5nZXRQdWJsaWNVcmwoY2xlYW5VcmwpO1xyXG4gICAgXHJcbiAgICAvLyBBZGljaW9uYSB0aW1lc3RhbXAgcGFyYSBldml0YXIgY2FjaGVcclxuICAgIHJldHVybiBgJHtkYXRhLnB1YmxpY1VybH0/dD0ke0RhdGUubm93KCl9YDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJybyBhbyBjb25zdHJ1aXIgVVJMIGRvIGF2YXRhcjonLCBlcnJvciwgeyBhdmF0YXJVcmwsIGJ1Y2tldE5hbWUgfSk7XHJcbiAgICAvLyBSZXRvcm5hciBmYWxsYmFjayBlbSBjYXNvIGRlIGVycm9cclxuICAgIHJldHVybiBgaHR0cHM6Ly91aS1hdmF0YXJzLmNvbS9hcGkvP25hbWU9JHtlbmNvZGVVUklDb21wb25lbnQobmFtZSl9JmJhY2tncm91bmQ9OGI1Y2Y2JmNvbG9yPWZmZiZzaXplPSR7c2l6ZX1gO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzYSBhdmF0YXIgZGUgdW0gcGVyZmlsIGNvbXBsZXRvIChvYmpldG8gY29tIGF2YXRhcl91cmwsIHVzZXJuYW1lLCBmdWxsX25hbWUpXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwcm9maWxlIC0gT2JqZXRvIGRvIHBlcmZpbCBjb20gYXZhdGFyX3VybCwgdXNlcm5hbWUsIGZ1bGxfbmFtZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gc2l6ZSAtIFRhbWFuaG8gZG8gYXZhdGFyIGZhbGxiYWNrXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFVSTCBwcm9jZXNzYWRhIGRvIGF2YXRhclxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldFByb2ZpbGVBdmF0YXJVcmwgPSAocHJvZmlsZSwgc2l6ZSA9IDQwKSA9PiB7XHJcbiAgY29uc3QgbmFtZSA9IHByb2ZpbGU/LnVzZXJuYW1lIHx8IHByb2ZpbGU/LmZ1bGxfbmFtZSB8fCBwcm9maWxlPy5uYW1lIHx8ICdVJztcclxuICByZXR1cm4gZ2V0QXZhdGFyVXJsKHByb2ZpbGU/LmF2YXRhcl91cmwsIG5hbWUsIHNpemUpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIPCfhpUgUHJvY2Vzc2EgYXZhdGFyIGRlIHVtIFBBUlRORVJcclxuICogQHBhcmFtIHtPYmplY3R9IHBhcnRuZXIgLSBPYmpldG8gZG8gcGFydG5lciBjb20gYXZhdGFyX3VybCwgbmFtZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gc2l6ZSAtIFRhbWFuaG8gZG8gYXZhdGFyIGZhbGxiYWNrXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFVSTCBwcm9jZXNzYWRhIGRvIGF2YXRhclxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldFBhcnRuZXJBdmF0YXJVcmwgPSAocGFydG5lciwgc2l6ZSA9IDQwKSA9PiB7XHJcbiAgaWYgKCFwYXJ0bmVyKSB7XHJcbiAgICByZXR1cm4gYGh0dHBzOi8vdWktYXZhdGFycy5jb20vYXBpLz9uYW1lPVBhcnRuZXImYmFja2dyb3VuZD04YjVjZjYmY29sb3I9ZmZmJnNpemU9JHtzaXplfWA7XHJcbiAgfVxyXG5cclxuICBjb25zdCBuYW1lID0gcGFydG5lci5uYW1lIHx8ICdQYXJ0bmVyJztcclxuICBcclxuICAvLyBTZSB0ZW0gYXZhdGFyX3VybCBkZWZpbmlkbywgdXNhIGVsZVxyXG4gIGlmIChwYXJ0bmVyLmF2YXRhcl91cmwpIHtcclxuICAgIHJldHVybiBnZXRBdmF0YXJVcmwocGFydG5lci5hdmF0YXJfdXJsLCBuYW1lLCBzaXplKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gU2UgbsOjbyB0ZW0gYXZhdGFyX3VybCBtYXMgdGVtIHBob3RvcyAoTEVHQURPKSwgdXNhIGEgcHJpbWVpcmEgZm90b1xyXG4gIGlmIChwYXJ0bmVyLnBob3RvcyAmJiBBcnJheS5pc0FycmF5KHBhcnRuZXIucGhvdG9zKSAmJiBwYXJ0bmVyLnBob3Rvcy5sZW5ndGggPiAwKSB7XHJcbiAgICByZXR1cm4gZ2V0QXZhdGFyVXJsKHBhcnRuZXIucGhvdG9zWzBdLCBuYW1lLCBzaXplKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gU2UgbsOjbyB0ZW0gbmFkYSwgcmV0b3JuYSBmYWxsYmFja1xyXG4gIHJldHVybiBgaHR0cHM6Ly91aS1hdmF0YXJzLmNvbS9hcGkvP25hbWU9JHtlbmNvZGVVUklDb21wb25lbnQobmFtZSl9JmJhY2tncm91bmQ9OGI1Y2Y2JmNvbG9yPWZmZiZzaXplPSR7c2l6ZX1gO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIPCfhpUgUHJvY2Vzc2EgZ2FsZXJpYSBkZSBmb3RvcyBkZSB1bSBQQVJUTkVSXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwYXJ0bmVyIC0gT2JqZXRvIGRvIHBhcnRuZXIgY29tIGdhbGxlcnlfcGhvdG9zXHJcbiAqIEByZXR1cm5zIHtBcnJheTxzdHJpbmc+fSBBcnJheSBkZSBVUkxzIHByb2Nlc3NhZGFzXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZ2V0UGFydG5lckdhbGxlcnlVcmxzID0gKHBhcnRuZXIpID0+IHtcclxuICBpZiAoIXBhcnRuZXIpIHJldHVybiBbXTtcclxuICBcclxuICAvLyBOb3ZhIGVzdHJ1dHVyYTogZ2FsbGVyeV9waG90b3NcclxuICBpZiAocGFydG5lci5nYWxsZXJ5X3Bob3RvcyAmJiBBcnJheS5pc0FycmF5KHBhcnRuZXIuZ2FsbGVyeV9waG90b3MpICYmIHBhcnRuZXIuZ2FsbGVyeV9waG90b3MubGVuZ3RoID4gMCkge1xyXG4gICAgcmV0dXJuIHBhcnRuZXIuZ2FsbGVyeV9waG90b3MubWFwKHBob3RvID0+IGdldEF2YXRhclVybChwaG90bywgcGFydG5lci5uYW1lIHx8ICdQaG90bycsIDQwMCkpO1xyXG4gIH1cclxuICBcclxuICAvLyBMRUdBRE86IFNlIGFpbmRhIHVzYSAncGhvdG9zJywgcGVnYSB0b2RhcyBtZW5vcyBhIHByaW1laXJhIChxdWUgw6kgbyBhdmF0YXIpXHJcbiAgaWYgKHBhcnRuZXIucGhvdG9zICYmIEFycmF5LmlzQXJyYXkocGFydG5lci5waG90b3MpICYmIHBhcnRuZXIucGhvdG9zLmxlbmd0aCA+IDEpIHtcclxuICAgIHJldHVybiBwYXJ0bmVyLnBob3Rvcy5zbGljZSgxKS5tYXAocGhvdG8gPT4gZ2V0QXZhdGFyVXJsKHBob3RvLCBwYXJ0bmVyLm5hbWUgfHwgJ1Bob3RvJywgNDAwKSk7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBbXTtcclxufTsiXSwidmVyc2lvbiI6M30=