{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\utils\\avatarHelper.js","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\utils\\avatarHelper.js"],"sourcesContent":["// src/utils/avatarHelper.js\r\nimport { supabase } from '@/lib/supabaseClient';\r\n\r\n/**\r\n * Processa avatar_url do Supabase Storage ou retorna fallback\r\n * @param {string} avatarUrl - URL do avatar (pode ser path do storage ou URL completa)\r\n * @param {string} name - Nome para fallback (username ou full_name)\r\n * @param {number} size - Tamanho do avatar fallback (padrÃ£o: 40)\r\n * @returns {string} URL processada do avatar\r\n */\r\nexport const getAvatarUrl = (avatarUrl, name = 'U', size = 40) => {\r\n  // Se nÃ£o tem avatar_url, retorna fallback do UI Avatars\r\n  if (!avatarUrl) {\r\n    return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8b5cf6&color=fff&size=${size}`;\r\n  }\r\n\r\n  // âœ… CORREÃ‡ÃƒO 1: Limpar URL (remover espaÃ§os/quebras)\r\n  const cleanUrl = avatarUrl.trim();\r\n\r\n  // âœ… CORREÃ‡ÃƒO 2: Se jÃ¡ Ã© URL completa (http/https), adiciona timestamp e retorna\r\n  if (cleanUrl.startsWith('http://') || cleanUrl.startsWith('https://')) {\r\n    // Adicionar timestamp para quebrar cache\r\n    const separator = cleanUrl.includes('?') ? '&' : '?';\r\n    return `${cleanUrl}${separator}t=${Date.now()}`;\r\n  }\r\n\r\n  // âœ… CORREÃ‡ÃƒO 3: Detectar bucket correto baseado no path\r\n  let bucketName = 'avatars'; // padrÃ£o\r\n  \r\n  if (cleanUrl.includes('partner-avatars/') || cleanUrl.startsWith('partner-avatars/')) {\r\n    bucketName = 'partner-avatars';\r\n  } else if (cleanUrl.includes('partner-photos/') || cleanUrl.startsWith('partner-photos/')) {\r\n    bucketName = 'partner-photos';\r\n  } else if (cleanUrl.includes('photos/') || cleanUrl.startsWith('photos/')) {\r\n    bucketName = 'photos';\r\n  } else if (cleanUrl.includes('event-photos/') || cleanUrl.startsWith('event-photos/')) {\r\n    bucketName = 'event-photos';\r\n  }\r\n\r\n  // âœ… CORREÃ‡ÃƒO 4: Tentar construir URL com tratamento de erro\r\n  try {\r\n    const { data } = supabase.storage\r\n      .from(bucketName)\r\n      .getPublicUrl(cleanUrl);\r\n    \r\n    // Adiciona timestamp para evitar cache\r\n    return `${data.publicUrl}?t=${Date.now()}`;\r\n  } catch (error) {\r\n    console.error('Erro ao construir URL do avatar:', error, { avatarUrl, bucketName });\r\n    // Retornar fallback em caso de erro\r\n    return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8b5cf6&color=fff&size=${size}`;\r\n  }\r\n};\r\n\r\n/**\r\n * Processa avatar de um perfil completo (objeto com avatar_url, username, full_name)\r\n * @param {Object} profile - Objeto do perfil com avatar_url, username, full_name\r\n * @param {number} size - Tamanho do avatar fallback\r\n * @returns {string} URL processada do avatar\r\n */\r\nexport const getProfileAvatarUrl = (profile, size = 40) => {\r\n  const name = profile?.username || profile?.full_name || profile?.name || 'U';\r\n  return getAvatarUrl(profile?.avatar_url, name, size);\r\n};\r\n\r\n/**\r\n * ðŸ†• Processa avatar de um PARTNER\r\n * @param {Object} partner - Objeto do partner com avatar_url, name\r\n * @param {number} size - Tamanho do avatar fallback\r\n * @returns {string} URL processada do avatar\r\n */\r\nexport const getPartnerAvatarUrl = (partner, size = 40) => {\r\n  if (!partner) {\r\n    return `https://ui-avatars.com/api/?name=Partner&background=8b5cf6&color=fff&size=${size}`;\r\n  }\r\n\r\n  const name = partner.name || 'Partner';\r\n  \r\n  // Se tem avatar_url definido, usa ele\r\n  if (partner.avatar_url) {\r\n    return getAvatarUrl(partner.avatar_url, name, size);\r\n  }\r\n  \r\n  // Se nÃ£o tem avatar_url mas tem photos (LEGADO), usa a primeira foto\r\n  if (partner.photos && Array.isArray(partner.photos) && partner.photos.length > 0) {\r\n    return getAvatarUrl(partner.photos[0], name, size);\r\n  }\r\n  \r\n  // Se nÃ£o tem nada, retorna fallback\r\n  return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8b5cf6&color=fff&size=${size}`;\r\n};\r\n\r\n/**\r\n * ðŸ†• Processa galeria de fotos de um PARTNER\r\n * @param {Object} partner - Objeto do partner com gallery_photos\r\n * @returns {Array<string>} Array de URLs processadas\r\n */\r\nexport const getPartnerGalleryUrls = (partner) => {\r\n  if (!partner) return [];\r\n  \r\n  // Nova estrutura: gallery_photos\r\n  if (partner.gallery_photos && Array.isArray(partner.gallery_photos) && partner.gallery_photos.length > 0) {\r\n    return partner.gallery_photos.map(photo => getAvatarUrl(photo, partner.name || 'Photo', 400));\r\n  }\r\n  \r\n  // LEGADO: Se ainda usa 'photos', pega todas menos a primeira (que Ã© o avatar)\r\n  if (partner.photos && Array.isArray(partner.photos) && partner.photos.length > 1) {\r\n    return partner.photos.slice(1).map(photo => getAvatarUrl(photo, partner.name || 'Photo', 400));\r\n  }\r\n  \r\n  return [];\r\n};"],"version":3}