f291f9bfc2bc84754923bd44c330af60
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => {
    const from = jest.fn();
    const storageFrom = jest.fn();
    return {
        supabase: {
            from,
            storage: {
                from: storageFrom
            }
        }
    };
});
// src/services/EventPhotosService.test.ts
/* eslint-disable @typescript-eslint/no-explicit-any */
// @ts-nocheck
const EventPhotosService_1 = tslib_1.__importDefault(require("./EventPhotosService"));
const supabaseClient_1 = require("../lib/supabaseClient");
describe('EventPhotosService', () => {
    const mockedSupabase = supabaseClient_1.supabase;
    // helpers de narrowing SEM acessar propriedades do outro ramo
    function assertFailure(result, message) {
        if (result.success) {
            throw new Error('expected failure but got success');
        }
        expect(result.success).toBe(false);
        if (message) {
            expect(result.error).toBe(message);
        }
    }
    function assertSuccess(result) {
        expect(result.success).toBe(true);
        if (result.success) {
            expect(result.photoUrl).toBeDefined();
        }
    }
    const makeFile = (name = 'photo.jpg', size = 1024, type = 'image/jpeg') => ({
        name,
        size,
        type
    });
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('uploadEventPhoto', () => {
        it('retorna erro quando o arquivo não é imagem', async () => {
            const file = makeFile('doc.pdf', 1000, 'application/pdf');
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'Apenas imagens são permitidas');
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('retorna erro quando o arquivo tem mais de 10MB antes do resize', async () => {
            const big = makeFile('big.jpg', 10 * 1024 * 1024 + 5);
            const result = await EventPhotosService_1.default.uploadEventPhoto(2, 'user-2', big);
            assertFailure(result, 'Arquivo muito grande (máx: 10MB)');
        });
        it('faz upload de nova foto, deleta a anterior e salva no BD', async () => {
            const file = makeFile();
            const oldPhoto = {
                id: 99,
                event_id: 1,
                user_id: 'user-1',
                photo_url: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-old.jpg',
                status: 'aprovado'
            };
            const getUserSpy = jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(oldPhoto);
            const deleteSpy = jest
                .spyOn(EventPhotosService_1.default, 'deleteEventPhoto')
                .mockResolvedValue(true);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove: jest.fn()
            });
            const insert = jest.fn().mockResolvedValue({ error: null });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertSuccess(result);
            if (result.success) {
                expect(result.photoUrl).toContain('event-photos/1/user-1-');
            }
            expect(getUserSpy).toHaveBeenCalledWith(1, 'user-1');
            expect(deleteSpy).toHaveBeenCalledWith(99, 'user-1');
            getUserSpy.mockRestore();
            deleteSpy.mockRestore();
        });
        it('remove o arquivo do storage se o insert no BD falhar', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            const remove = jest.fn();
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove
            });
            const insert = jest.fn().mockResolvedValue({
                error: { message: 'db error' }
            });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'db error');
            expect(remove).toHaveBeenCalled();
        });
        it('retorna erro quando o upload no storage falha', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({
                error: { message: 'storage error' }
            });
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl: jest.fn(),
                remove: jest.fn()
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(5, 'user-5', file);
            assertFailure(result, 'storage error');
        });
    });
    describe('getEventPhotos', () => {
        it('busca fotos aprovadas do evento', async () => {
            const select = jest.fn(() => ({
                eq: jest
                    .fn()
                    .mockImplementationOnce(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: [
                                {
                                    id: 1,
                                    event_id: 10,
                                    user_id: 'u1',
                                    photo_url: 'https://example.com/p1.jpg',
                                    status: 'aprovado'
                                }
                            ],
                            error: null
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toHaveLength(1);
            expect(photos[0].photo_url).toBe('https://example.com/p1.jpg');
        });
        it('retorna array vazio em caso de erro', async () => {
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: null,
                            error: { message: 'erro' }
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toEqual([]);
        });
    });
    describe('getUserPhotoForEvent', () => {
        it('retorna a foto do usuário quando existir', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 2,
                    event_id: 11,
                    user_id: 'user-1',
                    photo_url: 'https://example.com/p2.jpg',
                    status: 'aprovado'
                },
                error: null
            });
            const eq = jest.fn(() => ({ maybeSingle }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).not.toBeNull();
            expect(photo?.photo_url).toBe('https://example.com/p2.jpg');
        });
        it('retorna null em caso de erro', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'erro' }
            });
            const eq = jest.fn(() => ({ maybeSingle }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).toBeNull();
        });
    });
    describe('deleteEventPhoto', () => {
        it('retorna false se a foto não existir', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'not found' }
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
        });
        it('retorna false se não for o dono da foto', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 5,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/other.jpg',
                    user_id: 'outro-user'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('deleta do storage e do BD quando for o dono', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 7,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/user-1-123.jpg',
                    user_id: 'user-1'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            const deleteFn = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn().mockResolvedValue({ error: null })
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        select,
                        delete: deleteFn
                    };
                }
                return {};
            });
            const remove = jest.fn().mockResolvedValue({});
            mockedSupabase.storage.from.mockReturnValue({
                remove
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-1');
            expect(result).toBe(true);
            expect(mockedSupabase.storage.from).toHaveBeenCalledWith('event-photos');
            expect(remove).toHaveBeenCalledWith(['10/user-1-123.jpg']);
            expect(deleteFn).toHaveBeenCalled();
        });
    });
    describe('getPhotoStats', () => {
        it('retorna estatísticas calculadas', async () => {
            const photosSelect = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn().mockResolvedValue({
                        count: 3,
                        error: null
                    })
                }))
            }));
            const participantsSelect = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        eq: jest.fn().mockResolvedValue({
                            count: 6,
                            error: null
                        })
                    }))
                }))
            }));
            mockedSupabase.from
                .mockImplementationOnce(() => ({
                select: photosSelect
            }))
                .mockImplementationOnce(() => ({
                select: participantsSelect
            }));
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            expect(stats.totalPhotos).toBe(3);
            expect(stats.totalParticipants).toBe(6);
            expect(stats.percentageWithPhotos).toBeCloseTo(50);
        });
        it('retorna tudo 0 em caso de erro', async () => {
            mockedSupabase.from.mockReturnValue({
                select: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        eq: jest.fn(() => ({
                            eq: jest.fn().mockRejectedValue(new Error('erro'))
                        }))
                    }))
                }))
            });
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            const expected = {
                totalPhotos: 0,
                totalParticipants: 0,
                percentageWithPhotos: 0
            };
            expect(stats).toEqual(expected);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRQaG90b3NTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7O0FBVUEsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDdEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQ3ZCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUM5QixPQUFPO1FBQ0wsUUFBUSxFQUFFO1lBQ1IsSUFBSTtZQUNKLE9BQU8sRUFBRTtnQkFDUCxJQUFJLEVBQUUsV0FBVzthQUNsQjtTQUNGO0tBQ0YsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBckJILDBDQUEwQztBQUMxQyx1REFBdUQ7QUFDdkQsY0FBYztBQUNkLHNGQUk4QjtBQUM5QiwwREFBaUQ7QUFlakQsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyxNQUFNLGNBQWMsR0FBRyx5QkFLdEIsQ0FBQztJQUVGLDhEQUE4RDtJQUM5RCxTQUFTLGFBQWEsQ0FDcEIsTUFBb0IsRUFDcEIsT0FBZ0I7UUFFaEIsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDbkIsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQyxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ1osTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDckMsQ0FBQztJQUNILENBQUM7SUFFRCxTQUFTLGFBQWEsQ0FDcEIsTUFBb0I7UUFFcEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMs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Vk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRQaG90b3NTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL0V2ZW50UGhvdG9zU2VydmljZS50ZXN0LnRzXHJcbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi9cclxuLy8gQHRzLW5vY2hlY2tcclxuaW1wb3J0IEV2ZW50UGhvdG9zU2VydmljZSwge1xyXG4gIHR5cGUgRXZlbnRQaG90byxcclxuICB0eXBlIFBob3RvU3RhdHMsXHJcbiAgdHlwZSBVcGxvYWRSZXN1bHRcclxufSBmcm9tICcuL0V2ZW50UGhvdG9zU2VydmljZSc7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vbGliL3N1cGFiYXNlQ2xpZW50JztcclxuXHJcbmplc3QubW9jaygnLi4vbGliL3N1cGFiYXNlQ2xpZW50JywgKCkgPT4ge1xyXG4gIGNvbnN0IGZyb20gPSBqZXN0LmZuKCk7XHJcbiAgY29uc3Qgc3RvcmFnZUZyb20gPSBqZXN0LmZuKCk7XHJcbiAgcmV0dXJuIHtcclxuICAgIHN1cGFiYXNlOiB7XHJcbiAgICAgIGZyb20sXHJcbiAgICAgIHN0b3JhZ2U6IHtcclxuICAgICAgICBmcm9tOiBzdG9yYWdlRnJvbVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxufSk7XHJcblxyXG5kZXNjcmliZSgnRXZlbnRQaG90b3NTZXJ2aWNlJywgKCkgPT4ge1xyXG4gIGNvbnN0IG1vY2tlZFN1cGFiYXNlID0gc3VwYWJhc2UgYXMgdW5rbm93biBhcyB7XHJcbiAgICBmcm9tOiBqZXN0Lk1vY2s7XHJcbiAgICBzdG9yYWdlOiB7XHJcbiAgICAgIGZyb206IGplc3QuTW9jaztcclxuICAgIH07XHJcbiAgfTtcclxuXHJcbiAgLy8gaGVscGVycyBkZSBuYXJyb3dpbmcgU0VNIGFjZXNzYXIgcHJvcHJpZWRhZGVzIGRvIG91dHJvIHJhbW9cclxuICBmdW5jdGlvbiBhc3NlcnRGYWlsdXJlKFxyXG4gICAgcmVzdWx0OiBVcGxvYWRSZXN1bHQsXHJcbiAgICBtZXNzYWdlPzogc3RyaW5nXHJcbiAgKTogYXNzZXJ0cyByZXN1bHQgaXMgeyBzdWNjZXNzOiBmYWxzZTsgZXJyb3I6IHN0cmluZyB9IHtcclxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2V4cGVjdGVkIGZhaWx1cmUgYnV0IGdvdCBzdWNjZXNzJyk7XHJcbiAgICB9XHJcbiAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xyXG4gICAgaWYgKG1lc3NhZ2UpIHtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZShtZXNzYWdlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFzc2VydFN1Y2Nlc3MoXHJcbiAgICByZXN1bHQ6IFVwbG9hZFJlc3VsdFxyXG4gICk6IGFzc2VydHMgcmVzdWx0IGlzIHsgc3VjY2VzczogdHJ1ZTsgcGhvdG9Vcmw6IHN0cmluZyB9IHtcclxuICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICBleHBlY3QocmVzdWx0LnBob3RvVXJsKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgbWFrZUZpbGUgPSAoXHJcbiAgICBuYW1lID0gJ3Bob3RvLmpwZycsXHJcbiAgICBzaXplID0gMTAyNCxcclxuICAgIHR5cGUgPSAnaW1hZ2UvanBlZydcclxuICApOiBGaWxlID0+XHJcbiAgICAoe1xyXG4gICAgICBuYW1lLFxyXG4gICAgICBzaXplLFxyXG4gICAgICB0eXBlXHJcbiAgICB9IGFzIHVua25vd24gYXMgRmlsZSk7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd1cGxvYWRFdmVudFBob3RvJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldG9ybmEgZXJybyBxdWFuZG8gbyBhcnF1aXZvIG7Do28gw6kgaW1hZ2VtJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbWFrZUZpbGUoJ2RvYy5wZGYnLCAxMDAwLCAnYXBwbGljYXRpb24vcGRmJyk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UudXBsb2FkRXZlbnRQaG90bygxLCAndXNlci0xJywgZmlsZSk7XHJcblxyXG4gICAgICBhc3NlcnRGYWlsdXJlKHJlc3VsdCwgJ0FwZW5hcyBpbWFnZW5zIHPDo28gcGVybWl0aWRhcycpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldG9ybmEgZXJybyBxdWFuZG8gbyBhcnF1aXZvIHRlbSBtYWlzIGRlIDEwTUIgYW50ZXMgZG8gcmVzaXplJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBiaWcgPSBtYWtlRmlsZSgnYmlnLmpwZycsIDEwICogMTAyNCAqIDEwMjQgKyA1KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS51cGxvYWRFdmVudFBob3RvKDIsICd1c2VyLTInLCBiaWcpO1xyXG5cclxuICAgICAgYXNzZXJ0RmFpbHVyZShyZXN1bHQsICdBcnF1aXZvIG11aXRvIGdyYW5kZSAobcOheDogMTBNQiknKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdmYXogdXBsb2FkIGRlIG5vdmEgZm90bywgZGVsZXRhIGEgYW50ZXJpb3IgZSBzYWx2YSBubyBCRCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG1ha2VGaWxlKCk7XHJcblxyXG4gICAgICBjb25zdCBvbGRQaG90bzogRXZlbnRQaG90byA9IHtcclxuICAgICAgICBpZDogOTksXHJcbiAgICAgICAgZXZlbnRfaWQ6IDEsXHJcbiAgICAgICAgdXNlcl9pZDogJ3VzZXItMScsXHJcbiAgICAgICAgcGhvdG9fdXJsOlxyXG4gICAgICAgICAgJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL2V2ZW50LXBob3Rvcy8xL3VzZXItMS1vbGQuanBnJyxcclxuICAgICAgICBzdGF0dXM6ICdhcHJvdmFkbydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IGdldFVzZXJTcHkgPSBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50UGhvdG9zU2VydmljZSwgJ2dldFVzZXJQaG90b0ZvckV2ZW50JylcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUob2xkUGhvdG8pO1xyXG5cclxuICAgICAgY29uc3QgZGVsZXRlU3B5ID0gamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFBob3Rvc1NlcnZpY2UsICdkZWxldGVFdmVudFBob3RvJylcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XHJcblxyXG4gICAgICBjb25zdCB1cGxvYWQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgZ2V0UHVibGljVXJsID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHB1YmxpY1VybDpcclxuICAgICAgICAgICAgJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL2V2ZW50LXBob3Rvcy8xL3VzZXItMS0xMjMuanBnJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgdXBsb2FkLFxyXG4gICAgICAgIGdldFB1YmxpY1VybCxcclxuICAgICAgICByZW1vdmU6IGplc3QuZm4oKVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGluc2VydCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluc2VydFxyXG4gICAgICAgICAgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UudXBsb2FkRXZlbnRQaG90bygxLCAndXNlci0xJywgZmlsZSk7XHJcblxyXG4gICAgICBhc3NlcnRTdWNjZXNzKHJlc3VsdCk7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgIGV4cGVjdChyZXN1bHQucGhvdG9VcmwpLnRvQ29udGFpbignZXZlbnQtcGhvdG9zLzEvdXNlci0xLScpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBleHBlY3QoZ2V0VXNlclNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMSwgJ3VzZXItMScpO1xyXG4gICAgICBleHBlY3QoZGVsZXRlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg5OSwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZ2V0VXNlclNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgICBkZWxldGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZW1vdmUgbyBhcnF1aXZvIGRvIHN0b3JhZ2Ugc2UgbyBpbnNlcnQgbm8gQkQgZmFsaGFyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbWFrZUZpbGUoKTtcclxuXHJcbiAgICAgIGplc3RcclxuICAgICAgICAuc3B5T24oRXZlbnRQaG90b3NTZXJ2aWNlLCAnZ2V0VXNlclBob3RvRm9yRXZlbnQnKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuXHJcbiAgICAgIGNvbnN0IHVwbG9hZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBnZXRQdWJsaWNVcmwgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgcHVibGljVXJsOlxyXG4gICAgICAgICAgICAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvZXZlbnQtcGhvdG9zLzEvdXNlci0xLTEyMy5qcGcnXHJcbiAgICAgICAgfVxyXG4gICAgICB9KSk7XHJcbiAgICAgIGNvbnN0IHJlbW92ZSA9IGplc3QuZm4oKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVwbG9hZCxcclxuICAgICAgICBnZXRQdWJsaWNVcmwsXHJcbiAgICAgICAgcmVtb3ZlXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgaW5zZXJ0ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnZGIgZXJyb3InIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluc2VydFxyXG4gICAgICAgICAgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UudXBsb2FkRXZlbnRQaG90bygxLCAndXNlci0xJywgZmlsZSk7XHJcblxyXG4gICAgICBhc3NlcnRGYWlsdXJlKHJlc3VsdCwgJ2RiIGVycm9yJyk7XHJcbiAgICAgIGV4cGVjdChyZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGVycm8gcXVhbmRvIG8gdXBsb2FkIG5vIHN0b3JhZ2UgZmFsaGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBtYWtlRmlsZSgpO1xyXG5cclxuICAgICAgamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFBob3Rvc1NlcnZpY2UsICdnZXRVc2VyUGhvdG9Gb3JFdmVudCcpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgY29uc3QgdXBsb2FkID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnc3RvcmFnZSBlcnJvcicgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVwbG9hZCxcclxuICAgICAgICBnZXRQdWJsaWNVcmw6IGplc3QuZm4oKSxcclxuICAgICAgICByZW1vdmU6IGplc3QuZm4oKVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS51cGxvYWRFdmVudFBob3RvKDUsICd1c2VyLTUnLCBmaWxlKTtcclxuXHJcbiAgICAgIGFzc2VydEZhaWx1cmUocmVzdWx0LCAnc3RvcmFnZSBlcnJvcicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRFdmVudFBob3RvcycsICgpID0+IHtcclxuICAgIGl0KCdidXNjYSBmb3RvcyBhcHJvdmFkYXMgZG8gZXZlbnRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3RcclxuICAgICAgICAgIC5mbigpXHJcbiAgICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgIG9yZGVyOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgZGF0YTogW1xyXG4gICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRfaWQ6IDEwLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfaWQ6ICd1MScsXHJcbiAgICAgICAgICAgICAgICAgICAgcGhvdG9fdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9wMS5qcGcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2Fwcm92YWRvJ1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgIH0pKVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7IHNlbGVjdCB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7fSBhcyB1bmtub3duO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHBob3RvcyA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRFdmVudFBob3RvcygxMCk7XHJcblxyXG4gICAgICBleHBlY3QocGhvdG9zKS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgIGV4cGVjdChwaG90b3NbMF0ucGhvdG9fdXJsKS50b0JlKCdodHRwczovL2V4YW1wbGUuY29tL3AxLmpwZycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldG9ybmEgYXJyYXkgdmF6aW8gZW0gY2FzbyBkZSBlcnJvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIG9yZGVyOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ2Vycm8nIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0XHJcbiAgICAgIH0gYXMgdW5rbm93bik7XHJcblxyXG4gICAgICBjb25zdCBwaG90b3MgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0RXZlbnRQaG90b3MoMTApO1xyXG5cclxuICAgICAgZXhwZWN0KHBob3RvcykudG9FcXVhbChbXSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFVzZXJQaG90b0ZvckV2ZW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldG9ybmEgYSBmb3RvIGRvIHVzdcOhcmlvIHF1YW5kbyBleGlzdGlyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXliZVNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgaWQ6IDIsXHJcbiAgICAgICAgICBldmVudF9pZDogMTEsXHJcbiAgICAgICAgICB1c2VyX2lkOiAndXNlci0xJyxcclxuICAgICAgICAgIHBob3RvX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcDIuanBnJyxcclxuICAgICAgICAgIHN0YXR1czogJ2Fwcm92YWRvJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGVxID0gamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHsgZXEgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzZWxlY3QgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBwaG90byA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRVc2VyUGhvdG9Gb3JFdmVudCgxMSwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHBob3RvKS5ub3QudG9CZU51bGwoKTtcclxuICAgICAgZXhwZWN0KHBob3RvPy5waG90b191cmwpLnRvQmUoJ2h0dHBzOi8vZXhhbXBsZS5jb20vcDIuanBnJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBudWxsIGVtIGNhc28gZGUgZXJybycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWF5YmVTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ2Vycm8nIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGVxID0gamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHsgZXEgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcGhvdG8gPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0VXNlclBob3RvRm9yRXZlbnQoMTEsICd1c2VyLTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChwaG90bykudG9CZU51bGwoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGVsZXRlRXZlbnRQaG90bycsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGZhbHNlIHNlIGEgZm90byBuw6NvIGV4aXN0aXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1heWJlU2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdub3QgZm91bmQnIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzZWxlY3QgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZGVsZXRlRXZlbnRQaG90bygxMCwgJ3VzZXIteCcpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBmYWxzZSBzZSBuw6NvIGZvciBvIGRvbm8gZGEgZm90bycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWF5YmVTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIGlkOiA1LFxyXG4gICAgICAgICAgcGhvdG9fdXJsOlxyXG4gICAgICAgICAgICAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvZXZlbnQtcGhvdG9zLzEwL290aGVyLmpwZycsXHJcbiAgICAgICAgICB1c2VyX2lkOiAnb3V0cm8tdXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBzZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHsgbWF5YmVTaW5nbGUgfSkpXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBzZWxlY3RcclxuICAgICAgfSBhcyB1bmtub3duKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5kZWxldGVFdmVudFBob3RvKDEwLCAndXNlci14Jyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWxldGEgZG8gc3RvcmFnZSBlIGRvIEJEIHF1YW5kbyBmb3IgbyBkb25vJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXliZVNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgaWQ6IDcsXHJcbiAgICAgICAgICBwaG90b191cmw6XHJcbiAgICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMTAvdXNlci0xLTEyMy5qcGcnLFxyXG4gICAgICAgICAgdXNlcl9pZDogJ3VzZXItMSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBzZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHsgbWF5YmVTaW5nbGUgfSkpXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IGRlbGV0ZUZuID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZWxlY3QsXHJcbiAgICAgICAgICAgIGRlbGV0ZTogZGVsZXRlRm5cclxuICAgICAgICAgIH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVtb3ZlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHJlbW92ZVxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmRlbGV0ZUV2ZW50UGhvdG8oMTAsICd1c2VyLTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudC1waG90b3MnKTtcclxuICAgICAgZXhwZWN0KHJlbW92ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoWycxMC91c2VyLTEtMTIzLmpwZyddKTtcclxuICAgICAgZXhwZWN0KGRlbGV0ZUZuKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFBob3RvU3RhdHMnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0b3JuYSBlc3RhdMOtc3RpY2FzIGNhbGN1bGFkYXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBob3Rvc1NlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgICAgIGNvdW50OiAzLFxyXG4gICAgICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgcGFydGljaXBhbnRzU2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICBjb3VudDogNixcclxuICAgICAgICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSkpXHJcbiAgICAgICAgfSkpXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb21cclxuICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgICAgc2VsZWN0OiBwaG90b3NTZWxlY3RcclxuICAgICAgICB9KSlcclxuICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgICAgc2VsZWN0OiBwYXJ0aWNpcGFudHNTZWxlY3RcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRQaG90b1N0YXRzKDUwKTtcclxuXHJcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFBob3RvcykudG9CZSgzKTtcclxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUGFydGljaXBhbnRzKS50b0JlKDYpO1xyXG4gICAgICBleHBlY3Qoc3RhdHMucGVyY2VudGFnZVdpdGhQaG90b3MpLnRvQmVDbG9zZVRvKDUwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIHR1ZG8gMCBlbSBjYXNvIGRlIGVycm8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ2Vycm8nKSlcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgICB9KSlcclxuICAgICAgfSBhcyB1bmtub3duKTtcclxuXHJcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldFBob3RvU3RhdHMoNTApO1xyXG5cclxuICAgICAgY29uc3QgZXhwZWN0ZWQ6IFBob3RvU3RhdHMgPSB7XHJcbiAgICAgICAgdG90YWxQaG90b3M6IDAsXHJcbiAgICAgICAgdG90YWxQYXJ0aWNpcGFudHM6IDAsXHJcbiAgICAgICAgcGVyY2VudGFnZVdpdGhQaG90b3M6IDBcclxuICAgICAgfTtcclxuICAgICAgZXhwZWN0KHN0YXRzKS50b0VxdWFsKGV4cGVjdGVkKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=