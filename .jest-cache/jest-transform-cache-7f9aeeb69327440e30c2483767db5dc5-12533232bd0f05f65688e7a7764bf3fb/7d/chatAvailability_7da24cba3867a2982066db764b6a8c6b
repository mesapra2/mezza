83230188a35a7da92db6d1573faf8204
"use strict";
// src/utils/chatAvailability.js
Object.defineProperty(exports, "__esModule", { value: true });
exports.isChatAvailable = void 0;
const isChatAvailable = (event, isCreator, isApprovedParticipant) => {
    if (!event) {
        return {
            available: false,
            reason: 'Evento não encontrado.'
        };
    }
    // Criador sempre tem acesso ao chat
    if (isCreator) {
        return {
            available: true,
            reason: null
        };
    }
    // Para eventos institucionais, qualquer participante aprovado pode acessar
    if (event.event_type === 'institucional') {
        if (isApprovedParticipant) {
            return {
                available: true,
                reason: null
            };
        }
        return {
            available: false,
            reason: 'Você precisa ser aprovado para acessar o chat deste evento institucional.'
        };
    }
    // Para eventos normais (não institucionais)
    if (!isApprovedParticipant) {
        return {
            available: false,
            reason: 'Você precisa ser um participante aprovado para acessar o chat.'
        };
    }
    // Verifica se todas as vagas foram preenchidas ou se o evento foi confirmado
    const allVacasPreenchidas = event.approvedCount >= event.vagas;
    const eventConfirmado = event.status === 'Confirmado' || event.status === 'Em andamento';
    if (!allVacasPreenchidas && !eventConfirmado) {
        return {
            available: false,
            reason: `Aguardando ${event.vagas - event.approvedCount} participante(s) ou confirmação do evento para liberar o chat.`
        };
    }
    return {
        available: true,
        reason: null
    };
};
exports.isChatAvailable = isChatAvailable;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFx1dGlsc1xcY2hhdEF2YWlsYWJpbGl0eS5qcyIsIm1hcHBpbmdzIjoiO0FBQUEsZ0NBQWdDOzs7QUFFekIsTUFBTSxlQUFlLEdBQUcsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLHFCQUFxQixFQUFFLEVBQUU7SUFDekUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ1gsT0FBTztZQUNMLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLE1BQU0sRUFBRSx3QkFBd0I7U0FDakMsQ0FBQztJQUNKLENBQUM7SUFFRCxvQ0FBb0M7SUFDcEMsSUFBSSxTQUFTLEVBQUUsQ0FBQztRQUNkLE9BQU87WUFDTCxTQUFTLEVBQUUsSUFBSTtZQUNmLE1BQU0sRUFBRSxJQUFJO1NBQ2IsQ0FBQztJQUNKLENBQUM7SUFFRCwyRUFBMkU7SUFDM0UsSUFBSSxLQUFLLENBQUMsVUFBVSxLQUFLLGVBQWUsRUFBRSxDQUFDO1FBQ3pDLElBQUkscUJBQXFCLEVBQUUsQ0FBQztZQUMxQixPQUFPO2dCQUNMLFNBQVMsRUFBRSxJQUFJO2dCQUNmLE1BQU0sRUFBRSxJQUFJO2FBQ2IsQ0FBQztRQUNKLENBQUM7UUFDRCxPQUFPO1lBQ0wsU0FBUyxFQUFFLEtBQUs7WUFDaEIsTUFBTSxFQUFFLDJFQUEyRTtTQUNwRixDQUFDO0lBQ0osQ0FBQztJQUVELDRDQUE0QztJQUM1QyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUMzQixPQUFPO1lBQ0wsU0FBUyxFQUFFLEtBQUs7WUFDaEIsTUFBTSxFQUFFLGdFQUFnRTtTQUN6RSxDQUFDO0lBQ0osQ0FBQztJQUVELDZFQUE2RTtJQUM3RSxNQUFNLG1CQUFtQixHQUFHLEtBQUssQ0FBQyxhQUFhLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQztJQUMvRCxNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsTUFBTSxLQUFLLFlBQVksSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLGNBQWMsQ0FBQztJQUV6RixJQUFJLENBQUMsbUJBQW1CLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUM3QyxPQUFPO1lBQ0wsU0FBUyxFQUFFLEtBQUs7WUFDaEIsTUFBTSxFQUFFLGNBQWMsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsYUFBYSxnRUFBZ0U7U0FDeEgsQ0FBQztJQUNKLENBQUM7SUFFRCxPQUFPO1FBQ0wsU0FBUyxFQUFFLElBQUk7UUFDZixNQUFNLEVBQUUsSUFBSTtLQUNiLENBQUM7QUFDSixDQUFDLENBQUM7QUFyRFcsUUFBQSxlQUFlLG1CQXFEMUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFx1dGlsc1xcY2hhdEF2YWlsYWJpbGl0eS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvdXRpbHMvY2hhdEF2YWlsYWJpbGl0eS5qc1xyXG5cclxuZXhwb3J0IGNvbnN0IGlzQ2hhdEF2YWlsYWJsZSA9IChldmVudCwgaXNDcmVhdG9yLCBpc0FwcHJvdmVkUGFydGljaXBhbnQpID0+IHtcclxuICBpZiAoIWV2ZW50KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhdmFpbGFibGU6IGZhbHNlLFxyXG4gICAgICByZWFzb246ICdFdmVudG8gbsOjbyBlbmNvbnRyYWRvLidcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBDcmlhZG9yIHNlbXByZSB0ZW0gYWNlc3NvIGFvIGNoYXRcclxuICBpZiAoaXNDcmVhdG9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhdmFpbGFibGU6IHRydWUsXHJcbiAgICAgIHJlYXNvbjogbnVsbFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIFBhcmEgZXZlbnRvcyBpbnN0aXR1Y2lvbmFpcywgcXVhbHF1ZXIgcGFydGljaXBhbnRlIGFwcm92YWRvIHBvZGUgYWNlc3NhclxyXG4gIGlmIChldmVudC5ldmVudF90eXBlID09PSAnaW5zdGl0dWNpb25hbCcpIHtcclxuICAgIGlmIChpc0FwcHJvdmVkUGFydGljaXBhbnQpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBhdmFpbGFibGU6IHRydWUsXHJcbiAgICAgICAgcmVhc29uOiBudWxsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhdmFpbGFibGU6IGZhbHNlLFxyXG4gICAgICByZWFzb246ICdWb2PDqiBwcmVjaXNhIHNlciBhcHJvdmFkbyBwYXJhIGFjZXNzYXIgbyBjaGF0IGRlc3RlIGV2ZW50byBpbnN0aXR1Y2lvbmFsLidcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBQYXJhIGV2ZW50b3Mgbm9ybWFpcyAobsOjbyBpbnN0aXR1Y2lvbmFpcylcclxuICBpZiAoIWlzQXBwcm92ZWRQYXJ0aWNpcGFudCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYXZhaWxhYmxlOiBmYWxzZSxcclxuICAgICAgcmVhc29uOiAnVm9jw6ogcHJlY2lzYSBzZXIgdW0gcGFydGljaXBhbnRlIGFwcm92YWRvIHBhcmEgYWNlc3NhciBvIGNoYXQuJ1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIFZlcmlmaWNhIHNlIHRvZGFzIGFzIHZhZ2FzIGZvcmFtIHByZWVuY2hpZGFzIG91IHNlIG8gZXZlbnRvIGZvaSBjb25maXJtYWRvXHJcbiAgY29uc3QgYWxsVmFjYXNQcmVlbmNoaWRhcyA9IGV2ZW50LmFwcHJvdmVkQ291bnQgPj0gZXZlbnQudmFnYXM7XHJcbiAgY29uc3QgZXZlbnRDb25maXJtYWRvID0gZXZlbnQuc3RhdHVzID09PSAnQ29uZmlybWFkbycgfHwgZXZlbnQuc3RhdHVzID09PSAnRW0gYW5kYW1lbnRvJztcclxuXHJcbiAgaWYgKCFhbGxWYWNhc1ByZWVuY2hpZGFzICYmICFldmVudENvbmZpcm1hZG8pIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGF2YWlsYWJsZTogZmFsc2UsXHJcbiAgICAgIHJlYXNvbjogYEFndWFyZGFuZG8gJHtldmVudC52YWdhcyAtIGV2ZW50LmFwcHJvdmVkQ291bnR9IHBhcnRpY2lwYW50ZShzKSBvdSBjb25maXJtYcOnw6NvIGRvIGV2ZW50byBwYXJhIGxpYmVyYXIgbyBjaGF0LmBcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgYXZhaWxhYmxlOiB0cnVlLFxyXG4gICAgcmVhc29uOiBudWxsXHJcbiAgfTtcclxufTsiXSwidmVyc2lvbiI6M30=