0e2c656e453cbab0e41511c32bfdde45
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.register = register;
exports.login = login;
exports.getCurrentUser = getCurrentUser;
exports.updateProfile = updateProfile;
exports.logout = logout;
exports.sendVerificationCode = sendVerificationCode;
exports.verifyPhone = verifyPhone;
exports.resendVerificationCode = resendVerificationCode;
exports.verifyCode = verifyCode;
exports.resendCode = resendCode;
const tslib_1 = require("tslib");
// src/services/authService.ts
const axios_1 = tslib_1.__importDefault(require("axios"));
/* -------------------------------------------------------------------------- */
/*                            CONFIGURAÇÃO DE URL                             */
/* -------------------------------------------------------------------------- */
function getApiUrl() {
    // 1) tenta pegar do Vite (import.meta.env.VITE_API_URL)
    let fromVite;
    // Verifica se import.meta existe (Vite/browser)
    try {
        // @ts-ignore - import.meta só existe em ambiente ESM
        if (typeof import.meta !== 'undefined' && import.meta.env) {
            // @ts-ignore
            fromVite = import.meta.env.VITE_API_URL;
        }
    }
    catch (e) {
        // import.meta não disponível (Jest/Node)
    }
    // 2) tenta pegar do process.env (Next / Node / Jest)
    const hasProcess = typeof process !== 'undefined' && typeof process.env !== 'undefined';
    const fromNextPublic = hasProcess && typeof process.env.NEXT_PUBLIC_API_URL === 'string'
        ? process.env.NEXT_PUBLIC_API_URL
        : undefined;
    const fromViteEnv = hasProcess && typeof process.env.VITE_API_URL === 'string'
        ? process.env.VITE_API_URL
        : undefined;
    // 3) fallback
    const finalUrl = fromVite || fromNextPublic || fromViteEnv || 'http://localhost:4000';
    // tira barras sobrando no final
    return finalUrl.replace(/\/+$/, '');
}
function extractAxiosMessage(err, fallback) {
    const axiosErr = err;
    const specific = axiosErr?.response?.data?.message;
    return typeof specific === 'string' ? specific : fallback;
}
/* -------------------------------------------------------------------------- */
/*                             FUNÇÕES DE AUTH BASE                           */
/* -------------------------------------------------------------------------- */
async function register(payload) {
    const API_URL = getApiUrl();
    const { data } = await axios_1.default.post(`${API_URL}/auth/register`, payload);
    return data;
}
async function login(payload) {
    const API_URL = getApiUrl();
    const { data } = await axios_1.default.post(`${API_URL}/auth/login`, payload);
    return data;
}
async function getCurrentUser(token) {
    const API_URL = getApiUrl();
    const headers = {};
    if (token) {
        headers.Authorization = `Bearer ${token}`;
    }
    const { data } = await axios_1.default.get(`${API_URL}/auth/me`, { headers });
    return data;
}
async function updateProfile(updates, token) {
    const API_URL = getApiUrl();
    const headers = {};
    if (token) {
        headers.Authorization = `Bearer ${token}`;
    }
    const { data } = await axios_1.default.put(`${API_URL}/auth/me`, updates, { headers });
    return data;
}
async function logout(token) {
    const API_URL = getApiUrl();
    const headers = {};
    if (token) {
        headers.Authorization = `Bearer ${token}`;
    }
    await axios_1.default.post(`${API_URL}/auth/logout`, {}, { headers });
}
/* -------------------------------------------------------------------------- */
/*                           FUNÇÕES DE VERIFICAÇÃO SMS                       */
/* -------------------------------------------------------------------------- */
async function sendVerificationCode({ userId, phone }) {
    const API_URL = getApiUrl();
    try {
        const { data } = await axios_1.default.post(`${API_URL}/sms/send-code`, { userId, phone });
        return data;
    }
    catch (err) {
        throw new Error(extractAxiosMessage(err, 'Erro ao enviar código'));
    }
}
async function verifyPhone({ userId, code }) {
    const API_URL = getApiUrl();
    try {
        const { data } = await axios_1.default.post(`${API_URL}/sms/verify-code`, { userId, code });
        return data;
    }
    catch (err) {
        throw new Error(extractAxiosMessage(err, 'Código inválido'));
    }
}
async function resendVerificationCode({ userId, phone }) {
    const API_URL = getApiUrl();
    try {
        const { data } = await axios_1.default.post(`${API_URL}/sms/resend-code`, { userId, phone });
        return data;
    }
    catch (err) {
        throw new Error(extractAxiosMessage(err, 'Erro ao reenviar código'));
    }
}
/* -------------------------------------------------------------------------- */
/*                          ALIAS DE COMPATIBILIDADE TESTE                    */
/* -------------------------------------------------------------------------- */
async function verifyCode(payload) {
    return verifyPhone(payload);
}
async function resendCode(payload) {
    return resendVerificationCode(payload);
}
/* -------------------------------------------------------------------------- */
/*                             EXPORTAÇÃO DEFAULT                             */
/* -------------------------------------------------------------------------- */
const authService = {
    register,
    login,
    getCurrentUser,
    updateProfile,
    logout,
    sendVerificationCode,
    verifyPhone,
    resendVerificationCode,
    verifyCode,
    resendCode
};
exports.default = authService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcYXV0aFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7QUFzR0EsNEJBSUM7QUFFRCxzQkFJQztBQUVELHdDQVFDO0FBRUQsc0NBV0M7QUFFRCx3QkFPQztBQU1ELG9EQWNDO0FBRUQsa0NBY0M7QUFFRCx3REFjQztBQU1ELGdDQUVDO0FBRUQsZ0NBRUM7O0FBaE5ELDhCQUE4QjtBQUM5QiwwREFBMEM7QUFFMUMsZ0ZBQWdGO0FBQ2hGLGdGQUFnRjtBQUNoRixnRkFBZ0Y7QUFFaEYsU0FBUyxTQUFTO0lBQ2hCLHdEQUF3RDtJQUN4RCxJQUFJLFFBQTRCLENBQUM7SUFFakMsZ0RBQWdEO0lBQ2hELElBQUksQ0FBQztRQUNILHFEQUFxRDtRQUNyRCxJQUFJLE9BQU8sTUFBTSxDQUFDLElBQUksS0FBSyxXQUFXLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUMxRCxhQUFhO1lBQ2IsUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztRQUMxQyxDQUFDO0lBQ0gsQ0FBQztJQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDWCx5Q0FBeUM7SUFDM0MsQ0FBQztJQUVELHFEQUFxRDtJQUNyRCxNQUFNLFVBQVUsR0FDZCxPQUFPLE9BQU8sS0FBSyxXQUFXLElBQUksT0FBTyxPQUFPLENBQUMsR0FBRyxLQUFLLFdBQVcsQ0FBQztJQUV2RSxNQUFNLGNBQWMsR0FDbEIsVUFBVSxJQUFJLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsS0FBSyxRQUFRO1FBQy9ELENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQjtRQUNqQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBRWhCLE1BQU0sV0FBVyxHQUNmLFVBQVUsSUFBSSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxLQUFLLFFBQVE7UUFDeEQsQ0FBQyxDQUFDLE9BQU8sQ0FB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LEVBQzVCLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUNsQixDQUFDO1FBQ0YsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDLENBQUMsQ0FBQztJQUN2RSxDQUFDO0FBQ0gsQ0FBQztBQUVELGdGQUFnRjtBQUNoRixnRkFBZ0Y7QUFDaEYsZ0ZBQWdGO0FBRXpFLEtBQUssVUFBVSxVQUFVLENBQUMsT0FBMkI7SUFDMUQsT0FBTyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDOUIsQ0FBQztBQUVNLEtBQUssVUFBVSxVQUFVLENBQUMsT0FBa0M7SUFDakUsT0FBTyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN6QyxDQUFDO0FBRUQsZ0ZBQWdGO0FBQ2hGLGdGQUFnRjtBQUNoRixnRkFBZ0Y7QUFFaEYsTUFBTSxXQUFXLEdBQUc7SUFDbEIsUUFBUTtJQUNSLEtBQUs7SUFDTCxjQUFjO0lBQ2QsYUFBYTtJQUNiLE1BQU07SUFDTixvQkFBb0I7SUFDcEIsV0FBVztJQUNYLHNCQUFzQjtJQUN0QixVQUFVO0lBQ1YsVUFBVTtDQUNYLENBQUM7QUFFRixrQkFBZSxXQUFXLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcYXV0aFNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL2F1dGhTZXJ2aWNlLnRzXHJcbmltcG9ydCBheGlvcywgeyBBeGlvc0Vycm9yIH0gZnJvbSAnYXhpb3MnO1xyXG5cclxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cclxuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09ORklHVVJBw4fDg08gREUgVVJMICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG5cclxuZnVuY3Rpb24gZ2V0QXBpVXJsKCk6IHN0cmluZyB7XHJcbiAgLy8gMSkgdGVudGEgcGVnYXIgZG8gVml0ZSAoaW1wb3J0Lm1ldGEuZW52LlZJVEVfQVBJX1VSTClcclxuICBsZXQgZnJvbVZpdGU6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICBcclxuICAvLyBWZXJpZmljYSBzZSBpbXBvcnQubWV0YSBleGlzdGUgKFZpdGUvYnJvd3NlcilcclxuICB0cnkge1xyXG4gICAgLy8gQHRzLWlnbm9yZSAtIGltcG9ydC5tZXRhIHPDsyBleGlzdGUgZW0gYW1iaWVudGUgRVNNXHJcbiAgICBpZiAodHlwZW9mIGltcG9ydC5tZXRhICE9PSAndW5kZWZpbmVkJyAmJiBpbXBvcnQubWV0YS5lbnYpIHtcclxuICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICBmcm9tVml0ZSA9IGltcG9ydC5tZXRhLmVudi5WSVRFX0FQSV9VUkw7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgLy8gaW1wb3J0Lm1ldGEgbsOjbyBkaXNwb27DrXZlbCAoSmVzdC9Ob2RlKVxyXG4gIH1cclxuXHJcbiAgLy8gMikgdGVudGEgcGVnYXIgZG8gcHJvY2Vzcy5lbnYgKE5leHQgLyBOb2RlIC8gSmVzdClcclxuICBjb25zdCBoYXNQcm9jZXNzID1cclxuICAgIHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgcHJvY2Vzcy5lbnYgIT09ICd1bmRlZmluZWQnO1xyXG5cclxuICBjb25zdCBmcm9tTmV4dFB1YmxpYyA9XHJcbiAgICBoYXNQcm9jZXNzICYmIHR5cGVvZiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUElfVVJMID09PSAnc3RyaW5nJ1xyXG4gICAgICA/IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQSV9VUkxcclxuICAgICAgOiB1bmRlZmluZWQ7XHJcblxyXG4gIGNvbnN0IGZyb21WaXRlRW52ID1cclxuICAgIGhhc1Byb2Nlc3MgJiYgdHlwZW9mIHByb2Nlc3MuZW52LlZJVEVfQVBJX1VSTCA9PT0gJ3N0cmluZydcclxuICAgICAgPyBwcm9jZXNzLmVudi5WSVRFX0FQSV9VUkxcclxuICAgICAgOiB1bmRlZmluZWQ7XHJcblxyXG4gIC8vIDMpIGZhbGxiYWNrXHJcbiAgY29uc3QgZmluYWxVcmwgPSBmcm9tVml0ZSB8fCBmcm9tTmV4dFB1YmxpYyB8fCBmcm9tVml0ZUVudiB8fCAnaHR0cDovL2xvY2FsaG9zdDo0MDAwJztcclxuXHJcbiAgLy8gdGlyYSBiYXJyYXMgc29icmFuZG8gbm8gZmluYWxcclxuICByZXR1cm4gZmluYWxVcmwucmVwbGFjZSgvXFwvKyQvLCAnJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4dHJhY3RBeGlvc01lc3NhZ2UoZXJyOiB1bmtub3duLCBmYWxsYmFjazogc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBheGlvc0VyciA9IGVyciBhcyBBeGlvc0Vycm9yPHsgbWVzc2FnZT86IHN0cmluZyB9PjtcclxuICBjb25zdCBzcGVjaWZpYyA9IGF4aW9zRXJyPy5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZTtcclxuICByZXR1cm4gdHlwZW9mIHNwZWNpZmljID09PSAnc3RyaW5nJyA/IHNwZWNpZmljIDogZmFsbGJhY2s7XHJcbn1cclxuXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcbi8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUWVBFUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcblxyXG5leHBvcnQgdHlwZSBSZWdpc3RlclBheWxvYWQgPSB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgcGFzc3dvcmQ6IHN0cmluZztcclxuICBwaG9uZT86IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIExvZ2luUGF5bG9hZCA9IHtcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIHBhc3N3b3JkOiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBTZW5kVmVyaWZpY2F0aW9uUGF5bG9hZCA9IHtcclxuICB1c2VySWQ6IHN0cmluZztcclxuICBwaG9uZTogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgVmVyaWZ5UGhvbmVQYXlsb2FkID0ge1xyXG4gIHVzZXJJZDogc3RyaW5nO1xyXG4gIGNvZGU6IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFJlc2VuZFZlcmlmaWNhdGlvblBheWxvYWQgPSB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbiAgcGhvbmU6IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEF1dGhVc2VyID0ge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgcGhvbmU/OiBzdHJpbmcgfCBudWxsO1xyXG4gIGF2YXRhcl91cmw/OiBzdHJpbmcgfCBudWxsO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgQXV0aFRva2VucyA9IHtcclxuICBhY2Nlc3NUb2tlbjogc3RyaW5nO1xyXG4gIHJlZnJlc2hUb2tlbj86IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEF1dGhSZXNwb25zZSA9IHtcclxuICB1c2VyOiBBdXRoVXNlcjtcclxuICB0b2tlbnM/OiBBdXRoVG9rZW5zO1xyXG59O1xyXG5cclxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cclxuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZVTsOHw5VFUyBERSBBVVRIIEJBU0UgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZ2lzdGVyKHBheWxvYWQ6IFJlZ2lzdGVyUGF5bG9hZCk6IFByb21pc2U8QXV0aFJlc3BvbnNlPiB7XHJcbiAgY29uc3QgQVBJX1VSTCA9IGdldEFwaVVybCgpO1xyXG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MucG9zdDxBdXRoUmVzcG9uc2U+KGAke0FQSV9VUkx9L2F1dGgvcmVnaXN0ZXJgLCBwYXlsb2FkKTtcclxuICByZXR1cm4gZGF0YTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ2luKHBheWxvYWQ6IExvZ2luUGF5bG9hZCk6IFByb21pc2U8QXV0aFJlc3BvbnNlPiB7XHJcbiAgY29uc3QgQVBJX1VSTCA9IGdldEFwaVVybCgpO1xyXG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MucG9zdDxBdXRoUmVzcG9uc2U+KGAke0FQSV9VUkx9L2F1dGgvbG9naW5gLCBwYXlsb2FkKTtcclxuICByZXR1cm4gZGF0YTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyKHRva2VuPzogc3RyaW5nKTogUHJvbWlzZTxBdXRoVXNlcj4ge1xyXG4gIGNvbnN0IEFQSV9VUkwgPSBnZXRBcGlVcmwoKTtcclxuICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XHJcbiAgaWYgKHRva2VuKSB7XHJcbiAgICBoZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgQmVhcmVyICR7dG9rZW59YDtcclxuICB9XHJcbiAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBheGlvcy5nZXQ8QXV0aFVzZXI+KGAke0FQSV9VUkx9L2F1dGgvbWVgLCB7IGhlYWRlcnMgfSk7XHJcbiAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVQcm9maWxlKFxyXG4gIHVwZGF0ZXM6IFBhcnRpYWw8QXV0aFVzZXI+LFxyXG4gIHRva2VuPzogc3RyaW5nXHJcbik6IFByb21pc2U8QXV0aFVzZXI+IHtcclxuICBjb25zdCBBUElfVVJMID0gZ2V0QXBpVXJsKCk7XHJcbiAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xyXG4gIGlmICh0b2tlbikge1xyXG4gICAgaGVhZGVycy5BdXRob3JpemF0aW9uID0gYEJlYXJlciAke3Rva2VufWA7XHJcbiAgfVxyXG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MucHV0PEF1dGhVc2VyPihgJHtBUElfVVJMfS9hdXRoL21lYCwgdXBkYXRlcywgeyBoZWFkZXJzIH0pO1xyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nb3V0KHRva2VuPzogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc3QgQVBJX1VSTCA9IGdldEFwaVVybCgpO1xyXG4gIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcclxuICBpZiAodG9rZW4pIHtcclxuICAgIGhlYWRlcnMuQXV0aG9yaXphdGlvbiA9IGBCZWFyZXIgJHt0b2tlbn1gO1xyXG4gIH1cclxuICBhd2FpdCBheGlvcy5wb3N0KGAke0FQSV9VUkx9L2F1dGgvbG9nb3V0YCwge30sIHsgaGVhZGVycyB9KTtcclxufVxyXG5cclxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cclxuLyogICAgICAgICAgICAgICAgICAgICAgICAgICBGVU7Dh8OVRVMgREUgVkVSSUZJQ0HDh8ODTyBTTVMgICAgICAgICAgICAgICAgICAgICAgICovXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFZlcmlmaWNhdGlvbkNvZGUoe1xyXG4gIHVzZXJJZCxcclxuICBwaG9uZVxyXG59OiBTZW5kVmVyaWZpY2F0aW9uUGF5bG9hZCk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nIH0+IHtcclxuICBjb25zdCBBUElfVVJMID0gZ2V0QXBpVXJsKCk7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MucG9zdDx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmcgfT4oXHJcbiAgICAgIGAke0FQSV9VUkx9L3Ntcy9zZW5kLWNvZGVgLFxyXG4gICAgICB7IHVzZXJJZCwgcGhvbmUgfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGV4dHJhY3RBeGlvc01lc3NhZ2UoZXJyLCAnRXJybyBhbyBlbnZpYXIgY8OzZGlnbycpKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlQaG9uZSh7XHJcbiAgdXNlcklkLFxyXG4gIGNvZGVcclxufTogVmVyaWZ5UGhvbmVQYXlsb2FkKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmcgfT4ge1xyXG4gIGNvbnN0IEFQSV9VUkwgPSBnZXRBcGlVcmwoKTtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBheGlvcy5wb3N0PHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZyB9PihcclxuICAgICAgYCR7QVBJX1VSTH0vc21zL3ZlcmlmeS1jb2RlYCxcclxuICAgICAgeyB1c2VySWQsIGNvZGUgfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGV4dHJhY3RBeGlvc01lc3NhZ2UoZXJyLCAnQ8OzZGlnbyBpbnbDoWxpZG8nKSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVzZW5kVmVyaWZpY2F0aW9uQ29kZSh7XHJcbiAgdXNlcklkLFxyXG4gIHBob25lXHJcbn06IFJlc2VuZFZlcmlmaWNhdGlvblBheWxvYWQpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZyB9PiB7XHJcbiAgY29uc3QgQVBJX1VSTCA9IGdldEFwaVVybCgpO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnBvc3Q8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nIH0+KFxyXG4gICAgICBgJHtBUElfVVJMfS9zbXMvcmVzZW5kLWNvZGVgLFxyXG4gICAgICB7IHVzZXJJZCwgcGhvbmUgfVxyXG4gICAgKTtcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGV4dHJhY3RBeGlvc01lc3NhZ2UoZXJyLCAnRXJybyBhbyByZWVudmlhciBjw7NkaWdvJykpO1xyXG4gIH1cclxufVxyXG5cclxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cclxuLyogICAgICAgICAgICAgICAgICAgICAgICAgIEFMSUFTIERFIENPTVBBVElCSUxJREFERSBURVNURSAgICAgICAgICAgICAgICAgICAgKi9cclxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlDb2RlKHBheWxvYWQ6IFZlcmlmeVBob25lUGF5bG9hZCkge1xyXG4gIHJldHVybiB2ZXJpZnlQaG9uZShwYXlsb2FkKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc2VuZENvZGUocGF5bG9hZDogUmVzZW5kVmVyaWZpY2F0aW9uUGF5bG9hZCkge1xyXG4gIHJldHVybiByZXNlbmRWZXJpZmljYXRpb25Db2RlKHBheWxvYWQpO1xyXG59XHJcblxyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG4vKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRVhQT1JUQcOHw4NPIERFRkFVTFQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcblxyXG5jb25zdCBhdXRoU2VydmljZSA9IHtcclxuICByZWdpc3RlcixcclxuICBsb2dpbixcclxuICBnZXRDdXJyZW50VXNlcixcclxuICB1cGRhdGVQcm9maWxlLFxyXG4gIGxvZ291dCxcclxuICBzZW5kVmVyaWZpY2F0aW9uQ29kZSxcclxuICB2ZXJpZnlQaG9uZSxcclxuICByZXNlbmRWZXJpZmljYXRpb25Db2RlLFxyXG4gIHZlcmlmeUNvZGUsXHJcbiAgcmVzZW5kQ29kZVxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXV0aFNlcnZpY2U7Il0sInZlcnNpb24iOjN9