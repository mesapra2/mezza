{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\authService.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\authService.ts"],"sourcesContent":["// src/services/authService.ts\r\nimport axios, { AxiosError } from 'axios';\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                            CONFIGURAÇÃO DE URL                             */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nfunction getApiUrl(): string {\r\n  // 1) tenta pegar do Vite (import.meta.env.VITE_API_URL)\r\n  let fromVite: string | undefined;\r\n  \r\n  // Verifica se import.meta existe (Vite/browser)\r\n  try {\r\n    // @ts-ignore - import.meta só existe em ambiente ESM\r\n    if (typeof import.meta !== 'undefined' && import.meta.env) {\r\n      // @ts-ignore\r\n      fromVite = import.meta.env.VITE_API_URL;\r\n    }\r\n  } catch (e) {\r\n    // import.meta não disponível (Jest/Node)\r\n  }\r\n\r\n  // 2) tenta pegar do process.env (Next / Node / Jest)\r\n  const hasProcess =\r\n    typeof process !== 'undefined' && typeof process.env !== 'undefined';\r\n\r\n  const fromNextPublic =\r\n    hasProcess && typeof process.env.NEXT_PUBLIC_API_URL === 'string'\r\n      ? process.env.NEXT_PUBLIC_API_URL\r\n      : undefined;\r\n\r\n  const fromViteEnv =\r\n    hasProcess && typeof process.env.VITE_API_URL === 'string'\r\n      ? process.env.VITE_API_URL\r\n      : undefined;\r\n\r\n  // 3) fallback\r\n  const finalUrl = fromVite || fromNextPublic || fromViteEnv || 'http://localhost:4000';\r\n\r\n  // tira barras sobrando no final\r\n  return finalUrl.replace(/\\/+$/, '');\r\n}\r\n\r\nfunction extractAxiosMessage(err: unknown, fallback: string): string {\r\n  const axiosErr = err as AxiosError<{ message?: string }>;\r\n  const specific = axiosErr?.response?.data?.message;\r\n  return typeof specific === 'string' ? specific : fallback;\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                                   TYPES                                    */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nexport type RegisterPayload = {\r\n  name: string;\r\n  email: string;\r\n  password: string;\r\n  phone?: string;\r\n};\r\n\r\nexport type LoginPayload = {\r\n  email: string;\r\n  password: string;\r\n};\r\n\r\nexport type SendVerificationPayload = {\r\n  userId: string;\r\n  phone: string;\r\n};\r\n\r\nexport type VerifyPhonePayload = {\r\n  userId: string;\r\n  code: string;\r\n};\r\n\r\nexport type ResendVerificationPayload = {\r\n  userId: string;\r\n  phone: string;\r\n};\r\n\r\nexport type AuthUser = {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  phone?: string | null;\r\n  avatar_url?: string | null;\r\n};\r\n\r\nexport type AuthTokens = {\r\n  accessToken: string;\r\n  refreshToken?: string;\r\n};\r\n\r\nexport type AuthResponse = {\r\n  user: AuthUser;\r\n  tokens?: AuthTokens;\r\n};\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                             FUNÇÕES DE AUTH BASE                           */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nexport async function register(payload: RegisterPayload): Promise<AuthResponse> {\r\n  const API_URL = getApiUrl();\r\n  const { data } = await axios.post<AuthResponse>(`${API_URL}/auth/register`, payload);\r\n  return data;\r\n}\r\n\r\nexport async function login(payload: LoginPayload): Promise<AuthResponse> {\r\n  const API_URL = getApiUrl();\r\n  const { data } = await axios.post<AuthResponse>(`${API_URL}/auth/login`, payload);\r\n  return data;\r\n}\r\n\r\nexport async function getCurrentUser(token?: string): Promise<AuthUser> {\r\n  const API_URL = getApiUrl();\r\n  const headers: Record<string, string> = {};\r\n  if (token) {\r\n    headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  const { data } = await axios.get<AuthUser>(`${API_URL}/auth/me`, { headers });\r\n  return data;\r\n}\r\n\r\nexport async function updateProfile(\r\n  updates: Partial<AuthUser>,\r\n  token?: string\r\n): Promise<AuthUser> {\r\n  const API_URL = getApiUrl();\r\n  const headers: Record<string, string> = {};\r\n  if (token) {\r\n    headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  const { data } = await axios.put<AuthUser>(`${API_URL}/auth/me`, updates, { headers });\r\n  return data;\r\n}\r\n\r\nexport async function logout(token?: string): Promise<void> {\r\n  const API_URL = getApiUrl();\r\n  const headers: Record<string, string> = {};\r\n  if (token) {\r\n    headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  await axios.post(`${API_URL}/auth/logout`, {}, { headers });\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                           FUNÇÕES DE VERIFICAÇÃO SMS                       */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nexport async function sendVerificationCode({\r\n  userId,\r\n  phone\r\n}: SendVerificationPayload): Promise<{ success: boolean; message?: string }> {\r\n  const API_URL = getApiUrl();\r\n  try {\r\n    const { data } = await axios.post<{ success: boolean; message?: string }>(\r\n      `${API_URL}/sms/send-code`,\r\n      { userId, phone }\r\n    );\r\n    return data;\r\n  } catch (err) {\r\n    throw new Error(extractAxiosMessage(err, 'Erro ao enviar código'));\r\n  }\r\n}\r\n\r\nexport async function verifyPhone({\r\n  userId,\r\n  code\r\n}: VerifyPhonePayload): Promise<{ success: boolean; message?: string }> {\r\n  const API_URL = getApiUrl();\r\n  try {\r\n    const { data } = await axios.post<{ success: boolean; message?: string }>(\r\n      `${API_URL}/sms/verify-code`,\r\n      { userId, code }\r\n    );\r\n    return data;\r\n  } catch (err) {\r\n    throw new Error(extractAxiosMessage(err, 'Código inválido'));\r\n  }\r\n}\r\n\r\nexport async function resendVerificationCode({\r\n  userId,\r\n  phone\r\n}: ResendVerificationPayload): Promise<{ success: boolean; message?: string }> {\r\n  const API_URL = getApiUrl();\r\n  try {\r\n    const { data } = await axios.post<{ success: boolean; message?: string }>(\r\n      `${API_URL}/sms/resend-code`,\r\n      { userId, phone }\r\n    );\r\n    return data;\r\n  } catch (err) {\r\n    throw new Error(extractAxiosMessage(err, 'Erro ao reenviar código'));\r\n  }\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                          ALIAS DE COMPATIBILIDADE TESTE                    */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nexport async function verifyCode(payload: VerifyPhonePayload) {\r\n  return verifyPhone(payload);\r\n}\r\n\r\nexport async function resendCode(payload: ResendVerificationPayload) {\r\n  return resendVerificationCode(payload);\r\n}\r\n\r\n/* -------------------------------------------------------------------------- */\r\n/*                             EXPORTAÇÃO DEFAULT                             */\r\n/* -------------------------------------------------------------------------- */\r\n\r\nconst authService = {\r\n  register,\r\n  login,\r\n  getCurrentUser,\r\n  updateProfile,\r\n  logout,\r\n  sendVerificationCode,\r\n  verifyPhone,\r\n  resendVerificationCode,\r\n  verifyCode,\r\n  resendCode\r\n};\r\n\r\nexport default authService;"],"version":3}