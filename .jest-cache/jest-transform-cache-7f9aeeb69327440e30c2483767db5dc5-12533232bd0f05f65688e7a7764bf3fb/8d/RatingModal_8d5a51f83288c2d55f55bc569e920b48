74f970486415d7f8413589980acbf7b8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const prop_types_1 = tslib_1.__importDefault(require("prop-types"));
const lucide_react_1 = require("lucide-react");
const button_1 = require("@/features/shared/components/ui/button");
const use_toast_1 = require("@/features/shared/components/ui/use-toast");
const RatingService_1 = tslib_1.__importDefault(require("@/services/RatingService"));
const RatingModal = ({ isOpen, onClose, eventId, raterId, ratedId, ratedName, ratingType, onRatingSubmit }) => {
    const { toast } = (0, use_toast_1.useToast)();
    const [hoveredStar, setHoveredStar] = (0, react_1.useState)(0);
    const [selectedScore, setSelectedScore] = (0, react_1.useState)(0);
    const [isLoading, setIsLoading] = (0, react_1.useState)(false);
    const [existingRating, setExistingRating] = (0, react_1.useState)(null);
    const loadExistingRating = (0, react_1.useCallback)(async () => {
        try {
            const rating = await RatingService_1.default.getRating(eventId, raterId, ratedId, ratingType);
            if (rating) {
                setSelectedScore(rating.score);
                setExistingRating(rating);
            }
        }
        catch (error) {
            console.error('Erro ao carregar avaliação:', error);
        }
    }, [eventId, raterId, ratedId, ratingType]);
    (0, react_1.useEffect)(() => {
        if (isOpen && eventId && raterId && ratedId) {
            loadExistingRating();
        }
    }, [isOpen, eventId, raterId, ratedId, loadExistingRating]);
    const handleStarClick = (score) => {
        setSelectedScore(score);
    };
    const handleSubmit = async () => {
        if (!selectedScore) {
            toast({
                variant: 'destructive',
                title: 'Selecione uma avaliação',
                description: 'Por favor, clique em uma estrela para avaliar'
            });
            return;
        }
        try {
            setIsLoading(true);
            const result = await RatingService_1.default.createRating({
                eventId,
                raterId,
                ratedId,
                ratingType,
                score: selectedScore
            });
            if (result.success) {
                toast({
                    title: '✅ Avaliação enviada!',
                    description: `Você avaliou ${ratedName} com ${selectedScore} ⭐`
                });
                if (onRatingSubmit) {
                    onRatingSubmit();
                }
                setTimeout(() => {
                    onClose();
                    setSelectedScore(0);
                }, 500);
            }
            else {
                toast({
                    variant: 'destructive',
                    title: 'Erro',
                    description: result.error?.message || 'Não foi possível enviar a avaliação'
                });
            }
        }
        catch (error) {
            console.error('Erro ao salvar avaliação:', error);
            toast({
                variant: 'destructive',
                title: 'Erro',
                description: 'Ocorreu um erro ao enviar sua avaliação'
            });
        }
        finally {
            setIsLoading(false);
        }
    };
    if (!isOpen)
        return null;
    const typeLabel = ratingType === 'host' ? 'Anfitrião' : 'Participante';
    return ((0, jsx_runtime_1.jsx)("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm", children: (0, jsx_runtime_1.jsxs)("div", { className: "glass-effect rounded-2xl p-8 border border-white/10 max-w-sm w-full mx-4 space-y-6 animate-in fade-in zoom-in duration-300", children: [(0, jsx_runtime_1.jsxs)("div", { className: "text-center space-y-2", children: [(0, jsx_runtime_1.jsxs)("h2", { className: "text-2xl font-bold text-white", children: ["Avaliar ", typeLabel] }), (0, jsx_runtime_1.jsx)("p", { className: "text-lg text-purple-200 font-semibold", children: ratedName }), (0, jsx_runtime_1.jsx)("p", { className: "text-sm text-white/60", children: ratingType === 'host'
                                ? 'Como foi sua experiência com o anfitrião?'
                                : 'Como foi sua experiência com este participante?' })] }), (0, jsx_runtime_1.jsx)("div", { className: "flex justify-center gap-4", children: [1, 2, 3, 4, 5].map((score) => ((0, jsx_runtime_1.jsxs)("button", { onClick: () => handleStarClick(score), onMouseEnter: () => setHoveredStar(score), onMouseLeave: () => setHoveredStar(0), disabled: isLoading, className: "group relative transition-transform hover:scale-125 disabled:opacity-50", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Star, { size: 48, className: `transition-all duration-200 ${score <= (hoveredStar || selectedScore)
                                    ? 'fill-yellow-400 text-yellow-400 drop-shadow-lg'
                                    : 'text-white/30 hover:text-yellow-300'}` }), (0, jsx_runtime_1.jsxs)("span", { className: "absolute -bottom-10 left-1/2 -translate-x-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none", children: [score === 1 && 'Ruim', score === 2 && 'Regular', score === 3 && 'Bom', score === 4 && 'Muito Bom', score === 5 && 'Excelente'] })] }, score))) }), selectedScore > 0 && ((0, jsx_runtime_1.jsxs)("div", { className: "text-center bg-white/5 rounded-lg p-3 border border-white/10", children: [(0, jsx_runtime_1.jsx)("p", { className: "text-white/80 text-sm", children: "Sua avalia\u00E7\u00E3o:" }), (0, jsx_runtime_1.jsxs)("p", { className: "text-2xl font-bold text-yellow-400 mt-1", children: [selectedScore, " \u2B50"] })] })), existingRating && ((0, jsx_runtime_1.jsx)("div", { className: "bg-blue-500/10 border border-blue-500/20 rounded-lg p-3", children: (0, jsx_runtime_1.jsxs)("p", { className: "text-sm text-blue-200", children: ["\uD83D\uDCA1 Voc\u00EA j\u00E1 avaliou este ", ratingType === 'host' ? 'anfitrião' : 'participante', ". Clique em 'Enviar' para atualizar sua avalia\u00E7\u00E3o."] }) })), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-3 pt-4", children: [(0, jsx_runtime_1.jsx)(button_1.Button, { onClick: onClose, disabled: isLoading, variant: "outline", className: "flex-1 border-white/20 text-white hover:bg-white/10", children: "Cancelar" }), (0, jsx_runtime_1.jsx)(button_1.Button, { onClick: handleSubmit, disabled: !selectedScore || isLoading, className: "flex-1 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-semibold", children: isLoading ? 'Enviando...' : 'Enviar' })] }), (0, jsx_runtime_1.jsx)("button", { onClick: onClose, disabled: isLoading, className: "absolute top-4 right-4 text-white/60 hover:text-white disabled:opacity-50 transition-colors", children: (0, jsx_runtime_1.jsx)("svg", { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }) }) })] }) }));
};
RatingModal.propTypes = {
    isOpen: prop_types_1.default.bool.isRequired,
    onClose: prop_types_1.default.func.isRequired,
    eventId: prop_types_1.default.number.isRequired,
    raterId: prop_types_1.default.string.isRequired,
    ratedId: prop_types_1.default.string.isRequired,
    ratedName: prop_types_1.default.string.isRequired,
    ratingType: prop_types_1.default.oneOf(['host', 'participant']).isRequired,
    onRatingSubmit: prop_types_1.default.func
};
exports.default = RatingModal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcc2hhcmVkXFxjb21wb25lbnRzXFxldmVudHNcXFJhdGluZ01vZGFsLmpzeCIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsaUNBQXlEO0FBQ3pELG9FQUFtQztBQUNuQywrQ0FBb0M7QUFDcEMsbUVBQWdFO0FBQ2hFLHlFQUFxRTtBQUNyRSxxRkFBcUQ7QUFFckQsTUFBTSxXQUFXLEdBQUcsQ0FBQyxFQUNuQixNQUFNLEVBQ04sT0FBTyxFQUNQLE9BQU8sRUFDUCxPQUFPLEVBQ1AsT0FBTyxFQUNQLFNBQVMsRUFDVCxVQUFVLEVBQ1YsY0FBYyxFQUNmLEVBQUUsRUFBRTtJQUNILE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxJQUFBLG9CQUFRLEdBQUUsQ0FBQztJQUM3QixNQUFNLENBQUMsV0FBVyxFQUFFLGNBQWMsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQztJQUNsRCxNQUFNLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RELE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xELE1BQU0sQ0FBQyxjQUFjLEVBQUUsaUJBQWlCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsSUFBSSxDQUFDLENBQUM7SUFFM0QsTUFBTSxrQkFBa0IsR0FBRyxJQUFBLG1CQUFXLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDaEQsSUFBSSxDQUFDO1lBQ0gsTUFBTSxNQUFNLEdBQUcsTUFBTSx1QkFBYSxDQUFDLFNBQVMsQ0FDMUMsT0FBTyxFQUNQLE9BQU8sRUFDUCxPQUFPLEVBQ1AsVUFBVSxDQUNYLENBQUM7WUFDRixJQUFJLE1BQU0sRUFBRSxDQUFDO2dCQUNYLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDL0IsaUJBQWlC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LENBQUMsU0FBUyxHQUFHO0lBQ3RCLE1BQU0sRUFBRSxvQkFBUyxDQUFDLElBQUksQ0FBQyxVQUFVO0lBQ2pDLE9BQU8sRUFBRSxvQkFBUyxDQUFDLElBQUksQ0FBQyxVQUFVO0lBQ2xDLE9BQU8sRUFBRSxvQkFBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO0lBQ3BDLE9BQU8sRUFBRSxvQkFBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO0lBQ3BDLE9BQU8sRUFBRSxvQkFBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO0lBQ3BDLFNBQVMsRUFBRSxvQkFBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO0lBQ3RDLFVBQVUsRUFBRSxvQkFBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLFVBQVU7SUFDL0QsY0FBYyxFQUFFLG9CQUFTLENBQUMsSUFBSTtDQUMvQixDQUFDO0FBRUYsa0JBQWUsV0FBVyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcZmVhdHVyZXNcXHNoYXJlZFxcY29tcG9uZW50c1xcZXZlbnRzXFxSYXRpbmdNb2RhbC5qc3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XHJcbmltcG9ydCB7IFN0YXIgfSBmcm9tICdsdWNpZGUtcmVhY3QnO1xyXG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tICdAL2ZlYXR1cmVzL3NoYXJlZC9jb21wb25lbnRzL3VpL2J1dHRvbic7XHJcbmltcG9ydCB7IHVzZVRvYXN0IH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS91c2UtdG9hc3QnO1xyXG5pbXBvcnQgUmF0aW5nU2VydmljZSBmcm9tICdAL3NlcnZpY2VzL1JhdGluZ1NlcnZpY2UnO1xyXG5cclxuY29uc3QgUmF0aW5nTW9kYWwgPSAoe1xyXG4gIGlzT3BlbixcclxuICBvbkNsb3NlLFxyXG4gIGV2ZW50SWQsXHJcbiAgcmF0ZXJJZCxcclxuICByYXRlZElkLFxyXG4gIHJhdGVkTmFtZSxcclxuICByYXRpbmdUeXBlLFxyXG4gIG9uUmF0aW5nU3VibWl0XHJcbn0pID0+IHtcclxuICBjb25zdCB7IHRvYXN0IH0gPSB1c2VUb2FzdCgpO1xyXG4gIGNvbnN0IFtob3ZlcmVkU3Rhciwgc2V0SG92ZXJlZFN0YXJdID0gdXNlU3RhdGUoMCk7XHJcbiAgY29uc3QgW3NlbGVjdGVkU2NvcmUsIHNldFNlbGVjdGVkU2NvcmVdID0gdXNlU3RhdGUoMCk7XHJcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbZXhpc3RpbmdSYXRpbmcsIHNldEV4aXN0aW5nUmF0aW5nXSA9IHVzZVN0YXRlKG51bGwpO1xyXG5cclxuICBjb25zdCBsb2FkRXhpc3RpbmdSYXRpbmcgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByYXRpbmcgPSBhd2FpdCBSYXRpbmdTZXJ2aWNlLmdldFJhdGluZyhcclxuICAgICAgICBldmVudElkLFxyXG4gICAgICAgIHJhdGVySWQsXHJcbiAgICAgICAgcmF0ZWRJZCxcclxuICAgICAgICByYXRpbmdUeXBlXHJcbiAgICAgICk7XHJcbiAgICAgIGlmIChyYXRpbmcpIHtcclxuICAgICAgICBzZXRTZWxlY3RlZFNjb3JlKHJhdGluZy5zY29yZSk7XHJcbiAgICAgICAgc2V0RXhpc3RpbmdSYXRpbmcocmF0aW5nKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyBjYXJyZWdhciBhdmFsaWHDp8OjbzonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfSwgW2V2ZW50SWQsIHJhdGVySWQsIHJhdGVkSWQsIHJhdGluZ1R5cGVdKTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChpc09wZW4gJiYgZXZlbnRJZCAmJiByYXRlcklkICYmIHJhdGVkSWQpIHtcclxuICAgICAgbG9hZEV4aXN0aW5nUmF0aW5nKCk7XHJcbiAgICB9XHJcbiAgfSwgW2lzT3BlbiwgZXZlbnRJZCwgcmF0ZXJJZCwgcmF0ZWRJZCwgbG9hZEV4aXN0aW5nUmF0aW5nXSk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZVN0YXJDbGljayA9IChzY29yZSkgPT4ge1xyXG4gICAgc2V0U2VsZWN0ZWRTY29yZShzY29yZSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlU3VibWl0ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgaWYgKCFzZWxlY3RlZFNjb3JlKSB7XHJcbiAgICAgIHRvYXN0KHtcclxuICAgICAgICB2YXJpYW50OiAnZGVzdHJ1Y3RpdmUnLFxyXG4gICAgICAgIHRpdGxlOiAnU2VsZWNpb25lIHVtYSBhdmFsaWHDp8OjbycsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdQb3IgZmF2b3IsIGNsaXF1ZSBlbSB1bWEgZXN0cmVsYSBwYXJhIGF2YWxpYXInXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUmF0aW5nU2VydmljZS5jcmVhdGVSYXRpbmcoe1xyXG4gICAgICAgIGV2ZW50SWQsXHJcbiAgICAgICAgcmF0ZXJJZCxcclxuICAgICAgICByYXRlZElkLFxyXG4gICAgICAgIHJhdGluZ1R5cGUsXHJcbiAgICAgICAgc2NvcmU6IHNlbGVjdGVkU2NvcmVcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICB0b2FzdCh7XHJcbiAgICAgICAgICB0aXRsZTogJ+KchSBBdmFsaWHDp8OjbyBlbnZpYWRhIScsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYFZvY8OqIGF2YWxpb3UgJHtyYXRlZE5hbWV9IGNvbSAke3NlbGVjdGVkU2NvcmV9IOKtkGBcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKG9uUmF0aW5nU3VibWl0KSB7XHJcbiAgICAgICAgICBvblJhdGluZ1N1Ym1pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICBvbkNsb3NlKCk7XHJcbiAgICAgICAgICBzZXRTZWxlY3RlZFNjb3JlKDApO1xyXG4gICAgICAgIH0sIDUwMCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdG9hc3Qoe1xyXG4gICAgICAgICAgdmFyaWFudDogJ2Rlc3RydWN0aXZlJyxcclxuICAgICAgICAgIHRpdGxlOiAnRXJybycsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogcmVzdWx0LmVycm9yPy5tZXNzYWdlIHx8ICdOw6NvIGZvaSBwb3Nzw612ZWwgZW52aWFyIGEgYXZhbGlhw6fDo28nXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gc2FsdmFyIGF2YWxpYcOnw6NvOicsIGVycm9yKTtcclxuICAgICAgdG9hc3Qoe1xyXG4gICAgICAgIHZhcmlhbnQ6ICdkZXN0cnVjdGl2ZScsXHJcbiAgICAgICAgdGl0bGU6ICdFcnJvJyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ09jb3JyZXUgdW0gZXJybyBhbyBlbnZpYXIgc3VhIGF2YWxpYcOnw6NvJ1xyXG4gICAgICB9KTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgaWYgKCFpc09wZW4pIHJldHVybiBudWxsO1xyXG5cclxuICBjb25zdCB0eXBlTGFiZWwgPSByYXRpbmdUeXBlID09PSAnaG9zdCcgPyAnQW5maXRyacOjbycgOiAnUGFydGljaXBhbnRlJztcclxuXHJcbiAgcmV0dXJuIChcclxuICAgIDxkaXYgY2xhc3NOYW1lPVwiZml4ZWQgaW5zZXQtMCB6LTUwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJnLWJsYWNrLzUwIGJhY2tkcm9wLWJsdXItc21cIj5cclxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJnbGFzcy1lZmZlY3Qgcm91bmRlZC0yeGwgcC04IGJvcmRlciBib3JkZXItd2hpdGUvMTAgbWF4LXctc20gdy1mdWxsIG14LTQgc3BhY2UteS02IGFuaW1hdGUtaW4gZmFkZS1pbiB6b29tLWluIGR1cmF0aW9uLTMwMFwiPlxyXG4gICAgICAgIFxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXIgc3BhY2UteS0yXCI+XHJcbiAgICAgICAgICA8aDIgY2xhc3NOYW1lPVwidGV4dC0yeGwgZm9udC1ib2xkIHRleHQtd2hpdGVcIj5BdmFsaWFyIHt0eXBlTGFiZWx9PC9oMj5cclxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtbGcgdGV4dC1wdXJwbGUtMjAwIGZvbnQtc2VtaWJvbGRcIj57cmF0ZWROYW1lfTwvcD5cclxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtc20gdGV4dC13aGl0ZS82MFwiPlxyXG4gICAgICAgICAgICB7cmF0aW5nVHlwZSA9PT0gJ2hvc3QnXHJcbiAgICAgICAgICAgICAgPyAnQ29tbyBmb2kgc3VhIGV4cGVyacOqbmNpYSBjb20gbyBhbmZpdHJpw6NvPydcclxuICAgICAgICAgICAgICA6ICdDb21vIGZvaSBzdWEgZXhwZXJpw6puY2lhIGNvbSBlc3RlIHBhcnRpY2lwYW50ZT8nfVxyXG4gICAgICAgICAgPC9wPlxyXG4gICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXgganVzdGlmeS1jZW50ZXIgZ2FwLTRcIj5cclxuICAgICAgICAgIHtbMSwgMiwgMywgNCwgNV0ubWFwKChzY29yZSkgPT4gKFxyXG4gICAgICAgICAgICA8YnV0dG9uXHJcbiAgICAgICAgICAgICAga2V5PXtzY29yZX1cclxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBoYW5kbGVTdGFyQ2xpY2soc2NvcmUpfVxyXG4gICAgICAgICAgICAgIG9uTW91c2VFbnRlcj17KCkgPT4gc2V0SG92ZXJlZFN0YXIoc2NvcmUpfVxyXG4gICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17KCkgPT4gc2V0SG92ZXJlZFN0YXIoMCl9XHJcbiAgICAgICAgICAgICAgZGlzYWJsZWQ9e2lzTG9hZGluZ31cclxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJncm91cCByZWxhdGl2ZSB0cmFuc2l0aW9uLXRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMjUgZGlzYWJsZWQ6b3BhY2l0eS01MFwiXHJcbiAgICAgICAgICAgID5cclxuICAgICAgICAgICAgICA8U3RhclxyXG4gICAgICAgICAgICAgICAgc2l6ZT17NDh9XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2B0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgJHtcclxuICAgICAgICAgICAgICAgICAgc2NvcmUgPD0gKGhvdmVyZWRTdGFyIHx8IHNlbGVjdGVkU2NvcmUpXHJcbiAgICAgICAgICAgICAgICAgICAgPyAnZmlsbC15ZWxsb3ctNDAwIHRleHQteWVsbG93LTQwMCBkcm9wLXNoYWRvdy1sZydcclxuICAgICAgICAgICAgICAgICAgICA6ICd0ZXh0LXdoaXRlLzMwIGhvdmVyOnRleHQteWVsbG93LTMwMCdcclxuICAgICAgICAgICAgICAgIH1gfVxyXG4gICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiYWJzb2x1dGUgLWJvdHRvbS0xMCBsZWZ0LTEvMiAtdHJhbnNsYXRlLXgtMS8yIGJnLWJsYWNrLzgwIHRleHQtd2hpdGUgdGV4dC14cyBweC0yIHB5LTEgcm91bmRlZCB3aGl0ZXNwYWNlLW5vd3JhcCBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IHBvaW50ZXItZXZlbnRzLW5vbmVcIj5cclxuICAgICAgICAgICAgICAgIHtzY29yZSA9PT0gMSAmJiAnUnVpbSd9XHJcbiAgICAgICAgICAgICAgICB7c2NvcmUgPT09IDIgJiYgJ1JlZ3VsYXInfVxyXG4gICAgICAgICAgICAgICAge3Njb3JlID09PSAzICYmICdCb20nfVxyXG4gICAgICAgICAgICAgICAge3Njb3JlID09PSA0ICYmICdNdWl0byBCb20nfVxyXG4gICAgICAgICAgICAgICAge3Njb3JlID09PSA1ICYmICdFeGNlbGVudGUnfVxyXG4gICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICApKX1cclxuICAgICAgICA8L2Rpdj5cclxuXHJcbiAgICAgICAge3NlbGVjdGVkU2NvcmUgPiAwICYmIChcclxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXIgYmctd2hpdGUvNSByb3VuZGVkLWxnIHAtMyBib3JkZXIgYm9yZGVyLXdoaXRlLzEwXCI+XHJcbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtd2hpdGUvODAgdGV4dC1zbVwiPlN1YSBhdmFsaWHDp8Ojbzo8L3A+XHJcbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LXllbGxvdy00MDAgbXQtMVwiPntzZWxlY3RlZFNjb3JlfSDirZA8L3A+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApfVxyXG5cclxuICAgICAgICB7ZXhpc3RpbmdSYXRpbmcgJiYgKFxyXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJiZy1ibHVlLTUwMC8xMCBib3JkZXIgYm9yZGVyLWJsdWUtNTAwLzIwIHJvdW5kZWQtbGcgcC0zXCI+XHJcbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtc20gdGV4dC1ibHVlLTIwMFwiPlxyXG4gICAgICAgICAgICAgIPCfkqEgVm9jw6ogasOhIGF2YWxpb3UgZXN0ZSB7cmF0aW5nVHlwZSA9PT0gJ2hvc3QnID8gJ2FuZml0cmnDo28nIDogJ3BhcnRpY2lwYW50ZSd9LiBcclxuICAgICAgICAgICAgICBDbGlxdWUgZW0gJmFwb3M7RW52aWFyJmFwb3M7IHBhcmEgYXR1YWxpemFyIHN1YSBhdmFsaWHDp8Ojby5cclxuICAgICAgICAgICAgPC9wPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKX1cclxuXHJcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGdhcC0zIHB0LTRcIj5cclxuICAgICAgICAgIDxCdXR0b25cclxuICAgICAgICAgICAgb25DbGljaz17b25DbG9zZX1cclxuICAgICAgICAgICAgZGlzYWJsZWQ9e2lzTG9hZGluZ31cclxuICAgICAgICAgICAgdmFyaWFudD1cIm91dGxpbmVcIlxyXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJmbGV4LTEgYm9yZGVyLXdoaXRlLzIwIHRleHQtd2hpdGUgaG92ZXI6Ymctd2hpdGUvMTBcIlxyXG4gICAgICAgICAgPlxyXG4gICAgICAgICAgICBDYW5jZWxhclxyXG4gICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgICA8QnV0dG9uXHJcbiAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVN1Ym1pdH1cclxuICAgICAgICAgICAgZGlzYWJsZWQ9eyFzZWxlY3RlZFNjb3JlIHx8IGlzTG9hZGluZ31cclxuICAgICAgICAgICAgY2xhc3NOYW1lPVwiZmxleC0xIGJnLWdyYWRpZW50LXRvLXIgZnJvbS15ZWxsb3ctNTAwIHRvLXllbGxvdy02MDAgaG92ZXI6ZnJvbS15ZWxsb3ctNjAwIGhvdmVyOnRvLXllbGxvdy03MDAgdGV4dC13aGl0ZSBmb250LXNlbWlib2xkXCJcclxuICAgICAgICAgID5cclxuICAgICAgICAgICAge2lzTG9hZGluZyA/ICdFbnZpYW5kby4uLicgOiAnRW52aWFyJ31cclxuICAgICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICA8YnV0dG9uXHJcbiAgICAgICAgICBvbkNsaWNrPXtvbkNsb3NlfVxyXG4gICAgICAgICAgZGlzYWJsZWQ9e2lzTG9hZGluZ31cclxuICAgICAgICAgIGNsYXNzTmFtZT1cImFic29sdXRlIHRvcC00IHJpZ2h0LTQgdGV4dC13aGl0ZS82MCBob3Zlcjp0ZXh0LXdoaXRlIGRpc2FibGVkOm9wYWNpdHktNTAgdHJhbnNpdGlvbi1jb2xvcnNcIlxyXG4gICAgICAgID5cclxuICAgICAgICAgIDxzdmcgY2xhc3NOYW1lPVwidy02IGgtNlwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPlxyXG4gICAgICAgICAgICA8cGF0aCBzdHJva2VMaW5lY2FwPVwicm91bmRcIiBzdHJva2VMaW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlV2lkdGg9ezJ9IGQ9XCJNNiAxOEwxOCA2TTYgNmwxMiAxMlwiIC8+XHJcbiAgICAgICAgICA8L3N2Zz5cclxuICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICApO1xyXG59O1xyXG5cclxuUmF0aW5nTW9kYWwucHJvcFR5cGVzID0ge1xyXG4gIGlzT3BlbjogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcclxuICBvbkNsb3NlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxyXG4gIGV2ZW50SWQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcclxuICByYXRlcklkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXHJcbiAgcmF0ZWRJZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gIHJhdGVkTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxyXG4gIHJhdGluZ1R5cGU6IFByb3BUeXBlcy5vbmVPZihbJ2hvc3QnLCAncGFydGljaXBhbnQnXSkuaXNSZXF1aXJlZCxcclxuICBvblJhdGluZ1N1Ym1pdDogUHJvcFR5cGVzLmZ1bmNcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJhdGluZ01vZGFsOyJdLCJ2ZXJzaW9uIjozfQ==