9df6da9b7e7815aa0f9133fd410c74c2
"use strict";
// src/utils/index.js
Object.defineProperty(exports, "__esModule", { value: true });
exports.cn = cn;
exports.compressImage = compressImage;
exports.getPhotoUrl = getPhotoUrl;
exports.getAvatarUrl = getAvatarUrl;
exports.formatPhone = formatPhone;
exports.formatCNPJ = formatCNPJ;
exports.formatCEP = formatCEP;
exports.formatDate = formatDate;
exports.truncate = truncate;
exports.isValidEmail = isValidEmail;
exports.isValidCNPJ = isValidCNPJ;
exports.debounce = debounce;
exports.slugify = slugify;
exports.calculateDistance = calculateDistance;
const clsx_1 = require("clsx");
const tailwind_merge_1 = require("tailwind-merge");
const supabaseClient_1 = require("@/lib/supabaseClient");
/**
 * Combina classes CSS com Tailwind merge
 * Função essencial para componentes shadcn/ui
 */
function cn(...inputs) {
    return (0, tailwind_merge_1.twMerge)((0, clsx_1.clsx)(inputs));
}
/**
 * Comprime uma imagem para um tamanho máximo
 * @param {File} file - Arquivo de imagem
 * @param {number} maxSizeMB - Tamanho máximo em MB (padrão: 2MB)
 * @param {number} maxWidthOrHeight - Largura/altura máxima (padrão: 1920px)
 * @returns {Promise<File>} - Arquivo comprimido
 */
async function compressImage(file, maxSizeMB = 2, maxWidthOrHeight = 1920) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;
                // Redimensiona mantendo proporção
                if (width > height) {
                    if (width > maxWidthOrHeight) {
                        height *= maxWidthOrHeight / width;
                        width = maxWidthOrHeight;
                    }
                }
                else {
                    if (height > maxWidthOrHeight) {
                        width *= maxWidthOrHeight / height;
                        height = maxWidthOrHeight;
                    }
                }
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                // Converte para blob com qualidade ajustada
                canvas.toBlob((blob) => {
                    if (!blob) {
                        reject(new Error('Falha ao comprimir imagem'));
                        return;
                    }
                    // Se ainda estiver maior que o limite, reduz a qualidade
                    if (blob.size > maxSizeMB * 1024 * 1024) {
                        canvas.toBlob((blob2) => {
                            if (!blob2) {
                                reject(new Error('Falha ao comprimir imagem'));
                                return;
                            }
                            const compressedFile = new File([blob2], file.name, {
                                type: 'image/jpeg',
                                lastModified: Date.now(),
                            });
                            resolve(compressedFile);
                        }, 'image/jpeg', 0.7 // Qualidade reduzida
                        );
                    }
                    else {
                        const compressedFile = new File([blob], file.name, {
                            type: 'image/jpeg',
                            lastModified: Date.now(),
                        });
                        resolve(compressedFile);
                    }
                }, 'image/jpeg', 0.9 // Qualidade inicial
                );
            };
            img.onerror = () => {
                reject(new Error('Falha ao carregar imagem'));
            };
            img.src = event.target.result;
        };
        reader.onerror = () => {
            reject(new Error('Falha ao ler arquivo'));
        };
        reader.readAsDataURL(file);
    });
}
/**
 * Obtém a URL pública de uma foto do Supabase Storage
 * @param {string} photoPath - Caminho da foto no storage
 * @param {string} bucket - Nome do bucket (padrão: 'photos')
 * @returns {string|null} - URL pública da foto ou null
 */
function getPhotoUrl(photoPath, bucket = 'photos') {
    if (!photoPath)
        return null;
    // Se já for uma URL completa, retorna ela mesma
    if (photoPath.startsWith('http://') || photoPath.startsWith('https://')) {
        return photoPath;
    }
    try {
        const { data } = supabaseClient_1.supabase.storage
            .from(bucket)
            .getPublicUrl(photoPath);
        return data?.publicUrl || null;
    }
    catch (error) {
        console.error('Erro ao obter URL da foto:', error);
        return null;
    }
}
/**
 * Obtém a URL pública de um avatar do Supabase Storage
 * @param {string} avatarPath - Caminho do avatar no storage
 * @returns {string|null} - URL pública do avatar ou null
 */
function getAvatarUrl(avatarPath) {
    return getPhotoUrl(avatarPath, 'avatars');
}
/**
 * Formata um número de telefone brasileiro
 * @param {string} phone - Número de telefone
 * @returns {string} - Telefone formatado
 */
function formatPhone(phone) {
    if (!phone)
        return '';
    const cleaned = phone.replace(/\D/g, '');
    if (cleaned.length === 11) {
        return cleaned.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
    }
    else if (cleaned.length === 10) {
        return cleaned.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
    }
    return phone;
}
/**
 * Formata um CNPJ
 * @param {string} cnpj - CNPJ
 * @returns {string} - CNPJ formatado
 */
function formatCNPJ(cnpj) {
    if (!cnpj)
        return '';
    const cleaned = cnpj.replace(/\D/g, '');
    if (cleaned.length === 14) {
        return cleaned.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
    }
    return cnpj;
}
/**
 * Formata um CEP
 * @param {string} cep - CEP
 * @returns {string} - CEP formatado
 */
function formatCEP(cep) {
    if (!cep)
        return '';
    const cleaned = cep.replace(/\D/g, '');
    if (cleaned.length === 8) {
        return cleaned.replace(/(\d{5})(\d{3})/, '$1-$2');
    }
    return cep;
}
/**
 * Formata uma data para exibição
 * @param {string|Date} date - Data
 * @param {boolean} includeTime - Incluir hora (padrão: false)
 * @returns {string} - Data formatada
 */
function formatDate(date, includeTime = false) {
    if (!date)
        return '';
    const d = new Date(date);
    if (isNaN(d.getTime()))
        return '';
    const options = {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
    };
    if (includeTime) {
        options.hour = '2-digit';
        options.minute = '2-digit';
    }
    return d.toLocaleString('pt-BR', options);
}
/**
 * Trunca um texto com reticências
 * @param {string} text - Texto
 * @param {number} maxLength - Comprimento máximo
 * @returns {string} - Texto truncado
 */
function truncate(text, maxLength = 100) {
    if (!text)
        return '';
    if (text.length <= maxLength)
        return text;
    return text.substring(0, maxLength) + '...';
}
/**
 * Valida um email
 * @param {string} email - Email
 * @returns {boolean} - True se válido
 */
function isValidEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}
/**
 * Valida um CNPJ
 * @param {string} cnpj - CNPJ
 * @returns {boolean} - True se válido
 */
function isValidCNPJ(cnpj) {
    const cleaned = cnpj.replace(/\D/g, '');
    if (cleaned.length !== 14)
        return false;
    // Verifica se todos os dígitos são iguais
    if (/^(\d)\1+$/.test(cleaned))
        return false;
    // Validação dos dígitos verificadores
    let length = cleaned.length - 2;
    let numbers = cleaned.substring(0, length);
    const digits = cleaned.substring(length);
    let sum = 0;
    let pos = length - 7;
    for (let i = length; i >= 1; i--) {
        sum += numbers.charAt(length - i) * pos--;
        if (pos < 2)
            pos = 9;
    }
    let result = sum % 11 < 2 ? 0 : 11 - (sum % 11);
    if (result != digits.charAt(0))
        return false;
    length = length + 1;
    numbers = cleaned.substring(0, length);
    sum = 0;
    pos = length - 7;
    for (let i = length; i >= 1; i--) {
        sum += numbers.charAt(length - i) * pos--;
        if (pos < 2)
            pos = 9;
    }
    result = sum % 11 < 2 ? 0 : 11 - (sum % 11);
    if (result != digits.charAt(1))
        return false;
    return true;
}
/**
 * Debounce de uma função
 * @param {Function} func - Função a ser debounced
 * @param {number} wait - Tempo de espera em ms
 * @returns {Function} - Função debounced
 */
function debounce(func, wait = 300) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
/**
 * Gera um slug a partir de um texto
 * @param {string} text - Texto
 * @returns {string} - Slug
 */
function slugify(text) {
    return text
        .toString()
        .toLowerCase()
        .trim()
        .replace(/\s+/g, '-')
        .replace(/[^\w-]+/g, '')
        .replace(/--+/g, '-');
}
/**
 * Calcula a distância entre duas coordenadas (em km)
 * @param {number} lat1 - Latitude 1
 * @param {number} lon1 - Longitude 1
 * @param {number} lat2 - Latitude 2
 * @param {number} lon2 - Longitude 2
 * @returns {number} - Distância em km
 */
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Raio da Terra em km
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7SUFDdEQsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsc0JBQXNCO0lBQ3RDLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDO0lBQzNDLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDO0lBQzNDLE1BQU0sQ0FBQyxHQUNMLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQy9ELElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RCxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDZixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcdXRpbHNcXGluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy91dGlscy9pbmRleC5qc1xyXG5cclxuaW1wb3J0IHsgY2xzeCB9IGZyb20gJ2Nsc3gnO1xyXG5pbXBvcnQgeyB0d01lcmdlIH0gZnJvbSAndGFpbHdpbmQtbWVyZ2UnO1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJ0AvbGliL3N1cGFiYXNlQ2xpZW50JztcclxuXHJcbi8qKlxyXG4gKiBDb21iaW5hIGNsYXNzZXMgQ1NTIGNvbSBUYWlsd2luZCBtZXJnZVxyXG4gKiBGdW7Dp8OjbyBlc3NlbmNpYWwgcGFyYSBjb21wb25lbnRlcyBzaGFkY24vdWlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjbiguLi5pbnB1dHMpIHtcclxuICByZXR1cm4gdHdNZXJnZShjbHN4KGlucHV0cykpO1xyXG59XHJcblxyXG4vKipcclxuICogQ29tcHJpbWUgdW1hIGltYWdlbSBwYXJhIHVtIHRhbWFuaG8gbcOheGltb1xyXG4gKiBAcGFyYW0ge0ZpbGV9IGZpbGUgLSBBcnF1aXZvIGRlIGltYWdlbVxyXG4gKiBAcGFyYW0ge251bWJlcn0gbWF4U2l6ZU1CIC0gVGFtYW5obyBtw6F4aW1vIGVtIE1CIChwYWRyw6NvOiAyTUIpXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBtYXhXaWR0aE9ySGVpZ2h0IC0gTGFyZ3VyYS9hbHR1cmEgbcOheGltYSAocGFkcsOjbzogMTkyMHB4KVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxGaWxlPn0gLSBBcnF1aXZvIGNvbXByaW1pZG9cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb21wcmVzc0ltYWdlKGZpbGUsIG1heFNpemVNQiA9IDIsIG1heFdpZHRoT3JIZWlnaHQgPSAxOTIwKSB7XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICBcclxuICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpID0+IHtcclxuICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgIFxyXG4gICAgICBpbWcub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgIGxldCB3aWR0aCA9IGltZy53aWR0aDtcclxuICAgICAgICBsZXQgaGVpZ2h0ID0gaW1nLmhlaWdodDtcclxuXHJcbiAgICAgICAgLy8gUmVkaW1lbnNpb25hIG1hbnRlbmRvIHByb3BvcsOnw6NvXHJcbiAgICAgICAgaWYgKHdpZHRoID4gaGVpZ2h0KSB7XHJcbiAgICAgICAgICBpZiAod2lkdGggPiBtYXhXaWR0aE9ySGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGhlaWdodCAqPSBtYXhXaWR0aE9ySGVpZ2h0IC8gd2lkdGg7XHJcbiAgICAgICAgICAgIHdpZHRoID0gbWF4V2lkdGhPckhlaWdodDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaWYgKGhlaWdodCA+IG1heFdpZHRoT3JIZWlnaHQpIHtcclxuICAgICAgICAgICAgd2lkdGggKj0gbWF4V2lkdGhPckhlaWdodCAvIGhlaWdodDtcclxuICAgICAgICAgICAgaGVpZ2h0ID0gbWF4V2lkdGhPckhlaWdodDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XHJcblxyXG4gICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcclxuXHJcbiAgICAgICAgLy8gQ29udmVydGUgcGFyYSBibG9iIGNvbSBxdWFsaWRhZGUgYWp1c3RhZGFcclxuICAgICAgICBjYW52YXMudG9CbG9iKFxyXG4gICAgICAgICAgKGJsb2IpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFibG9iKSB7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignRmFsaGEgYW8gY29tcHJpbWlyIGltYWdlbScpKTtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFNlIGFpbmRhIGVzdGl2ZXIgbWFpb3IgcXVlIG8gbGltaXRlLCByZWR1eiBhIHF1YWxpZGFkZVxyXG4gICAgICAgICAgICBpZiAoYmxvYi5zaXplID4gbWF4U2l6ZU1CICogMTAyNCAqIDEwMjQpIHtcclxuICAgICAgICAgICAgICBjYW52YXMudG9CbG9iKFxyXG4gICAgICAgICAgICAgICAgKGJsb2IyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICghYmxvYjIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdGYWxoYSBhbyBjb21wcmltaXIgaW1hZ2VtJykpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBjb25zdCBjb21wcmVzc2VkRmlsZSA9IG5ldyBGaWxlKFtibG9iMl0sIGZpbGUubmFtZSwge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpbWFnZS9qcGVnJyxcclxuICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IERhdGUubm93KCksXHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICByZXNvbHZlKGNvbXByZXNzZWRGaWxlKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgICAgICAgICAwLjcgLy8gUXVhbGlkYWRlIHJlZHV6aWRhXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBjb25zdCBjb21wcmVzc2VkRmlsZSA9IG5ldyBGaWxlKFtibG9iXSwgZmlsZS5uYW1lLCB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IERhdGUubm93KCksXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShjb21wcmVzc2VkRmlsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAnaW1hZ2UvanBlZycsXHJcbiAgICAgICAgICAwLjkgLy8gUXVhbGlkYWRlIGluaWNpYWxcclxuICAgICAgICApO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignRmFsaGEgYW8gY2FycmVnYXIgaW1hZ2VtJykpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaW1nLnNyYyA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHJlYWRlci5vbmVycm9yID0gKCkgPT4ge1xyXG4gICAgICByZWplY3QobmV3IEVycm9yKCdGYWxoYSBhbyBsZXIgYXJxdWl2bycpKTtcclxuICAgIH07XHJcblxyXG4gICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBPYnTDqW0gYSBVUkwgcMO6YmxpY2EgZGUgdW1hIGZvdG8gZG8gU3VwYWJhc2UgU3RvcmFnZVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGhvdG9QYXRoIC0gQ2FtaW5obyBkYSBmb3RvIG5vIHN0b3JhZ2VcclxuICogQHBhcmFtIHtzdHJpbmd9IGJ1Y2tldCAtIE5vbWUgZG8gYnVja2V0IChwYWRyw6NvOiAncGhvdG9zJylcclxuICogQHJldHVybnMge3N0cmluZ3xudWxsfSAtIFVSTCBww7pibGljYSBkYSBmb3RvIG91IG51bGxcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQaG90b1VybChwaG90b1BhdGgsIGJ1Y2tldCA9ICdwaG90b3MnKSB7XHJcbiAgaWYgKCFwaG90b1BhdGgpIHJldHVybiBudWxsO1xyXG5cclxuICAvLyBTZSBqw6EgZm9yIHVtYSBVUkwgY29tcGxldGEsIHJldG9ybmEgZWxhIG1lc21hXHJcbiAgaWYgKHBob3RvUGF0aC5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgcGhvdG9QYXRoLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHtcclxuICAgIHJldHVybiBwaG90b1BhdGg7XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKGJ1Y2tldClcclxuICAgICAgLmdldFB1YmxpY1VybChwaG90b1BhdGgpO1xyXG5cclxuICAgIHJldHVybiBkYXRhPy5wdWJsaWNVcmwgfHwgbnVsbDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJybyBhbyBvYnRlciBVUkwgZGEgZm90bzonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBPYnTDqW0gYSBVUkwgcMO6YmxpY2EgZGUgdW0gYXZhdGFyIGRvIFN1cGFiYXNlIFN0b3JhZ2VcclxuICogQHBhcmFtIHtzdHJpbmd9IGF2YXRhclBhdGggLSBDYW1pbmhvIGRvIGF2YXRhciBubyBzdG9yYWdlXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gLSBVUkwgcMO6YmxpY2EgZG8gYXZhdGFyIG91IG51bGxcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRBdmF0YXJVcmwoYXZhdGFyUGF0aCkge1xyXG4gIHJldHVybiBnZXRQaG90b1VybChhdmF0YXJQYXRoLCAnYXZhdGFycycpO1xyXG59XHJcblxyXG4vKipcclxuICogRm9ybWF0YSB1bSBuw7ptZXJvIGRlIHRlbGVmb25lIGJyYXNpbGVpcm9cclxuICogQHBhcmFtIHtzdHJpbmd9IHBob25lIC0gTsO6bWVybyBkZSB0ZWxlZm9uZVxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfSAtIFRlbGVmb25lIGZvcm1hdGFkb1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFBob25lKHBob25lKSB7XHJcbiAgaWYgKCFwaG9uZSkgcmV0dXJuICcnO1xyXG4gIFxyXG4gIGNvbnN0IGNsZWFuZWQgPSBwaG9uZS5yZXBsYWNlKC9cXEQvZywgJycpO1xyXG4gIFxyXG4gIGlmIChjbGVhbmVkLmxlbmd0aCA9PT0gMTEpIHtcclxuICAgIHJldHVybiBjbGVhbmVkLnJlcGxhY2UoLyhcXGR7Mn0pKFxcZHs1fSkoXFxkezR9KS8sICcoJDEpICQyLSQzJyk7XHJcbiAgfSBlbHNlIGlmIChjbGVhbmVkLmxlbmd0aCA9PT0gMTApIHtcclxuICAgIHJldHVybiBjbGVhbmVkLnJlcGxhY2UoLyhcXGR7Mn0pKFxcZHs0fSkoXFxkezR9KS8sICcoJDEpICQyLSQzJyk7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBwaG9uZTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZvcm1hdGEgdW0gQ05QSlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gY25waiAtIENOUEpcclxuICogQHJldHVybnMge3N0cmluZ30gLSBDTlBKIGZvcm1hdGFkb1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdENOUEooY25waikge1xyXG4gIGlmICghY25waikgcmV0dXJuICcnO1xyXG4gIFxyXG4gIGNvbnN0IGNsZWFuZWQgPSBjbnBqLnJlcGxhY2UoL1xcRC9nLCAnJyk7XHJcbiAgXHJcbiAgaWYgKGNsZWFuZWQubGVuZ3RoID09PSAxNCkge1xyXG4gICAgcmV0dXJuIGNsZWFuZWQucmVwbGFjZSgvKFxcZHsyfSkoXFxkezN9KShcXGR7M30pKFxcZHs0fSkoXFxkezJ9KS8sICckMS4kMi4kMy8kNC0kNScpO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gY25wajtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZvcm1hdGEgdW0gQ0VQXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBjZXAgLSBDRVBcclxuICogQHJldHVybnMge3N0cmluZ30gLSBDRVAgZm9ybWF0YWRvXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0Q0VQKGNlcCkge1xyXG4gIGlmICghY2VwKSByZXR1cm4gJyc7XHJcbiAgXHJcbiAgY29uc3QgY2xlYW5lZCA9IGNlcC5yZXBsYWNlKC9cXEQvZywgJycpO1xyXG4gIFxyXG4gIGlmIChjbGVhbmVkLmxlbmd0aCA9PT0gOCkge1xyXG4gICAgcmV0dXJuIGNsZWFuZWQucmVwbGFjZSgvKFxcZHs1fSkoXFxkezN9KS8sICckMS0kMicpO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gY2VwO1xyXG59XHJcblxyXG4vKipcclxuICogRm9ybWF0YSB1bWEgZGF0YSBwYXJhIGV4aWJpw6fDo29cclxuICogQHBhcmFtIHtzdHJpbmd8RGF0ZX0gZGF0ZSAtIERhdGFcclxuICogQHBhcmFtIHtib29sZWFufSBpbmNsdWRlVGltZSAtIEluY2x1aXIgaG9yYSAocGFkcsOjbzogZmFsc2UpXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IC0gRGF0YSBmb3JtYXRhZGFcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUsIGluY2x1ZGVUaW1lID0gZmFsc2UpIHtcclxuICBpZiAoIWRhdGUpIHJldHVybiAnJztcclxuICBcclxuICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZSk7XHJcbiAgXHJcbiAgaWYgKGlzTmFOKGQuZ2V0VGltZSgpKSkgcmV0dXJuICcnO1xyXG4gIFxyXG4gIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICBkYXk6ICcyLWRpZ2l0JyxcclxuICAgIG1vbnRoOiAnMi1kaWdpdCcsXHJcbiAgICB5ZWFyOiAnbnVtZXJpYycsXHJcbiAgfTtcclxuICBcclxuICBpZiAoaW5jbHVkZVRpbWUpIHtcclxuICAgIG9wdGlvbnMuaG91ciA9ICcyLWRpZ2l0JztcclxuICAgIG9wdGlvbnMubWludXRlID0gJzItZGlnaXQnO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gZC50b0xvY2FsZVN0cmluZygncHQtQlInLCBvcHRpb25zKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFRydW5jYSB1bSB0ZXh0byBjb20gcmV0aWPDqm5jaWFzXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gVGV4dG9cclxuICogQHBhcmFtIHtudW1iZXJ9IG1heExlbmd0aCAtIENvbXByaW1lbnRvIG3DoXhpbW9cclxuICogQHJldHVybnMge3N0cmluZ30gLSBUZXh0byB0cnVuY2Fkb1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHRydW5jYXRlKHRleHQsIG1heExlbmd0aCA9IDEwMCkge1xyXG4gIGlmICghdGV4dCkgcmV0dXJuICcnO1xyXG4gIGlmICh0ZXh0Lmxlbmd0aCA8PSBtYXhMZW5ndGgpIHJldHVybiB0ZXh0O1xyXG4gIFxyXG4gIHJldHVybiB0ZXh0LnN1YnN0cmluZygwLCBtYXhMZW5ndGgpICsgJy4uLic7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGEgdW0gZW1haWxcclxuICogQHBhcmFtIHtzdHJpbmd9IGVtYWlsIC0gRW1haWxcclxuICogQHJldHVybnMge2Jvb2xlYW59IC0gVHJ1ZSBzZSB2w6FsaWRvXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZEVtYWlsKGVtYWlsKSB7XHJcbiAgY29uc3QgcmUgPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcclxuICByZXR1cm4gcmUudGVzdChlbWFpbCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGEgdW0gQ05QSlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gY25waiAtIENOUEpcclxuICogQHJldHVybnMge2Jvb2xlYW59IC0gVHJ1ZSBzZSB2w6FsaWRvXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZENOUEooY25waikge1xyXG4gIGNvbnN0IGNsZWFuZWQgPSBjbnBqLnJlcGxhY2UoL1xcRC9nLCAnJyk7XHJcbiAgXHJcbiAgaWYgKGNsZWFuZWQubGVuZ3RoICE9PSAxNCkgcmV0dXJuIGZhbHNlO1xyXG4gIFxyXG4gIC8vIFZlcmlmaWNhIHNlIHRvZG9zIG9zIGTDrWdpdG9zIHPDo28gaWd1YWlzXHJcbiAgaWYgKC9eKFxcZClcXDErJC8udGVzdChjbGVhbmVkKSkgcmV0dXJuIGZhbHNlO1xyXG4gIFxyXG4gIC8vIFZhbGlkYcOnw6NvIGRvcyBkw61naXRvcyB2ZXJpZmljYWRvcmVzXHJcbiAgbGV0IGxlbmd0aCA9IGNsZWFuZWQubGVuZ3RoIC0gMjtcclxuICBsZXQgbnVtYmVycyA9IGNsZWFuZWQuc3Vic3RyaW5nKDAsIGxlbmd0aCk7XHJcbiAgY29uc3QgZGlnaXRzID0gY2xlYW5lZC5zdWJzdHJpbmcobGVuZ3RoKTtcclxuICBsZXQgc3VtID0gMDtcclxuICBsZXQgcG9zID0gbGVuZ3RoIC0gNztcclxuICBcclxuICBmb3IgKGxldCBpID0gbGVuZ3RoOyBpID49IDE7IGktLSkge1xyXG4gICAgc3VtICs9IG51bWJlcnMuY2hhckF0KGxlbmd0aCAtIGkpICogcG9zLS07XHJcbiAgICBpZiAocG9zIDwgMikgcG9zID0gOTtcclxuICB9XHJcbiAgXHJcbiAgbGV0IHJlc3VsdCA9IHN1bSAlIDExIDwgMiA/IDAgOiAxMSAtIChzdW0gJSAxMSk7XHJcbiAgaWYgKHJlc3VsdCAhPSBkaWdpdHMuY2hhckF0KDApKSByZXR1cm4gZmFsc2U7XHJcbiAgXHJcbiAgbGVuZ3RoID0gbGVuZ3RoICsgMTtcclxuICBudW1iZXJzID0gY2xlYW5lZC5zdWJzdHJpbmcoMCwgbGVuZ3RoKTtcclxuICBzdW0gPSAwO1xyXG4gIHBvcyA9IGxlbmd0aCAtIDc7XHJcbiAgXHJcbiAgZm9yIChsZXQgaSA9IGxlbmd0aDsgaSA+PSAxOyBpLS0pIHtcclxuICAgIHN1bSArPSBudW1iZXJzLmNoYXJBdChsZW5ndGggLSBpKSAqIHBvcy0tO1xyXG4gICAgaWYgKHBvcyA8IDIpIHBvcyA9IDk7XHJcbiAgfVxyXG4gIFxyXG4gIHJlc3VsdCA9IHN1bSAlIDExIDwgMiA/IDAgOiAxMSAtIChzdW0gJSAxMSk7XHJcbiAgaWYgKHJlc3VsdCAhPSBkaWdpdHMuY2hhckF0KDEpKSByZXR1cm4gZmFsc2U7XHJcbiAgXHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZWJvdW5jZSBkZSB1bWEgZnVuw6fDo29cclxuICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyAtIEZ1bsOnw6NvIGEgc2VyIGRlYm91bmNlZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdCAtIFRlbXBvIGRlIGVzcGVyYSBlbSBtc1xyXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IC0gRnVuw6fDo28gZGVib3VuY2VkXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCA9IDMwMCkge1xyXG4gIGxldCB0aW1lb3V0O1xyXG4gIFxyXG4gIHJldHVybiBmdW5jdGlvbiBleGVjdXRlZEZ1bmN0aW9uKC4uLmFyZ3MpIHtcclxuICAgIGNvbnN0IGxhdGVyID0gKCkgPT4ge1xyXG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XHJcbiAgICAgIGZ1bmMoLi4uYXJncyk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XHJcbiAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdlcmEgdW0gc2x1ZyBhIHBhcnRpciBkZSB1bSB0ZXh0b1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIFRleHRvXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IC0gU2x1Z1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNsdWdpZnkodGV4dCkge1xyXG4gIHJldHVybiB0ZXh0XHJcbiAgICAudG9TdHJpbmcoKVxyXG4gICAgLnRvTG93ZXJDYXNlKClcclxuICAgIC50cmltKClcclxuICAgIC5yZXBsYWNlKC9cXHMrL2csICctJylcclxuICAgIC5yZXBsYWNlKC9bXlxcdy1dKy9nLCAnJylcclxuICAgIC5yZXBsYWNlKC8tLSsvZywgJy0nKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENhbGN1bGEgYSBkaXN0w6JuY2lhIGVudHJlIGR1YXMgY29vcmRlbmFkYXMgKGVtIGttKVxyXG4gKiBAcGFyYW0ge251bWJlcn0gbGF0MSAtIExhdGl0dWRlIDFcclxuICogQHBhcmFtIHtudW1iZXJ9IGxvbjEgLSBMb25naXR1ZGUgMVxyXG4gKiBAcGFyYW0ge251bWJlcn0gbGF0MiAtIExhdGl0dWRlIDJcclxuICogQHBhcmFtIHtudW1iZXJ9IGxvbjIgLSBMb25naXR1ZGUgMlxyXG4gKiBAcmV0dXJucyB7bnVtYmVyfSAtIERpc3TDom5jaWEgZW0ga21cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVEaXN0YW5jZShsYXQxLCBsb24xLCBsYXQyLCBsb24yKSB7XHJcbiAgY29uc3QgUiA9IDYzNzE7IC8vIFJhaW8gZGEgVGVycmEgZW0ga21cclxuICBjb25zdCBkTGF0ID0gKGxhdDIgLSBsYXQxKSAqIE1hdGguUEkgLyAxODA7XHJcbiAgY29uc3QgZExvbiA9IChsb24yIC0gbG9uMSkgKiBNYXRoLlBJIC8gMTgwO1xyXG4gIGNvbnN0IGEgPSBcclxuICAgIE1hdGguc2luKGRMYXQgLyAyKSAqIE1hdGguc2luKGRMYXQgLyAyKSArXHJcbiAgICBNYXRoLmNvcyhsYXQxICogTWF0aC5QSSAvIDE4MCkgKiBNYXRoLmNvcyhsYXQyICogTWF0aC5QSSAvIDE4MCkgKlxyXG4gICAgTWF0aC5zaW4oZExvbiAvIDIpICogTWF0aC5zaW4oZExvbiAvIDIpO1xyXG4gIGNvbnN0IGMgPSAyICogTWF0aC5hdGFuMihNYXRoLnNxcnQoYSksIE1hdGguc3FydCgxIC0gYSkpO1xyXG4gIHJldHVybiBSICogYztcclxufSJdLCJ2ZXJzaW9uIjozfQ==