de59a7f6386daa6bc27bc86d4034964e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_router_dom_1 = require("react-router-dom");
const react_helmet_async_1 = require("react-helmet-async");
const supabaseClient_1 = require("@/lib/supabaseClient");
const button_1 = require("@/features/shared/components/ui/button");
const input_1 = require("@/features/shared/components/ui/input");
const textarea_1 = require("@/features/shared/components/ui/textarea");
const use_toast_1 = require("@/features/shared/components/ui/use-toast");
const lucide_react_1 = require("lucide-react");
const AuthContext_1 = require("@/contexts/AuthContext"); // Para verificar permissão
const EditEventPage = () => {
    const { id } = (0, react_router_dom_1.useParams)();
    const navigate = (0, react_router_dom_1.useNavigate)();
    const { user } = (0, AuthContext_1.useAuth)(); // Pegar usuário logado
    const [eventData, setEventData] = (0, react_1.useState)(null);
    const [loading, setLoading] = (0, react_1.useState)(true);
    const [error, setError] = (0, react_1.useState)(null);
    const [isSubmitting, setIsSubmitting] = (0, react_1.useState)(false);
    (0, react_1.useEffect)(() => {
        const fetchEvent = async () => {
            setLoading(true);
            setError(null);
            try {
                const { data, error: fetchError } = await supabaseClient_1.supabase
                    .from('events')
                    .select('*')
                    .eq('id', id)
                    .single();
                if (fetchError)
                    throw fetchError;
                if (!data)
                    throw new Error('Evento não encontrado');
                // Verificar se o usuário logado é o criador do evento
                if (data.creator_id !== user.id) {
                    throw new Error('Você não tem permissão para editar este evento.');
                }
                setEventData(data);
            }
            catch (err) {
                setError(err.message || 'Erro ao carregar evento.');
                console.error(err);
            }
            finally {
                setLoading(false);
            }
        };
        if (user) { // Só busca se o usuário estiver carregado
            fetchEvent();
        }
    }, [id, user]); // Depende do ID do evento e do usuário
    const handleChange = (e) => {
        const { name, value, type } = e.target;
        setEventData(prev => ({
            ...prev,
            // Garante que 'vagas' seja sempre um número
            [name]: type === 'number' ? parseInt(value, 10) || 0 : value
        }));
    };
    const handleSubmit = async (e) => {
        e.preventDefault();
        setIsSubmitting(true);
        setError(null);
        // eslint-disable-next-line no-unused-vars
        const { id: eventId, created_at, creator_id, partner, creator, status, cancelamento_motivo, ...updateData } = eventData;
        try {
            const { error: updateError } = await supabaseClient_1.supabase
                .from('events')
                .update({
                ...updateData,
                updated_at: new Date().toISOString() // Atualiza timestamp
            })
                .eq('id', eventId)
                .eq('creator_id', user.id); // Segurança extra: só atualiza se for o criador
            if (updateError)
                throw updateError;
            (0, use_toast_1.toast)({ title: "✅ Evento atualizado com sucesso!" });
            navigate('/meus-eventos'); // Volta para a lista após salvar
        }
        catch (err) {
            setError(err.message || 'Erro ao salvar alterações.');
            console.error(err);
            (0, use_toast_1.toast)({ variant: "destructive", title: "Erro ao salvar", description: err.message });
        }
        finally {
            setIsSubmitting(false);
        }
    };
    if (loading) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-center h-[calc(100vh-10rem)]", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Loader2, { className: "w-12 h-12 text-purple-500 animate-spin" }), (0, jsx_runtime_1.jsx)("p", { className: "ml-3 text-white/70", children: "Carregando evento..." })] }));
    }
    if (error) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col items-center justify-center h-[calc(100vh-10rem)] text-center", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.AlertTriangle, { className: "w-12 h-12 text-red-500 mb-4" }), (0, jsx_runtime_1.jsx)("h2", { className: "text-xl font-semibold text-white mb-2", children: error }), (0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: () => navigate('/meus-eventos'), children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-4 h-4 mr-2" }), "Voltar para Meus Eventos"] })] }));
    }
    if (!eventData) {
        // Caso de segurança, já tratado pelo 'error' mas bom ter
        return (0, jsx_runtime_1.jsx)("div", { children: "Evento n\u00E3o encontrado." });
    }
    return ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(react_helmet_async_1.Helmet, { children: (0, jsx_runtime_1.jsxs)("title", { children: ["Editar: ", eventData.title, " | Mesapra2"] }) }), (0, jsx_runtime_1.jsxs)("div", { className: "py-6 px-4 sm:px-6 lg:px-8 max-w-3xl mx-auto", children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { variant: "ghost", onClick: () => navigate('/meus-eventos'), className: "mb-4", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-4 h-4 mr-2" }), "Voltar para Meus Eventos"] }), (0, jsx_runtime_1.jsx)("h1", { className: "text-3xl font-bold text-white mb-6", children: "Editar Evento" }), (0, jsx_runtime_1.jsxs)("form", { onSubmit: handleSubmit, className: "space-y-6 glass-effect p-8 rounded-2xl border border-white/10", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "title", className: "block text-sm font-medium text-white/80 mb-1", children: "T\u00EDtulo do Evento" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "title", name: "title", value: eventData.title || '', onChange: handleChange, required: true, className: "bg-gray-800 border-gray-700" })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "description", className: "block text-sm font-medium text-white/80 mb-1", children: "Descri\u00E7\u00E3o" }), (0, jsx_runtime_1.jsx)(textarea_1.Textarea, { id: "description", name: "description", value: eventData.description || '', onChange: handleChange, rows: 4, className: "bg-gray-800 border-gray-700" })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "vagas", className: "block text-sm font-medium text-white/80 mb-1", children: "Vagas Dispon\u00EDveis" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "vagas", name: "vagas", type: "number", value: eventData.vagas || 0, onChange: handleChange, min: "0", required: true, className: "bg-gray-800 border-gray-700" }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-white/50 mt-1", children: "Defina o n\u00FAmero atual de vagas ABERTAS. Se aumentar, novas pessoas podem se candidatar." })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-4 pt-4 border-t border-white/10", children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { type: "submit", disabled: isSubmitting, className: "bg-gradient-to-r from-purple-500 to-pink-500", children: [isSubmitting ? (0, jsx_runtime_1.jsx)(lucide_react_1.Loader2, { className: "w-4 h-4 mr-2 animate-spin" }) : null, isSubmitting ? 'Salvando...' : 'Salvar Alterações'] }), (0, jsx_runtime_1.jsx)(button_1.Button, { type: "button", variant: "outline", onClick: () => navigate('/meus-eventos'), disabled: isSubmitting, children: "Cancelar" })] })] })] })] }));
};
exports.default = EditEventPage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcdXNlclxccGFnZXNcXEVkaXRFdmVudFBhZ2UuanN4IiwibWFwcGluZ3MiOiI7OztBQUFBLGlDQUE0QztBQUM1Qyx1REFBMEQ7QUFDMUQsMkRBQTRDO0FBQzVDLHlEQUFnRDtBQUNoRCxtRUFBZ0U7QUFDaEUsaUVBQThEO0FBQzlELHVFQUFvRTtBQUNwRSx5RUFBa0U7QUFDbEUsK0NBQWlFO0FBQ2pFLHdEQUFpRCxDQUFDLDJCQUEyQjtBQUU3RSxNQUFNLGFBQWEsR0FBRyxHQUFHLEVBQUU7SUFDekIsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUEsNEJBQVMsR0FBRSxDQUFDO0lBQzNCLE1BQU0sUUFBUSxHQUFHLElBQUEsOEJBQVcsR0FBRSxDQUFDO0lBQy9CLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFBLHFCQUFPLEdBQUUsQ0FBQyxDQUFDLHVCQUF1QjtJQUNuRCxNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxJQUFJLENBQUMsQ0FBQztJQUNqRCxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxJQUFJLENBQUMsQ0FBQztJQUM3QyxNQUFNLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxJQUFJLENBQUMsQ0FBQztJQUN6QyxNQUFNLENBQUMsWUFBWSxFQUFFLGVBQWUsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUV4RCxJQUFBLGlCQUFTLEVBQUMsR0FBRyxFQUFFO1FBQ2IsTUFBTSxVQUFVLEdBQUcsS0FBSyxJQUFJLEVBQUU7WUFDNUIsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNmLElBQUksQ0FBQztnQkFDSCxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxV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QyxLQUFLLElBQUksQ0FBQyxFQUMzQixRQUFRLEVBQUUsWUFBWSxFQUN0QixHQUFHLEVBQUMsR0FBRyxFQUNQLFFBQVEsUUFDUixTQUFTLEVBQUMsNkJBQTZCLEdBQ3ZDLEVBQ0YsOEJBQUcsU0FBUyxFQUFDLDRCQUE0Qiw2R0FFckMsSUFDQSxFQU1OLGlDQUFLLFNBQVMsRUFBQywwQ0FBMEMsYUFDdkQsd0JBQUMsZUFBTSxJQUFDLElBQUksRUFBQyxRQUFRLEVBQUMsUUFBUSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUMsOENBQThDLGFBQ25HLFlBQVksQ0FBQyxDQUFDLENBQUMsdUJBQUMsc0JBQU8sSUFBQyxTQUFTLEVBQUMsMkJBQTJCLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUN2RSxZQUFZLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsbUJBQW1CLElBQzVDLEVBQ1QsdUJBQUMsZUFBTSxJQUFDLElBQUksRUFBQyxRQUFRLEVBQUMsT0FBTyxFQUFDLFNBQVMsRUFBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxZQUFZLHlCQUUvRixJQUNMLElBQ0QsSUFDSCxJQUNMLENBQ0osQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGtCQUFlLGFBQWEsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXGZlYXR1cmVzXFx1c2VyXFxwYWdlc1xcRWRpdEV2ZW50UGFnZS5qc3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgdXNlUGFyYW1zLCB1c2VOYXZpZ2F0ZSB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xyXG5pbXBvcnQgeyBIZWxtZXQgfSBmcm9tICdyZWFjdC1oZWxtZXQtYXN5bmMnO1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJ0AvbGliL3N1cGFiYXNlQ2xpZW50JztcclxuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS9idXR0b24nO1xyXG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ0AvZmVhdHVyZXMvc2hhcmVkL2NvbXBvbmVudHMvdWkvaW5wdXQnO1xyXG5pbXBvcnQgeyBUZXh0YXJlYSB9IGZyb20gJ0AvZmVhdHVyZXMvc2hhcmVkL2NvbXBvbmVudHMvdWkvdGV4dGFyZWEnO1xyXG5pbXBvcnQgeyB0b2FzdCB9IGZyb20gJ0AvZmVhdHVyZXMvc2hhcmVkL2NvbXBvbmVudHMvdWkvdXNlLXRvYXN0JztcclxuaW1wb3J0IHsgTG9hZGVyMiwgQWxlcnRUcmlhbmdsZSwgQXJyb3dMZWZ0IH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcclxuaW1wb3J0IHsgdXNlQXV0aCB9IGZyb20gJ0AvY29udGV4dHMvQXV0aENvbnRleHQnOyAvLyBQYXJhIHZlcmlmaWNhciBwZXJtaXNzw6NvXHJcblxyXG5jb25zdCBFZGl0RXZlbnRQYWdlID0gKCkgPT4ge1xyXG4gIGNvbnN0IHsgaWQgfSA9IHVzZVBhcmFtcygpO1xyXG4gIGNvbnN0IG5hdmlnYXRlID0gdXNlTmF2aWdhdGUoKTtcclxuICBjb25zdCB7IHVzZXIgfSA9IHVzZUF1dGgoKTsgLy8gUGVnYXIgdXN1w6FyaW8gbG9nYWRvXHJcbiAgY29uc3QgW2V2ZW50RGF0YSwgc2V0RXZlbnREYXRhXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xyXG4gIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgY29uc3QgW2lzU3VibWl0dGluZywgc2V0SXNTdWJtaXR0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGNvbnN0IGZldGNoRXZlbnQgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIHNldExvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIHNldEVycm9yKG51bGwpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAgICAgLmVxKCdpZCcsIGlkKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZmV0Y2hFcnJvcikgdGhyb3cgZmV0Y2hFcnJvcjtcclxuICAgICAgICBpZiAoIWRhdGEpIHRocm93IG5ldyBFcnJvcignRXZlbnRvIG7Do28gZW5jb250cmFkbycpO1xyXG5cclxuICAgICAgICAvLyBWZXJpZmljYXIgc2UgbyB1c3XDoXJpbyBsb2dhZG8gw6kgbyBjcmlhZG9yIGRvIGV2ZW50b1xyXG4gICAgICAgIGlmIChkYXRhLmNyZWF0b3JfaWQgIT09IHVzZXIuaWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWb2PDqiBuw6NvIHRlbSBwZXJtaXNzw6NvIHBhcmEgZWRpdGFyIGVzdGUgZXZlbnRvLicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0RXZlbnREYXRhKGRhdGEpO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBzZXRFcnJvcihlcnIubWVzc2FnZSB8fCAnRXJybyBhbyBjYXJyZWdhciBldmVudG8uJyk7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgaWYgKHVzZXIpIHsgLy8gU8OzIGJ1c2NhIHNlIG8gdXN1w6FyaW8gZXN0aXZlciBjYXJyZWdhZG9cclxuICAgICAgICBmZXRjaEV2ZW50KCk7XHJcbiAgICB9XHJcbiAgfSwgW2lkLCB1c2VyXSk7IC8vIERlcGVuZGUgZG8gSUQgZG8gZXZlbnRvIGUgZG8gdXN1w6FyaW9cclxuXHJcbiAgY29uc3QgaGFuZGxlQ2hhbmdlID0gKGUpID0+IHtcclxuICAgIGNvbnN0IHsgbmFtZSwgdmFsdWUsIHR5cGUgfSA9IGUudGFyZ2V0O1xyXG4gICAgc2V0RXZlbnREYXRhKHByZXYgPT4gKHtcclxuICAgICAgLi4ucHJldixcclxuICAgICAgLy8gR2FyYW50ZSBxdWUgJ3ZhZ2FzJyBzZWphIHNlbXByZSB1bSBuw7ptZXJvXHJcbiAgICAgIFtuYW1lXTogdHlwZSA9PT0gJ251bWJlcicgPyBwYXJzZUludCh2YWx1ZSwgMTApIHx8IDAgOiB2YWx1ZVxyXG4gICAgfSkpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZVN1Ym1pdCA9IGFzeW5jIChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBzZXRJc1N1Ym1pdHRpbmcodHJ1ZSk7XHJcbiAgICBzZXRFcnJvcihudWxsKTtcclxuXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcclxuICAgIGNvbnN0IHsgaWQ6IGV2ZW50SWQsIGNyZWF0ZWRfYXQsIGNyZWF0b3JfaWQsIHBhcnRuZXIsIGNyZWF0b3IsIHN0YXR1cywgY2FuY2VsYW1lbnRvX21vdGl2bywgLi4udXBkYXRlRGF0YSB9ID0gZXZlbnREYXRhO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgICAuLi51cGRhdGVEYXRhLFxyXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgLy8gQXR1YWxpemEgdGltZXN0YW1wXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZClcclxuICAgICAgICAuZXEoJ2NyZWF0b3JfaWQnLCB1c2VyLmlkKTsgLy8gU2VndXJhbsOnYSBleHRyYTogc8OzIGF0dWFsaXphIHNlIGZvciBvIGNyaWFkb3JcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikgdGhyb3cgdXBkYXRlRXJyb3I7XHJcblxyXG4gICAgICB0b2FzdCh7IHRpdGxlOiBcIuKchSBFdmVudG8gYXR1YWxpemFkbyBjb20gc3VjZXNzbyFcIiB9KTtcclxuICAgICAgbmF2aWdhdGUoJy9tZXVzLWV2ZW50b3MnKTsgLy8gVm9sdGEgcGFyYSBhIGxpc3RhIGFww7NzIHNhbHZhclxyXG5cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBzZXRFcnJvcihlcnIubWVzc2FnZSB8fCAnRXJybyBhbyBzYWx2YXIgYWx0ZXJhw6fDtWVzLicpO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgIHRvYXN0KHsgdmFyaWFudDogXCJkZXN0cnVjdGl2ZVwiLCB0aXRsZTogXCJFcnJvIGFvIHNhbHZhclwiLCBkZXNjcmlwdGlvbjogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICBzZXRJc1N1Ym1pdHRpbmcoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGlmIChsb2FkaW5nKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtW2NhbGMoMTAwdmgtMTByZW0pXVwiPlxyXG4gICAgICAgIDxMb2FkZXIyIGNsYXNzTmFtZT1cInctMTIgaC0xMiB0ZXh0LXB1cnBsZS01MDAgYW5pbWF0ZS1zcGluXCIgLz5cclxuICAgICAgICA8cCBjbGFzc05hbWU9XCJtbC0zIHRleHQtd2hpdGUvNzBcIj5DYXJyZWdhbmRvIGV2ZW50by4uLjwvcD5cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtW2NhbGMoMTAwdmgtMTByZW0pXSB0ZXh0LWNlbnRlclwiPlxyXG4gICAgICAgIDxBbGVydFRyaWFuZ2xlIGNsYXNzTmFtZT1cInctMTIgaC0xMiB0ZXh0LXJlZC01MDAgbWItNFwiIC8+XHJcbiAgICAgICAgPGgyIGNsYXNzTmFtZT1cInRleHQteGwgZm9udC1zZW1pYm9sZCB0ZXh0LXdoaXRlIG1iLTJcIj57ZXJyb3J9PC9oMj5cclxuICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IG5hdmlnYXRlKCcvbWV1cy1ldmVudG9zJyl9PlxyXG4gICAgICAgICAgPEFycm93TGVmdCBjbGFzc05hbWU9XCJ3LTQgaC00IG1yLTJcIiAvPlxyXG4gICAgICAgICAgVm9sdGFyIHBhcmEgTWV1cyBFdmVudG9zXHJcbiAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGlmICghZXZlbnREYXRhKSB7XHJcbiAgICAgLy8gQ2FzbyBkZSBzZWd1cmFuw6dhLCBqw6EgdHJhdGFkbyBwZWxvICdlcnJvcicgbWFzIGJvbSB0ZXJcclxuICAgICByZXR1cm4gPGRpdj5FdmVudG8gbsOjbyBlbmNvbnRyYWRvLjwvZGl2PjtcclxuICB9XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8PlxyXG4gICAgICA8SGVsbWV0PlxyXG4gICAgICAgIDx0aXRsZT5FZGl0YXI6IHtldmVudERhdGEudGl0bGV9IHwgTWVzYXByYTI8L3RpdGxlPlxyXG4gICAgICA8L0hlbG1ldD5cclxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJweS02IHB4LTQgc206cHgtNiBsZzpweC04IG1heC13LTN4bCBteC1hdXRvXCI+XHJcbiAgICAgICAgPEJ1dHRvbiB2YXJpYW50PVwiZ2hvc3RcIiBvbkNsaWNrPXsoKSA9PiBuYXZpZ2F0ZSgnL21ldXMtZXZlbnRvcycpfSBjbGFzc05hbWU9XCJtYi00XCI+XHJcbiAgICAgICAgICAgIDxBcnJvd0xlZnQgY2xhc3NOYW1lPVwidy00IGgtNCBtci0yXCIgLz5cclxuICAgICAgICAgICAgVm9sdGFyIHBhcmEgTWV1cyBFdmVudG9zXHJcbiAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgPGgxIGNsYXNzTmFtZT1cInRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIG1iLTZcIj5FZGl0YXIgRXZlbnRvPC9oMT5cclxuXHJcbiAgICAgICAgPGZvcm0gb25TdWJtaXQ9e2hhbmRsZVN1Ym1pdH0gY2xhc3NOYW1lPVwic3BhY2UteS02IGdsYXNzLWVmZmVjdCBwLTggcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci13aGl0ZS8xMFwiPlxyXG4gICAgICAgICAgey8qIFTDrXR1bG8gKi99XHJcbiAgICAgICAgICA8ZGl2PlxyXG4gICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cInRpdGxlXCIgY2xhc3NOYW1lPVwiYmxvY2sgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LXdoaXRlLzgwIG1iLTFcIj5Uw610dWxvIGRvIEV2ZW50bzwvbGFiZWw+XHJcbiAgICAgICAgICAgIDxJbnB1dCBcclxuICAgICAgICAgICAgICBpZD1cInRpdGxlXCIgXHJcbiAgICAgICAgICAgICAgbmFtZT1cInRpdGxlXCIgXHJcbiAgICAgICAgICAgICAgdmFsdWU9e2V2ZW50RGF0YS50aXRsZSB8fCAnJ30gXHJcbiAgICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0gXHJcbiAgICAgICAgICAgICAgcmVxdWlyZWQgXHJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiYmctZ3JheS04MDAgYm9yZGVyLWdyYXktNzAwXCJcclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgIHsvKiBEZXNjcmnDp8OjbyAqL31cclxuICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgIDxsYWJlbCBodG1sRm9yPVwiZGVzY3JpcHRpb25cIiBjbGFzc05hbWU9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtd2hpdGUvODAgbWItMVwiPkRlc2NyacOnw6NvPC9sYWJlbD5cclxuICAgICAgICAgICAgPFRleHRhcmVhIFxyXG4gICAgICAgICAgICAgIGlkPVwiZGVzY3JpcHRpb25cIiBcclxuICAgICAgICAgICAgICBuYW1lPVwiZGVzY3JpcHRpb25cIiBcclxuICAgICAgICAgICAgICB2YWx1ZT17ZXZlbnREYXRhLmRlc2NyaXB0aW9uIHx8ICcnfSBcclxuICAgICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlfSBcclxuICAgICAgICAgICAgICByb3dzPXs0fVxyXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImJnLWdyYXktODAwIGJvcmRlci1ncmF5LTcwMFwiXHJcbiAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuXHJcbiAgICAgICAgICB7LyogVmFnYXMgRGlzcG9uw612ZWlzICovfVxyXG4gICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ2YWdhc1wiIGNsYXNzTmFtZT1cImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC13aGl0ZS84MCBtYi0xXCI+VmFnYXMgRGlzcG9uw612ZWlzPC9sYWJlbD5cclxuICAgICAgICAgICAgPElucHV0IFxyXG4gICAgICAgICAgICAgIGlkPVwidmFnYXNcIiBcclxuICAgICAgICAgICAgICBuYW1lPVwidmFnYXNcIiBcclxuICAgICAgICAgICAgICB0eXBlPVwibnVtYmVyXCIgXHJcbiAgICAgICAgICAgICAgdmFsdWU9e2V2ZW50RGF0YS52YWdhcyB8fCAwfSBcclxuICAgICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlfSBcclxuICAgICAgICAgICAgICBtaW49XCIwXCIgXHJcbiAgICAgICAgICAgICAgcmVxdWlyZWQgXHJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiYmctZ3JheS04MDAgYm9yZGVyLWdyYXktNzAwXCJcclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC14cyB0ZXh0LXdoaXRlLzUwIG10LTFcIj5cclxuICAgICAgICAgICAgICBEZWZpbmEgbyBuw7ptZXJvIGF0dWFsIGRlIHZhZ2FzIEFCRVJUQVMuIFNlIGF1bWVudGFyLCBub3ZhcyBwZXNzb2FzIHBvZGVtIHNlIGNhbmRpZGF0YXIuXHJcbiAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgIHsvKiBWb2PDqiBwb2RlIGFkaWNpb25hciBvdXRyb3MgY2FtcG9zIGFxdWkgc2UgcHJlY2lzYXIgKGRhdGEsIGhvcmEsIGV0Yy4pICovfVxyXG4gICAgICAgICAgey8qIExlbWJyZS1zZSBxdWUgY2FtcG9zIGNvbW8gc3RhcnRfdGltZS9lbmRfdGltZSBwcmVjaXNhbSBkZSBpbnB1dHMgdHlwZT1cImRhdGV0aW1lLWxvY2FsXCIgKi99XHJcblxyXG4gICAgICAgICAgey8qIEJvdMO1ZXMgKi99XHJcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZ2FwLTQgcHQtNCBib3JkZXItdCBib3JkZXItd2hpdGUvMTBcIj5cclxuICAgICAgICAgICAgPEJ1dHRvbiB0eXBlPVwic3VibWl0XCIgZGlzYWJsZWQ9e2lzU3VibWl0dGluZ30gY2xhc3NOYW1lPVwiYmctZ3JhZGllbnQtdG8tciBmcm9tLXB1cnBsZS01MDAgdG8tcGluay01MDBcIj5cclxuICAgICAgICAgICAgICB7aXNTdWJtaXR0aW5nID8gPExvYWRlcjIgY2xhc3NOYW1lPVwidy00IGgtNCBtci0yIGFuaW1hdGUtc3BpblwiIC8+IDogbnVsbH1cclxuICAgICAgICAgICAgICB7aXNTdWJtaXR0aW5nID8gJ1NhbHZhbmRvLi4uJyA6ICdTYWx2YXIgQWx0ZXJhw6fDtWVzJ31cclxuICAgICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgICAgIDxCdXR0b24gdHlwZT1cImJ1dHRvblwiIHZhcmlhbnQ9XCJvdXRsaW5lXCIgb25DbGljaz17KCkgPT4gbmF2aWdhdGUoJy9tZXVzLWV2ZW50b3MnKX0gZGlzYWJsZWQ9e2lzU3VibWl0dGluZ30+XHJcbiAgICAgICAgICAgICAgQ2FuY2VsYXJcclxuICAgICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Zvcm0+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC8+XHJcbiAgKTtcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEVkaXRFdmVudFBhZ2U7Il0sInZlcnNpb24iOjN9