{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\features\\user\\pages\\EditEventPage.jsx","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\features\\user\\pages\\EditEventPage.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { Helmet } from 'react-helmet-async';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport { Button } from '@/features/shared/components/ui/button';\r\nimport { Input } from '@/features/shared/components/ui/input';\r\nimport { Textarea } from '@/features/shared/components/ui/textarea';\r\nimport { toast } from '@/features/shared/components/ui/use-toast';\r\nimport { Loader2, AlertTriangle, ArrowLeft } from 'lucide-react';\r\nimport { useAuth } from '@/contexts/AuthContext'; // Para verificar permissão\r\n\r\nconst EditEventPage = () => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth(); // Pegar usuário logado\r\n  const [eventData, setEventData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchEvent = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      try {\r\n        const { data, error: fetchError } = await supabase\r\n          .from('events')\r\n          .select('*')\r\n          .eq('id', id)\r\n          .single();\r\n\r\n        if (fetchError) throw fetchError;\r\n        if (!data) throw new Error('Evento não encontrado');\r\n\r\n        // Verificar se o usuário logado é o criador do evento\r\n        if (data.creator_id !== user.id) {\r\n            throw new Error('Você não tem permissão para editar este evento.');\r\n        }\r\n\r\n        setEventData(data);\r\n      } catch (err) {\r\n        setError(err.message || 'Erro ao carregar evento.');\r\n        console.error(err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    if (user) { // Só busca se o usuário estiver carregado\r\n        fetchEvent();\r\n    }\r\n  }, [id, user]); // Depende do ID do evento e do usuário\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value, type } = e.target;\r\n    setEventData(prev => ({\r\n      ...prev,\r\n      // Garante que 'vagas' seja sempre um número\r\n      [name]: type === 'number' ? parseInt(value, 10) || 0 : value\r\n    }));\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setError(null);\r\n\r\n    // eslint-disable-next-line no-unused-vars\r\n    const { id: eventId, created_at, creator_id, partner, creator, status, cancelamento_motivo, ...updateData } = eventData;\r\n\r\n    try {\r\n      const { error: updateError } = await supabase\r\n        .from('events')\r\n        .update({\r\n            ...updateData,\r\n            updated_at: new Date().toISOString() // Atualiza timestamp\r\n        })\r\n        .eq('id', eventId)\r\n        .eq('creator_id', user.id); // Segurança extra: só atualiza se for o criador\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      toast({ title: \"✅ Evento atualizado com sucesso!\" });\r\n      navigate('/meus-eventos'); // Volta para a lista após salvar\r\n\r\n    } catch (err) {\r\n      setError(err.message || 'Erro ao salvar alterações.');\r\n      console.error(err);\r\n      toast({ variant: \"destructive\", title: \"Erro ao salvar\", description: err.message });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-[calc(100vh-10rem)]\">\r\n        <Loader2 className=\"w-12 h-12 text-purple-500 animate-spin\" />\r\n        <p className=\"ml-3 text-white/70\">Carregando evento...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-[calc(100vh-10rem)] text-center\">\r\n        <AlertTriangle className=\"w-12 h-12 text-red-500 mb-4\" />\r\n        <h2 className=\"text-xl font-semibold text-white mb-2\">{error}</h2>\r\n        <Button onClick={() => navigate('/meus-eventos')}>\r\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n          Voltar para Meus Eventos\r\n        </Button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!eventData) {\r\n     // Caso de segurança, já tratado pelo 'error' mas bom ter\r\n     return <div>Evento não encontrado.</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>Editar: {eventData.title} | Mesapra2</title>\r\n      </Helmet>\r\n      <div className=\"py-6 px-4 sm:px-6 lg:px-8 max-w-3xl mx-auto\">\r\n        <Button variant=\"ghost\" onClick={() => navigate('/meus-eventos')} className=\"mb-4\">\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            Voltar para Meus Eventos\r\n        </Button>\r\n        <h1 className=\"text-3xl font-bold text-white mb-6\">Editar Evento</h1>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-6 glass-effect p-8 rounded-2xl border border-white/10\">\r\n          {/* Título */}\r\n          <div>\r\n            <label htmlFor=\"title\" className=\"block text-sm font-medium text-white/80 mb-1\">Título do Evento</label>\r\n            <Input \r\n              id=\"title\" \r\n              name=\"title\" \r\n              value={eventData.title || ''} \r\n              onChange={handleChange} \r\n              required \r\n              className=\"bg-gray-800 border-gray-700\"\r\n            />\r\n          </div>\r\n\r\n          {/* Descrição */}\r\n          <div>\r\n            <label htmlFor=\"description\" className=\"block text-sm font-medium text-white/80 mb-1\">Descrição</label>\r\n            <Textarea \r\n              id=\"description\" \r\n              name=\"description\" \r\n              value={eventData.description || ''} \r\n              onChange={handleChange} \r\n              rows={4}\r\n              className=\"bg-gray-800 border-gray-700\"\r\n            />\r\n          </div>\r\n\r\n          {/* Vagas Disponíveis */}\r\n          <div>\r\n            <label htmlFor=\"vagas\" className=\"block text-sm font-medium text-white/80 mb-1\">Vagas Disponíveis</label>\r\n            <Input \r\n              id=\"vagas\" \r\n              name=\"vagas\" \r\n              type=\"number\" \r\n              value={eventData.vagas || 0} \r\n              onChange={handleChange} \r\n              min=\"0\" \r\n              required \r\n              className=\"bg-gray-800 border-gray-700\"\r\n            />\r\n            <p className=\"text-xs text-white/50 mt-1\">\r\n              Defina o número atual de vagas ABERTAS. Se aumentar, novas pessoas podem se candidatar.\r\n            </p>\r\n          </div>\r\n\r\n          {/* Você pode adicionar outros campos aqui se precisar (data, hora, etc.) */}\r\n          {/* Lembre-se que campos como start_time/end_time precisam de inputs type=\"datetime-local\" */}\r\n\r\n          {/* Botões */}\r\n          <div className=\"flex gap-4 pt-4 border-t border-white/10\">\r\n            <Button type=\"submit\" disabled={isSubmitting} className=\"bg-gradient-to-r from-purple-500 to-pink-500\">\r\n              {isSubmitting ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : null}\r\n              {isSubmitting ? 'Salvando...' : 'Salvar Alterações'}\r\n            </Button>\r\n            <Button type=\"button\" variant=\"outline\" onClick={() => navigate('/meus-eventos')} disabled={isSubmitting}>\r\n              Cancelar\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EditEventPage;"],"version":3}