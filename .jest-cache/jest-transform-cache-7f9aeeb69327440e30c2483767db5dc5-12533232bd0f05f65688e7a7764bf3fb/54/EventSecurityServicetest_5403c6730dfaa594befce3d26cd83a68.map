{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventSecurityService.test.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventSecurityService.test.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\r\n/* eslint-disable @typescript-eslint/no-unsafe-call */\r\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\r\n\r\n// src/services/EventSecurityService.test.ts\r\nimport { supabase } from '../lib/supabaseClient';\r\n\r\n// Mock do supabase ANTES de importar o serviço\r\njest.mock('../lib/supabaseClient', () => {\r\n  const from = jest.fn();\r\n  return {\r\n    supabase: {\r\n      from\r\n    }\r\n  };\r\n});\r\n\r\n// Importa o serviço DEPOIS do mock\r\nimport EventSecurityService from './EventSecurityService';\r\n\r\ndescribe('EventSecurityService', () => {\r\n  const mockedSupabase = supabase as unknown as {\r\n    from: jest.Mock;\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    jest.useRealTimers();\r\n  });\r\n\r\n  describe('generatePassword', () => {\r\n    it('gera uma senha de 4 dígitos numéricos', () => {\r\n      const password = EventSecurityService.generatePassword();\r\n\r\n      expect(password).toMatch(/^\\d{4}$/);\r\n      expect(password.length).toBe(4);\r\n    });\r\n  });\r\n\r\n  describe('savePasswordToEvent', () => {\r\n    it('retorna erro se a senha não tiver exatamente 4 dígitos', async () => {\r\n      const result = await EventSecurityService.savePasswordToEvent(1, '12');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe('Senha deve ser exatamente 4 dígitos');\r\n      expect(mockedSupabase.from).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('salva a senha no evento quando for válida', async () => {\r\n      const eq = jest.fn().mockResolvedValue({ error: null });\r\n      const update = jest.fn(() => ({ eq }));\r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        update\r\n      }));\r\n\r\n      const result = await EventSecurityService.savePasswordToEvent(42, '1234');\r\n\r\n      expect(result).toEqual({ success: true, password: '1234' });\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('events');\r\n      expect(update).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          event_entry_password: '1234'\r\n        })\r\n      );\r\n      expect(eq).toHaveBeenCalledWith('id', 42);\r\n    });\r\n\r\n    it('propaga erro do supabase', async () => {\r\n      const eq = jest.fn().mockResolvedValue({ error: new Error('db error') });\r\n      const update = jest.fn(() => ({ eq }));\r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        update\r\n      }));\r\n\r\n      const result = await EventSecurityService.savePasswordToEvent(99, '5678');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBeInstanceOf(Error);\r\n    });\r\n  });\r\n\r\n  describe('generateAndSavePassword', () => {\r\n    it('gera e salva uma senha', async () => {\r\n      const eq = jest.fn().mockResolvedValue({ error: null });\r\n      const update = jest.fn(() => ({ eq }));\r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        update\r\n      }));\r\n\r\n      const result = await EventSecurityService.generateAndSavePassword(10);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.password).toMatch(/^\\d{4}$/);\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('events');\r\n      expect(update).toHaveBeenCalled();\r\n      expect(eq).toHaveBeenCalledWith('id', 10);\r\n    });\r\n  });\r\n\r\n  describe('isEntryTimeValid', () => {\r\n    it('retorna \"Evento não encontrado\" quando não há evento', async () => {\r\n      const single = jest.fn().mockResolvedValue({ data: null, error: null });\r\n      const eq = jest.fn(() => ({ single }));\r\n      const select = jest.fn(() => ({ eq }));\r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        select\r\n      }));\r\n\r\n      const result = await EventSecurityService.isEntryTimeValid(123);\r\n\r\n      expect(result.allowed).toBe(false);\r\n      expect(result.reason).toBe('Evento não encontrado');\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('events');\r\n    });\r\n\r\n    it('retorna allowed=true quando está dentro da janela de entrada e status é válido', async () => {\r\n      // agora: 2025-11-02T15:00:00Z\r\n      jest.useFakeTimers().setSystemTime(new Date('2025-11-02T15:00:00Z'));\r\n\r\n      const event = {\r\n        start_time: '2025-11-02T15:00:30Z', // começa 30s depois → já passou de 1 min antes\r\n        end_time: '2025-11-02T16:00:00Z',\r\n        status: 'Confirmado'\r\n      };\r\n\r\n      const single = jest.fn().mockResolvedValue({ data: event, error: null });\r\n      const eq = jest.fn(() => ({ single }));\r\n      const select = jest.fn(() => ({ eq }));\r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        select\r\n      }));\r\n\r\n      const result = await EventSecurityService.isEntryTimeValid(1);\r\n\r\n      expect(result.allowed).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('validateEntryPassword', () => {\r\n    it('nega acesso quando o timing não permite', async () => {\r\n      const timingSpy = jest\r\n        .spyOn(EventSecurityService, 'isEntryTimeValid')\r\n        .mockResolvedValue({ allowed: false, reason: 'Entrada encerrada' });\r\n\r\n      const result = await EventSecurityService.validateEntryPassword({\r\n        eventId: 1,\r\n        participantId: 'user-1',\r\n        password: '1234'\r\n      });\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.message).toBe('Entrada encerrada');\r\n      expect(timingSpy).toHaveBeenCalledWith(1);\r\n      timingSpy.mockRestore();\r\n    });\r\n\r\n    it('nega acesso quando a senha está errada', async () => {\r\n      jest\r\n        .spyOn(EventSecurityService, 'isEntryTimeValid')\r\n        .mockResolvedValue({ allowed: true });\r\n\r\n      // 1ª chamada: events\r\n      const singleEvent = jest.fn().mockResolvedValue({\r\n        data: {\r\n          event_entry_password: '9999',\r\n          status: 'Confirmado'\r\n        },\r\n        error: null\r\n      });\r\n      const eqEvent = jest.fn(() => ({ single: singleEvent }));\r\n      const selectEvent = jest.fn(() => ({ eq: eqEvent }));\r\n\r\n      mockedSupabase.from.mockImplementationOnce(() => ({\r\n        select: selectEvent\r\n      }));\r\n\r\n      const result = await EventSecurityService.validateEntryPassword({\r\n        eventId: 1,\r\n        participantId: 'user-1',\r\n        password: '1234'\r\n      });\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.message).toBe('Senha incorreta. Tente novamente.');\r\n    });\r\n\r\n    it('concede acesso e registra participação quando a senha está correta', async () => {\r\n      jest\r\n        .spyOn(EventSecurityService, 'isEntryTimeValid')\r\n        .mockResolvedValue({ allowed: true });\r\n\r\n      // 1ª chamada → events\r\n      const singleEvent = jest.fn().mockResolvedValue({\r\n        data: {\r\n          event_entry_password: '1234',\r\n          status: 'Confirmado'\r\n        },\r\n        error: null\r\n      });\r\n      const eqEvent = jest.fn(() => ({ single: singleEvent }));\r\n      const selectEvent = jest.fn(() => ({ eq: eqEvent }));\r\n\r\n      // 2ª chamada → event_participants (update com dois .eq() encadeados)\r\n      const secondEq = jest.fn().mockResolvedValue({ error: null });\r\n      const firstEq = jest.fn(() => ({ eq: secondEq }));\r\n      const updateParticipant = jest.fn(() => ({ eq: firstEq }));\r\n\r\n      mockedSupabase.from\r\n        // chamada do events\r\n        .mockImplementationOnce(() => ({\r\n          select: selectEvent\r\n        }))\r\n        // chamada do event_participants\r\n        .mockImplementationOnce(() => ({\r\n          update: updateParticipant\r\n        }));\r\n\r\n      const result = await EventSecurityService.validateEntryPassword({\r\n        eventId: 1,\r\n        participantId: 'user-1',\r\n        password: '1234'\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.message).toBe('✅ Acesso liberado! Bem-vindo ao evento.');\r\n      expect(updateParticipant).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          com_acesso: true\r\n        })\r\n      );\r\n      expect(firstEq).toHaveBeenCalledWith('event_id', 1);\r\n      expect(secondEq).toHaveBeenCalledWith('user_id', 'user-1');\r\n    });\r\n  });\r\n\r\n  describe('hasUserAccess', () => {\r\n    it('retorna true quando o participante já tem acesso', async () => {\r\n      const single = jest.fn().mockResolvedValue({\r\n        data: {\r\n          com_acesso: true\r\n        },\r\n        error: null\r\n      });\r\n      const secondEq = jest.fn(() => ({ single }));\r\n      const firstEq = jest.fn(() => ({ eq: secondEq }));\r\n      const select = jest.fn(() => ({ eq: firstEq }));\r\n      \r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        select\r\n      }));\r\n\r\n      const hasAccess = await EventSecurityService.hasUserAccess(1, 'user-1');\r\n\r\n      expect(hasAccess).toBe(true);\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('event_participants');\r\n    });\r\n\r\n    it('retorna false quando não encontrar o participante', async () => {\r\n      const single = jest.fn().mockResolvedValue({\r\n        data: null,\r\n        error: { code: 'PGRST116' }\r\n      });\r\n      const secondEq = jest.fn(() => ({ single }));\r\n      const firstEq = jest.fn(() => ({ eq: secondEq }));\r\n      const select = jest.fn(() => ({ eq: firstEq }));\r\n      \r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        select\r\n      }));\r\n\r\n      const hasAccess = await EventSecurityService.hasUserAccess(1, 'user-2');\r\n\r\n      expect(hasAccess).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('lockEventEntry', () => {\r\n    it('bloqueia a entrada no evento', async () => {\r\n      const eq = jest.fn().mockResolvedValue({ error: null });\r\n      const update = jest.fn(() => ({ eq }));\r\n      mockedSupabase.from.mockImplementation(() => ({\r\n        update\r\n      }));\r\n\r\n      const result = await EventSecurityService.lockEventEntry(7);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('events');\r\n      expect(update).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          entry_locked: true\r\n        })\r\n      );\r\n      expect(eq).toHaveBeenCalledWith('id', 7);\r\n    });\r\n  });\r\n\r\n  describe('getEntryStatus', () => {\r\n    it('retorna status formatado do evento', async () => {\r\n      // 1ª chamada → events\r\n      mockedSupabase.from\r\n        .mockImplementationOnce(() => ({\r\n          select: jest.fn(() => ({\r\n            eq: jest.fn(() => ({\r\n              single: jest.fn().mockResolvedValue({\r\n                data: {\r\n                  event_entry_password: '4321',\r\n                  entry_locked: false,\r\n                  entry_locked_at: null,\r\n                  entry_opened_at: '2025-11-02T14:59:00Z'\r\n                },\r\n                error: null\r\n              })\r\n            }))\r\n          }))\r\n        }))\r\n        // 2ª chamada → event_participants\r\n        .mockImplementationOnce(() => ({\r\n          select: jest.fn(() => ({\r\n            eq: jest.fn().mockResolvedValue({\r\n              data: [\r\n                { com_acesso: true },\r\n                { com_acesso: false },\r\n                { com_acesso: true }\r\n              ],\r\n              error: null\r\n            })\r\n          }))\r\n        }));\r\n\r\n      const result = await EventSecurityService.getEntryStatus(55);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toEqual({\r\n        password: '4321',\r\n        isLocked: false,\r\n        lockedAt: null,\r\n        openedAt: '2025-11-02T14:59:00Z',\r\n        totalWithAccess: 2,\r\n        totalParticipants: 3\r\n      });\r\n    });\r\n  });\r\n});"],"version":3}