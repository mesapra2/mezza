69ec27b827f19ac701ec5ab4c981920c
"use strict";
/* eslint-disable @typescript-eslint/no-explicit-any */
/* eslint-disable @typescript-eslint/no-unsafe-assignment */
/* eslint-disable @typescript-eslint/no-unsafe-call */
/* eslint-disable @typescript-eslint/no-unsafe-member-access */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
// Mock do supabase ANTES de importar o serviço
jest.mock('../lib/supabaseClient', () => {
    const from = jest.fn();
    return {
        supabase: {
            from
        }
    };
});
// src/services/EventSecurityService.test.ts
const supabaseClient_1 = require("../lib/supabaseClient");
// Importa o serviço DEPOIS do mock
const EventSecurityService_1 = tslib_1.__importDefault(require("./EventSecurityService"));
describe('EventSecurityService', () => {
    const mockedSupabase = supabaseClient_1.supabase;
    beforeEach(() => {
        jest.clearAllMocks();
        jest.useRealTimers();
    });
    describe('generatePassword', () => {
        it('gera uma senha de 4 dígitos numéricos', () => {
            const password = EventSecurityService_1.default.generatePassword();
            expect(password).toMatch(/^\d{4}$/);
            expect(password.length).toBe(4);
        });
    });
    describe('savePasswordToEvent', () => {
        it('retorna erro se a senha não tiver exatamente 4 dígitos', async () => {
            const result = await EventSecurityService_1.default.savePasswordToEvent(1, '12');
            expect(result.success).toBe(false);
            expect(result.error).toBe('Senha deve ser exatamente 4 dígitos');
            expect(mockedSupabase.from).not.toHaveBeenCalled();
        });
        it('salva a senha no evento quando for válida', async () => {
            const eq = jest.fn().mockResolvedValue({ error: null });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.savePasswordToEvent(42, '1234');
            expect(result).toEqual({ success: true, password: '1234' });
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
            expect(update).toHaveBeenCalledWith(expect.objectContaining({
                event_entry_password: '1234'
            }));
            expect(eq).toHaveBeenCalledWith('id', 42);
        });
        it('propaga erro do supabase', async () => {
            const eq = jest.fn().mockResolvedValue({ error: new Error('db error') });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.savePasswordToEvent(99, '5678');
            expect(result.success).toBe(false);
            expect(result.error).toBeInstanceOf(Error);
        });
    });
    describe('generateAndSavePassword', () => {
        it('gera e salva uma senha', async () => {
            const eq = jest.fn().mockResolvedValue({ error: null });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.generateAndSavePassword(10);
            expect(result.success).toBe(true);
            expect(result.password).toMatch(/^\d{4}$/);
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
            expect(update).toHaveBeenCalled();
            expect(eq).toHaveBeenCalledWith('id', 10);
        });
    });
    describe('isEntryTimeValid', () => {
        it('retorna "Evento não encontrado" quando não há evento', async () => {
            const single = jest.fn().mockResolvedValue({ data: null, error: null });
            const eq = jest.fn(() => ({ single }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const result = await EventSecurityService_1.default.isEntryTimeValid(123);
            expect(result.allowed).toBe(false);
            expect(result.reason).toBe('Evento não encontrado');
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
        });
        it('retorna allowed=true quando está dentro da janela de entrada e status é válido', async () => {
            // agora: 2025-11-02T15:00:00Z
            jest.useFakeTimers().setSystemTime(new Date('2025-11-02T15:00:00Z'));
            const event = {
                start_time: '2025-11-02T15:00:30Z', // começa 30s depois → já passou de 1 min antes
                end_time: '2025-11-02T16:00:00Z',
                status: 'Confirmado'
            };
            const single = jest.fn().mockResolvedValue({ data: event, error: null });
            const eq = jest.fn(() => ({ single }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const result = await EventSecurityService_1.default.isEntryTimeValid(1);
            expect(result.allowed).toBe(true);
        });
    });
    describe('validateEntryPassword', () => {
        it('nega acesso quando o timing não permite', async () => {
            const timingSpy = jest
                .spyOn(EventSecurityService_1.default, 'isEntryTimeValid')
                .mockResolvedValue({ allowed: false, reason: 'Entrada encerrada' });
            const result = await EventSecurityService_1.default.validateEntryPassword({
                eventId: 1,
                participantId: 'user-1',
                password: '1234'
            });
            expect(result.success).toBe(false);
            expect(result.message).toBe('Entrada encerrada');
            expect(timingSpy).toHaveBeenCalledWith(1);
            timingSpy.mockRestore();
        });
        it('nega acesso quando a senha está errada', async () => {
            jest
                .spyOn(EventSecurityService_1.default, 'isEntryTimeValid')
                .mockResolvedValue({ allowed: true });
            // 1ª chamada: events
            const singleEvent = jest.fn().mockResolvedValue({
                data: {
                    event_entry_password: '9999',
                    status: 'Confirmado'
                },
                error: null
            });
            const eqEvent = jest.fn(() => ({ single: singleEvent }));
            const selectEvent = jest.fn(() => ({ eq: eqEvent }));
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: selectEvent
            }));
            const result = await EventSecurityService_1.default.validateEntryPassword({
                eventId: 1,
                participantId: 'user-1',
                password: '1234'
            });
            expect(result.success).toBe(false);
            expect(result.message).toBe('Senha incorreta. Tente novamente.');
        });
        it('concede acesso e registra participação quando a senha está correta', async () => {
            jest
                .spyOn(EventSecurityService_1.default, 'isEntryTimeValid')
                .mockResolvedValue({ allowed: true });
            // 1ª chamada → events
            const singleEvent = jest.fn().mockResolvedValue({
                data: {
                    event_entry_password: '1234',
                    status: 'Confirmado'
                },
                error: null
            });
            const eqEvent = jest.fn(() => ({ single: singleEvent }));
            const selectEvent = jest.fn(() => ({ eq: eqEvent }));
            // 2ª chamada → event_participants (update com dois .eq() encadeados)
            const secondEq = jest.fn().mockResolvedValue({ error: null });
            const firstEq = jest.fn(() => ({ eq: secondEq }));
            const updateParticipant = jest.fn(() => ({ eq: firstEq }));
            mockedSupabase.from
                // chamada do events
                .mockImplementationOnce(() => ({
                select: selectEvent
            }))
                // chamada do event_participants
                .mockImplementationOnce(() => ({
                update: updateParticipant
            }));
            const result = await EventSecurityService_1.default.validateEntryPassword({
                eventId: 1,
                participantId: 'user-1',
                password: '1234'
            });
            expect(result.success).toBe(true);
            expect(result.message).toBe('✅ Acesso liberado! Bem-vindo ao evento.');
            expect(updateParticipant).toHaveBeenCalledWith(expect.objectContaining({
                com_acesso: true
            }));
            expect(firstEq).toHaveBeenCalledWith('event_id', 1);
            expect(secondEq).toHaveBeenCalledWith('user_id', 'user-1');
        });
    });
    describe('hasUserAccess', () => {
        it('retorna true quando o participante já tem acesso', async () => {
            const single = jest.fn().mockResolvedValue({
                data: {
                    com_acesso: true
                },
                error: null
            });
            const secondEq = jest.fn(() => ({ single }));
            const firstEq = jest.fn(() => ({ eq: secondEq }));
            const select = jest.fn(() => ({ eq: firstEq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const hasAccess = await EventSecurityService_1.default.hasUserAccess(1, 'user-1');
            expect(hasAccess).toBe(true);
            expect(mockedSupabase.from).toHaveBeenCalledWith('event_participants');
        });
        it('retorna false quando não encontrar o participante', async () => {
            const single = jest.fn().mockResolvedValue({
                data: null,
                error: { code: 'PGRST116' }
            });
            const secondEq = jest.fn(() => ({ single }));
            const firstEq = jest.fn(() => ({ eq: secondEq }));
            const select = jest.fn(() => ({ eq: firstEq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const hasAccess = await EventSecurityService_1.default.hasUserAccess(1, 'user-2');
            expect(hasAccess).toBe(false);
        });
    });
    describe('lockEventEntry', () => {
        it('bloqueia a entrada no evento', async () => {
            const eq = jest.fn().mockResolvedValue({ error: null });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.lockEventEntry(7);
            expect(result.success).toBe(true);
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
            expect(update).toHaveBeenCalledWith(expect.objectContaining({
                entry_locked: true
            }));
            expect(eq).toHaveBeenCalledWith('id', 7);
        });
    });
    describe('getEntryStatus', () => {
        it('retorna status formatado do evento', async () => {
            // 1ª chamada → events
            mockedSupabase.from
                .mockImplementationOnce(() => ({
                select: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        single: jest.fn().mockResolvedValue({
                            data: {
                                event_entry_password: '4321',
                                entry_locked: false,
                                entry_locked_at: null,
                                entry_opened_at: '2025-11-02T14:59:00Z'
                            },
                            error: null
                        })
                    }))
                }))
            }))
                // 2ª chamada → event_participants
                .mockImplementationOnce(() => ({
                select: jest.fn(() => ({
                    eq: jest.fn().mockResolvedValue({
                        data: [
                            { com_acesso: true },
                            { com_acesso: false },
                            { com_acesso: true }
                        ],
                        error: null
                    })
                }))
            }));
            const result = await EventSecurityService_1.default.getEntryStatus(55);
            expect(result.success).toBe(true);
            expect(result.data).toEqual({
                password: '4321',
                isLocked: false,
                lockedAt: null,
                openedAt: '2025-11-02T14:59:00Z',
                totalWithAccess: 2,
                totalParticipants: 3
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRTZWN1cml0eVNlcnZpY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUEsdURBQXVEO0FBQ3ZELDREQUE0RDtBQUM1RCxzREFBc0Q7QUFDdEQsK0RBQStEOzs7QUFLL0QsK0NBQStDO0FBQy9DLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUN2QixPQUFPO1FBQ0wsUUFBUSxFQUFFO1lBQ1IsSUFBSTtTQUNMO0tBQ0YsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBWEgsNENBQTRDO0FBQzVDLDBEQUFpRDtBQVlqRCxtQ0FBbUM7QUFDbkMsMEZBQTBEO0FBRTFELFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsTUFBTSxjQUFjLEdBQUcseUJBRXRCLENBQUM7SUFFRixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUMvQyxNQUFNLFFBQVEsR0FBRyw4QkFBb0IsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBRXpELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLHdE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O2FBQ0osQ0FBQyxDQUFDO2dCQUNILGtDQUFrQztpQkFDakMsc0JBQXNCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDN0IsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztvQkFDckIsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQzt3QkFDOUIsSUFBSSxFQUFFOzRCQUNKLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRTs0QkFDcEIsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFOzRCQUNyQixFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUU7eUJBQ3JCO3dCQUNELEtBQUssRUFBRSxJQUFJO3FCQUNaLENBQUM7aUJBQ0gsQ0FBQyxDQUFDO2FBQ0osQ0FBQyxDQUFDLENBQUM7WUFFTixNQUFNLE1BQU0sR0FBRyxNQUFNLDhCQUFvQixDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUU3RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDMUIsUUFBUSxFQUFFLE1BQU07Z0JBQ2hCLFFBQVEsRUFBRSxLQUFLO2dCQUNmLFFBQVEsRUFBRSxJQUFJO2dCQUNkLFFBQVEsRUFBRSxzQkFBc0I7Z0JBQ2hDLGVBQWUsRUFBRSxDQUFDO2dCQUNsQixpQkFBaUIsRUFBRSxDQUFDO2FBQ3JCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXHNlcnZpY2VzXFxFdmVudFNlY3VyaXR5U2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi9cclxuLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hc3NpZ25tZW50ICovXHJcbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtY2FsbCAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLW1lbWJlci1hY2Nlc3MgKi9cclxuXHJcbi8vIHNyYy9zZXJ2aWNlcy9FdmVudFNlY3VyaXR5U2VydmljZS50ZXN0LnRzXHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vbGliL3N1cGFiYXNlQ2xpZW50JztcclxuXHJcbi8vIE1vY2sgZG8gc3VwYWJhc2UgQU5URVMgZGUgaW1wb3J0YXIgbyBzZXJ2acOnb1xyXG5qZXN0Lm1vY2soJy4uL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+IHtcclxuICBjb25zdCBmcm9tID0gamVzdC5mbigpO1xyXG4gIHJldHVybiB7XHJcbiAgICBzdXBhYmFzZToge1xyXG4gICAgICBmcm9tXHJcbiAgICB9XHJcbiAgfTtcclxufSk7XHJcblxyXG4vLyBJbXBvcnRhIG8gc2VydmnDp28gREVQT0lTIGRvIG1vY2tcclxuaW1wb3J0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlIGZyb20gJy4vRXZlbnRTZWN1cml0eVNlcnZpY2UnO1xyXG5cclxuZGVzY3JpYmUoJ0V2ZW50U2VjdXJpdHlTZXJ2aWNlJywgKCkgPT4ge1xyXG4gIGNvbnN0IG1vY2tlZFN1cGFiYXNlID0gc3VwYWJhc2UgYXMgdW5rbm93biBhcyB7XHJcbiAgICBmcm9tOiBqZXN0Lk1vY2s7XHJcbiAgfTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIGplc3QudXNlUmVhbFRpbWVycygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2VuZXJhdGVQYXNzd29yZCcsICgpID0+IHtcclxuICAgIGl0KCdnZXJhIHVtYSBzZW5oYSBkZSA0IGTDrWdpdG9zIG51bcOpcmljb3MnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gRXZlbnRTZWN1cml0eVNlcnZpY2UuZ2VuZXJhdGVQYXNzd29yZCgpO1xyXG5cclxuICAgICAgZXhwZWN0KHBhc3N3b3JkKS50b01hdGNoKC9eXFxkezR9JC8pO1xyXG4gICAgICBleHBlY3QocGFzc3dvcmQubGVuZ3RoKS50b0JlKDQpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdzYXZlUGFzc3dvcmRUb0V2ZW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldG9ybmEgZXJybyBzZSBhIHNlbmhhIG7Do28gdGl2ZXIgZXhhdGFtZW50ZSA0IGTDrWdpdG9zJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS5zYXZlUGFzc3dvcmRUb0V2ZW50KDEsICcxMicpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgnU2VuaGEgZGV2ZSBzZXIgZXhhdGFtZW50ZSA0IGTDrWdpdG9zJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3NhbHZhIGEgc2VuaGEgbm8gZXZlbnRvIHF1YW5kbyBmb3IgdsOhbGlkYScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgdXBkYXRlXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLnNhdmVQYXNzd29yZFRvRXZlbnQoNDIsICcxMjM0Jyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgc3VjY2VzczogdHJ1ZSwgcGFzc3dvcmQ6ICcxMjM0JyB9KTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudHMnKTtcclxuICAgICAgZXhwZWN0KHVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgZXZlbnRfZW50cnlfcGFzc3dvcmQ6ICcxMjM0J1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChlcSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2lkJywgNDIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Byb3BhZ2EgZXJybyBkbyBzdXBhYmFzZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbmV3IEVycm9yKCdkYiBlcnJvcicpIH0pO1xyXG4gICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCgpID0+ICh7IGVxIH0pKTtcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICB1cGRhdGVcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2Uuc2F2ZVBhc3N3b3JkVG9FdmVudCg5OSwgJzU2NzgnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmVJbnN0YW5jZU9mKEVycm9yKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2VuZXJhdGVBbmRTYXZlUGFzc3dvcmQnLCAoKSA9PiB7XHJcbiAgICBpdCgnZ2VyYSBlIHNhbHZhIHVtYSBzZW5oYScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgdXBkYXRlXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmdlbmVyYXRlQW5kU2F2ZVBhc3N3b3JkKDEwKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5wYXNzd29yZCkudG9NYXRjaCgvXlxcZHs0fSQvKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudHMnKTtcclxuICAgICAgZXhwZWN0KHVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QoZXEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpZCcsIDEwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnaXNFbnRyeVRpbWVWYWxpZCcsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIFwiRXZlbnRvIG7Do28gZW5jb250cmFkb1wiIHF1YW5kbyBuw6NvIGjDoSBldmVudG8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG51bGwsIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBlcSA9IGplc3QuZm4oKCkgPT4gKHsgc2luZ2xlIH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0XHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmlzRW50cnlUaW1lVmFsaWQoMTIzKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucmVhc29uKS50b0JlKCdFdmVudG8gbsOjbyBlbmNvbnRyYWRvJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXZlbnRzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBhbGxvd2VkPXRydWUgcXVhbmRvIGVzdMOhIGRlbnRybyBkYSBqYW5lbGEgZGUgZW50cmFkYSBlIHN0YXR1cyDDqSB2w6FsaWRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBhZ29yYTogMjAyNS0xMS0wMlQxNTowMDowMFpcclxuICAgICAgamVzdC51c2VGYWtlVGltZXJzKCkuc2V0U3lzdGVtVGltZShuZXcgRGF0ZSgnMjAyNS0xMS0wMlQxNTowMDowMFonKSk7XHJcblxyXG4gICAgICBjb25zdCBldmVudCA9IHtcclxuICAgICAgICBzdGFydF90aW1lOiAnMjAyNS0xMS0wMlQxNTowMDozMFonLCAvLyBjb21lw6dhIDMwcyBkZXBvaXMg4oaSIGrDoSBwYXNzb3UgZGUgMSBtaW4gYW50ZXNcclxuICAgICAgICBlbmRfdGltZTogJzIwMjUtMTEtMDJUMTY6MDA6MDBaJyxcclxuICAgICAgICBzdGF0dXM6ICdDb25maXJtYWRvJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3Qgc2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogZXZlbnQsIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBlcSA9IGplc3QuZm4oKCkgPT4gKHsgc2luZ2xlIH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0XHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmlzRW50cnlUaW1lVmFsaWQoMSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlRW50cnlQYXNzd29yZCcsICgpID0+IHtcclxuICAgIGl0KCduZWdhIGFjZXNzbyBxdWFuZG8gbyB0aW1pbmcgbsOjbyBwZXJtaXRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0aW1pbmdTcHkgPSBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50U2VjdXJpdHlTZXJ2aWNlLCAnaXNFbnRyeVRpbWVWYWxpZCcpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWxsb3dlZDogZmFsc2UsIHJlYXNvbjogJ0VudHJhZGEgZW5jZXJyYWRhJyB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLnZhbGlkYXRlRW50cnlQYXNzd29yZCh7XHJcbiAgICAgICAgZXZlbnRJZDogMSxcclxuICAgICAgICBwYXJ0aWNpcGFudElkOiAndXNlci0xJyxcclxuICAgICAgICBwYXNzd29yZDogJzEyMzQnXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0JlKCdFbnRyYWRhIGVuY2VycmFkYScpO1xyXG4gICAgICBleHBlY3QodGltaW5nU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgxKTtcclxuICAgICAgdGltaW5nU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnbmVnYSBhY2Vzc28gcXVhbmRvIGEgc2VuaGEgZXN0w6EgZXJyYWRhJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50U2VjdXJpdHlTZXJ2aWNlLCAnaXNFbnRyeVRpbWVWYWxpZCcpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWxsb3dlZDogdHJ1ZSB9KTtcclxuXHJcbiAgICAgIC8vIDHCqiBjaGFtYWRhOiBldmVudHNcclxuICAgICAgY29uc3Qgc2luZ2xlRXZlbnQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIGV2ZW50X2VudHJ5X3Bhc3N3b3JkOiAnOTk5OScsXHJcbiAgICAgICAgICBzdGF0dXM6ICdDb25maXJtYWRvJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGVxRXZlbnQgPSBqZXN0LmZuKCgpID0+ICh7IHNpbmdsZTogc2luZ2xlRXZlbnQgfSkpO1xyXG4gICAgICBjb25zdCBzZWxlY3RFdmVudCA9IGplc3QuZm4oKCkgPT4gKHsgZXE6IGVxRXZlbnQgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0OiBzZWxlY3RFdmVudFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS52YWxpZGF0ZUVudHJ5UGFzc3dvcmQoe1xyXG4gICAgICAgIGV2ZW50SWQ6IDEsXHJcbiAgICAgICAgcGFydGljaXBhbnRJZDogJ3VzZXItMScsXHJcbiAgICAgICAgcGFzc3dvcmQ6ICcxMjM0J1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9CZSgnU2VuaGEgaW5jb3JyZXRhLiBUZW50ZSBub3ZhbWVudGUuJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29uY2VkZSBhY2Vzc28gZSByZWdpc3RyYSBwYXJ0aWNpcGHDp8OjbyBxdWFuZG8gYSBzZW5oYSBlc3TDoSBjb3JyZXRhJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50U2VjdXJpdHlTZXJ2aWNlLCAnaXNFbnRyeVRpbWVWYWxpZCcpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWxsb3dlZDogdHJ1ZSB9KTtcclxuXHJcbiAgICAgIC8vIDHCqiBjaGFtYWRhIOKGkiBldmVudHNcclxuICAgICAgY29uc3Qgc2luZ2xlRXZlbnQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIGV2ZW50X2VudHJ5X3Bhc3N3b3JkOiAnMTIzNCcsXHJcbiAgICAgICAgICBzdGF0dXM6ICdDb25maXJtYWRvJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGVxRXZlbnQgPSBqZXN0LmZuKCgpID0+ICh7IHNpbmdsZTogc2luZ2xlRXZlbnQgfSkpO1xyXG4gICAgICBjb25zdCBzZWxlY3RFdmVudCA9IGplc3QuZm4oKCkgPT4gKHsgZXE6IGVxRXZlbnQgfSkpO1xyXG5cclxuICAgICAgLy8gMsKqIGNoYW1hZGEg4oaSIGV2ZW50X3BhcnRpY2lwYW50cyAodXBkYXRlIGNvbSBkb2lzIC5lcSgpIGVuY2FkZWFkb3MpXHJcbiAgICAgIGNvbnN0IHNlY29uZEVxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IGZpcnN0RXEgPSBqZXN0LmZuKCgpID0+ICh7IGVxOiBzZWNvbmRFcSB9KSk7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZVBhcnRpY2lwYW50ID0gamVzdC5mbigoKSA9PiAoeyBlcTogZmlyc3RFcSB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tXHJcbiAgICAgICAgLy8gY2hhbWFkYSBkbyBldmVudHNcclxuICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgICAgc2VsZWN0OiBzZWxlY3RFdmVudFxyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIC8vIGNoYW1hZGEgZG8gZXZlbnRfcGFydGljaXBhbnRzXHJcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICAgIHVwZGF0ZTogdXBkYXRlUGFydGljaXBhbnRcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS52YWxpZGF0ZUVudHJ5UGFzc3dvcmQoe1xyXG4gICAgICAgIGV2ZW50SWQ6IDEsXHJcbiAgICAgICAgcGFydGljaXBhbnRJZDogJ3VzZXItMScsXHJcbiAgICAgICAgcGFzc3dvcmQ6ICcxMjM0J1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0JlKCfinIUgQWNlc3NvIGxpYmVyYWRvISBCZW0tdmluZG8gYW8gZXZlbnRvLicpO1xyXG4gICAgICBleHBlY3QodXBkYXRlUGFydGljaXBhbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIGNvbV9hY2Vzc286IHRydWVcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QoZmlyc3RFcSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50X2lkJywgMSk7XHJcbiAgICAgIGV4cGVjdChzZWNvbmRFcSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXJfaWQnLCAndXNlci0xJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2hhc1VzZXJBY2Nlc3MnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0b3JuYSB0cnVlIHF1YW5kbyBvIHBhcnRpY2lwYW50ZSBqw6EgdGVtIGFjZXNzbycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBjb21fYWNlc3NvOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3Qgc2Vjb25kRXEgPSBqZXN0LmZuKCgpID0+ICh7IHNpbmdsZSB9KSk7XHJcbiAgICAgIGNvbnN0IGZpcnN0RXEgPSBqZXN0LmZuKCgpID0+ICh7IGVxOiBzZWNvbmRFcSB9KSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHsgZXE6IGZpcnN0RXEgfSkpO1xyXG4gICAgICBcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBzZWxlY3RcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgaGFzQWNjZXNzID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2UuaGFzVXNlckFjY2VzcygxLCAndXNlci0xJyk7XHJcblxyXG4gICAgICBleHBlY3QoaGFzQWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2UuZnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50X3BhcnRpY2lwYW50cycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldG9ybmEgZmFsc2UgcXVhbmRvIG7Do28gZW5jb250cmFyIG8gcGFydGljaXBhbnRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgY29kZTogJ1BHUlNUMTE2JyB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBzZWNvbmRFcSA9IGplc3QuZm4oKCkgPT4gKHsgc2luZ2xlIH0pKTtcclxuICAgICAgY29uc3QgZmlyc3RFcSA9IGplc3QuZm4oKCkgPT4gKHsgZXE6IHNlY29uZEVxIH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoeyBlcTogZmlyc3RFcSB9KSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCBoYXNBY2Nlc3MgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS5oYXNVc2VyQWNjZXNzKDEsICd1c2VyLTInKTtcclxuXHJcbiAgICAgIGV4cGVjdChoYXNBY2Nlc3MpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdsb2NrRXZlbnRFbnRyeScsICgpID0+IHtcclxuICAgIGl0KCdibG9xdWVpYSBhIGVudHJhZGEgbm8gZXZlbnRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlcSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCgpID0+ICh7IGVxIH0pKTtcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICB1cGRhdGVcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2UubG9ja0V2ZW50RW50cnkoNyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXZlbnRzJyk7XHJcbiAgICAgIGV4cGVjdCh1cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIGVudHJ5X2xvY2tlZDogdHJ1ZVxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChlcSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2lkJywgNyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldEVudHJ5U3RhdHVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldG9ybmEgc3RhdHVzIGZvcm1hdGFkbyBkbyBldmVudG8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIDHCqiBjaGFtYWRhIOKGkiBldmVudHNcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbVxyXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICAgIGV2ZW50X2VudHJ5X3Bhc3N3b3JkOiAnNDMyMScsXHJcbiAgICAgICAgICAgICAgICAgIGVudHJ5X2xvY2tlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgIGVudHJ5X2xvY2tlZF9hdDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgZW50cnlfb3BlbmVkX2F0OiAnMjAyNS0xMS0wMlQxNDo1OTowMFonXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIC8vIDLCqiBjaGFtYWRhIOKGkiBldmVudF9wYXJ0aWNpcGFudHNcclxuICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgIGRhdGE6IFtcclxuICAgICAgICAgICAgICAgIHsgY29tX2FjZXNzbzogdHJ1ZSB9LFxyXG4gICAgICAgICAgICAgICAgeyBjb21fYWNlc3NvOiBmYWxzZSB9LFxyXG4gICAgICAgICAgICAgICAgeyBjb21fYWNlc3NvOiB0cnVlIH1cclxuICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS5nZXRFbnRyeVN0YXR1cyg1NSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbCh7XHJcbiAgICAgICAgcGFzc3dvcmQ6ICc0MzIxJyxcclxuICAgICAgICBpc0xvY2tlZDogZmFsc2UsXHJcbiAgICAgICAgbG9ja2VkQXQ6IG51bGwsXHJcbiAgICAgICAgb3BlbmVkQXQ6ICcyMDI1LTExLTAyVDE0OjU5OjAwWicsXHJcbiAgICAgICAgdG90YWxXaXRoQWNjZXNzOiAyLFxyXG4gICAgICAgIHRvdGFsUGFydGljaXBhbnRzOiAzXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==