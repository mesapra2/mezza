b27a9cf9596c104949c06e4da8d4f3a1
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// src/services/TrustScoreService.ts
const supabaseClient_1 = require("../lib/supabaseClient");
// ‚úÖ Interface 'UserTrustStatus' removida daqui (Corre√ß√£o TS6196)
/**
 * ‚≠ê Servi√ßo de Ranking de Confiabilidade
 * Gerencia trust score (5-0) e banimentos
 * Regra: N√£o compareceu = -1 score, quando chega em 0 = banido
 */
class TrustScoreService {
    /**
     * üéØ Obt√©m trust score do usu√°rio
     * @param userId - ID do usu√°rio
     */
    static async getTrustScore(userId) {
        try {
            const { data: profile, error } = await supabaseClient_1.supabase
                .from('profiles')
                .select('trust_score, is_banned')
                .eq('id', userId)
                .single();
            if (error) {
                if (error.code === 'PGRST116') {
                    return { success: false, error: 'Usu√°rio n√£o encontrado' };
                }
                throw error;
            }
            return {
                success: true,
                data: {
                    trustScore: profile?.trust_score || 5,
                    isBanned: profile?.is_banned || false
                }
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao obter trust score:', error);
            return { success: false, error };
        }
    }
    /**
     * üö´ Verifica se usu√°rio est√° banido
     * @param userId - ID do usu√°rio
     */
    static async isBanned(userId) {
        try {
            const result = await this.getTrustScore(userId);
            if (!result.success)
                return false;
            return result.data?.isBanned === true;
        }
        catch (error) {
            console.error('‚ùå Erro ao verificar banimento:', error);
            return false;
        }
    }
    /**
     * ‚¨áÔ∏è Reduz trust score (n√£o compareceu)
     * @param userId - ID do usu√°rio
     */
    static async penalizeNoShow(userId) {
        try {
            const { data: profile, error: getError } = await supabaseClient_1.supabase
                .from('profiles')
                .select('trust_score')
                .eq('id', userId)
                .single();
            if (getError)
                throw getError;
            const currentScore = profile?.trust_score || 5;
            const newScore = Math.max(0, currentScore - 1); // M√≠nimo 0
            console.log(`‚¨áÔ∏è Penalizando ${userId}: ${currentScore} ‚Üí ${newScore}`);
            const { error: updateError } = await supabaseClient_1.supabase
                .from('profiles')
                .update({
                trust_score: newScore,
                updated_at: new Date().toISOString()
            })
                .eq('id', userId);
            if (updateError)
                throw updateError;
            // üö´ Se score chegou em 0, banir automaticamente
            if (newScore === 0) {
                await this.banUser(userId, 'Trust score atingiu 0');
            }
            // üìä Registrar penalidade
            await this.logTrustScoreChange(userId, currentScore, newScore, 'no_show');
            console.log(`‚úÖ Penalidade aplicada: ${userId} agora tem score ${newScore}`);
            return {
                success: true,
                data: {
                    previousScore: currentScore,
                    newScore,
                    wasBanned: newScore === 0
                }
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao penalizar usu√°rio:', error);
            return { success: false, error };
        }
    }
    /**
     * üö´ Bani um usu√°rio (trust_score = 0)
     * @param userId - ID do usu√°rio
     * @param reason - Motivo do banimento
     */
    static async banUser(userId, reason = 'Trust score zerado') {
        try {
            console.log(`üö´ Banindo usu√°rio ${userId}: ${reason}`);
            const { error } = await supabaseClient_1.supabase
                .from('profiles')
                .update({
                is_banned: true,
                trust_score: 0,
                updated_at: new Date().toISOString()
            })
                .eq('id', userId);
            if (error)
                throw error;
            // üìä Registrar banimento
            await this.logBanishment(userId, reason);
            console.log(`‚úÖ Usu√°rio ${userId} foi banido`);
            return { success: true, data: { userId, reason } };
        }
        catch (error) {
            console.error('‚ùå Erro ao banir usu√°rio:', error);
            return { success: false, error };
        }
    }
    /**
     * üí∞ Desbloqueia usu√°rio ap√≥s pagamento (trust_score = 5 novamente)
     * @param userId - ID do usu√°rio
     * @param paymentId - ID da transa√ß√£o Stripe/Mercado Pago
     */
    static async unbanUserAfterPayment(userId, paymentId) {
        try {
            console.log(`üíö Desbloqueando usu√°rio ${userId} ap√≥s pagamento`);
            // 1Ô∏è‚É£ Resetar score para 5 e desbanir
            const { error: updateError } = await supabaseClient_1.supabase
                .from('profiles')
                .update({
                trust_score: 5, // Volta para o m√°ximo
                is_banned: false,
                updated_at: new Date().toISOString()
            })
                .eq('id', userId);
            if (updateError)
                throw updateError;
            // 2Ô∏è‚É£ Registrar desbloqueio no payments table
            const { error: paymentError } = await supabaseClient_1.supabase
                .from('payments')
                .insert({
                user_id: userId,
                amount: 249.00,
                reason: 'unban_trust_score',
                status: 'completed',
                stripe_payment_id: paymentId,
                created_at: new Date().toISOString()
            });
            if (paymentError) {
                console.warn('‚ö†Ô∏è Erro ao registrar pagamento (n√£o √© cr√≠tico):', paymentError);
                // N√£o falhar - usu√°rio j√° foi desbloqueado
            }
            // 3Ô∏è‚É£ Registrar no log
            await this.logUnbanishment(userId, paymentId);
            console.log(`‚úÖ Usu√°rio ${userId} foi desbloqueado. Score resetado para 5.`);
            return {
                success: true,
                data: {
                    userId,
                    newScore: 5,
                    message: 'Perfil desbloqueado com sucesso!'
                }
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao desbloquear usu√°rio:', error);
            return { success: false, error };
        }
    }
    /**
     * üìä Penaliza n√£o-presen√ßa de participantes (chamar quando evento termina)
     * @param eventId - ID do evento
     */
    static async penalizeNoShowsForEvent(eventId) {
        try {
            console.log(`üìä Processando penalidades de n√£o-presen√ßa para evento ${eventId}`);
            // 1Ô∏è‚É£ Buscar participa√ß√µes de aprovados SEM acesso (n√£o compareceu)
            const { data: noShows, error: queryError } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('id, user_id')
                .eq('event_id', eventId)
                .eq('status', 'aprovado')
                .eq('presenca_confirmada', true) // Confirmou presen√ßa
                .eq('com_acesso', false); // Mas n√£o entrou
            if (queryError)
                throw queryError;
            if (!noShows || noShows.length === 0) {
                console.log(`‚úÖ Nenhuma n√£o-presen√ßa para penalizar no evento ${eventId}`);
                return { success: true, data: { penalized: 0 } };
            }
            console.log(`‚ö†Ô∏è Encontradas ${noShows.length} n√£o-presen√ßas`);
            // 2Ô∏è‚É£ Penalizar cada um
            let penalizedCount = 0;
            const errors = [];
            for (const noShow of noShows) {
                try {
                    const result = await this.penalizeNoShow(noShow.user_id);
                    if (result.success) {
                        penalizedCount++;
                    }
                    else {
                        errors.push({ userId: noShow.user_id, error: result.error });
                    }
                }
                catch (error) {
                    errors.push({ userId: noShow.user_id, error });
                }
            }
            console.log(`‚úÖ Penalizadas ${penalizedCount}/${noShows.length} n√£o-presen√ßas`);
            return {
                success: true,
                data: {
                    eventId,
                    penalized: penalizedCount,
                    errors: errors.length > 0 ? errors : undefined
                }
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao penalizar no-shows:', error);
            return { success: false, error };
        }
    }
    /**
     * üìà Restaura trust score manualmente (admin)
     * @param userId - ID do usu√°rio
     * @param newScore - Novo score (0-5)
     */
    static async setTrustScoreManual(userId, newScore) {
        try {
            if (newScore < 0 || newScore > 5) {
                return { success: false, error: 'Score deve estar entre 0 e 5' };
            }
            console.log(`üîß Ajustando score de ${userId} para ${newScore} (manual)`);
            const { error } = await supabaseClient_1.supabase
                .from('profiles')
                .update({
                trust_score: newScore,
                is_banned: newScore === 0,
                updated_at: new Date().toISOString()
            })
                .eq('id', userId);
            if (error)
                throw error;
            console.log(`‚úÖ Score ajustado manualmente`);
            return { success: true, data: { userId, newScore } };
        }
        catch (error) {
            console.error('‚ùå Erro ao ajustar score:', error);
            return { success: false, error };
        }
    }
    /**
     * üìä Obt√©m relat√≥rio de confiabilidade do usu√°rio
     */
    static async getTrustReport(userId) {
        try {
            const { data: profile, error: profileError } = await supabaseClient_1.supabase
                .from('profiles')
                .select('trust_score, is_banned, created_at')
                .eq('id', userId)
                .single();
            if (profileError)
                throw profileError;
            // Buscar hist√≥rico de mudan√ßas
            const { data: history, error: historyError } = await supabaseClient_1.supabase
                .from('trust_score_changes')
                .select('*')
                .eq('user_id', userId)
                .order('created_at', { ascending: false })
                .limit(10);
            if (historyError) {
                console.warn('‚ö†Ô∏è Erro ao buscar hist√≥rico:', historyError);
            }
            return {
                success: true,
                data: {
                    userId,
                    currentScore: profile?.trust_score,
                    isBanned: profile?.is_banned,
                    memberSince: profile?.created_at,
                    scoreHistory: history || []
                }
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao obter relat√≥rio:', error);
            return { success: false, error };
        }
    }
    /**
     * üìù Registra mudan√ßa de score (log)
     */
    static async logTrustScoreChange(userId, previousScore, newScore, reason) {
        try {
            await supabaseClient_1.supabase.from('trust_score_changes').insert({
                user_id: userId,
                previous_score: previousScore,
                new_score: newScore,
                reason,
                created_at: new Date().toISOString()
            });
        }
        catch (error) {
            console.warn('‚ö†Ô∏è Erro ao registrar mudan√ßa de score:', error);
        }
    }
    /**
     * üìù Registra banimento (log)
     */
    static async logBanishment(userId, reason) {
        try {
            await supabaseClient_1.supabase.from('banishment_logs').insert({
                user_id: userId,
                reason,
                banned_at: new Date().toISOString()
            });
        }
        catch (error) {
            console.warn('‚ö†Ô∏è Erro ao registrar banimento:', error);
        }
    }
    /**
     * üìù Registra desbloqueio (log)
     */
    static async logUnbanishment(userId, paymentId) {
        try {
            await supabaseClient_1.supabase.from('unbanishment_logs').insert({
                user_id: userId,
                payment_id: paymentId,
                unbanned_at: new Date().toISOString()
            });
        }
        catch (error) {
            console.warn('‚ö†Ô∏è Erro ao registrar desbloqueio:', error);
        }
    }
}
exports.default = TrustScoreService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcVHJ1c3RTY29yZVNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxvQ0FBb0M7QUFDcEMsMERBQWlEO0FBUWpELGlFQUFpRTtBQUVqRTs7OztHQUlHO0FBQ0gsTUFBTSxpQkFBaUI7SUFDckI7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBYztRQUN2QyxJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxNQUFNLHlCQUFRO2lCQUM1QyxJQUFJLENBQUMsVUFBVSxDQUFDO2lCQUNoQixNQUFNLENBQUMsd0JBQXdCLENBQUM7aUJBQ2hDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDO2lCQUNoQixNQUFNLEVBQUUsQ0FBQztZQUVaLElBQUksS0FBSyxFQUFFLENBQUM7Z0JBQ1YsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFVBQVUsRUFBRSxDQUFDO29CQUM5QixPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQztnQkFDN0QsQ0FBQztnQkFDRCxNQUFNLEtBQUssQ0FBQztZQUNkLENBQUM7WUFFRCxPQUFPO2dCQUNMLE9BQU8sRUFBRSxJQUFJO2dCQUNiLElBQUksRUFBRTtvQkFDSixVQUFVLEVBQUUsT0FBTyxFQUFFLFdBQVcsSUFBSSxDQUFDO29CQUNyQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsSUFBSSxLQUFLO2lCQUN0QzthQUNGLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsOEJBQThCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDckQsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUM7UUFDbkMsQ0FBQztJQUNILENBQUM7SUFFRDs7O09BR0c7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QU07Z0JBQ2YsVUFBVSxFQUFFLFNBQVM7Z0JBQ3JCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTthQUN0QyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxJQUFJLENBQUMsbUNBQW1DLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDM0QsQ0FBQztJQUNILENBQUM7Q0FDRjtBQUVELGtCQUFlLGlCQUFpQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcc2VydmljZXNcXFRydXN0U2NvcmVTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2aWNlcy9UcnVzdFNjb3JlU2VydmljZS50c1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJy4uL2xpYi9zdXBhYmFzZUNsaWVudCc7XHJcblxyXG5pbnRlcmZhY2UgVHJ1c3RTY29yZVJlc3VsdCB7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBkYXRhPzogYW55O1xyXG4gIGVycm9yPzogYW55O1xyXG59XHJcblxyXG4vLyDinIUgSW50ZXJmYWNlICdVc2VyVHJ1c3RTdGF0dXMnIHJlbW92aWRhIGRhcXVpIChDb3JyZcOnw6NvIFRTNjE5NilcclxuXHJcbi8qKlxyXG4gKiDirZAgU2VydmnDp28gZGUgUmFua2luZyBkZSBDb25maWFiaWxpZGFkZVxyXG4gKiBHZXJlbmNpYSB0cnVzdCBzY29yZSAoNS0wKSBlIGJhbmltZW50b3NcclxuICogUmVncmE6IE7Do28gY29tcGFyZWNldSA9IC0xIHNjb3JlLCBxdWFuZG8gY2hlZ2EgZW0gMCA9IGJhbmlkb1xyXG4gKi9cclxuY2xhc3MgVHJ1c3RTY29yZVNlcnZpY2Uge1xyXG4gIC8qKlxyXG4gICAqIPCfjq8gT2J0w6ltIHRydXN0IHNjb3JlIGRvIHVzdcOhcmlvXHJcbiAgICogQHBhcmFtIHVzZXJJZCAtIElEIGRvIHVzdcOhcmlvXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldFRydXN0U2NvcmUodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFRydXN0U2NvcmVSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuc2VsZWN0KCd0cnVzdF9zY29yZSwgaXNfYmFubmVkJylcclxuICAgICAgICAuZXEoJ2lkJywgdXNlcklkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdVc3XDoXJpbyBuw6NvIGVuY29udHJhZG8nIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgdHJ1c3RTY29yZTogcHJvZmlsZT8udHJ1c3Rfc2NvcmUgfHwgNSxcclxuICAgICAgICAgIGlzQmFubmVkOiBwcm9maWxlPy5pc19iYW5uZWQgfHwgZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBvYnRlciB0cnVzdCBzY29yZTonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvciB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog8J+aqyBWZXJpZmljYSBzZSB1c3XDoXJpbyBlc3TDoSBiYW5pZG9cclxuICAgKiBAcGFyYW0gdXNlcklkIC0gSUQgZG8gdXN1w6FyaW9cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgaXNCYW5uZWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZ2V0VHJ1c3RTY29yZSh1c2VySWQpO1xyXG4gICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgIHJldHVybiByZXN1bHQuZGF0YT8uaXNCYW5uZWQgPT09IHRydWU7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyB2ZXJpZmljYXIgYmFuaW1lbnRvOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4qyH77iPIFJlZHV6IHRydXN0IHNjb3JlIChuw6NvIGNvbXBhcmVjZXUpXHJcbiAgICogQHBhcmFtIHVzZXJJZCAtIElEIGRvIHVzdcOhcmlvXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHBlbmFsaXplTm9TaG93KHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxUcnVzdFNjb3JlUmVzdWx0PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBnZXRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ3RydXN0X3Njb3JlJylcclxuICAgICAgICAuZXEoJ2lkJywgdXNlcklkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChnZXRFcnJvcikgdGhyb3cgZ2V0RXJyb3I7XHJcblxyXG4gICAgICBjb25zdCBjdXJyZW50U2NvcmUgPSBwcm9maWxlPy50cnVzdF9zY29yZSB8fCA1O1xyXG4gICAgICBjb25zdCBuZXdTY29yZSA9IE1hdGgubWF4KDAsIGN1cnJlbnRTY29yZSAtIDEpOyAvLyBNw61uaW1vIDBcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGDirIfvuI8gUGVuYWxpemFuZG8gJHt1c2VySWR9OiAke2N1cnJlbnRTY29yZX0g4oaSICR7bmV3U2NvcmV9YCk7XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgdHJ1c3Rfc2NvcmU6IG5ld1Njb3JlLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2lkJywgdXNlcklkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikgdGhyb3cgdXBkYXRlRXJyb3I7XHJcblxyXG4gICAgICAvLyDwn5qrIFNlIHNjb3JlIGNoZWdvdSBlbSAwLCBiYW5pciBhdXRvbWF0aWNhbWVudGVcclxuICAgICAgaWYgKG5ld1Njb3JlID09PSAwKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5iYW5Vc2VyKHVzZXJJZCwgJ1RydXN0IHNjb3JlIGF0aW5naXUgMCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDwn5OKIFJlZ2lzdHJhciBwZW5hbGlkYWRlXHJcbiAgICAgIGF3YWl0IHRoaXMubG9nVHJ1c3RTY29yZUNoYW5nZSh1c2VySWQsIGN1cnJlbnRTY29yZSwgbmV3U2NvcmUsICdub19zaG93Jyk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIFBlbmFsaWRhZGUgYXBsaWNhZGE6ICR7dXNlcklkfSBhZ29yYSB0ZW0gc2NvcmUgJHtuZXdTY29yZX1gKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBwcmV2aW91c1Njb3JlOiBjdXJyZW50U2NvcmUsXHJcbiAgICAgICAgICBuZXdTY29yZSxcclxuICAgICAgICAgIHdhc0Jhbm5lZDogbmV3U2NvcmUgPT09IDBcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBwZW5hbGl6YXIgdXN1w6FyaW86JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3IgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfmqsgQmFuaSB1bSB1c3XDoXJpbyAodHJ1c3Rfc2NvcmUgPSAwKVxyXG4gICAqIEBwYXJhbSB1c2VySWQgLSBJRCBkbyB1c3XDoXJpb1xyXG4gICAqIEBwYXJhbSByZWFzb24gLSBNb3Rpdm8gZG8gYmFuaW1lbnRvXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGJhblVzZXIodXNlcklkOiBzdHJpbmcsIHJlYXNvbjogc3RyaW5nID0gJ1RydXN0IHNjb3JlIHplcmFkbycpOiBQcm9taXNlPFRydXN0U2NvcmVSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDwn5qrIEJhbmluZG8gdXN1w6FyaW8gJHt1c2VySWR9OiAke3JlYXNvbn1gKTtcclxuXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIGlzX2Jhbm5lZDogdHJ1ZSxcclxuICAgICAgICAgIHRydXN0X3Njb3JlOiAwLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2lkJywgdXNlcklkKTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcblxyXG4gICAgICAvLyDwn5OKIFJlZ2lzdHJhciBiYW5pbWVudG9cclxuICAgICAgYXdhaXQgdGhpcy5sb2dCYW5pc2htZW50KHVzZXJJZCwgcmVhc29uKTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgVXN1w6FyaW8gJHt1c2VySWR9IGZvaSBiYW5pZG9gKTtcclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgdXNlcklkLCByZWFzb24gfSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gYW8gYmFuaXIgdXN1w6FyaW86JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3IgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfkrAgRGVzYmxvcXVlaWEgdXN1w6FyaW8gYXDDs3MgcGFnYW1lbnRvICh0cnVzdF9zY29yZSA9IDUgbm92YW1lbnRlKVxyXG4gICAqIEBwYXJhbSB1c2VySWQgLSBJRCBkbyB1c3XDoXJpb1xyXG4gICAqIEBwYXJhbSBwYXltZW50SWQgLSBJRCBkYSB0cmFuc2HDp8OjbyBTdHJpcGUvTWVyY2FkbyBQYWdvXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHVuYmFuVXNlckFmdGVyUGF5bWVudChcclxuICAgIHVzZXJJZDogc3RyaW5nLFxyXG4gICAgcGF5bWVudElkOiBzdHJpbmdcclxuICApOiBQcm9taXNlPFRydXN0U2NvcmVSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDwn5KaIERlc2Jsb3F1ZWFuZG8gdXN1w6FyaW8gJHt1c2VySWR9IGFww7NzIHBhZ2FtZW50b2ApO1xyXG5cclxuICAgICAgLy8gMe+4j+KDoyBSZXNldGFyIHNjb3JlIHBhcmEgNSBlIGRlc2JhbmlyXHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICB0cnVzdF9zY29yZTogNSwgLy8gVm9sdGEgcGFyYSBvIG3DoXhpbW9cclxuICAgICAgICAgIGlzX2Jhbm5lZDogZmFsc2UsXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCB1c2VySWQpO1xyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB0aHJvdyB1cGRhdGVFcnJvcjtcclxuXHJcbiAgICAgIC8vIDLvuI/ig6MgUmVnaXN0cmFyIGRlc2Jsb3F1ZWlvIG5vIHBheW1lbnRzIHRhYmxlXHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IHBheW1lbnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncGF5bWVudHMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgICAgYW1vdW50OiAyNDkuMDAsXHJcbiAgICAgICAgICByZWFzb246ICd1bmJhbl90cnVzdF9zY29yZScsXHJcbiAgICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxyXG4gICAgICAgICAgc3RyaXBlX3BheW1lbnRfaWQ6IHBheW1lbnRJZCxcclxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKHBheW1lbnRFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEVycm8gYW8gcmVnaXN0cmFyIHBhZ2FtZW50byAobsOjbyDDqSBjcsOtdGljbyk6JywgcGF5bWVudEVycm9yKTtcclxuICAgICAgICAvLyBOw6NvIGZhbGhhciAtIHVzdcOhcmlvIGrDoSBmb2kgZGVzYmxvcXVlYWRvXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIDPvuI/ig6MgUmVnaXN0cmFyIG5vIGxvZ1xyXG4gICAgICBhd2FpdCB0aGlzLmxvZ1VuYmFuaXNobWVudCh1c2VySWQsIHBheW1lbnRJZCk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIFVzdcOhcmlvICR7dXNlcklkfSBmb2kgZGVzYmxvcXVlYWRvLiBTY29yZSByZXNldGFkbyBwYXJhIDUuYCk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgdXNlcklkLFxyXG4gICAgICAgICAgbmV3U2NvcmU6IDUsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnUGVyZmlsIGRlc2Jsb3F1ZWFkbyBjb20gc3VjZXNzbyEnXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gYW8gZGVzYmxvcXVlYXIgdXN1w6FyaW86JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3IgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfk4ogUGVuYWxpemEgbsOjby1wcmVzZW7Dp2EgZGUgcGFydGljaXBhbnRlcyAoY2hhbWFyIHF1YW5kbyBldmVudG8gdGVybWluYSlcclxuICAgKiBAcGFyYW0gZXZlbnRJZCAtIElEIGRvIGV2ZW50b1xyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBwZW5hbGl6ZU5vU2hvd3NGb3JFdmVudChldmVudElkOiBudW1iZXIpOiBQcm9taXNlPFRydXN0U2NvcmVSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OKIFByb2Nlc3NhbmRvIHBlbmFsaWRhZGVzIGRlIG7Do28tcHJlc2Vuw6dhIHBhcmEgZXZlbnRvICR7ZXZlbnRJZH1gKTtcclxuXHJcbiAgICAgIC8vIDHvuI/ig6MgQnVzY2FyIHBhcnRpY2lwYcOnw7VlcyBkZSBhcHJvdmFkb3MgU0VNIGFjZXNzbyAobsOjbyBjb21wYXJlY2V1KVxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5vU2hvd3MsIGVycm9yOiBxdWVyeUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudF9wYXJ0aWNpcGFudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkLCB1c2VyX2lkJylcclxuICAgICAgICAuZXEoJ2V2ZW50X2lkJywgZXZlbnRJZClcclxuICAgICAgICAuZXEoJ3N0YXR1cycsICdhcHJvdmFkbycpXHJcbiAgICAgICAgLmVxKCdwcmVzZW5jYV9jb25maXJtYWRhJywgdHJ1ZSkgLy8gQ29uZmlybW91IHByZXNlbsOnYVxyXG4gICAgICAgIC5lcSgnY29tX2FjZXNzbycsIGZhbHNlKTsgLy8gTWFzIG7Do28gZW50cm91XHJcblxyXG4gICAgICBpZiAocXVlcnlFcnJvcikgdGhyb3cgcXVlcnlFcnJvcjtcclxuXHJcbiAgICAgIGlmICghbm9TaG93cyB8fCBub1Nob3dzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgTmVuaHVtYSBuw6NvLXByZXNlbsOnYSBwYXJhIHBlbmFsaXphciBubyBldmVudG8gJHtldmVudElkfWApO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgcGVuYWxpemVkOiAwIH0gfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc29sZS5sb2coYOKaoO+4jyBFbmNvbnRyYWRhcyAke25vU2hvd3MubGVuZ3RofSBuw6NvLXByZXNlbsOnYXNgKTtcclxuXHJcbiAgICAgIC8vIDLvuI/ig6MgUGVuYWxpemFyIGNhZGEgdW1cclxuICAgICAgbGV0IHBlbmFsaXplZENvdW50ID0gMDtcclxuICAgICAgY29uc3QgZXJyb3JzOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBub1Nob3cgb2Ygbm9TaG93cykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBlbmFsaXplTm9TaG93KG5vU2hvdy51c2VyX2lkKTtcclxuICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICBwZW5hbGl6ZWRDb3VudCsrO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZXJyb3JzLnB1c2goeyB1c2VySWQ6IG5vU2hvdy51c2VyX2lkLCBlcnJvcjogcmVzdWx0LmVycm9yIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICBlcnJvcnMucHVzaCh7IHVzZXJJZDogbm9TaG93LnVzZXJfaWQsIGVycm9yIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc29sZS5sb2coYOKchSBQZW5hbGl6YWRhcyAke3BlbmFsaXplZENvdW50fS8ke25vU2hvd3MubGVuZ3RofSBuw6NvLXByZXNlbsOnYXNgKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBldmVudElkLFxyXG4gICAgICAgICAgcGVuYWxpemVkOiBwZW5hbGl6ZWRDb3VudCxcclxuICAgICAgICAgIGVycm9yczogZXJyb3JzLmxlbmd0aCA+IDAgPyBlcnJvcnMgOiB1bmRlZmluZWRcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBwZW5hbGl6YXIgbm8tc2hvd3M6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3IgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfk4ggUmVzdGF1cmEgdHJ1c3Qgc2NvcmUgbWFudWFsbWVudGUgKGFkbWluKVxyXG4gICAqIEBwYXJhbSB1c2VySWQgLSBJRCBkbyB1c3XDoXJpb1xyXG4gICAqIEBwYXJhbSBuZXdTY29yZSAtIE5vdm8gc2NvcmUgKDAtNSlcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgc2V0VHJ1c3RTY29yZU1hbnVhbCh1c2VySWQ6IHN0cmluZywgbmV3U2NvcmU6IG51bWJlcik6IFByb21pc2U8VHJ1c3RTY29yZVJlc3VsdD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKG5ld1Njb3JlIDwgMCB8fCBuZXdTY29yZSA+IDUpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdTY29yZSBkZXZlIGVzdGFyIGVudHJlIDAgZSA1JyB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhg8J+UpyBBanVzdGFuZG8gc2NvcmUgZGUgJHt1c2VySWR9IHBhcmEgJHtuZXdTY29yZX0gKG1hbnVhbClgKTtcclxuXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHRydXN0X3Njb3JlOiBuZXdTY29yZSxcclxuICAgICAgICAgIGlzX2Jhbm5lZDogbmV3U2NvcmUgPT09IDAsXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCB1c2VySWQpO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgU2NvcmUgYWp1c3RhZG8gbWFudWFsbWVudGVgKTtcclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgdXNlcklkLCBuZXdTY29yZSB9IH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBhanVzdGFyIHNjb3JlOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDwn5OKIE9idMOpbSByZWxhdMOzcmlvIGRlIGNvbmZpYWJpbGlkYWRlIGRvIHVzdcOhcmlvXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldFRydXN0UmVwb3J0KHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxUcnVzdFNjb3JlUmVzdWx0PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAuc2VsZWN0KCd0cnVzdF9zY29yZSwgaXNfYmFubmVkLCBjcmVhdGVkX2F0JylcclxuICAgICAgICAuZXEoJ2lkJywgdXNlcklkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChwcm9maWxlRXJyb3IpIHRocm93IHByb2ZpbGVFcnJvcjtcclxuXHJcbiAgICAgIC8vIEJ1c2NhciBoaXN0w7NyaWNvIGRlIG11ZGFuw6dhc1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGhpc3RvcnksIGVycm9yOiBoaXN0b3J5RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3RydXN0X3Njb3JlX2NoYW5nZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgICAubGltaXQoMTApO1xyXG5cclxuICAgICAgaWYgKGhpc3RvcnlFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEVycm8gYW8gYnVzY2FyIGhpc3TDs3JpY286JywgaGlzdG9yeUVycm9yKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHVzZXJJZCxcclxuICAgICAgICAgIGN1cnJlbnRTY29yZTogcHJvZmlsZT8udHJ1c3Rfc2NvcmUsXHJcbiAgICAgICAgICBpc0Jhbm5lZDogcHJvZmlsZT8uaXNfYmFubmVkLFxyXG4gICAgICAgICAgbWVtYmVyU2luY2U6IHByb2ZpbGU/LmNyZWF0ZWRfYXQsXHJcbiAgICAgICAgICBzY29yZUhpc3Rvcnk6IGhpc3RvcnkgfHwgW11cclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBvYnRlciByZWxhdMOzcmlvOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDwn5OdIFJlZ2lzdHJhIG11ZGFuw6dhIGRlIHNjb3JlIChsb2cpXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgbG9nVHJ1c3RTY29yZUNoYW5nZShcclxuICAgIHVzZXJJZDogc3RyaW5nLFxyXG4gICAgcHJldmlvdXNTY29yZTogbnVtYmVyLFxyXG4gICAgbmV3U2NvcmU6IG51bWJlcixcclxuICAgIHJlYXNvbjogc3RyaW5nXHJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCd0cnVzdF9zY29yZV9jaGFuZ2VzJykuaW5zZXJ0KHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgcHJldmlvdXNfc2NvcmU6IHByZXZpb3VzU2NvcmUsXHJcbiAgICAgICAgbmV3X3Njb3JlOiBuZXdTY29yZSxcclxuICAgICAgICByZWFzb24sXHJcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRXJybyBhbyByZWdpc3RyYXIgbXVkYW7Dp2EgZGUgc2NvcmU6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog8J+TnSBSZWdpc3RyYSBiYW5pbWVudG8gKGxvZylcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBhc3luYyBsb2dCYW5pc2htZW50KHVzZXJJZDogc3RyaW5nLCByZWFzb246IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnYmFuaXNobWVudF9sb2dzJykuaW5zZXJ0KHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgcmVhc29uLFxyXG4gICAgICAgIGJhbm5lZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRXJybyBhbyByZWdpc3RyYXIgYmFuaW1lbnRvOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfk50gUmVnaXN0cmEgZGVzYmxvcXVlaW8gKGxvZylcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBhc3luYyBsb2dVbmJhbmlzaG1lbnQodXNlcklkOiBzdHJpbmcsIHBheW1lbnRJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCd1bmJhbmlzaG1lbnRfbG9ncycpLmluc2VydCh7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgIHBheW1lbnRfaWQ6IHBheW1lbnRJZCxcclxuICAgICAgICB1bmJhbm5lZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRXJybyBhbyByZWdpc3RyYXIgZGVzYmxvcXVlaW86JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVHJ1c3RTY29yZVNlcnZpY2U7XHJcblxyXG4iXSwidmVyc2lvbiI6M30=