5fae4400ae0b1bc7c278e17c467c9c39
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
// src/features/auth/pages/AuthCallbackPage.test.jsx
/* eslint-disable react/prop-types */
const globals_1 = require("@jest/globals");
// Mock do react-router-dom
globals_1.jest.mock('react-router-dom', () => ({
    ...globals_1.jest.requireActual('react-router-dom'),
    useNavigate: () => mockNavigate,
    useSearchParams: () => [{ get: mockGet }],
}));
globals_1.jest.mock('@/lib/supabaseClient', () => ({
    supabase: {
        auth: {
            verifyOtp: globals_1.jest.fn(),
        },
    },
}));
// Mock do Helmet
globals_1.jest.mock('react-helmet-async', () => ({
    Helmet: ({ children }) => (0, jsx_runtime_1.jsx)("div", { "data-testid": "helmet", children: children }),
}));
// Mock do Framer Motion
globals_1.jest.mock('framer-motion', () => ({
    motion: {
        div: ({ children, ...props }) => (0, jsx_runtime_1.jsx)("div", { ...props, children: children }),
    },
}));
// Mock dos componentes Lucide
globals_1.jest.mock('lucide-react', () => ({
    CheckCircle: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "check-icon", children: "\u2713" }),
    XCircle: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "x-icon", children: "\u2717" }),
    Loader2: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "loader-icon", children: "Loading..." }),
}));
// Mock do Button
globals_1.jest.mock('@/features/shared/components/ui/button', () => ({
    Button: ({ children, onClick, ...props }) => ((0, jsx_runtime_1.jsx)("button", { onClick: onClick, "data-testid": props['data-testid'], ...props, children: children })),
}));
const react_1 = require("@testing-library/react");
const react_router_dom_1 = require("react-router-dom");
const user_event_1 = tslib_1.__importDefault(require("@testing-library/user-event"));
const AuthCallbackPage_1 = tslib_1.__importDefault(require("./AuthCallbackPage"));
// --- MOCKS ---
const mockNavigate = globals_1.jest.fn();
const mockGet = globals_1.jest.fn();
// Mock do Supabase - criar mock dentro da factory
const mockVerifyOtp = globals_1.jest.fn();
// --- HELPER ---
const renderWithRouter = (component) => {
    return (0, react_1.render)((0, jsx_runtime_1.jsx)(react_router_dom_1.BrowserRouter, { children: component }));
};
// --- TESTES ---
(0, globals_1.describe)('AuthCallbackPage', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        globals_1.jest.useFakeTimers();
        mockGet.mockReset();
        // Resetar e configurar comportamento padrão do mockVerifyOtp
        if (mockVerifyOtp.mockReset) {
            mockVerifyOtp.mockReset();
        }
        // Comportamento padrão: sucesso
        mockVerifyOtp.mockResolvedValue({
            data: { user: { email: 'test@example.com' } },
            error: null,
        });
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.runOnlyPendingTimers();
        globals_1.jest.useRealTimers();
    });
    (0, globals_1.describe)('Estado de loading', () => {
        (0, globals_1.it)('deve mostrar loader enquanto processa a confirmação', () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'test-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockImplementation(() => new Promise(() => { })); // Never resolves
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            (0, globals_1.expect)(react_1.screen.getByTestId('loader-icon')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Confirmando seu email...')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Aguarde enquanto validamos seu cadastro')).toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('Confirmação bem-sucedida', () => {
        (0, globals_1.it)('deve mostrar mensagem de sucesso e redirecionar após confirmar email', async () => {
            const mockUser = { email: 'test@example.com' };
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'valid-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValueOnce({
                data: { user: mockUser },
                error: null,
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            // Aguarda processamento
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('check-icon')).toBeInTheDocument();
            }, { timeout: 3000 });
            (0, globals_1.expect)(react_1.screen.getByText('Email Confirmado!')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText(/confirmado com sucesso/i)).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText(/Redirecionando para o login/i)).toBeInTheDocument();
            // Verifica se verifyOtp foi chamado corretamente
            (0, globals_1.expect)(mockVerifyOtp).toHaveBeenCalledWith({
                token_hash: 'valid-token',
                type: 'email',
            });
            // Avança o timer para simular o timeout
            globals_1.jest.advanceTimersByTime(2000);
            // Verifica redirecionamento
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/login', {
                    state: {
                        emailConfirmed: true,
                        email: 'test@example.com',
                    },
                });
            });
        });
        (0, globals_1.it)('deve funcionar mesmo sem email do usuário', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'valid-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValueOnce({
                data: { user: null },
                error: null,
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('check-icon')).toBeInTheDocument();
            }, { timeout: 3000 });
            globals_1.jest.advanceTimersByTime(2000);
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/login', {
                    state: {
                        emailConfirmed: true,
                        email: undefined,
                    },
                });
            });
        });
    });
    (0, globals_1.describe)('Erros de validação', () => {
        (0, globals_1.it)('deve mostrar erro quando token_hash estiver ausente', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'type')
                    return 'email';
                return null; // token_hash ausente
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_1.screen.getByText('Erro na Confirmação')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Link de confirmação inválido')).toBeInTheDocument();
            (0, globals_1.expect)(mockVerifyOtp).not.toHaveBeenCalled();
        });
        (0, globals_1.it)('deve mostrar erro quando type não for "email"', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'test-token';
                if (param === 'type')
                    return 'recovery'; // tipo errado
                return null;
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_1.screen.getByText('Link de confirmação inválido')).toBeInTheDocument();
            (0, globals_1.expect)(mockVerifyOtp).not.toHaveBeenCalled();
        });
        (0, globals_1.it)('deve mostrar erro quando verifyOtp falhar', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'invalid-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            // Configurar mock para retornar erro
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: { message: 'Token inválido' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_1.screen.getByText(/Token inválido/i)).toBeInTheDocument();
        });
        (0, globals_1.it)('deve mostrar mensagem específica para email já confirmado', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'already-used-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: { message: 'Email already confirmed' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByText(/já foi confirmado anteriormente/i)).toBeInTheDocument();
            });
        });
        (0, globals_1.it)('deve mostrar mensagem específica para link expirado', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'expired-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: { message: 'Token expired' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByText(/link de confirmação expirou/i)).toBeInTheDocument();
            });
        });
    });
    (0, globals_1.describe)('Interações do usuário no estado de erro', () => {
        (0, globals_1.beforeEach)(async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'error-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValue({
                data: null,
                error: { message: 'Erro genérico' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
        });
        (0, globals_1.it)('deve navegar para login ao clicar em "Ir para Login"', async () => {
            const user = user_event_1.default.setup({ delay: null });
            const loginButton = react_1.screen.getByText('Ir para Login');
            await user.click(loginButton);
            (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/login');
        });
        (0, globals_1.it)('deve navegar para registro ao clicar em "Tentar Novamente"', async () => {
            const user = user_event_1.default.setup({ delay: null });
            const retryButton = react_1.screen.getByText('Tentar Novamente');
            await user.click(retryButton);
            (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/partner/register');
        });
    });
    (0, globals_1.describe)('Metadados e SEO', () => {
        (0, globals_1.it)('deve renderizar o Helmet com título correto', () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'test-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockImplementation(() => new Promise(() => { }));
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            const helmet = react_1.screen.getByTestId('helmet');
            (0, globals_1.expect)(helmet).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Confirmação de Email - Mesa Pra 2')).toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('Console errors', () => {
        (0, globals_1.it)('deve logar erro no console quando verificação falhar', async () => {
            const consoleErrorSpy = globals_1.jest.spyOn(console, 'error').mockImplementation(() => { });
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'error-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            const errorObj = { message: 'Test error' };
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: errorObj,
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            // Verifica se console.error foi chamado com o erro
            (0, globals_1.expect)(consoleErrorSpy).toHaveBeenCalled();
            (0, globals_1.expect)(consoleErrorSpy.mock.calls[0][0]).toBe('Erro na confirmação:');
            consoleErrorSpy.mockRestore();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcc2hhcmVkXFxwYWdlc1xcQXV0aENhbGxiYWNrUGFnZS50ZXN0LmpzeCIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsb0RBQW9EO0FBQ3BELHFDQUFxQztBQUVyQywyQ0FBa0Y7QUFXbEYsMkJBQTJCO0FBQzNCLGNBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuQyxHQUFHLGNBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUM7SUFDekMsV0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVk7SUFDL0IsZUFBZSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLENBQUM7Q0FDMUMsQ0FBQyxDQUFDLENBQUM7QUFJSixjQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdkMsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFO1lBQ0osU0FBUyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7U0FDckI7S0FDRjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBRUosaUJBQWlCO0FBQ2pCLGNBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQywrQ0FBaUIsUUFBUSxZQUFFLFFBQVEsR0FBTztDQUNyRSxDQUFDLENBQUMsQ0FBQztBQUVKLHdCQUF3QjtBQUN4QixjQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hDLE1BQU0sRUFBRTtRQUNOLEdBQUcsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLEdBQUcsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLG1DQUFTLEtBQUssWUFBRyxRQUFRLEdBQU87S0FDbEU7Q0FDRixDQUFD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TSxFQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFFdEUsZUFBZSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXGZlYXR1cmVzXFxzaGFyZWRcXHBhZ2VzXFxBdXRoQ2FsbGJhY2tQYWdlLnRlc3QuanN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9mZWF0dXJlcy9hdXRoL3BhZ2VzL0F1dGhDYWxsYmFja1BhZ2UudGVzdC5qc3hcclxuLyogZXNsaW50LWRpc2FibGUgcmVhY3QvcHJvcC10eXBlcyAqL1xyXG5cclxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGplc3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xyXG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgd2FpdEZvciB9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xyXG5pbXBvcnQgeyBCcm93c2VyUm91dGVyIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XHJcbmltcG9ydCB1c2VyRXZlbnQgZnJvbSAnQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50JztcclxuaW1wb3J0IEF1dGhDYWxsYmFja1BhZ2UgZnJvbSAnLi9BdXRoQ2FsbGJhY2tQYWdlJztcclxuXHJcbi8vIC0tLSBNT0NLUyAtLS1cclxuXHJcbmNvbnN0IG1vY2tOYXZpZ2F0ZSA9IGplc3QuZm4oKTtcclxuY29uc3QgbW9ja0dldCA9IGplc3QuZm4oKTtcclxuXHJcbi8vIE1vY2sgZG8gcmVhY3Qtcm91dGVyLWRvbVxyXG5qZXN0Lm1vY2soJ3JlYWN0LXJvdXRlci1kb20nLCAoKSA9PiAoe1xyXG4gIC4uLmplc3QucmVxdWlyZUFjdHVhbCgncmVhY3Qtcm91dGVyLWRvbScpLFxyXG4gIHVzZU5hdmlnYXRlOiAoKSA9PiBtb2NrTmF2aWdhdGUsXHJcbiAgdXNlU2VhcmNoUGFyYW1zOiAoKSA9PiBbeyBnZXQ6IG1vY2tHZXQgfV0sXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgZG8gU3VwYWJhc2UgLSBjcmlhciBtb2NrIGRlbnRybyBkYSBmYWN0b3J5XHJcbmNvbnN0IG1vY2tWZXJpZnlPdHAgPSBqZXN0LmZuKCk7XHJcbmplc3QubW9jaygnQC9saWIvc3VwYWJhc2VDbGllbnQnLCAoKSA9PiAoe1xyXG4gIHN1cGFiYXNlOiB7XHJcbiAgICBhdXRoOiB7XHJcbiAgICAgIHZlcmlmeU90cDogamVzdC5mbigpLFxyXG4gICAgfSxcclxuICB9LFxyXG59KSk7XHJcblxyXG4vLyBNb2NrIGRvIEhlbG1ldFxyXG5qZXN0Lm1vY2soJ3JlYWN0LWhlbG1ldC1hc3luYycsICgpID0+ICh7XHJcbiAgSGVsbWV0OiAoeyBjaGlsZHJlbiB9KSA9PiA8ZGl2IGRhdGEtdGVzdGlkPVwiaGVsbWV0XCI+e2NoaWxkcmVufTwvZGl2PixcclxufSkpO1xyXG5cclxuLy8gTW9jayBkbyBGcmFtZXIgTW90aW9uXHJcbmplc3QubW9jaygnZnJhbWVyLW1vdGlvbicsICgpID0+ICh7XHJcbiAgbW90aW9uOiB7XHJcbiAgICBkaXY6ICh7IGNoaWxkcmVuLCAuLi5wcm9wcyB9KSA9PiA8ZGl2IHsuLi5wcm9wc30+e2NoaWxkcmVufTwvZGl2PixcclxuICB9LFxyXG59KSk7XHJcblxyXG4vLyBNb2NrIGRvcyBjb21wb25lbnRlcyBMdWNpZGVcclxuamVzdC5tb2NrKCdsdWNpZGUtcmVhY3QnLCAoKSA9PiAoe1xyXG4gIENoZWNrQ2lyY2xlOiAoKSA9PiA8ZGl2IGRhdGEtdGVzdGlkPVwiY2hlY2staWNvblwiPuKckzwvZGl2PixcclxuICBYQ2lyY2xlOiAoKSA9PiA8ZGl2IGRhdGEtdGVzdGlkPVwieC1pY29uXCI+4pyXPC9kaXY+LFxyXG4gIExvYWRlcjI6ICgpID0+IDxkaXYgZGF0YS10ZXN0aWQ9XCJsb2FkZXItaWNvblwiPkxvYWRpbmcuLi48L2Rpdj4sXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgZG8gQnV0dG9uXHJcbmplc3QubW9jaygnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS9idXR0b24nLCAoKSA9PiAoe1xyXG4gIEJ1dHRvbjogKHsgY2hpbGRyZW4sIG9uQ2xpY2ssIC4uLnByb3BzIH0pID0+IChcclxuICAgIDxidXR0b24gb25DbGljaz17b25DbGlja30gZGF0YS10ZXN0aWQ9e3Byb3BzWydkYXRhLXRlc3RpZCddfSB7Li4ucHJvcHN9PlxyXG4gICAgICB7Y2hpbGRyZW59XHJcbiAgICA8L2J1dHRvbj5cclxuICApLFxyXG59KSk7XHJcblxyXG4vLyAtLS0gSEVMUEVSIC0tLVxyXG5cclxuY29uc3QgcmVuZGVyV2l0aFJvdXRlciA9IChjb21wb25lbnQpID0+IHtcclxuICByZXR1cm4gcmVuZGVyKFxyXG4gICAgPEJyb3dzZXJSb3V0ZXI+XHJcbiAgICAgIHtjb21wb25lbnR9XHJcbiAgICA8L0Jyb3dzZXJSb3V0ZXI+XHJcbiAgKTtcclxufTtcclxuXHJcbi8vIC0tLSBURVNURVMgLS0tXHJcblxyXG5kZXNjcmliZSgnQXV0aENhbGxiYWNrUGFnZScsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgamVzdC51c2VGYWtlVGltZXJzKCk7XHJcbiAgICBtb2NrR2V0Lm1vY2tSZXNldCgpO1xyXG4gICAgXHJcbiAgICAvLyBSZXNldGFyIGUgY29uZmlndXJhciBjb21wb3J0YW1lbnRvIHBhZHLDo28gZG8gbW9ja1ZlcmlmeU90cFxyXG4gICAgaWYgKG1vY2tWZXJpZnlPdHAubW9ja1Jlc2V0KSB7XHJcbiAgICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc2V0KCk7XHJcbiAgICB9XHJcbiAgICAvLyBDb21wb3J0YW1lbnRvIHBhZHLDo286IHN1Y2Vzc29cclxuICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICBkYXRhOiB7IHVzZXI6IHsgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyB9IH0sXHJcbiAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzKCk7XHJcbiAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0VzdGFkbyBkZSBsb2FkaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgbW9zdHJhciBsb2FkZXIgZW5xdWFudG8gcHJvY2Vzc2EgYSBjb25maXJtYcOnw6NvJywgKCkgPT4ge1xyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICd0ZXN0LXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbmV3IFByb21pc2UoKCkgPT4ge30pKTsgLy8gTmV2ZXIgcmVzb2x2ZXNcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnbG9hZGVyLWljb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ0NvbmZpcm1hbmRvIHNldSBlbWFpbC4uLicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnQWd1YXJkZSBlbnF1YW50byB2YWxpZGFtb3Mgc2V1IGNhZGFzdHJvJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NvbmZpcm1hw6fDo28gYmVtLXN1Y2VkaWRhJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgbW9zdHJhciBtZW5zYWdlbSBkZSBzdWNlc3NvIGUgcmVkaXJlY2lvbmFyIGFww7NzIGNvbmZpcm1hciBlbWFpbCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScgfTtcclxuICAgICAgXHJcbiAgICAgIG1vY2tHZXQubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbSkgPT4ge1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3Rva2VuX2hhc2gnKSByZXR1cm4gJ3ZhbGlkLXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgIGRhdGE6IHsgdXNlcjogbW9ja1VzZXIgfSxcclxuICAgICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIC8vIEFndWFyZGEgcHJvY2Vzc2FtZW50b1xyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdjaGVjay1pY29uJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIH0sIHsgdGltZW91dDogMzAwMCB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdFbWFpbCBDb25maXJtYWRvIScpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgvY29uZmlybWFkbyBjb20gc3VjZXNzby9pKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL1JlZGlyZWNpb25hbmRvIHBhcmEgbyBsb2dpbi9pKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIHZlcmlmeU90cCBmb2kgY2hhbWFkbyBjb3JyZXRhbWVudGVcclxuICAgICAgZXhwZWN0KG1vY2tWZXJpZnlPdHApLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICB0b2tlbl9oYXNoOiAndmFsaWQtdG9rZW4nLFxyXG4gICAgICAgIHR5cGU6ICdlbWFpbCcsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQXZhbsOnYSBvIHRpbWVyIHBhcmEgc2ltdWxhciBvIHRpbWVvdXRcclxuICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDIwMDApO1xyXG5cclxuICAgICAgLy8gVmVyaWZpY2EgcmVkaXJlY2lvbmFtZW50b1xyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBleHBlY3QobW9ja05hdmlnYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL2xvZ2luJywge1xyXG4gICAgICAgICAgc3RhdGU6IHtcclxuICAgICAgICAgICAgZW1haWxDb25maXJtZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIGZ1bmNpb25hciBtZXNtbyBzZW0gZW1haWwgZG8gdXN1w6FyaW8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tHZXQubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbSkgPT4ge1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3Rva2VuX2hhc2gnKSByZXR1cm4gJ3ZhbGlkLXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgIGRhdGE6IHsgdXNlcjogbnVsbCB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnY2hlY2staWNvbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9LCB7IHRpbWVvdXQ6IDMwMDAgfSk7XHJcblxyXG4gICAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMjAwMCk7XHJcblxyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBleHBlY3QobW9ja05hdmlnYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL2xvZ2luJywge1xyXG4gICAgICAgICAgc3RhdGU6IHtcclxuICAgICAgICAgICAgZW1haWxDb25maXJtZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIGVtYWlsOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRXJyb3MgZGUgdmFsaWRhw6fDo28nLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSBtb3N0cmFyIGVycm8gcXVhbmRvIHRva2VuX2hhc2ggZXN0aXZlciBhdXNlbnRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7IC8vIHRva2VuX2hhc2ggYXVzZW50ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgneC1pY29uJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ0Vycm8gbmEgQ29uZmlybWHDp8OjbycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnTGluayBkZSBjb25maXJtYcOnw6NvIGludsOhbGlkbycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICBleHBlY3QobW9ja1ZlcmlmeU90cCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG1vc3RyYXIgZXJybyBxdWFuZG8gdHlwZSBuw6NvIGZvciBcImVtYWlsXCInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tHZXQubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbSkgPT4ge1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3Rva2VuX2hhc2gnKSByZXR1cm4gJ3Rlc3QtdG9rZW4nO1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3R5cGUnKSByZXR1cm4gJ3JlY292ZXJ5JzsgLy8gdGlwbyBlcnJhZG9cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3gtaWNvbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdMaW5rIGRlIGNvbmZpcm1hw6fDo28gaW52w6FsaWRvJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIGV4cGVjdChtb2NrVmVyaWZ5T3RwKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgbW9zdHJhciBlcnJvIHF1YW5kbyB2ZXJpZnlPdHAgZmFsaGFyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICdpbnZhbGlkLXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIHBhcmEgcmV0b3JuYXIgZXJyb1xyXG4gICAgICBtb2NrVmVyaWZ5T3RwLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnVG9rZW4gaW52w6FsaWRvJyB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgneC1pY29uJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL1Rva2VuIGludsOhbGlkby9pKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG1vc3RyYXIgbWVuc2FnZW0gZXNwZWPDrWZpY2EgcGFyYSBlbWFpbCBqw6EgY29uZmlybWFkbycsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0dldC5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtKSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndG9rZW5faGFzaCcpIHJldHVybiAnYWxyZWFkeS11c2VkLXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ0VtYWlsIGFscmVhZHkgY29uZmlybWVkJyB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL2rDoSBmb2kgY29uZmlybWFkbyBhbnRlcmlvcm1lbnRlL2kpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG1vc3RyYXIgbWVuc2FnZW0gZXNwZWPDrWZpY2EgcGFyYSBsaW5rIGV4cGlyYWRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICdleHBpcmVkLXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ1Rva2VuIGV4cGlyZWQnIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVuZGVyV2l0aFJvdXRlcig8QXV0aENhbGxiYWNrUGFnZSAvPik7XHJcblxyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgvbGluayBkZSBjb25maXJtYcOnw6NvIGV4cGlyb3UvaSkpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdJbnRlcmHDp8O1ZXMgZG8gdXN1w6FyaW8gbm8gZXN0YWRvIGRlIGVycm8nLCAoKSA9PiB7XHJcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0dldC5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtKSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndG9rZW5faGFzaCcpIHJldHVybiAnZXJyb3ItdG9rZW4nO1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3R5cGUnKSByZXR1cm4gJ2VtYWlsJztcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBtb2NrVmVyaWZ5T3RwLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdFcnJvIGdlbsOpcmljbycgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3gtaWNvbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG5hdmVnYXIgcGFyYSBsb2dpbiBhbyBjbGljYXIgZW0gXCJJciBwYXJhIExvZ2luXCInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoeyBkZWxheTogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbG9naW5CdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXh0KCdJciBwYXJhIExvZ2luJyk7XHJcblxyXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKGxvZ2luQnV0dG9uKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrTmF2aWdhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvbG9naW4nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG5hdmVnYXIgcGFyYSByZWdpc3RybyBhbyBjbGljYXIgZW0gXCJUZW50YXIgTm92YW1lbnRlXCInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoeyBkZWxheTogbnVsbCB9KTtcclxuICAgICAgY29uc3QgcmV0cnlCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXh0KCdUZW50YXIgTm92YW1lbnRlJyk7XHJcblxyXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKHJldHJ5QnV0dG9uKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrTmF2aWdhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvcGFydG5lci9yZWdpc3RlcicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdNZXRhZGFkb3MgZSBTRU8nLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSByZW5kZXJpemFyIG8gSGVsbWV0IGNvbSB0w610dWxvIGNvcnJldG8nLCAoKSA9PiB7XHJcbiAgICAgIG1vY2tHZXQubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbSkgPT4ge1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3Rva2VuX2hhc2gnKSByZXR1cm4gJ3Rlc3QtdG9rZW4nO1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3R5cGUnKSByZXR1cm4gJ2VtYWlsJztcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBtb2NrVmVyaWZ5T3RwLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBuZXcgUHJvbWlzZSgoKSA9PiB7fSkpO1xyXG5cclxuICAgICAgcmVuZGVyV2l0aFJvdXRlcig8QXV0aENhbGxiYWNrUGFnZSAvPik7XHJcblxyXG4gICAgICBjb25zdCBoZWxtZXQgPSBzY3JlZW4uZ2V0QnlUZXN0SWQoJ2hlbG1ldCcpO1xyXG4gICAgICBleHBlY3QoaGVsbWV0KS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnQ29uZmlybWHDp8OjbyBkZSBFbWFpbCAtIE1lc2EgUHJhIDInKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnQ29uc29sZSBlcnJvcnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSBsb2dhciBlcnJvIG5vIGNvbnNvbGUgcXVhbmRvIHZlcmlmaWNhw6fDo28gZmFsaGFyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb25zb2xlRXJyb3JTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICdlcnJvci10b2tlbic7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGVycm9yT2JqID0geyBtZXNzYWdlOiAnVGVzdCBlcnJvcicgfTtcclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yT2JqLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgneC1pY29uJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gVmVyaWZpY2Egc2UgY29uc29sZS5lcnJvciBmb2kgY2hhbWFkbyBjb20gbyBlcnJvXHJcbiAgICAgIGV4cGVjdChjb25zb2xlRXJyb3JTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KGNvbnNvbGVFcnJvclNweS5tb2NrLmNhbGxzWzBdWzBdKS50b0JlKCdFcnJvIG5hIGNvbmZpcm1hw6fDo286Jyk7XHJcblxyXG4gICAgICBjb25zb2xlRXJyb3JTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=