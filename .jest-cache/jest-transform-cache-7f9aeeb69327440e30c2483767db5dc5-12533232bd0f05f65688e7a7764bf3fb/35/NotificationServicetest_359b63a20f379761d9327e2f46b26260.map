{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\NotificationService.test.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\NotificationService.test.ts"],"sourcesContent":["// src/services/NotificationService.test.ts\r\n\r\n// --- 1. MOCKING DEPEND√äNCIAS (ANTES DAS IMPORTA√á√ïES) ---\r\n\r\n// Mock do Supabase\r\nconst mockFrom = jest.fn();\r\nconst mockRpc = jest.fn();\r\n\r\njest.mock('@/lib/supabaseClient', () => ({\r\n  supabase: {\r\n    from: mockFrom,\r\n    rpc: mockRpc,\r\n  }\r\n}));\r\n\r\n// --- 2. IMPORTA√á√ïES (DEPOIS DOS MOCKS) ---\r\n\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport NotificationService from './NotificationService';\r\n\r\n// --- 3. CONFIGURA√á√ÉO DOS TESTES ---\r\n\r\ndescribe('NotificationService', () => {\r\n\r\n  // Limpa todos os mocks antes de cada teste\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  // --- 4. TESTES DOS M√âTODOS ---\r\n\r\n  describe('create (RLS)', () => {\r\n    it('deve chamar supabase.insert com os dados corretos', async () => {\r\n      const mockNotification = {\r\n        user_id: 'user-123',\r\n        event_id: 1,\r\n        notification_type: 'Novo Evento',\r\n        title: 'Teste',\r\n        message: 'Mensagem teste',\r\n      };\r\n      \r\n      const mockSingle = jest.fn().mockResolvedValue({ \r\n        data: { id: 1, ...mockNotification }, \r\n        error: null \r\n      });\r\n      const mockSelect = jest.fn().mockReturnValue({ single: mockSingle });\r\n      const mockInsert = jest.fn().mockReturnValue({ select: mockSelect });\r\n      \r\n      mockFrom.mockReturnValue({\r\n        insert: mockInsert,\r\n      });\r\n\r\n      const result = await NotificationService.create(mockNotification as any);\r\n\r\n      expect(mockFrom).toHaveBeenCalledWith('notifications');\r\n      expect(mockInsert).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          ...mockNotification,\r\n          sent: false,\r\n        })\r\n      );\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toHaveProperty('id', 1);\r\n    });\r\n  });\r\n\r\n  describe('createForUser (RPC)', () => {\r\n    it('deve chamar supabase.rpc com os par√¢metros corretos', async () => {\r\n      const rpcParams = {\r\n        target_user_id: 'user-456',\r\n        target_event_id: 2,\r\n        notification_type: 'Candidatura Aprovada' as const,\r\n        title: 'Aprovado!',\r\n        message: 'Voc√™ foi aprovado.',\r\n        target_participation_id: 'part-789',\r\n      };\r\n\r\n      mockRpc.mockResolvedValue({ error: null });\r\n\r\n      const result = await NotificationService.createForUser(rpcParams);\r\n\r\n      expect(mockRpc).toHaveBeenCalledWith('create_notification_for_user', rpcParams);\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('deve lidar com participation_id nulo no RPC', async () => {\r\n      mockRpc.mockResolvedValue({ error: null });\r\n\r\n      await NotificationService.createForUser({\r\n        target_user_id: 'user-456',\r\n        target_event_id: 2,\r\n        notification_type: 'Candidatura Aprovada',\r\n        title: 'Aprovado!',\r\n        message: 'Voc√™ foi aprovado.',\r\n        // participation_id √© omitido\r\n      });\r\n\r\n      expect(mockRpc).toHaveBeenCalledWith('create_notification_for_user', \r\n        expect.objectContaining({\r\n          target_participation_id: null, // Verifica se foi definido como null\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Fun√ß√µes de Notifica√ß√£o (notify*)', () => {\r\n    // Espiona o m√©todo 'createForUser' que √© a base de todos\r\n    let spyCreateForUser: jest.SpiedFunction<typeof NotificationService.createForUser>;\r\n\r\n    beforeEach(() => {\r\n      // Espionamos o m√©todo e simulamos um retorno de sucesso\r\n      spyCreateForUser = jest.spyOn(NotificationService, 'createForUser')\r\n        .mockResolvedValue({ success: true });\r\n    });\r\n\r\n    afterEach(() => {\r\n      // Restauramos o m√©todo original ap√≥s cada teste\r\n      spyCreateForUser.mockRestore();\r\n    });\r\n\r\n    it('notifyNewParticipation deve chamar createForUser corretamente', async () => {\r\n      await NotificationService.notifyNewParticipation('host-id', 1, 'part-id', 'Michael', 'Evento Teste');\r\n      \r\n      expect(spyCreateForUser).toHaveBeenCalledWith({\r\n        target_user_id: 'host-id',\r\n        target_event_id: 1,\r\n        notification_type: 'Candidatura Recebida',\r\n        title: 'üéâ Nova Candidatura!',\r\n        message: 'Michael se candidatou ao seu evento \"Evento Teste\"',\r\n        target_participation_id: 'part-id',\r\n      });\r\n    });\r\n\r\n    it('notifyParticipationApproved deve chamar createForUser corretamente', async () => {\r\n      await NotificationService.notifyParticipationApproved('user-id', 2, 'Evento Aprovado');\r\n      \r\n      expect(spyCreateForUser).toHaveBeenCalledWith({\r\n        target_user_id: 'user-id',\r\n        target_event_id: 2,\r\n        notification_type: 'Candidatura Aprovada',\r\n        title: '‚úÖ Voc√™ foi aprovado!',\r\n        message: 'Sua candidatura para \"Evento Aprovado\" foi aprovada!',\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('notifyUsersWithMatchingHashtags', () => {\r\n    it('deve notificar usu√°rios com hashtags correspondentes', async () => {\r\n      const profiles = [\r\n        { id: 'user-1', username: 'user1', hashtags: ['react', 'node'] },\r\n        { id: 'user-2', username: 'user2', hashtags: ['react', 'outro'] },\r\n        { id: 'user-3', username: 'user3', hashtags: ['python'] }, // n√£o deve notificar\r\n      ];\r\n      \r\n      const eventData = {\r\n        creator_id: 'host-id',\r\n        title: 'Evento de React',\r\n        hashtags: ['react', 'typescript'],\r\n        event_type: 'padrao',\r\n      };\r\n\r\n      // Mock 1: SELECT de perfis\r\n      const mockSelectNeq = jest.fn().mockResolvedValue({ data: profiles, error: null });\r\n      const mockSelectNot = jest.fn().mockReturnValue({ neq: mockSelectNeq });\r\n      const mockSelect = jest.fn().mockReturnValue({ not: mockSelectNot });\r\n      \r\n      // Mock 2: INSERT de notifica√ß√µes\r\n      const mockInsert = jest.fn().mockResolvedValue({ error: null });\r\n\r\n      mockFrom\r\n        .mockReturnValueOnce({ select: mockSelect })  // primeira chamada: buscar perfis\r\n        .mockReturnValueOnce({ insert: mockInsert }); // segunda chamada: inserir notifica√ß√µes\r\n\r\n      const result = await NotificationService.notifyUsersWithMatchingHashtags(10, eventData);\r\n\r\n      expect(mockFrom).toHaveBeenCalledWith('profiles');\r\n      expect(mockFrom).toHaveBeenCalledWith('notifications');\r\n      expect(mockInsert).toHaveBeenCalled();\r\n      \r\n      // Verifica se apenas 2 usu√°rios (user-1, user-2) foram notificados\r\n      const insertedNotifications = mockInsert.mock.calls[0][0];\r\n      expect(insertedNotifications).toHaveLength(2);\r\n      expect(insertedNotifications[0].user_id).toBe('user-1');\r\n      expect(insertedNotifications[1].user_id).toBe('user-2');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data.notified).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('getUserNotifications', () => {\r\n    it('deve buscar notifica√ß√µes e orden√°-las', async () => {\r\n      const mockNotifications = [{ id: 1, message: 'Notifica√ß√£o 1' }];\r\n      \r\n      const mockLimit = jest.fn().mockResolvedValue({ data: mockNotifications, error: null });\r\n      const mockOrder = jest.fn().mockReturnValue({ limit: mockLimit });\r\n      const mockEq = jest.fn().mockReturnValue({ order: mockOrder });\r\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });\r\n      \r\n      mockFrom.mockReturnValue({\r\n        select: mockSelect,\r\n      });\r\n\r\n      const result = await NotificationService.getUserNotifications('user-id');\r\n\r\n      expect(mockFrom).toHaveBeenCalledWith('notifications');\r\n      expect(mockSelect).toHaveBeenCalledWith('*');\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toEqual(mockNotifications);\r\n    });\r\n  });\r\n\r\n  describe('markAsRead', () => {\r\n    it('deve chamar update para marcar como sent: true', async () => {\r\n      const mockEq = jest.fn().mockResolvedValue({ error: null });\r\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\r\n      \r\n      mockFrom.mockReturnValue({\r\n        update: mockUpdate,\r\n      });\r\n\r\n      await NotificationService.markAsRead(123);\r\n\r\n      expect(mockFrom).toHaveBeenCalledWith('notifications');\r\n      expect(mockUpdate).toHaveBeenCalledWith({ sent: true });\r\n      expect(mockEq).toHaveBeenCalledWith('id', 123);\r\n    });\r\n  });\r\n\r\n  describe('getUnreadCount', () => {\r\n    it('deve retornar a contagem de notifica√ß√µes n√£o lidas', async () => {\r\n      const mockEq2 = jest.fn().mockResolvedValue({ count: 5, error: null });\r\n      const mockEq1 = jest.fn().mockReturnValue({ eq: mockEq2 });\r\n      const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });\r\n      \r\n      mockFrom.mockReturnValue({\r\n        select: mockSelect,\r\n      });\r\n\r\n      const count = await NotificationService.getUnreadCount('user-id');\r\n\r\n      expect(mockSelect).toHaveBeenCalledWith('*', { count: 'exact', head: true });\r\n      expect(mockEq2).toHaveBeenCalledWith('sent', false);\r\n      expect(count).toBe(5);\r\n    });\r\n  });\r\n\r\n  describe('delete', () => {\r\n    it('deve chamar delete com o ID correto', async () => {\r\n      const mockEq = jest.fn().mockResolvedValue({ error: null });\r\n      const mockDelete = jest.fn().mockReturnValue({ eq: mockEq });\r\n      \r\n      mockFrom.mockReturnValue({\r\n        delete: mockDelete,\r\n      });\r\n\r\n      await NotificationService.delete(123);\r\n\r\n      expect(mockFrom).toHaveBeenCalledWith('notifications');\r\n      expect(mockEq).toHaveBeenCalledWith('id', 123);\r\n    });\r\n  });\r\n\r\n});"],"version":3}