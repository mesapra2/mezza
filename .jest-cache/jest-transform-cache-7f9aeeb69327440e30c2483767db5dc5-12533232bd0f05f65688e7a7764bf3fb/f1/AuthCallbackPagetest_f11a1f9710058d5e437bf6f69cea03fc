f5c9d98962f80c4ee73471ba701755ef
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
// src/features/auth/pages/AuthCallbackPage.test.jsx
/* eslint-disable react/prop-types */
const globals_1 = require("@jest/globals");
// Mock do react-router-dom
globals_1.jest.mock('react-router-dom', () => ({
    ...globals_1.jest.requireActual('react-router-dom'),
    useNavigate: () => mockNavigate,
    useSearchParams: () => [{ get: mockGet }],
}));
globals_1.jest.mock('@/lib/supabaseClient', () => ({
    supabase: {
        auth: {
            verifyOtp: globals_1.jest.fn(),
        },
    },
}));
// Mock do Helmet
globals_1.jest.mock('react-helmet-async', () => ({
    Helmet: ({ children }) => (0, jsx_runtime_1.jsx)("div", { "data-testid": "helmet", children: children }),
}));
// Mock do Framer Motion
globals_1.jest.mock('framer-motion', () => ({
    motion: {
        div: ({ children, ...props }) => (0, jsx_runtime_1.jsx)("div", { ...props, children: children }),
    },
}));
// Mock dos componentes Lucide
globals_1.jest.mock('lucide-react', () => ({
    CheckCircle: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "check-icon", children: "\u2713" }),
    XCircle: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "x-icon", children: "\u2717" }),
    Loader2: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "loader-icon", children: "Loading..." }),
}));
// Mock do Button
globals_1.jest.mock('@/features/shared/components/ui/button', () => ({
    Button: ({ children, onClick, ...props }) => ((0, jsx_runtime_1.jsx)("button", { onClick: onClick, "data-testid": props['data-testid'], ...props, children: children })),
}));
const react_1 = require("@testing-library/react");
const react_router_dom_1 = require("react-router-dom");
const user_event_1 = tslib_1.__importDefault(require("@testing-library/user-event"));
const AuthCallbackPage_1 = tslib_1.__importDefault(require("./AuthCallbackPage"));
// --- MOCKS ---
const mockNavigate = globals_1.jest.fn();
const mockGet = globals_1.jest.fn();
// Mock do Supabase - criar mock dentro da factory
const mockVerifyOtp = globals_1.jest.fn();
// --- HELPER ---
const renderWithRouter = (component) => {
    return (0, react_1.render)((0, jsx_runtime_1.jsx)(react_router_dom_1.BrowserRouter, { children: component }));
};
// --- TESTES ---
(0, globals_1.describe)('AuthCallbackPage', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        globals_1.jest.useFakeTimers();
        mockGet.mockReset();
        // Resetar e configurar comportamento padrão do mockVerifyOtp
        mockVerifyOtp.mockReset();
        mockVerifyOtp.mockResolvedValue({
            data: { user: { email: 'default@example.com' } },
            error: null,
        });
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.runOnlyPendingTimers();
        globals_1.jest.useRealTimers();
    });
    (0, globals_1.describe)('Estado de loading', () => {
        (0, globals_1.it)('deve mostrar loader enquanto processa a confirmação', () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'test-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockImplementation(() => new Promise(() => { })); // Never resolves
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            (0, globals_1.expect)(react_1.screen.getByTestId('loader-icon')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Confirmando seu email...')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Aguarde enquanto validamos seu cadastro')).toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('Confirmação bem-sucedida', () => {
        (0, globals_1.it)('deve mostrar mensagem de sucesso e redirecionar após confirmar email', async () => {
            const mockUser = { email: 'test@example.com' };
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'valid-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            // Configurar mock ANTES de renderizar
            mockVerifyOtp.mockResolvedValueOnce({
                data: { user: mockUser },
                error: null,
            });
            // Debug
            console.log('Mock configurado:', mockVerifyOtp.getMockName?.());
            console.log('Mock é função?', typeof mockVerifyOtp);
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            // Aguarda processamento
            await (0, react_1.waitFor)(() => {
                const checkIcon = react_1.screen.queryByTestId('check-icon');
                const xIcon = react_1.screen.queryByTestId('x-icon');
                console.log('Check icon:', checkIcon);
                console.log('X icon:', xIcon);
                console.log('Mock foi chamado?', mockVerifyOtp.mock.calls.length);
                (0, globals_1.expect)(react_1.screen.getByTestId('check-icon')).toBeInTheDocument();
            }, { timeout: 3000 });
            (0, globals_1.expect)(react_1.screen.getByText('Email Confirmado!')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText(/confirmado com sucesso/i)).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText(/Redirecionando para o login/i)).toBeInTheDocument();
            // Verifica se verifyOtp foi chamado corretamente
            (0, globals_1.expect)(mockVerifyOtp).toHaveBeenCalledWith({
                token_hash: 'valid-token',
                type: 'email',
            });
            // Avança o timer para simular o timeout
            globals_1.jest.advanceTimersByTime(2000);
            // Verifica redirecionamento
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/login', {
                    state: {
                        emailConfirmed: true,
                        email: 'test@example.com',
                    },
                });
            });
        });
        (0, globals_1.it)('deve funcionar mesmo sem email do usuário', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'valid-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValueOnce({
                data: { user: null },
                error: null,
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('check-icon')).toBeInTheDocument();
            }, { timeout: 3000 });
            globals_1.jest.advanceTimersByTime(2000);
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/login', {
                    state: {
                        emailConfirmed: true,
                        email: undefined,
                    },
                });
            });
        });
    });
    (0, globals_1.describe)('Erros de validação', () => {
        (0, globals_1.it)('deve mostrar erro quando token_hash estiver ausente', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'type')
                    return 'email';
                return null; // token_hash ausente
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_1.screen.getByText('Erro na Confirmação')).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Link de confirmação inválido')).toBeInTheDocument();
            (0, globals_1.expect)(mockVerifyOtp).not.toHaveBeenCalled();
        });
        (0, globals_1.it)('deve mostrar erro quando type não for "email"', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'test-token';
                if (param === 'type')
                    return 'recovery'; // tipo errado
                return null;
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_1.screen.getByText('Link de confirmação inválido')).toBeInTheDocument();
            (0, globals_1.expect)(mockVerifyOtp).not.toHaveBeenCalled();
        });
        (0, globals_1.it)('deve mostrar erro quando verifyOtp falhar', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'invalid-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            // Configurar mock para retornar erro
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: { message: 'Token inválido' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_1.screen.getByText(/Token inválido/i)).toBeInTheDocument();
        });
        (0, globals_1.it)('deve mostrar mensagem específica para email já confirmado', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'already-used-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: { message: 'Email already confirmed' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByText(/já foi confirmado anteriormente/i)).toBeInTheDocument();
            });
        });
        (0, globals_1.it)('deve mostrar mensagem específica para link expirado', async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'expired-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: { message: 'Token expired' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByText(/link de confirmação expirou/i)).toBeInTheDocument();
            });
        });
    });
    (0, globals_1.describe)('Interações do usuário no estado de erro', () => {
        (0, globals_1.beforeEach)(async () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'error-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockResolvedValue({
                data: null,
                error: { message: 'Erro genérico' },
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
        });
        (0, globals_1.it)('deve navegar para login ao clicar em "Ir para Login"', async () => {
            const user = user_event_1.default.setup({ delay: null });
            const loginButton = react_1.screen.getByText('Ir para Login');
            await user.click(loginButton);
            (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/login');
        });
        (0, globals_1.it)('deve navegar para registro ao clicar em "Tentar Novamente"', async () => {
            const user = user_event_1.default.setup({ delay: null });
            const retryButton = react_1.screen.getByText('Tentar Novamente');
            await user.click(retryButton);
            (0, globals_1.expect)(mockNavigate).toHaveBeenCalledWith('/partner/register');
        });
    });
    (0, globals_1.describe)('Metadados e SEO', () => {
        (0, globals_1.it)('deve renderizar o Helmet com título correto', () => {
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'test-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            mockVerifyOtp.mockImplementation(() => new Promise(() => { }));
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            const helmet = react_1.screen.getByTestId('helmet');
            (0, globals_1.expect)(helmet).toBeInTheDocument();
            (0, globals_1.expect)(react_1.screen.getByText('Confirmação de Email - Mesa Pra 2')).toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('Console errors', () => {
        (0, globals_1.it)('deve logar erro no console quando verificação falhar', async () => {
            const consoleErrorSpy = globals_1.jest.spyOn(console, 'error').mockImplementation(() => { });
            mockGet.mockImplementation((param) => {
                if (param === 'token_hash')
                    return 'error-token';
                if (param === 'type')
                    return 'email';
                return null;
            });
            const errorObj = { message: 'Test error' };
            mockVerifyOtp.mockResolvedValueOnce({
                data: null,
                error: errorObj,
            });
            renderWithRouter((0, jsx_runtime_1.jsx)(AuthCallbackPage_1.default, {}));
            await (0, react_1.waitFor)(() => {
                (0, globals_1.expect)(react_1.screen.getByTestId('x-icon')).toBeInTheDocument();
            });
            // Verifica se console.error foi chamado com o erro
            (0, globals_1.expect)(consoleErrorSpy).toHaveBeenCalled();
            (0, globals_1.expect)(consoleErrorSpy.mock.calls[0][0]).toBe('Erro na confirmação:');
            consoleErrorSpy.mockRestore();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcc2hhcmVkXFxwYWdlc1xcQXV0aENhbGxiYWNrUGFnZS50ZXN0LmpzeCIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsb0RBQW9EO0FBQ3BELHFDQUFxQztBQUVyQywyQ0FBa0Y7QUFXbEYsMkJBQTJCO0FBQzNCLGNBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuQyxHQUFHLGNBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUM7SUFDekMsV0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVk7SUFDL0IsZUFBZSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLENBQUM7Q0FDMUMsQ0FBQyxDQUFDLENBQUM7QUFJSixjQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdkMsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFO1lBQ0osU0FBUyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7U0FDckI7S0FDRjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBRUosaUJBQWlCO0FBQ2pCLGNBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQywrQ0FBaUIsUUFBUSxZQUFFLFFBQVEsR0FBTztDQUNyRSxDQUFDLENBQUMsQ0FBQztBQUVKLHdCQUF3QjtBQUN4QixjQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hDLE1BQU0sRUFBRTtRQUNOLEdBQUcsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLEdBQUcsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLG1DQUFTLEtBQUssWUFBRyxRQUFRLEdBQU87S0FDbEU7Q0FDRixDQUFD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SCxNQUFNLFFBQVEsR0FBRyxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsQ0FBQztZQUMzQyxhQUFhLENBQUMscUJBQXFCLENBQUM7Z0JBQ2xDLElBQUksRUFBRSxJQUFJO2dCQUNWLEtBQUssRUFBRSxRQUFRO2FBQ2hCLENBQUMsQ0FBQztZQUVILGdCQUFnQixDQUFDLHVCQUFDLDBCQUFnQixLQUFHLENBQUMsQ0FBQztZQUV2QyxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzNELENBQUMsQ0FBQyxDQUFDO1lBRUgsbURBQW1EO1lBQ25ELElBQUEsZ0JBQU0sRUFBQyxlQUFlLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQzNDLElBQUEsZ0JBQU0sRUFBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBRXRFLGVBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcc2hhcmVkXFxwYWdlc1xcQXV0aENhbGxiYWNrUGFnZS50ZXN0LmpzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvZmVhdHVyZXMvYXV0aC9wYWdlcy9BdXRoQ2FsbGJhY2tQYWdlLnRlc3QuanN4XHJcbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L3Byb3AtdHlwZXMgKi9cclxuXHJcbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBqZXN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcclxuaW1wb3J0IHsgcmVuZGVyLCBzY3JlZW4sIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcclxuaW1wb3J0IHsgQnJvd3NlclJvdXRlciB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xyXG5pbXBvcnQgdXNlckV2ZW50IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvdXNlci1ldmVudCc7XHJcbmltcG9ydCBBdXRoQ2FsbGJhY2tQYWdlIGZyb20gJy4vQXV0aENhbGxiYWNrUGFnZSc7XHJcblxyXG4vLyAtLS0gTU9DS1MgLS0tXHJcblxyXG5jb25zdCBtb2NrTmF2aWdhdGUgPSBqZXN0LmZuKCk7XHJcbmNvbnN0IG1vY2tHZXQgPSBqZXN0LmZuKCk7XHJcblxyXG4vLyBNb2NrIGRvIHJlYWN0LXJvdXRlci1kb21cclxuamVzdC5tb2NrKCdyZWFjdC1yb3V0ZXItZG9tJywgKCkgPT4gKHtcclxuICAuLi5qZXN0LnJlcXVpcmVBY3R1YWwoJ3JlYWN0LXJvdXRlci1kb20nKSxcclxuICB1c2VOYXZpZ2F0ZTogKCkgPT4gbW9ja05hdmlnYXRlLFxyXG4gIHVzZVNlYXJjaFBhcmFtczogKCkgPT4gW3sgZ2V0OiBtb2NrR2V0IH1dLFxyXG59KSk7XHJcblxyXG4vLyBNb2NrIGRvIFN1cGFiYXNlIC0gY3JpYXIgbW9jayBkZW50cm8gZGEgZmFjdG9yeVxyXG5jb25zdCBtb2NrVmVyaWZ5T3RwID0gamVzdC5mbigpO1xyXG5qZXN0Lm1vY2soJ0AvbGliL3N1cGFiYXNlQ2xpZW50JywgKCkgPT4gKHtcclxuICBzdXBhYmFzZToge1xyXG4gICAgYXV0aDoge1xyXG4gICAgICB2ZXJpZnlPdHA6IGplc3QuZm4oKSxcclxuICAgIH0sXHJcbiAgfSxcclxufSkpO1xyXG5cclxuLy8gTW9jayBkbyBIZWxtZXRcclxuamVzdC5tb2NrKCdyZWFjdC1oZWxtZXQtYXN5bmMnLCAoKSA9PiAoe1xyXG4gIEhlbG1ldDogKHsgY2hpbGRyZW4gfSkgPT4gPGRpdiBkYXRhLXRlc3RpZD1cImhlbG1ldFwiPntjaGlsZHJlbn08L2Rpdj4sXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgZG8gRnJhbWVyIE1vdGlvblxyXG5qZXN0Lm1vY2soJ2ZyYW1lci1tb3Rpb24nLCAoKSA9PiAoe1xyXG4gIG1vdGlvbjoge1xyXG4gICAgZGl2OiAoeyBjaGlsZHJlbiwgLi4ucHJvcHMgfSkgPT4gPGRpdiB7Li4ucHJvcHN9PntjaGlsZHJlbn08L2Rpdj4sXHJcbiAgfSxcclxufSkpO1xyXG5cclxuLy8gTW9jayBkb3MgY29tcG9uZW50ZXMgTHVjaWRlXHJcbmplc3QubW9jaygnbHVjaWRlLXJlYWN0JywgKCkgPT4gKHtcclxuICBDaGVja0NpcmNsZTogKCkgPT4gPGRpdiBkYXRhLXRlc3RpZD1cImNoZWNrLWljb25cIj7inJM8L2Rpdj4sXHJcbiAgWENpcmNsZTogKCkgPT4gPGRpdiBkYXRhLXRlc3RpZD1cIngtaWNvblwiPuKclzwvZGl2PixcclxuICBMb2FkZXIyOiAoKSA9PiA8ZGl2IGRhdGEtdGVzdGlkPVwibG9hZGVyLWljb25cIj5Mb2FkaW5nLi4uPC9kaXY+LFxyXG59KSk7XHJcblxyXG4vLyBNb2NrIGRvIEJ1dHRvblxyXG5qZXN0Lm1vY2soJ0AvZmVhdHVyZXMvc2hhcmVkL2NvbXBvbmVudHMvdWkvYnV0dG9uJywgKCkgPT4gKHtcclxuICBCdXR0b246ICh7IGNoaWxkcmVuLCBvbkNsaWNrLCAuLi5wcm9wcyB9KSA9PiAoXHJcbiAgICA8YnV0dG9uIG9uQ2xpY2s9e29uQ2xpY2t9IGRhdGEtdGVzdGlkPXtwcm9wc1snZGF0YS10ZXN0aWQnXX0gey4uLnByb3BzfT5cclxuICAgICAge2NoaWxkcmVufVxyXG4gICAgPC9idXR0b24+XHJcbiAgKSxcclxufSkpO1xyXG5cclxuLy8gLS0tIEhFTFBFUiAtLS1cclxuXHJcbmNvbnN0IHJlbmRlcldpdGhSb3V0ZXIgPSAoY29tcG9uZW50KSA9PiB7XHJcbiAgcmV0dXJuIHJlbmRlcihcclxuICAgIDxCcm93c2VyUm91dGVyPlxyXG4gICAgICB7Y29tcG9uZW50fVxyXG4gICAgPC9Ccm93c2VyUm91dGVyPlxyXG4gICk7XHJcbn07XHJcblxyXG4vLyAtLS0gVEVTVEVTIC0tLVxyXG5cclxuZGVzY3JpYmUoJ0F1dGhDYWxsYmFja1BhZ2UnLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xyXG4gICAgbW9ja0dldC5tb2NrUmVzZXQoKTtcclxuICAgIFxyXG4gICAgLy8gUmVzZXRhciBlIGNvbmZpZ3VyYXIgY29tcG9ydGFtZW50byBwYWRyw6NvIGRvIG1vY2tWZXJpZnlPdHBcclxuICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc2V0KCk7XHJcbiAgICBtb2NrVmVyaWZ5T3RwLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgZGF0YTogeyB1c2VyOiB7IGVtYWlsOiAnZGVmYXVsdEBleGFtcGxlLmNvbScgfSB9LFxyXG4gICAgICBlcnJvcjogbnVsbCxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5ydW5Pbmx5UGVuZGluZ1RpbWVycygpO1xyXG4gICAgamVzdC51c2VSZWFsVGltZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdFc3RhZG8gZGUgbG9hZGluZycsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIG1vc3RyYXIgbG9hZGVyIGVucXVhbnRvIHByb2Nlc3NhIGEgY29uZmlybWHDp8OjbycsICgpID0+IHtcclxuICAgICAgbW9ja0dldC5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtKSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndG9rZW5faGFzaCcpIHJldHVybiAndGVzdC10b2tlbic7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tWZXJpZnlPdHAubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG5ldyBQcm9taXNlKCgpID0+IHt9KSk7IC8vIE5ldmVyIHJlc29sdmVzXHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2xvYWRlci1pY29uJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdDb25maXJtYW5kbyBzZXUgZW1haWwuLi4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ0FndWFyZGUgZW5xdWFudG8gdmFsaWRhbW9zIHNldSBjYWRhc3RybycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDb25maXJtYcOnw6NvIGJlbS1zdWNlZGlkYScsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIG1vc3RyYXIgbWVuc2FnZW0gZGUgc3VjZXNzbyBlIHJlZGlyZWNpb25hciBhcMOzcyBjb25maXJtYXIgZW1haWwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0geyBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nIH07XHJcbiAgICAgIFxyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICd2YWxpZC10b2tlbic7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9jayBBTlRFUyBkZSByZW5kZXJpemFyXHJcbiAgICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcclxuICAgICAgICBkYXRhOiB7IHVzZXI6IG1vY2tVc2VyIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gRGVidWdcclxuICAgICAgY29uc29sZS5sb2coJ01vY2sgY29uZmlndXJhZG86JywgbW9ja1ZlcmlmeU90cC5nZXRNb2NrTmFtZT8uKCkpO1xyXG4gICAgICBjb25zb2xlLmxvZygnTW9jayDDqSBmdW7Dp8Ojbz8nLCB0eXBlb2YgbW9ja1ZlcmlmeU90cCk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIC8vIEFndWFyZGEgcHJvY2Vzc2FtZW50b1xyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBjb25zdCBjaGVja0ljb24gPSBzY3JlZW4ucXVlcnlCeVRlc3RJZCgnY2hlY2staWNvbicpO1xyXG4gICAgICAgIGNvbnN0IHhJY29uID0gc2NyZWVuLnF1ZXJ5QnlUZXN0SWQoJ3gtaWNvbicpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdDaGVjayBpY29uOicsIGNoZWNrSWNvbik7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1ggaWNvbjonLCB4SWNvbik7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ01vY2sgZm9pIGNoYW1hZG8/JywgbW9ja1ZlcmlmeU90cC5tb2NrLmNhbGxzLmxlbmd0aCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnY2hlY2staWNvbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9LCB7IHRpbWVvdXQ6IDMwMDAgfSk7XHJcblxyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnRW1haWwgQ29uZmlybWFkbyEnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL2NvbmZpcm1hZG8gY29tIHN1Y2Vzc28vaSkpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KC9SZWRpcmVjaW9uYW5kbyBwYXJhIG8gbG9naW4vaSkpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcblxyXG4gICAgICAvLyBWZXJpZmljYSBzZSB2ZXJpZnlPdHAgZm9pIGNoYW1hZG8gY29ycmV0YW1lbnRlXHJcbiAgICAgIGV4cGVjdChtb2NrVmVyaWZ5T3RwKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgdG9rZW5faGFzaDogJ3ZhbGlkLXRva2VuJyxcclxuICAgICAgICB0eXBlOiAnZW1haWwnLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEF2YW7Dp2EgbyB0aW1lciBwYXJhIHNpbXVsYXIgbyB0aW1lb3V0XHJcbiAgICAgIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSgyMDAwKTtcclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhIHJlZGlyZWNpb25hbWVudG9cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KG1vY2tOYXZpZ2F0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9sb2dpbicsIHtcclxuICAgICAgICAgIHN0YXRlOiB7XHJcbiAgICAgICAgICAgIGVtYWlsQ29uZmlybWVkOiB0cnVlLFxyXG4gICAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBmdW5jaW9uYXIgbWVzbW8gc2VtIGVtYWlsIGRvIHVzdcOhcmlvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICd2YWxpZC10b2tlbic7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcclxuICAgICAgICBkYXRhOiB7IHVzZXI6IG51bGwgfSxcclxuICAgICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2NoZWNrLWljb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgfSwgeyB0aW1lb3V0OiAzMDAwIH0pO1xyXG5cclxuICAgICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDIwMDApO1xyXG5cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KG1vY2tOYXZpZ2F0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9sb2dpbicsIHtcclxuICAgICAgICAgIHN0YXRlOiB7XHJcbiAgICAgICAgICAgIGVtYWlsQ29uZmlybWVkOiB0cnVlLFxyXG4gICAgICAgICAgICBlbWFpbDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Vycm9zIGRlIHZhbGlkYcOnw6NvJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgbW9zdHJhciBlcnJvIHF1YW5kbyB0b2tlbl9oYXNoIGVzdGl2ZXIgYXVzZW50ZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0dldC5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtKSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsOyAvLyB0b2tlbl9oYXNoIGF1c2VudGVcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3gtaWNvbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdFcnJvIG5hIENvbmZpcm1hw6fDo28nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ0xpbmsgZGUgY29uZmlybWHDp8OjbyBpbnbDoWxpZG8nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KG1vY2tWZXJpZnlPdHApLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBtb3N0cmFyIGVycm8gcXVhbmRvIHR5cGUgbsOjbyBmb3IgXCJlbWFpbFwiJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICd0ZXN0LXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdyZWNvdmVyeSc7IC8vIHRpcG8gZXJyYWRvXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVuZGVyV2l0aFJvdXRlcig8QXV0aENhbGxiYWNrUGFnZSAvPik7XHJcblxyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCd4LWljb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnTGluayBkZSBjb25maXJtYcOnw6NvIGludsOhbGlkbycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICBleHBlY3QobW9ja1ZlcmlmeU90cCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG1vc3RyYXIgZXJybyBxdWFuZG8gdmVyaWZ5T3RwIGZhbGhhcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0dldC5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtKSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndG9rZW5faGFzaCcpIHJldHVybiAnaW52YWxpZC10b2tlbic7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9jayBwYXJhIHJldG9ybmFyIGVycm9cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ1Rva2VuIGludsOhbGlkbycgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3gtaWNvbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KC9Ub2tlbiBpbnbDoWxpZG8vaSkpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBtb3N0cmFyIG1lbnNhZ2VtIGVzcGVjw61maWNhIHBhcmEgZW1haWwgasOhIGNvbmZpcm1hZG8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tHZXQubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbSkgPT4ge1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3Rva2VuX2hhc2gnKSByZXR1cm4gJ2FscmVhZHktdXNlZC10b2tlbic7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdFbWFpbCBhbHJlYWR5IGNvbmZpcm1lZCcgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KC9qw6EgZm9pIGNvbmZpcm1hZG8gYW50ZXJpb3JtZW50ZS9pKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBtb3N0cmFyIG1lbnNhZ2VtIGVzcGVjw61maWNhIHBhcmEgbGluayBleHBpcmFkbycsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0dldC5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtKSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndG9rZW5faGFzaCcpIHJldHVybiAnZXhwaXJlZC10b2tlbic7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndHlwZScpIHJldHVybiAnZW1haWwnO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdUb2tlbiBleHBpcmVkJyB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL2xpbmsgZGUgY29uZmlybWHDp8OjbyBleHBpcm91L2kpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnSW50ZXJhw6fDtWVzIGRvIHVzdcOhcmlvIG5vIGVzdGFkbyBkZSBlcnJvJywgKCkgPT4ge1xyXG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tHZXQubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbSkgPT4ge1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3Rva2VuX2hhc2gnKSByZXR1cm4gJ2Vycm9yLXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnRXJybyBnZW7DqXJpY28nIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmVuZGVyV2l0aFJvdXRlcig8QXV0aENhbGxiYWNrUGFnZSAvPik7XHJcblxyXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCd4LWljb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBuYXZlZ2FyIHBhcmEgbG9naW4gYW8gY2xpY2FyIGVtIFwiSXIgcGFyYSBMb2dpblwiJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKHsgZGVsYXk6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IGxvZ2luQnV0dG9uID0gc2NyZWVuLmdldEJ5VGV4dCgnSXIgcGFyYSBMb2dpbicpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlci5jbGljayhsb2dpbkJ1dHRvbik7XHJcblxyXG4gICAgICBleHBlY3QobW9ja05hdmlnYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL2xvZ2luJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBuYXZlZ2FyIHBhcmEgcmVnaXN0cm8gYW8gY2xpY2FyIGVtIFwiVGVudGFyIE5vdmFtZW50ZVwiJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKHsgZGVsYXk6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IHJldHJ5QnV0dG9uID0gc2NyZWVuLmdldEJ5VGV4dCgnVGVudGFyIE5vdmFtZW50ZScpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlci5jbGljayhyZXRyeUJ1dHRvbik7XHJcblxyXG4gICAgICBleHBlY3QobW9ja05hdmlnYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3BhcnRuZXIvcmVnaXN0ZXInKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnTWV0YWRhZG9zIGUgU0VPJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgcmVuZGVyaXphciBvIEhlbG1ldCBjb20gdMOtdHVsbyBjb3JyZXRvJywgKCkgPT4ge1xyXG4gICAgICBtb2NrR2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGFyYW0pID0+IHtcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0b2tlbl9oYXNoJykgcmV0dXJuICd0ZXN0LXRva2VuJztcclxuICAgICAgICBpZiAocGFyYW0gPT09ICd0eXBlJykgcmV0dXJuICdlbWFpbCc7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja1ZlcmlmeU90cC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbmV3IFByb21pc2UoKCkgPT4ge30pKTtcclxuXHJcbiAgICAgIHJlbmRlcldpdGhSb3V0ZXIoPEF1dGhDYWxsYmFja1BhZ2UgLz4pO1xyXG5cclxuICAgICAgY29uc3QgaGVsbWV0ID0gc2NyZWVuLmdldEJ5VGVzdElkKCdoZWxtZXQnKTtcclxuICAgICAgZXhwZWN0KGhlbG1ldCkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ0NvbmZpcm1hw6fDo28gZGUgRW1haWwgLSBNZXNhIFByYSAyJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NvbnNvbGUgZXJyb3JzJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgbG9nYXIgZXJybyBubyBjb25zb2xlIHF1YW5kbyB2ZXJpZmljYcOnw6NvIGZhbGhhcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY29uc29sZUVycm9yU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0dldC5tb2NrSW1wbGVtZW50YXRpb24oKHBhcmFtKSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtID09PSAndG9rZW5faGFzaCcpIHJldHVybiAnZXJyb3ItdG9rZW4nO1xyXG4gICAgICAgIGlmIChwYXJhbSA9PT0gJ3R5cGUnKSByZXR1cm4gJ2VtYWlsJztcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBlcnJvck9iaiA9IHsgbWVzc2FnZTogJ1Rlc3QgZXJyb3InIH07XHJcbiAgICAgIG1vY2tWZXJpZnlPdHAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIGVycm9yOiBlcnJvck9iaixcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZW5kZXJXaXRoUm91dGVyKDxBdXRoQ2FsbGJhY2tQYWdlIC8+KTtcclxuXHJcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3gtaWNvbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIGNvbnNvbGUuZXJyb3IgZm9pIGNoYW1hZG8gY29tIG8gZXJyb1xyXG4gICAgICBleHBlY3QoY29uc29sZUVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgIGV4cGVjdChjb25zb2xlRXJyb3JTcHkubW9jay5jYWxsc1swXVswXSkudG9CZSgnRXJybyBuYSBjb25maXJtYcOnw6NvOicpO1xyXG5cclxuICAgICAgY29uc29sZUVycm9yU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9