{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\ParticipationService.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\ParticipationService.ts"],"sourcesContent":["// src/services/ParticipationService.ts\r\n// ‚úÖ VERS√ÉO CONSOLIDADA (alinhada ao NotificationService, WaitingListService e EventSecurityService)\r\n\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport NotificationService from '@/services/NotificationService';\r\nimport WaitingListService from '@/services/WaitingListService';\r\nimport EventSecurityService from './EventSecurityService';\r\n\r\nconst toNumber = (value: string | number): number =>\r\n  typeof value === 'string' ? Number(value) : value;\r\n\r\ntype EventStatus =\r\n  | 'Aberto'\r\n  | 'Confirmado'\r\n  | 'Em Andamento'\r\n  | 'Finalizado'\r\n  | 'Conclu√≠do'\r\n  | 'Cancelado';\r\n\r\ntype ParticipationStatus =\r\n  | 'pendente'\r\n  | 'aprovado'\r\n  | 'rejeitado'\r\n  | 'cancelado';\r\n\r\ntype EventType =\r\n  | 'institucional'\r\n  | 'privado'\r\n  | 'publico'\r\n  | 'padrao'\r\n  | 'particular'\r\n  | 'crusher';\r\n\r\ninterface Event {\r\n  id: number | string;\r\n  status: EventStatus;\r\n  start_time: string;\r\n  end_time: string;\r\n  vagas?: number | null;\r\n  event_type: EventType;\r\n  creator_id: string;\r\n  title: string;\r\n  event_entry_password?: string | null;\r\n  entry_locked?: boolean | null;\r\n  crusher_invited_user_id?: string | null;\r\n  [key: string]: any;\r\n}\r\n\r\n// ‚úÖ CORRE√á√ÉO: Interface 'Participation' removida pois n√£o estava sendo usada (TS6196)\r\n\r\ninterface ServiceResult<T = any> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: string;\r\n  message?: string;\r\n  [key: string]: any;\r\n}\r\n\r\n\r\nclass ParticipationService {\r\n  /**\r\n   * üß™ verifica se o evento est√° muito perto do hor√°rio\r\n   */\r\n  private static isEventTooClose(event: Event): boolean {\r\n    if (!event.start_time) return false;\r\n    const start = new Date(event.start_time).getTime();\r\n    const now = Date.now();\r\n    const diffMs = start - now;\r\n    // 1 minuto\r\n    return diffMs <= 60_000;\r\n  }\r\n\r\n  /**\r\n   * üîé Verifica se o usu√°rio j√° participa do evento\r\n   */\r\n  static async userAlreadyInEvent(\r\n    eventId: string | number,\r\n    userId: string,\r\n  ): Promise<{ exists: boolean; participation?: any }> {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('event_participants')\r\n        .select('id, status, mensagem_candidatura, created_at')\r\n        .eq('event_id', eventId)\r\n        .eq('user_id', userId)\r\n        .maybeSingle();\r\n\r\n      if (error) {\r\n        console.error('‚ùå Erro ao verificar se usu√°rio j√° participa do evento:', error);\r\n        return { exists: false };\r\n      }\r\n\r\n      if (data) {\r\n        console.log(`‚ÑπÔ∏è Usu√°rio ${userId} j√° est√° inscrito no evento ${eventId} com status: ${data.status}`);\r\n      }\r\n\r\n      return { exists: !!data, participation: data };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro inesperado ao verificar participa√ß√£o:', error);\r\n      return { exists: false };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üß† Valida se o usu√°rio pode se inscrever num evento\r\n   */\r\n  static async validateApplication(\r\n    event: Event,\r\n    userId: string,\r\n  ): Promise<{ valid: boolean; error?: string }> {\r\n    try {\r\n      const { data: userEvents, error: userEventsError } = await supabase\r\n        .from('event_participants')\r\n        .select(\r\n          `\r\n          id,\r\n          status,\r\n          events:events!inner (\r\n            id,\r\n            start_time,\r\n            end_time,\r\n            status\r\n          )\r\n        `,\r\n        )\r\n        .eq('user_id', userId)\r\n        .eq('status', 'aprovado');\r\n\r\n      if (userEventsError) {\r\n        console.error(\r\n          '‚ùå Erro ao buscar eventos do usu√°rio para validar inscri√ß√£o:',\r\n          userEventsError,\r\n        );\r\n        return { valid: false, error: 'Erro ao validar inscri√ß√£o.' };\r\n      }\r\n\r\n      if (!userEvents || userEvents.length === 0) {\r\n        return { valid: true };\r\n      }\r\n\r\n      const eventStart = new Date(event.start_time);\r\n      const eventEnd = new Date(event.end_time);\r\n\r\n      for (const participation of userEvents as any[]) {\r\n        const existingEvent = participation.events;\r\n        if (\r\n          existingEvent.status === 'Cancelado' ||\r\n          existingEvent.status === 'Conclu√≠do'\r\n        ) {\r\n          continue;\r\n        }\r\n\r\n        const existingStart = new Date(existingEvent.start_time);\r\n        const existingEnd = new Date(existingEvent.end_time);\r\n\r\n        const hasOverlap =\r\n          eventStart < existingEnd && eventEnd > existingStart;\r\n\r\n        if (hasOverlap) {\r\n          return {\r\n            valid: false,\r\n            error: 'Voc√™ j√° tem um evento neste hor√°rio.',\r\n          };\r\n        }\r\n      }\r\n\r\n      return { valid: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro inesperado na valida√ß√£o de inscri√ß√£o:', error);\r\n      return { valid: false, error: 'Erro ao validar inscri√ß√£o.' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üì® Candidatar-se a um evento\r\n   */\r\n  static async applyToEvent(\r\n    eventId: string | number,\r\n    userId: string,\r\n    message?: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      console.log(`üìã Iniciando inscri√ß√£o: usu√°rio ${userId} ‚Üí evento ${eventId}`);\r\n\r\n      // ‚úÖ CORRE√á√ÉO: Verificar se usu√°rio j√° est√° inscrito\r\n      const { exists, participation: existingParticipation } = await this.userAlreadyInEvent(eventId, userId);\r\n      \r\n      if (exists && existingParticipation) {\r\n        const statusMessages: Record<string, string> = {\r\n          'pendente': 'Sua candidatura j√° foi enviada e est√° aguardando aprova√ß√£o.',\r\n          'aprovado': 'Voc√™ j√° est√° inscrito e aprovado neste evento.',\r\n          'rejeitado': 'Sua candidatura anterior foi rejeitada.',\r\n          'cancelado': 'Voc√™ cancelou sua participa√ß√£o anterior neste evento.',\r\n        };\r\n\r\n        const msg = statusMessages[existingParticipation.status] || `Voc√™ j√° est√° inscrito neste evento (status: ${existingParticipation.status}).`;\r\n        console.warn(`‚ö†Ô∏è Tentativa de inscri√ß√£o duplicada: ${msg}`);\r\n        \r\n        return {\r\n          success: false,\r\n          error: msg,\r\n          isDuplicate: true,\r\n          existingParticipation: existingParticipation,\r\n        };\r\n      }\r\n\r\n      // 1. busca o evento\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('*')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError || !event) {\r\n        throw eventError ?? new Error('Evento n√£o encontrado');\r\n      }\r\n\r\n      const eventData = event as unknown as Event;\r\n\r\n      // 2. valida conflitos\r\n      const validations = await this.validateApplication(eventData, userId);\r\n      if (!validations.valid) {\r\n        return { success: false, error: validations.error };\r\n      }\r\n\r\n      // 3. decide status inicial\r\n      const isDirectEnrollment = eventData.event_type === 'institucional';\r\n      const initialStatus: ParticipationStatus = isDirectEnrollment\r\n        ? 'aprovado'\r\n        : 'pendente';\r\n\r\n      // 4. checa vagas\r\n      if (\r\n        typeof eventData.vagas === 'number' &&\r\n        eventData.vagas !== null &&\r\n        eventData.vagas !== undefined\r\n      ) {\r\n        if (eventData.vagas <= 0) {\r\n          // sem vagas ‚Üí lista de espera\r\n          // ‚úÖ ajustado: espera string\r\n          await WaitingListService.addToWaitingList(String(eventId), userId);\r\n          return {\r\n            success: true,\r\n            message: 'Sem vagas. Voc√™ foi colocado na lista de espera.',\r\n          };\r\n        }\r\n      }\r\n\r\n      // 5. ‚úÖ UPSERT - insere ou atualiza se j√° existir (previne duplica√ß√£o)\r\n      const { data: newParticipation, error: participationError } = await supabase\r\n        .from('event_participants')\r\n        .upsert(\r\n          {\r\n            event_id: eventId,\r\n            user_id: userId,\r\n            status: initialStatus,\r\n            mensagem_candidatura: message ?? null,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          },\r\n          {\r\n            onConflict: 'event_id,user_id',\r\n            ignoreDuplicates: false,\r\n          }\r\n        )\r\n        .select()\r\n        .single();\r\n\r\n      if (participationError) {\r\n        console.error('‚ùå Erro ao inserir/atualizar participa√ß√£o:', participationError);\r\n        throw participationError;\r\n      }\r\n\r\n      // 6. se entrou aprovado ‚Üí decrementa vaga\r\n      if (initialStatus === 'aprovado') {\r\n        await this.decrementEventVacancy(eventId);\r\n      }\r\n\r\n      // 7. notifica dono do evento\r\n      await NotificationService.createForUser({\r\n        target_user_id: eventData.creator_id,\r\n        target_event_id: toNumber(eventId),\r\n        notification_type: 'event_application',\r\n        title: 'üì© Nova participa√ß√£o',\r\n        message: `Novo pedido de participa√ß√£o no evento \"${eventData.title}\"`,\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        data: newParticipation,\r\n        message:\r\n          initialStatus === 'aprovado'\r\n            ? 'Entrada confirmada no evento.'\r\n            : 'Solicita√ß√£o enviada ao anfitri√£o.',\r\n      };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao se candidatar ao evento:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚¨áÔ∏è Decrementa vaga de um evento aprovado\r\n   */\r\n  static async decrementEventVacancy(\r\n    eventId: string | number,\r\n  ): Promise<void> {\r\n    try {\r\n      const { data: event, error: fetchError } = await supabase\r\n        .from('events')\r\n        .select('vagas')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (fetchError || !event) {\r\n        console.error(\r\n          '‚ùå Erro ao buscar evento para decrementar vaga:',\r\n          fetchError,\r\n        );\r\n        return;\r\n      }\r\n\r\n      const eventData = event as unknown as Event;\r\n\r\n      if (\r\n        typeof eventData.vagas === 'number' &&\r\n        eventData.vagas !== null &&\r\n        eventData.vagas !== undefined\r\n      ) {\r\n        const { error: updateError } = await supabase\r\n          .from('events')\r\n          .update({\r\n            vagas: eventData.vagas > 0 ? eventData.vagas - 1 : 0,\r\n            updated_at: new Date().toISOString(),\r\n          })\r\n          .eq('id', eventId);\r\n\r\n        if (updateError) {\r\n          console.error('‚ùå Erro ao decrementar vaga:', updateError);\r\n        } else {\r\n          console.log(\r\n            `‚úÖ Vaga decrementada. Vagas restantes: ${\r\n              eventData.vagas > 0 ? eventData.vagas - 1 : 0\r\n            }`,\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\r\n        '‚ùå Erro inesperado ao decrementar vaga do evento:',\r\n        error,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚úÖ Aprovar participa√ß√£o (anfitri√£o)\r\n   */\r\n  static async approveParticipation(\r\n    participationId: string,\r\n    eventId: string | number,\r\n    _hostId?: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      console.log('üîî [approveParticipation] Iniciando aprova√ß√£o:', {\r\n        participationId,\r\n        eventId,\r\n      });\r\n\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('vagas, title, start_time')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) {\r\n        console.error('‚ùå Erro ao buscar evento:', eventError);\r\n        throw eventError;\r\n      }\r\n\r\n      const eventData = event as unknown as Event;\r\n\r\n      // se estiver a menos de 1 minuto, bloqueia\r\n      if (this.isEventTooClose(eventData)) {\r\n        return {\r\n          success: false,\r\n          error: 'N√£o √© poss√≠vel aprovar participa√ß√µes t√£o perto do evento.',\r\n        };\r\n      }\r\n\r\n      // busca participa√ß√£o pra pegar o user\r\n      const { data: participation, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('user_id')\r\n        .eq('id', participationId)\r\n        .single();\r\n\r\n      if (partError) {\r\n        console.error('‚ùå Erro ao buscar participa√ß√£o:', partError);\r\n        throw partError;\r\n      }\r\n\r\n      // atualiza participa√ß√£o\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          status: 'aprovado',\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', participationId);\r\n\r\n      if (updateError) {\r\n        console.error('‚ùå Erro ao atualizar participa√ß√£o:', updateError);\r\n        throw updateError;\r\n      }\r\n\r\n      // decrementa vaga\r\n      await this.decrementEventVacancy(eventId);\r\n\r\n      // notifica usu√°rio aprovado\r\n      await NotificationService.createForUser({\r\n        target_user_id: (participation as any).user_id,\r\n        target_event_id: toNumber(eventId),\r\n        notification_type: 'candidate_approved',\r\n        title: '‚úÖ Participa√ß√£o Aprovada',\r\n        message: `Sua participa√ß√£o em \"${eventData.title}\" foi aprovada!`,\r\n      });\r\n\r\n      return { success: true, message: 'Participa√ß√£o aprovada!' };\r\n    } catch (error: any) {\r\n      console.error('‚ùå [approveParticipation] Erro:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚ùå Rejeitar participa√ß√£o (anfitri√£o)\r\n   */\r\n  static async rejectParticipation(\r\n    participationId: string,\r\n    eventId: string | number,\r\n    reason = '',\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data: participation, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('user_id')\r\n        .eq('id', participationId)\r\n        .single();\r\n\r\n      if (partError) {\r\n        throw partError;\r\n      }\r\n\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('start_time, title, creator_id, event_type')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) {\r\n        throw eventError;\r\n      }\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          status: 'rejeitado',\r\n          motivo_rejeicao: reason,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', participationId);\r\n\r\n      if (updateError) {\r\n        throw updateError;\r\n      }\r\n\r\n      await NotificationService.createForUser({\r\n        target_user_id: (participation as any).user_id,\r\n        target_event_id: toNumber(eventId),\r\n        notification_type: 'participation_rejected',\r\n        title: '‚ùå Participa√ß√£o Rejeitada',\r\n        message: `Sua candidatura para \"${(event as any).title}\" foi rejeitada.${\r\n          reason ? ` Motivo: ${reason}` : ''\r\n        }`,\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        message: 'Participa√ß√£o rejeitada',\r\n      };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao rejeitar participa√ß√£o:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üõë Cancelar participa√ß√£o (usu√°rio saindo do evento)\r\n   */\r\n  static async cancelParticipation(\r\n    participationId: string,\r\n    eventId: string | number,\r\n    userId: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('start_time, title, creator_id, event_type')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) {\r\n        throw eventError;\r\n      }\r\n\r\n      const { data: participation, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('status')\r\n        .eq('id', participationId)\r\n        .eq('user_id', userId)\r\n        .single();\r\n\r\n      if (partError) {\r\n        throw partError;\r\n      }\r\n\r\n      if ((participation as any).status !== 'aprovado') {\r\n        return {\r\n          success: false,\r\n          error: 'Apenas participa√ß√µes aprovadas podem ser canceladas',\r\n        };\r\n      }\r\n\r\n      const startTime = new Date((event as any).start_time);\r\n      const now = new Date();\r\n      const hoursUntilEvent =\r\n        (startTime.getTime() - now.getTime()) / (1000 * 60 * 60);\r\n\r\n      const isLateCancellation = hoursUntilEvent < 2;\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          status: 'cancelado',\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', participationId);\r\n\r\n      if (updateError) {\r\n        throw updateError;\r\n      }\r\n\r\n      // devolve vaga\r\n      await this.incrementEventVacancy(eventId);\r\n\r\n      // notifica dono\r\n      await NotificationService.createForUser({\r\n        target_user_id: (event as any).creator_id,\r\n        target_event_id: toNumber(eventId),\r\n        notification_type: 'participation_cancelled',\r\n        title: '‚ùå Participante desistiu',\r\n        message: `Um participante cancelou sua presen√ßa em \"${(event as any).title}\"`,\r\n      });\r\n\r\n      // ‚úÖ ajustado: tua WaitingListService espera string\r\n      await WaitingListService.processWaitingList(String(eventId));\r\n\r\n      return {\r\n        success: true,\r\n        message: isLateCancellation\r\n          ? 'Participa√ß√£o cancelada, mas foi em cima da hora.'\r\n          : 'Participa√ß√£o cancelada.',\r\n      };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao cancelar participa√ß√£o:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚¨ÜÔ∏è Incrementa vaga quando algu√©m sai\r\n   */\r\n  static async incrementEventVacancy(\r\n    eventId: string | number,\r\n  ): Promise<void> {\r\n    try {\r\n      const { data: event, error: fetchError } = await supabase\r\n        .from('events')\r\n        .select('vagas')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (fetchError || !event) {\r\n        console.error(\r\n          '‚ùå Erro ao buscar evento para incrementar vaga:',\r\n          fetchError,\r\n        );\r\n        return;\r\n      }\r\n\r\n      const eventData = event as unknown as Event;\r\n\r\n      if (\r\n        typeof eventData.vagas === 'number' &&\r\n        eventData.vagas !== null &&\r\n        eventData.vagas !== undefined\r\n      ) {\r\n        const { error: updateError } = await supabase\r\n          .from('events')\r\n          .update({\r\n            vagas: eventData.vagas + 1,\r\n            updated_at: new Date().toISOString(),\r\n          })\r\n          .eq('id', eventId);\r\n\r\n        if (updateError) {\r\n          console.error('‚ùå Erro ao incrementar vaga:', updateError);\r\n        } else {\r\n          console.log(\r\n            `‚úÖ Vaga incrementada. Vagas dispon√≠veis: ${\r\n              eventData.vagas + 1\r\n            }`,\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\r\n        '‚ùå Erro inesperado ao incrementar vaga do evento:',\r\n        error,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üéØ Aceitar convite ‚ÄúCrusher‚Äù\r\n   */\r\n  static async acceptCrusherInvite(\r\n    participationId: string,\r\n    eventId: string | number,\r\n    userId: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('event_type, title, crusher_invited_user_id, creator_id')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) {\r\n        throw eventError;\r\n      }\r\n\r\n      if (event.event_type !== 'crusher') {\r\n        return {\r\n          success: false,\r\n          error: 'Este n√£o √© um evento Crusher',\r\n        };\r\n      }\r\n\r\n      if (event.crusher_invited_user_id !== userId) {\r\n        return {\r\n          success: false,\r\n          error: 'Voc√™ n√£o foi convidado para este evento',\r\n        };\r\n      }\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          status: 'aprovado',\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', participationId)\r\n        .eq('user_id', userId);\r\n\r\n      if (updateError) {\r\n        throw updateError;\r\n      }\r\n\r\n      await NotificationService.createForUser({\r\n        target_user_id: event.creator_id,\r\n        target_event_id: toNumber(eventId),\r\n        notification_type: 'crusher_accepted',\r\n        title: 'üíú Convite Crusher Aceito!',\r\n        message: `Seu convite para \"${event.title}\" foi aceito!`,\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        message: 'Convite aceito!',\r\n      };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao aceitar convite Crusher:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üéØ Rejeitar convite ‚ÄúCrusher‚Äù\r\n   */\r\n  static async rejectCrusherInvite(\r\n    participationId: string,\r\n    eventId: string | number,\r\n    userId: string,\r\n    reason = '',\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('event_type, title, crusher_invited_user_id, creator_id')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) {\r\n        throw eventError;\r\n      }\r\n\r\n      if (event.event_type !== 'crusher') {\r\n        return {\r\n          success: false,\r\n          error: 'Este n√£o √© um evento Crusher',\r\n        };\r\n      }\r\n\r\n      if (event.crusher_invited_user_id !== userId) {\r\n        return {\r\n          success: false,\r\n          error: 'Voc√™ n√£o foi convidado para este evento',\r\n        };\r\n      }\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          status: 'rejeitado',\r\n          rejeicao_motivo: reason || null,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', participationId)\r\n        .eq('user_id', userId);\r\n\r\n      if (updateError) {\r\n        throw updateError;\r\n      }\r\n\r\n      await NotificationService.createForUser({\r\n        target_user_id: event.creator_id,\r\n        target_event_id: toNumber(eventId),\r\n        notification_type: 'participation_rejected',\r\n        title: 'üíî Convite Crusher Recusado',\r\n        message: `Seu convite para \"${event.title}\" foi recusado.${\r\n          reason ? ` Motivo: ${reason}` : ''\r\n        }`,\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        message: 'Convite recusado',\r\n      };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao rejeitar convite Crusher:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üëÄ Verifica se um usu√°rio √© o convidado do evento Crusher\r\n   */\r\n  static async isUserCrusherInvitee(\r\n    eventId: string | number,\r\n    userId: string,\r\n  ): Promise<boolean> {\r\n    try {\r\n      const { data: participation, error } = await supabase\r\n        .from('event_participants')\r\n        .select('event_id')\r\n        .eq('event_id', eventId)\r\n        .single();\r\n\r\n      if (error || !participation) {\r\n        return false;\r\n      }\r\n\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('event_type, crusher_invited_user_id')\r\n        .eq('id', participation.event_id)\r\n        .single();\r\n\r\n      if (eventError) {\r\n        return false;\r\n      }\r\n\r\n      return (\r\n        event.event_type === 'crusher' &&\r\n        event.crusher_invited_user_id === userId\r\n      );\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao verificar convite Crusher:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üì• Lista TODAS as participa√ß√µes de um evento (para anfitri√£o)\r\n   * ‚ö†Ô∏è AQUI estava dando 406 porque usava id=eq.<evento>\r\n   */\r\n  static async getEventParticipations(\r\n    eventId: string | number,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data: participations, error } = await supabase\r\n        .from('event_participants')\r\n        .select(\r\n          `\r\n          id,\r\n          event_id,\r\n          user_id,\r\n          status,\r\n          presenca_confirmada,\r\n          com_acesso,\r\n          mensagem_candidatura,\r\n          created_at,\r\n          user:profiles!event_participants_user_id_fkey (\r\n            id,\r\n            username,\r\n            avatar_url,\r\n            reputation_stars\r\n          )\r\n        `,\r\n        )\r\n        .eq('event_id', eventId)\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      return { success: true, data: participations };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao buscar participa√ß√µes:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üë§ Participa√ß√µes de um usu√°rio em todos os eventos\r\n   */\r\n  static async getUserParticipations(\r\n    userId: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('event_participants')\r\n        .select(\r\n          `\r\n          id,\r\n          event_id,\r\n          status,\r\n          presenca_confirmada,\r\n          avaliacao_feita,\r\n          com_acesso,\r\n          events:events!inner (\r\n            id,\r\n            title,\r\n            start_time,\r\n            end_time,\r\n            status,\r\n            event_type\r\n          )\r\n        `,\r\n        )\r\n        .eq('user_id', userId)\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      return { success: true, data };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao buscar participa√ß√µes do usu√°rio:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üìå Ver detalhes de uma participa√ß√£o espec√≠fica\r\n   */\r\n  static async getParticipationById(\r\n    participationId: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('event_participants')\r\n        .select(\r\n          `\r\n          id,\r\n          event_id,\r\n          user_id,\r\n          status,\r\n          presenca_confirmada,\r\n          com_acesso,\r\n          avaliacao_feita,\r\n          events:events!inner (\r\n            id,\r\n            title,\r\n            start_time,\r\n            end_time,\r\n            status\r\n          ),\r\n          user:profiles!event_participants_user_id_fkey (\r\n            id,\r\n            username,\r\n            avatar_url\r\n          )\r\n        `,\r\n        )\r\n        .eq('id', participationId)\r\n        .single();\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      return { success: true, data };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao buscar participa√ß√£o:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚úÖ Confirma presen√ßa\r\n   */\r\n  static async confirmPresence(\r\n    participationId: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          presenca_confirmada: true,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', participationId);\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao confirmar presen√ßa:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üö™ Libera acesso do participante dentro do evento\r\n   */\r\n  static async grantAccess(\r\n    participationId: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          com_acesso: true,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', participationId);\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao liberar acesso:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîê Valida senha de entrada do evento\r\n   */\r\n  static async validateEventEntryPassword(\r\n    eventId: string | number,\r\n    participantId: string,\r\n    password: string,\r\n  ): Promise<{\r\n    success: boolean;\r\n    canEnter: boolean;\r\n    message: string;\r\n    error?: string;\r\n  }> {\r\n    try {\r\n      console.log(\r\n        `üîç Validando entrada: participante ${participantId} no evento ${eventId}`,\r\n      );\r\n\r\n      // 1Ô∏è‚É£ Verificar se participante est√° aprovado\r\n      const { data: participation, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('id, status, com_acesso, presenca_confirmada')\r\n        .eq('event_id', eventId)\r\n        .eq('user_id', participantId)\r\n        .single();\r\n\r\n      if (partError || !participation) {\r\n        return {\r\n          success: false,\r\n          canEnter: false,\r\n          message: 'Voc√™ n√£o est√° inscrito neste evento',\r\n        };\r\n      }\r\n\r\n      if (participation.status !== 'aprovado') {\r\n        return {\r\n          success: false,\r\n          canEnter: false,\r\n          message: `Sua inscri√ß√£o est√° com status: ${participation.status}`,\r\n        };\r\n      }\r\n\r\n      // 2Ô∏è‚É£ Validar a senha usando o servi√ßo j√° existente\r\n      const securityResult = await EventSecurityService.validateEntryPassword({\r\n        eventId: toNumber(eventId), // ‚úÖ ajustado: o service espera number\r\n        participantId,\r\n        password,\r\n      });\r\n\r\n      if (!securityResult.success) {\r\n        return {\r\n          success: false,\r\n          canEnter: false,\r\n          message: securityResult.message || 'Senha inv√°lida.',\r\n        };\r\n      }\r\n\r\n      // 3Ô∏è‚É£ Senha correta ‚Üí marcar presen√ßa\r\n      const { error: presencaError } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          presenca_confirmada: true,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('event_id', eventId)\r\n        .eq('user_id', participantId);\r\n\r\n      if (presencaError) {\r\n        throw presencaError;\r\n      }\r\n\r\n      console.log(\r\n        `‚úÖ Participante ${participantId} agora tem acesso ao evento ${eventId}`,\r\n      );\r\n\r\n      return {\r\n        success: true,\r\n        canEnter: true,\r\n        message:\r\n          securityResult.message || '‚úÖ Acesso liberado! Bem-vindo ao evento.',\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao validar entrada:', error);\r\n      return {\r\n        success: false,\r\n        canEnter: false,\r\n        message: 'Erro ao processar sua entrada',\r\n        error: error instanceof Error ? error.message : String(error),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üìä Estat√≠sticas de entrada\r\n   */\r\n  static async getEventEntryStats(\r\n    eventId: string | number,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const { data: participants, error } = await supabase\r\n        .from('event_participants')\r\n        .select('id, com_acesso')\r\n        .eq('event_id', eventId);\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      const total = participants.length;\r\n      const withAccess = participants.filter(p => p.com_acesso).length;\r\n      const withoutAccess = total - withAccess;\r\n      const percentage = total > 0 ? (withAccess / total) * 100 : 0;\r\n\r\n      return {\r\n        success: true,\r\n        data: {\r\n          totalParticipants: total,\r\n          participantsWithAccess: withAccess,\r\n          participantsWithoutAccess: withoutAccess,\r\n          accessPercentage: percentage,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao obter stats de entrada:', error);\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîí verifica se o usu√°rio pode criar mais eventos (regra extra sua)\r\n   */\r\n  static async canUserCreateEvent(\r\n    userId: string,\r\n  ): Promise<ServiceResult> {\r\n    try {\r\n      const today = new Date().toISOString().split('T')[0];\r\n\r\n      // eventos hoje\r\n      const { data: todayEvents, error: todayError } = await supabase\r\n        .from('events')\r\n        .select('id')\r\n        .eq('creator_id', userId)\r\n        .gte('start_time', `${today}T00:00:00`)\r\n        .lte('start_time', `${today}T23:59:59`);\r\n\r\n      if (todayError) {\r\n        throw todayError;\r\n      }\r\n\r\n      if (todayEvents && todayEvents.length > 0) {\r\n        return {\r\n          success: false,\r\n          error: 'Voc√™ j√° tem um evento hoje.',\r\n        };\r\n      }\r\n\r\n      // eventos n√£o conclu√≠dos\r\n      const { data: unfinished, error: unfinishedError } = await supabase\r\n        .from('events')\r\n        .select('id, title')\r\n        .eq('creator_id', userId)\r\n        .in('status', [\r\n          'Aberto',\r\n          'Confirmado',\r\n          'Em Andamento',\r\n          'Finalizado',\r\n        ]);\r\n\r\n      if (unfinishedError) {\r\n        throw unfinishedError;\r\n      }\r\n\r\n      if (unfinished && unfinished.length > 0) {\r\n        return {\r\n          success: false,\r\n          error:\r\n            'Voc√™ tem eventos em aberto. Conclua ou cancele antes de criar outro.',\r\n        };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      console.error(\r\n        '‚ùå Erro ao verificar se usu√°rio pode criar evento:',\r\n        error,\r\n      );\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n}\r\n\r\nexport default ParticipationService;\r\n\r\n"],"version":3}