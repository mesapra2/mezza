2d6317928b8057ccc7153ccc201c8229
"use strict";
// src/services/ParticipationService.ts
// ‚úÖ VERS√ÉO CONSOLIDADA (alinhada ao NotificationService, WaitingListService e EventSecurityService)
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const supabaseClient_1 = require("@/lib/supabaseClient");
const NotificationService_1 = tslib_1.__importDefault(require("@/services/NotificationService"));
const WaitingListService_1 = tslib_1.__importDefault(require("@/services/WaitingListService"));
const EventSecurityService_1 = tslib_1.__importDefault(require("./EventSecurityService"));
const toNumber = (value) => typeof value === 'string' ? Number(value) : value;
class ParticipationService {
    /**
     * üß™ verifica se o evento est√° muito perto do hor√°rio
     */
    static isEventTooClose(event) {
        if (!event.start_time)
            return false;
        const start = new Date(event.start_time).getTime();
        const now = Date.now();
        const diffMs = start - now;
        // 1 minuto
        return diffMs <= 60000;
    }
    /**
     * üîé Verifica se o usu√°rio j√° participa do evento
     */
    static async userAlreadyInEvent(eventId, userId) {
        try {
            const { data, error } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('id, status, mensagem_candidatura, created_at')
                .eq('event_id', eventId)
                .eq('user_id', userId)
                .maybeSingle();
            if (error) {
                console.error('‚ùå Erro ao verificar se usu√°rio j√° participa do evento:', error);
                return { exists: false };
            }
            if (data) {
                console.log(`‚ÑπÔ∏è Usu√°rio ${userId} j√° est√° inscrito no evento ${eventId} com status: ${data.status}`);
            }
            return { exists: !!data, participation: data };
        }
        catch (error) {
            console.error('‚ùå Erro inesperado ao verificar participa√ß√£o:', error);
            return { exists: false };
        }
    }
    /**
     * üß† Valida se o usu√°rio pode se inscrever num evento
     */
    static async validateApplication(event, userId) {
        try {
            const { data: userEvents, error: userEventsError } = await supabaseClient_1.supabase
                .from('event_participants')
                .select(`
          id,
          status,
          events:events!inner (
            id,
            start_time,
            end_time,
            status
          )
        `)
                .eq('user_id', userId)
                .eq('status', 'aprovado');
            if (userEventsError) {
                console.error('‚ùå Erro ao buscar eventos do usu√°rio para validar inscri√ß√£o:', userEventsError);
                return { valid: false, error: 'Erro ao validar inscri√ß√£o.' };
            }
            if (!userEvents || userEvents.length === 0) {
                return { valid: true };
            }
            const eventStart = new Date(event.start_time);
            const eventEnd = new Date(event.end_time);
            for (const participation of userEvents) {
                const existingEvent = participation.events;
                if (existingEvent.status === 'Cancelado' ||
                    existingEvent.status === 'Conclu√≠do') {
                    continue;
                }
                const existingStart = new Date(existingEvent.start_time);
                const existingEnd = new Date(existingEvent.end_time);
                const hasOverlap = eventStart < existingEnd && eventEnd > existingStart;
                if (hasOverlap) {
                    return {
                        valid: false,
                        error: 'Voc√™ j√° tem um evento neste hor√°rio.',
                    };
                }
            }
            return { valid: true };
        }
        catch (error) {
            console.error('‚ùå Erro inesperado na valida√ß√£o de inscri√ß√£o:', error);
            return { valid: false, error: 'Erro ao validar inscri√ß√£o.' };
        }
    }
    /**
     * üì® Candidatar-se a um evento
     */
    static async applyToEvent(eventId, userId, message) {
        try {
            console.log(`üìã Iniciando inscri√ß√£o: usu√°rio ${userId} ‚Üí evento ${eventId}`);
            // ‚úÖ CORRE√á√ÉO: Verificar se usu√°rio j√° est√° inscrito
            const { exists, participation: existingParticipation } = await this.userAlreadyInEvent(eventId, userId);
            if (exists && existingParticipation) {
                const statusMessages = {
                    'pendente': 'Sua candidatura j√° foi enviada e est√° aguardando aprova√ß√£o.',
                    'aprovado': 'Voc√™ j√° est√° inscrito e aprovado neste evento.',
                    'rejeitado': 'Sua candidatura anterior foi rejeitada.',
                    'cancelado': 'Voc√™ cancelou sua participa√ß√£o anterior neste evento.',
                };
                const msg = statusMessages[existingParticipation.status] || `Voc√™ j√° est√° inscrito neste evento (status: ${existingParticipation.status}).`;
                console.warn(`‚ö†Ô∏è Tentativa de inscri√ß√£o duplicada: ${msg}`);
                return {
                    success: false,
                    error: msg,
                    isDuplicate: true,
                    existingParticipation: existingParticipation,
                };
            }
            // 1. busca o evento
            const { data: event, error: eventError } = await supabaseClient_1.supabase
                .from('events')
                .select('*')
                .eq('id', eventId)
                .single();
            if (eventError || !event) {
                throw eventError ?? new Error('Evento n√£o encontrado');
            }
            const eventData = event;
            // 2. valida conflitos
            const validations = await this.validateApplication(eventData, userId);
            if (!validations.valid) {
                return { success: false, error: validations.error };
            }
            // 3. decide status inicial
            const isDirectEnrollment = eventData.event_type === 'institucional';
            const initialStatus = isDirectEnrollment
                ? 'aprovado'
                : 'pendente';
            // 4. checa vagas
            if (typeof eventData.vagas === 'number' &&
                eventData.vagas !== null &&
                eventData.vagas !== undefined) {
                if (eventData.vagas <= 0) {
                    // sem vagas ‚Üí lista de espera
                    // ‚úÖ ajustado: espera string
                    await WaitingListService_1.default.addToWaitingList(String(eventId), userId);
                    return {
                        success: true,
                        message: 'Sem vagas. Voc√™ foi colocado na lista de espera.',
                    };
                }
            }
            // 5. ‚úÖ UPSERT - insere ou atualiza se j√° existir (previne duplica√ß√£o)
            const { data: newParticipation, error: participationError } = await supabaseClient_1.supabase
                .from('event_participants')
                .upsert({
                event_id: eventId,
                user_id: userId,
                status: initialStatus,
                mensagem_candidatura: message ?? null,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
            }, {
                onConflict: 'event_id,user_id',
                ignoreDuplicates: false,
            })
                .select()
                .single();
            if (participationError) {
                console.error('‚ùå Erro ao inserir/atualizar participa√ß√£o:', participationError);
                throw participationError;
            }
            // 6. se entrou aprovado ‚Üí decrementa vaga
            if (initialStatus === 'aprovado') {
                await this.decrementEventVacancy(eventId);
            }
            // 7. notifica dono do evento
            await NotificationService_1.default.createForUser({
                target_user_id: eventData.creator_id,
                target_event_id: toNumber(eventId),
                notification_type: 'event_application',
                title: 'üì© Nova participa√ß√£o',
                message: `Novo pedido de participa√ß√£o no evento "${eventData.title}"`,
            });
            return {
                success: true,
                data: newParticipation,
                message: initialStatus === 'aprovado'
                    ? 'Entrada confirmada no evento.'
                    : 'Solicita√ß√£o enviada ao anfitri√£o.',
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao se candidatar ao evento:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * ‚¨áÔ∏è Decrementa vaga de um evento aprovado
     */
    static async decrementEventVacancy(eventId) {
        try {
            const { data: event, error: fetchError } = await supabaseClient_1.supabase
                .from('events')
                .select('vagas')
                .eq('id', eventId)
                .single();
            if (fetchError || !event) {
                console.error('‚ùå Erro ao buscar evento para decrementar vaga:', fetchError);
                return;
            }
            const eventData = event;
            if (typeof eventData.vagas === 'number' &&
                eventData.vagas !== null &&
                eventData.vagas !== undefined) {
                const { error: updateError } = await supabaseClient_1.supabase
                    .from('events')
                    .update({
                    vagas: eventData.vagas > 0 ? eventData.vagas - 1 : 0,
                    updated_at: new Date().toISOString(),
                })
                    .eq('id', eventId);
                if (updateError) {
                    console.error('‚ùå Erro ao decrementar vaga:', updateError);
                }
                else {
                    console.log(`‚úÖ Vaga decrementada. Vagas restantes: ${eventData.vagas > 0 ? eventData.vagas - 1 : 0}`);
                }
            }
        }
        catch (error) {
            console.error('‚ùå Erro inesperado ao decrementar vaga do evento:', error);
        }
    }
    /**
     * ‚úÖ Aprovar participa√ß√£o (anfitri√£o)
     */
    static async approveParticipation(participationId, eventId, _hostId) {
        try {
            console.log('üîî [approveParticipation] Iniciando aprova√ß√£o:', {
                participationId,
                eventId,
            });
            const { data: event, error: eventError } = await supabaseClient_1.supabase
                .from('events')
                .select('vagas, title, start_time')
                .eq('id', eventId)
                .single();
            if (eventError) {
                console.error('‚ùå Erro ao buscar evento:', eventError);
                throw eventError;
            }
            const eventData = event;
            // se estiver a menos de 1 minuto, bloqueia
            if (this.isEventTooClose(eventData)) {
                return {
                    success: false,
                    error: 'N√£o √© poss√≠vel aprovar participa√ß√µes t√£o perto do evento.',
                };
            }
            // busca participa√ß√£o pra pegar o user
            const { data: participation, error: partError } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('user_id')
                .eq('id', participationId)
                .single();
            if (partError) {
                console.error('‚ùå Erro ao buscar participa√ß√£o:', partError);
                throw partError;
            }
            // atualiza participa√ß√£o
            const { error: updateError } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                status: 'aprovado',
                updated_at: new Date().toISOString(),
            })
                .eq('id', participationId);
            if (updateError) {
                console.error('‚ùå Erro ao atualizar participa√ß√£o:', updateError);
                throw updateError;
            }
            // decrementa vaga
            await this.decrementEventVacancy(eventId);
            // notifica usu√°rio aprovado
            await NotificationService_1.default.createForUser({
                target_user_id: participation.user_id,
                target_event_id: toNumber(eventId),
                notification_type: 'candidate_approved',
                title: '‚úÖ Participa√ß√£o Aprovada',
                message: `Sua participa√ß√£o em "${eventData.title}" foi aprovada!`,
            });
            return { success: true, message: 'Participa√ß√£o aprovada!' };
        }
        catch (error) {
            console.error('‚ùå [approveParticipation] Erro:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * ‚ùå Rejeitar participa√ß√£o (anfitri√£o)
     */
    static async rejectParticipation(participationId, eventId, reason = '') {
        try {
            const { data: participation, error: partError } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('user_id')
                .eq('id', participationId)
                .single();
            if (partError) {
                throw partError;
            }
            const { data: event, error: eventError } = await supabaseClient_1.supabase
                .from('events')
                .select('start_time, title, creator_id, event_type')
                .eq('id', eventId)
                .single();
            if (eventError) {
                throw eventError;
            }
            const { error: updateError } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                status: 'rejeitado',
                motivo_rejeicao: reason,
                updated_at: new Date().toISOString(),
            })
                .eq('id', participationId);
            if (updateError) {
                throw updateError;
            }
            await NotificationService_1.default.createForUser({
                target_user_id: participation.user_id,
                target_event_id: toNumber(eventId),
                notification_type: 'participation_rejected',
                title: '‚ùå Participa√ß√£o Rejeitada',
                message: `Sua candidatura para "${event.title}" foi rejeitada.${reason ? ` Motivo: ${reason}` : ''}`,
            });
            return {
                success: true,
                message: 'Participa√ß√£o rejeitada',
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao rejeitar participa√ß√£o:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * üõë Cancelar participa√ß√£o (usu√°rio saindo do evento)
     */
    static async cancelParticipation(participationId, eventId, userId) {
        try {
            const { data: event, error: eventError } = await supabaseClient_1.supabase
                .from('events')
                .select('start_time, title, creator_id, event_type')
                .eq('id', eventId)
                .single();
            if (eventError) {
                throw eventError;
            }
            const { data: participation, error: partError } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('status')
                .eq('id', participationId)
                .eq('user_id', userId)
                .single();
            if (partError) {
                throw partError;
            }
            if (participation.status !== 'aprovado') {
                return {
                    success: false,
                    error: 'Apenas participa√ß√µes aprovadas podem ser canceladas',
                };
            }
            const startTime = new Date(event.start_time);
            const now = new Date();
            const hoursUntilEvent = (startTime.getTime() - now.getTime()) / (1000 * 60 * 60);
            const isLateCancellation = hoursUntilEvent < 2;
            const { error: updateError } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                status: 'cancelado',
                updated_at: new Date().toISOString(),
            })
                .eq('id', participationId);
            if (updateError) {
                throw updateError;
            }
            // devolve vaga
            await this.incrementEventVacancy(eventId);
            // notifica dono
            await NotificationService_1.default.createForUser({
                target_user_id: event.creator_id,
                target_event_id: toNumber(eventId),
                notification_type: 'participation_cancelled',
                title: '‚ùå Participante desistiu',
                message: `Um participante cancelou sua presen√ßa em "${event.title}"`,
            });
            // ‚úÖ ajustado: tua WaitingListService espera string
            await WaitingListService_1.default.processWaitingList(String(eventId));
            return {
                success: true,
                message: isLateCancellation
                    ? 'Participa√ß√£o cancelada, mas foi em cima da hora.'
                    : 'Participa√ß√£o cancelada.',
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao cancelar participa√ß√£o:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * ‚¨ÜÔ∏è Incrementa vaga quando algu√©m sai
     */
    static async incrementEventVacancy(eventId) {
        try {
            const { data: event, error: fetchError } = await supabaseClient_1.supabase
                .from('events')
                .select('vagas')
                .eq('id', eventId)
                .single();
            if (fetchError || !event) {
                console.error('‚ùå Erro ao buscar evento para incrementar vaga:', fetchError);
                return;
            }
            const eventData = event;
            if (typeof eventData.vagas === 'number' &&
                eventData.vagas !== null &&
                eventData.vagas !== undefined) {
                const { error: updateError } = await supabaseClient_1.supabase
                    .from('events')
                    .update({
                    vagas: eventData.vagas + 1,
                    updated_at: new Date().toISOString(),
                })
                    .eq('id', eventId);
                if (updateError) {
                    console.error('‚ùå Erro ao incrementar vaga:', updateError);
                }
                else {
                    console.log(`‚úÖ Vaga incrementada. Vagas dispon√≠veis: ${eventData.vagas + 1}`);
                }
            }
        }
        catch (error) {
            console.error('‚ùå Erro inesperado ao incrementar vaga do evento:', error);
        }
    }
    /**
     * üéØ Aceitar convite ‚ÄúCrusher‚Äù
     */
    static async acceptCrusherInvite(participationId, eventId, userId) {
        try {
            const { data: event, error: eventError } = await supabaseClient_1.supabase
                .from('events')
                .select('event_type, title, crusher_invited_user_id, creator_id')
                .eq('id', eventId)
                .single();
            if (eventError) {
                throw eventError;
            }
            if (event.event_type !== 'crusher') {
                return {
                    success: false,
                    error: 'Este n√£o √© um evento Crusher',
                };
            }
            if (event.crusher_invited_user_id !== userId) {
                return {
                    success: false,
                    error: 'Voc√™ n√£o foi convidado para este evento',
                };
            }
            const { error: updateError } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                status: 'aprovado',
                updated_at: new Date().toISOString(),
            })
                .eq('id', participationId)
                .eq('user_id', userId);
            if (updateError) {
                throw updateError;
            }
            await NotificationService_1.default.createForUser({
                target_user_id: event.creator_id,
                target_event_id: toNumber(eventId),
                notification_type: 'crusher_accepted',
                title: 'üíú Convite Crusher Aceito!',
                message: `Seu convite para "${event.title}" foi aceito!`,
            });
            return {
                success: true,
                message: 'Convite aceito!',
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao aceitar convite Crusher:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * üéØ Rejeitar convite ‚ÄúCrusher‚Äù
     */
    static async rejectCrusherInvite(participationId, eventId, userId, reason = '') {
        try {
            const { data: event, error: eventError } = await supabaseClient_1.supabase
                .from('events')
                .select('event_type, title, crusher_invited_user_id, creator_id')
                .eq('id', eventId)
                .single();
            if (eventError) {
                throw eventError;
            }
            if (event.event_type !== 'crusher') {
                return {
                    success: false,
                    error: 'Este n√£o √© um evento Crusher',
                };
            }
            if (event.crusher_invited_user_id !== userId) {
                return {
                    success: false,
                    error: 'Voc√™ n√£o foi convidado para este evento',
                };
            }
            const { error: updateError } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                status: 'rejeitado',
                rejeicao_motivo: reason || null,
                updated_at: new Date().toISOString(),
            })
                .eq('id', participationId)
                .eq('user_id', userId);
            if (updateError) {
                throw updateError;
            }
            await NotificationService_1.default.createForUser({
                target_user_id: event.creator_id,
                target_event_id: toNumber(eventId),
                notification_type: 'participation_rejected',
                title: 'üíî Convite Crusher Recusado',
                message: `Seu convite para "${event.title}" foi recusado.${reason ? ` Motivo: ${reason}` : ''}`,
            });
            return {
                success: true,
                message: 'Convite recusado',
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao rejeitar convite Crusher:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * üëÄ Verifica se um usu√°rio √© o convidado do evento Crusher
     */
    static async isUserCrusherInvitee(eventId, userId) {
        try {
            const { data: participation, error } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('event_id')
                .eq('event_id', eventId)
                .single();
            if (error || !participation) {
                return false;
            }
            const { data: event, error: eventError } = await supabaseClient_1.supabase
                .from('events')
                .select('event_type, crusher_invited_user_id')
                .eq('id', participation.event_id)
                .single();
            if (eventError) {
                return false;
            }
            return (event.event_type === 'crusher' &&
                event.crusher_invited_user_id === userId);
        }
        catch (error) {
            console.error('‚ùå Erro ao verificar convite Crusher:', error);
            return false;
        }
    }
    /**
     * üì• Lista TODAS as participa√ß√µes de um evento (para anfitri√£o)
     * ‚ö†Ô∏è AQUI estava dando 406 porque usava id=eq.<evento>
     */
    static async getEventParticipations(eventId) {
        try {
            const { data: participations, error } = await supabaseClient_1.supabase
                .from('event_participants')
                .select(`
          id,
          event_id,
          user_id,
          status,
          presenca_confirmada,
          com_acesso,
          mensagem_candidatura,
          created_at,
          user:profiles!event_participants_user_id_fkey (
            id,
            username,
            avatar_url,
            reputation_stars
          )
        `)
                .eq('event_id', eventId)
                .order('created_at', { ascending: false });
            if (error) {
                throw error;
            }
            return { success: true, data: participations };
        }
        catch (error) {
            console.error('‚ùå Erro ao buscar participa√ß√µes:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * üë§ Participa√ß√µes de um usu√°rio em todos os eventos
     */
    static async getUserParticipations(userId) {
        try {
            const { data, error } = await supabaseClient_1.supabase
                .from('event_participants')
                .select(`
          id,
          event_id,
          status,
          presenca_confirmada,
          avaliacao_feita,
          com_acesso,
          events:events!inner (
            id,
            title,
            start_time,
            end_time,
            status,
            event_type
          )
        `)
                .eq('user_id', userId)
                .order('created_at', { ascending: false });
            if (error) {
                throw error;
            }
            return { success: true, data };
        }
        catch (error) {
            console.error('‚ùå Erro ao buscar participa√ß√µes do usu√°rio:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * üìå Ver detalhes de uma participa√ß√£o espec√≠fica
     */
    static async getParticipationById(participationId) {
        try {
            const { data, error } = await supabaseClient_1.supabase
                .from('event_participants')
                .select(`
          id,
          event_id,
          user_id,
          status,
          presenca_confirmada,
          com_acesso,
          avaliacao_feita,
          events:events!inner (
            id,
            title,
            start_time,
            end_time,
            status
          ),
          user:profiles!event_participants_user_id_fkey (
            id,
            username,
            avatar_url
          )
        `)
                .eq('id', participationId)
                .single();
            if (error) {
                throw error;
            }
            return { success: true, data };
        }
        catch (error) {
            console.error('‚ùå Erro ao buscar participa√ß√£o:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * ‚úÖ Confirma presen√ßa
     */
    static async confirmPresence(participationId) {
        try {
            const { error } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                presenca_confirmada: true,
                updated_at: new Date().toISOString(),
            })
                .eq('id', participationId);
            if (error) {
                throw error;
            }
            return { success: true };
        }
        catch (error) {
            console.error('‚ùå Erro ao confirmar presen√ßa:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * üö™ Libera acesso do participante dentro do evento
     */
    static async grantAccess(participationId) {
        try {
            const { error } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                com_acesso: true,
                updated_at: new Date().toISOString(),
            })
                .eq('id', participationId);
            if (error) {
                throw error;
            }
            return { success: true };
        }
        catch (error) {
            console.error('‚ùå Erro ao liberar acesso:', error);
            return { success: false, error: error.message };
        }
    }
    /**
     * üîê Valida senha de entrada do evento
     */
    static async validateEventEntryPassword(eventId, participantId, password) {
        try {
            console.log(`üîç Validando entrada: participante ${participantId} no evento ${eventId}`);
            // 1Ô∏è‚É£ Verificar se participante est√° aprovado
            const { data: participation, error: partError } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('id, status, com_acesso, presenca_confirmada')
                .eq('event_id', eventId)
                .eq('user_id', participantId)
                .single();
            if (partError || !participation) {
                return {
                    success: false,
                    canEnter: false,
                    message: 'Voc√™ n√£o est√° inscrito neste evento',
                };
            }
            if (participation.status !== 'aprovado') {
                return {
                    success: false,
                    canEnter: false,
                    message: `Sua inscri√ß√£o est√° com status: ${participation.status}`,
                };
            }
            // 2Ô∏è‚É£ Validar a senha usando o servi√ßo j√° existente
            const securityResult = await EventSecurityService_1.default.validateEntryPassword({
                eventId: toNumber(eventId), // ‚úÖ ajustado: o service espera number
                participantId,
                password,
            });
            if (!securityResult.success) {
                return {
                    success: false,
                    canEnter: false,
                    message: securityResult.message || 'Senha inv√°lida.',
                };
            }
            // 3Ô∏è‚É£ Senha correta ‚Üí marcar presen√ßa
            const { error: presencaError } = await supabaseClient_1.supabase
                .from('event_participants')
                .update({
                presenca_confirmada: true,
                updated_at: new Date().toISOString(),
            })
                .eq('event_id', eventId)
                .eq('user_id', participantId);
            if (presencaError) {
                throw presencaError;
            }
            console.log(`‚úÖ Participante ${participantId} agora tem acesso ao evento ${eventId}`);
            return {
                success: true,
                canEnter: true,
                message: securityResult.message || '‚úÖ Acesso liberado! Bem-vindo ao evento.',
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao validar entrada:', error);
            return {
                success: false,
                canEnter: false,
                message: 'Erro ao processar sua entrada',
                error: error instanceof Error ? error.message : String(error),
            };
        }
    }
    /**
     * üìä Estat√≠sticas de entrada
     */
    static async getEventEntryStats(eventId) {
        try {
            const { data: participants, error } = await supabaseClient_1.supabase
                .from('event_participants')
                .select('id, com_acesso')
                .eq('event_id', eventId);
            if (error) {
                throw error;
            }
            const total = participants.length;
            const withAccess = participants.filter(p => p.com_acesso).length;
            const withoutAccess = total - withAccess;
            const percentage = total > 0 ? (withAccess / total) * 100 : 0;
            return {
                success: true,
                data: {
                    totalParticipants: total,
                    participantsWithAccess: withAccess,
                    participantsWithoutAccess: withoutAccess,
                    accessPercentage: percentage,
                },
            };
        }
        catch (error) {
            console.error('‚ùå Erro ao obter stats de entrada:', error);
            return {
                success: false,
                error: error instanceof Error ? error.message : String(error),
            };
        }
    }
    /**
     * üîí verifica se o usu√°rio pode criar mais eventos (regra extra sua)
     */
    static async canUserCreateEvent(userId) {
        try {
            const today = new Date().toISOString().split('T')[0];
            // eventos hoje
            const { data: todayEvents, error: todayError } = await supabaseClient_1.supabase
                .from('events')
                .select('id')
                .eq('creator_id', userId)
                .gte('start_time', `${today}T00:00:00`)
                .lte('start_time', `${today}T23:59:59`);
            if (todayError) {
                throw todayError;
            }
            if (todayEvents && todayEvents.length > 0) {
                return {
                    success: false,
                    error: 'Voc√™ j√° tem um evento hoje.',
                };
            }
            // eventos n√£o conclu√≠dos
            const { data: unfinished, error: unfinishedError } = await supabaseClient_1.supabase
                .from('events')
                .select('id, title')
                .eq('creator_id', userId)
                .in('status', [
                'Aberto',
                'Confirmado',
                'Em Andamento',
                'Finalizado',
            ]);
            if (unfinishedError) {
                throw unfinishedError;
            }
            if (unfinished && unfinished.length > 0) {
                return {
                    success: false,
                    error: 'Voc√™ tem eventos em aberto. Conclua ou cancele antes de criar outro.',
                };
            }
            return { success: true };
        }
        catch (error) {
            console.error('‚ùå Erro ao verificar se usu√°rio pode criar evento:', error);
            return { success: false, error: error.message };
        }
    }
}
exports.default = ParticipationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcUGFydGljaXBhdGlvblNlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBLHVDQUF1QztBQUN2QyxvR0FBb0c7OztBQUVwRyx5REFBZ0Q7QUFDaEQsaUdBQWlFO0FBQ2pFLCtGQUErRDtBQUMvRCwwRkFBMEQ7QUFFMUQsTUFBTSxRQUFRLEdBQUcsQ0FBQyxLQUFzQixFQUFVLEVBQUUsQ0FDbEQsT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztBQWtEcEQsTUFBTSxvQkFBb0I7SUFDeEI7O09BRUc7SUFDSyxNQUFNLENBQUMsZUFBZSxDQUFDLEtBQVk7UUFDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFDcEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ25ELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUN2QixNQUFNLE1BQU0sR0FBRyxLQUFLLEdBQUcsR0FBRyxDQUFDO1FBQzNCLFdBQVc7UUFDWCxPQUFPLE1BQU0sSUFBSSxLQUFNLENBQUM7SUFDMUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FDN0IsT0FBd0IsRUFDeEIsTUFBYztRQUVkLElBQUksQ0FBQztZQUNILE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsTUFBTSx5QkFBUTtpQkFDbkMsSUFBSSxDQUFDLG9CQUFvQixDQUFDO2lCQUMxQixNQUFNLENBQUMsOENBQThDLENBQUM7aUJBQ3RELEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDO2lCQUN2QixFQUFFLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQztpQkFDckIsV0FB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c0U7aUJBQ3pFLENBQUM7WUFDSixDQUFDO1lBRUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUMzQixDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUNYLG1EQUFtRCxFQUNuRCxLQUFLLENBQ04sQ0FBQztZQUNGLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDbEQsQ0FBQztJQUNILENBQUM7Q0FDRjtBQUVELGtCQUFlLG9CQUFvQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcc2VydmljZXNcXFBhcnRpY2lwYXRpb25TZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2aWNlcy9QYXJ0aWNpcGF0aW9uU2VydmljZS50c1xyXG4vLyDinIUgVkVSU8ODTyBDT05TT0xJREFEQSAoYWxpbmhhZGEgYW8gTm90aWZpY2F0aW9uU2VydmljZSwgV2FpdGluZ0xpc3RTZXJ2aWNlIGUgRXZlbnRTZWN1cml0eVNlcnZpY2UpXHJcblxyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJ0AvbGliL3N1cGFiYXNlQ2xpZW50JztcclxuaW1wb3J0IE5vdGlmaWNhdGlvblNlcnZpY2UgZnJvbSAnQC9zZXJ2aWNlcy9Ob3RpZmljYXRpb25TZXJ2aWNlJztcclxuaW1wb3J0IFdhaXRpbmdMaXN0U2VydmljZSBmcm9tICdAL3NlcnZpY2VzL1dhaXRpbmdMaXN0U2VydmljZSc7XHJcbmltcG9ydCBFdmVudFNlY3VyaXR5U2VydmljZSBmcm9tICcuL0V2ZW50U2VjdXJpdHlTZXJ2aWNlJztcclxuXHJcbmNvbnN0IHRvTnVtYmVyID0gKHZhbHVlOiBzdHJpbmcgfCBudW1iZXIpOiBudW1iZXIgPT5cclxuICB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gTnVtYmVyKHZhbHVlKSA6IHZhbHVlO1xyXG5cclxudHlwZSBFdmVudFN0YXR1cyA9XHJcbiAgfCAnQWJlcnRvJ1xyXG4gIHwgJ0NvbmZpcm1hZG8nXHJcbiAgfCAnRW0gQW5kYW1lbnRvJ1xyXG4gIHwgJ0ZpbmFsaXphZG8nXHJcbiAgfCAnQ29uY2x1w61kbydcclxuICB8ICdDYW5jZWxhZG8nO1xyXG5cclxudHlwZSBQYXJ0aWNpcGF0aW9uU3RhdHVzID1cclxuICB8ICdwZW5kZW50ZSdcclxuICB8ICdhcHJvdmFkbydcclxuICB8ICdyZWplaXRhZG8nXHJcbiAgfCAnY2FuY2VsYWRvJztcclxuXHJcbnR5cGUgRXZlbnRUeXBlID1cclxuICB8ICdpbnN0aXR1Y2lvbmFsJ1xyXG4gIHwgJ3ByaXZhZG8nXHJcbiAgfCAncHVibGljbydcclxuICB8ICdwYWRyYW8nXHJcbiAgfCAncGFydGljdWxhcidcclxuICB8ICdjcnVzaGVyJztcclxuXHJcbmludGVyZmFjZSBFdmVudCB7XHJcbiAgaWQ6IG51bWJlciB8IHN0cmluZztcclxuICBzdGF0dXM6IEV2ZW50U3RhdHVzO1xyXG4gIHN0YXJ0X3RpbWU6IHN0cmluZztcclxuICBlbmRfdGltZTogc3RyaW5nO1xyXG4gIHZhZ2FzPzogbnVtYmVyIHwgbnVsbDtcclxuICBldmVudF90eXBlOiBFdmVudFR5cGU7XHJcbiAgY3JlYXRvcl9pZDogc3RyaW5nO1xyXG4gIHRpdGxlOiBzdHJpbmc7XHJcbiAgZXZlbnRfZW50cnlfcGFzc3dvcmQ/OiBzdHJpbmcgfCBudWxsO1xyXG4gIGVudHJ5X2xvY2tlZD86IGJvb2xlYW4gfCBudWxsO1xyXG4gIGNydXNoZXJfaW52aXRlZF91c2VyX2lkPzogc3RyaW5nIHwgbnVsbDtcclxuICBba2V5OiBzdHJpbmddOiBhbnk7XHJcbn1cclxuXHJcbi8vIOKchSBDT1JSRcOHw4NPOiBJbnRlcmZhY2UgJ1BhcnRpY2lwYXRpb24nIHJlbW92aWRhIHBvaXMgbsOjbyBlc3RhdmEgc2VuZG8gdXNhZGEgKFRTNjE5NilcclxuXHJcbmludGVyZmFjZSBTZXJ2aWNlUmVzdWx0PFQgPSBhbnk+IHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGRhdGE/OiBUO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG4gIG1lc3NhZ2U/OiBzdHJpbmc7XHJcbiAgW2tleTogc3RyaW5nXTogYW55O1xyXG59XHJcblxyXG5cclxuY2xhc3MgUGFydGljaXBhdGlvblNlcnZpY2Uge1xyXG4gIC8qKlxyXG4gICAqIPCfp6ogdmVyaWZpY2Egc2UgbyBldmVudG8gZXN0w6EgbXVpdG8gcGVydG8gZG8gaG9yw6FyaW9cclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBpc0V2ZW50VG9vQ2xvc2UoZXZlbnQ6IEV2ZW50KTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIWV2ZW50LnN0YXJ0X3RpbWUpIHJldHVybiBmYWxzZTtcclxuICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoZXZlbnQuc3RhcnRfdGltZSkuZ2V0VGltZSgpO1xyXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcclxuICAgIGNvbnN0IGRpZmZNcyA9IHN0YXJ0IC0gbm93O1xyXG4gICAgLy8gMSBtaW51dG9cclxuICAgIHJldHVybiBkaWZmTXMgPD0gNjBfMDAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog8J+UjiBWZXJpZmljYSBzZSBvIHVzdcOhcmlvIGrDoSBwYXJ0aWNpcGEgZG8gZXZlbnRvXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHVzZXJBbHJlYWR5SW5FdmVudChcclxuICAgIGV2ZW50SWQ6IHN0cmluZyB8IG51bWJlcixcclxuICAgIHVzZXJJZDogc3RyaW5nLFxyXG4gICk6IFByb21pc2U8eyBleGlzdHM6IGJvb2xlYW47IHBhcnRpY2lwYXRpb24/OiBhbnkgfT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfcGFydGljaXBhbnRzJylcclxuICAgICAgICAuc2VsZWN0KCdpZCwgc3RhdHVzLCBtZW5zYWdlbV9jYW5kaWRhdHVyYSwgY3JlYXRlZF9hdCcpXHJcbiAgICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gYW8gdmVyaWZpY2FyIHNlIHVzdcOhcmlvIGrDoSBwYXJ0aWNpcGEgZG8gZXZlbnRvOicsIGVycm9yKTtcclxuICAgICAgICByZXR1cm4geyBleGlzdHM6IGZhbHNlIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYOKEue+4jyBVc3XDoXJpbyAke3VzZXJJZH0gasOhIGVzdMOhIGluc2NyaXRvIG5vIGV2ZW50byAke2V2ZW50SWR9IGNvbSBzdGF0dXM6ICR7ZGF0YS5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IGV4aXN0czogISFkYXRhLCBwYXJ0aWNpcGF0aW9uOiBkYXRhIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBpbmVzcGVyYWRvIGFvIHZlcmlmaWNhciBwYXJ0aWNpcGHDp8OjbzonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IGV4aXN0czogZmFsc2UgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfp6AgVmFsaWRhIHNlIG8gdXN1w6FyaW8gcG9kZSBzZSBpbnNjcmV2ZXIgbnVtIGV2ZW50b1xyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyB2YWxpZGF0ZUFwcGxpY2F0aW9uKFxyXG4gICAgZXZlbnQ6IEV2ZW50LFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgKTogUHJvbWlzZTx7IHZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHVzZXJFdmVudHMsIGVycm9yOiB1c2VyRXZlbnRzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnNlbGVjdChcclxuICAgICAgICAgIGBcclxuICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgc3RhdHVzLFxyXG4gICAgICAgICAgZXZlbnRzOmV2ZW50cyFpbm5lciAoXHJcbiAgICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgICBzdGFydF90aW1lLFxyXG4gICAgICAgICAgICBlbmRfdGltZSxcclxuICAgICAgICAgICAgc3RhdHVzXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgYCxcclxuICAgICAgICApXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxyXG4gICAgICAgIC5lcSgnc3RhdHVzJywgJ2Fwcm92YWRvJyk7XHJcblxyXG4gICAgICBpZiAodXNlckV2ZW50c0Vycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICAgICfinYwgRXJybyBhbyBidXNjYXIgZXZlbnRvcyBkbyB1c3XDoXJpbyBwYXJhIHZhbGlkYXIgaW5zY3Jpw6fDo286JyxcclxuICAgICAgICAgIHVzZXJFdmVudHNFcnJvcixcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdFcnJvIGFvIHZhbGlkYXIgaW5zY3Jpw6fDo28uJyB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXVzZXJFdmVudHMgfHwgdXNlckV2ZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBldmVudFN0YXJ0ID0gbmV3IERhdGUoZXZlbnQuc3RhcnRfdGltZSk7XHJcbiAgICAgIGNvbnN0IGV2ZW50RW5kID0gbmV3IERhdGUoZXZlbnQuZW5kX3RpbWUpO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBwYXJ0aWNpcGF0aW9uIG9mIHVzZXJFdmVudHMgYXMgYW55W10pIHtcclxuICAgICAgICBjb25zdCBleGlzdGluZ0V2ZW50ID0gcGFydGljaXBhdGlvbi5ldmVudHM7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgZXhpc3RpbmdFdmVudC5zdGF0dXMgPT09ICdDYW5jZWxhZG8nIHx8XHJcbiAgICAgICAgICBleGlzdGluZ0V2ZW50LnN0YXR1cyA9PT0gJ0NvbmNsdcOtZG8nXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nU3RhcnQgPSBuZXcgRGF0ZShleGlzdGluZ0V2ZW50LnN0YXJ0X3RpbWUpO1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nRW5kID0gbmV3IERhdGUoZXhpc3RpbmdFdmVudC5lbmRfdGltZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGhhc092ZXJsYXAgPVxyXG4gICAgICAgICAgZXZlbnRTdGFydCA8IGV4aXN0aW5nRW5kICYmIGV2ZW50RW5kID4gZXhpc3RpbmdTdGFydDtcclxuXHJcbiAgICAgICAgaWYgKGhhc092ZXJsYXApIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHZhbGlkOiBmYWxzZSxcclxuICAgICAgICAgICAgZXJyb3I6ICdWb2PDqiBqw6EgdGVtIHVtIGV2ZW50byBuZXN0ZSBob3LDoXJpby4nLFxyXG4gICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHZhbGlkOiB0cnVlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBpbmVzcGVyYWRvIG5hIHZhbGlkYcOnw6NvIGRlIGluc2NyacOnw6NvOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0Vycm8gYW8gdmFsaWRhciBpbnNjcmnDp8Ojby4nIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDwn5OoIENhbmRpZGF0YXItc2UgYSB1bSBldmVudG9cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgYXBwbHlUb0V2ZW50KFxyXG4gICAgZXZlbnRJZDogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgICBtZXNzYWdlPzogc3RyaW5nLFxyXG4gICk6IFByb21pc2U8U2VydmljZVJlc3VsdD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coYPCfk4sgSW5pY2lhbmRvIGluc2NyacOnw6NvOiB1c3XDoXJpbyAke3VzZXJJZH0g4oaSIGV2ZW50byAke2V2ZW50SWR9YCk7XHJcblxyXG4gICAgICAvLyDinIUgQ09SUkXDh8ODTzogVmVyaWZpY2FyIHNlIHVzdcOhcmlvIGrDoSBlc3TDoSBpbnNjcml0b1xyXG4gICAgICBjb25zdCB7IGV4aXN0cywgcGFydGljaXBhdGlvbjogZXhpc3RpbmdQYXJ0aWNpcGF0aW9uIH0gPSBhd2FpdCB0aGlzLnVzZXJBbHJlYWR5SW5FdmVudChldmVudElkLCB1c2VySWQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGV4aXN0cyAmJiBleGlzdGluZ1BhcnRpY2lwYXRpb24pIHtcclxuICAgICAgICBjb25zdCBzdGF0dXNNZXNzYWdlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcclxuICAgICAgICAgICdwZW5kZW50ZSc6ICdTdWEgY2FuZGlkYXR1cmEgasOhIGZvaSBlbnZpYWRhIGUgZXN0w6EgYWd1YXJkYW5kbyBhcHJvdmHDp8Ojby4nLFxyXG4gICAgICAgICAgJ2Fwcm92YWRvJzogJ1ZvY8OqIGrDoSBlc3TDoSBpbnNjcml0byBlIGFwcm92YWRvIG5lc3RlIGV2ZW50by4nLFxyXG4gICAgICAgICAgJ3JlamVpdGFkbyc6ICdTdWEgY2FuZGlkYXR1cmEgYW50ZXJpb3IgZm9pIHJlamVpdGFkYS4nLFxyXG4gICAgICAgICAgJ2NhbmNlbGFkbyc6ICdWb2PDqiBjYW5jZWxvdSBzdWEgcGFydGljaXBhw6fDo28gYW50ZXJpb3IgbmVzdGUgZXZlbnRvLicsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgbXNnID0gc3RhdHVzTWVzc2FnZXNbZXhpc3RpbmdQYXJ0aWNpcGF0aW9uLnN0YXR1c10gfHwgYFZvY8OqIGrDoSBlc3TDoSBpbnNjcml0byBuZXN0ZSBldmVudG8gKHN0YXR1czogJHtleGlzdGluZ1BhcnRpY2lwYXRpb24uc3RhdHVzfSkuYDtcclxuICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyBUZW50YXRpdmEgZGUgaW5zY3Jpw6fDo28gZHVwbGljYWRhOiAke21zZ31gKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogbXNnLFxyXG4gICAgICAgICAgaXNEdXBsaWNhdGU6IHRydWUsXHJcbiAgICAgICAgICBleGlzdGluZ1BhcnRpY2lwYXRpb246IGV4aXN0aW5nUGFydGljaXBhdGlvbixcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyAxLiBidXNjYSBvIGV2ZW50b1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGV2ZW50LCBlcnJvcjogZXZlbnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoZXZlbnRFcnJvciB8fCAhZXZlbnQpIHtcclxuICAgICAgICB0aHJvdyBldmVudEVycm9yID8/IG5ldyBFcnJvcignRXZlbnRvIG7Do28gZW5jb250cmFkbycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBldmVudERhdGEgPSBldmVudCBhcyB1bmtub3duIGFzIEV2ZW50O1xyXG5cclxuICAgICAgLy8gMi4gdmFsaWRhIGNvbmZsaXRvc1xyXG4gICAgICBjb25zdCB2YWxpZGF0aW9ucyA9IGF3YWl0IHRoaXMudmFsaWRhdGVBcHBsaWNhdGlvbihldmVudERhdGEsIHVzZXJJZCk7XHJcbiAgICAgIGlmICghdmFsaWRhdGlvbnMudmFsaWQpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHZhbGlkYXRpb25zLmVycm9yIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIDMuIGRlY2lkZSBzdGF0dXMgaW5pY2lhbFxyXG4gICAgICBjb25zdCBpc0RpcmVjdEVucm9sbG1lbnQgPSBldmVudERhdGEuZXZlbnRfdHlwZSA9PT0gJ2luc3RpdHVjaW9uYWwnO1xyXG4gICAgICBjb25zdCBpbml0aWFsU3RhdHVzOiBQYXJ0aWNpcGF0aW9uU3RhdHVzID0gaXNEaXJlY3RFbnJvbGxtZW50XHJcbiAgICAgICAgPyAnYXByb3ZhZG8nXHJcbiAgICAgICAgOiAncGVuZGVudGUnO1xyXG5cclxuICAgICAgLy8gNC4gY2hlY2EgdmFnYXNcclxuICAgICAgaWYgKFxyXG4gICAgICAgIHR5cGVvZiBldmVudERhdGEudmFnYXMgPT09ICdudW1iZXInICYmXHJcbiAgICAgICAgZXZlbnREYXRhLnZhZ2FzICE9PSBudWxsICYmXHJcbiAgICAgICAgZXZlbnREYXRhLnZhZ2FzICE9PSB1bmRlZmluZWRcclxuICAgICAgKSB7XHJcbiAgICAgICAgaWYgKGV2ZW50RGF0YS52YWdhcyA8PSAwKSB7XHJcbiAgICAgICAgICAvLyBzZW0gdmFnYXMg4oaSIGxpc3RhIGRlIGVzcGVyYVxyXG4gICAgICAgICAgLy8g4pyFIGFqdXN0YWRvOiBlc3BlcmEgc3RyaW5nXHJcbiAgICAgICAgICBhd2FpdCBXYWl0aW5nTGlzdFNlcnZpY2UuYWRkVG9XYWl0aW5nTGlzdChTdHJpbmcoZXZlbnRJZCksIHVzZXJJZCk7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VtIHZhZ2FzLiBWb2PDqiBmb2kgY29sb2NhZG8gbmEgbGlzdGEgZGUgZXNwZXJhLicsXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gNS4g4pyFIFVQU0VSVCAtIGluc2VyZSBvdSBhdHVhbGl6YSBzZSBqw6EgZXhpc3RpciAocHJldmluZSBkdXBsaWNhw6fDo28pXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3UGFydGljaXBhdGlvbiwgZXJyb3I6IHBhcnRpY2lwYXRpb25FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfcGFydGljaXBhbnRzJylcclxuICAgICAgICAudXBzZXJ0KFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBldmVudF9pZDogZXZlbnRJZCxcclxuICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgICAgICBzdGF0dXM6IGluaXRpYWxTdGF0dXMsXHJcbiAgICAgICAgICAgIG1lbnNhZ2VtX2NhbmRpZGF0dXJhOiBtZXNzYWdlID8/IG51bGwsXHJcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgb25Db25mbGljdDogJ2V2ZW50X2lkLHVzZXJfaWQnLFxyXG4gICAgICAgICAgICBpZ25vcmVEdXBsaWNhdGVzOiBmYWxzZSxcclxuICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHBhcnRpY2lwYXRpb25FcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIGluc2VyaXIvYXR1YWxpemFyIHBhcnRpY2lwYcOnw6NvOicsIHBhcnRpY2lwYXRpb25FcnJvcik7XHJcbiAgICAgICAgdGhyb3cgcGFydGljaXBhdGlvbkVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyA2LiBzZSBlbnRyb3UgYXByb3ZhZG8g4oaSIGRlY3JlbWVudGEgdmFnYVxyXG4gICAgICBpZiAoaW5pdGlhbFN0YXR1cyA9PT0gJ2Fwcm92YWRvJykge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuZGVjcmVtZW50RXZlbnRWYWNhbmN5KGV2ZW50SWQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyA3LiBub3RpZmljYSBkb25vIGRvIGV2ZW50b1xyXG4gICAgICBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmNyZWF0ZUZvclVzZXIoe1xyXG4gICAgICAgIHRhcmdldF91c2VyX2lkOiBldmVudERhdGEuY3JlYXRvcl9pZCxcclxuICAgICAgICB0YXJnZXRfZXZlbnRfaWQ6IHRvTnVtYmVyKGV2ZW50SWQpLFxyXG4gICAgICAgIG5vdGlmaWNhdGlvbl90eXBlOiAnZXZlbnRfYXBwbGljYXRpb24nLFxyXG4gICAgICAgIHRpdGxlOiAn8J+TqSBOb3ZhIHBhcnRpY2lwYcOnw6NvJyxcclxuICAgICAgICBtZXNzYWdlOiBgTm92byBwZWRpZG8gZGUgcGFydGljaXBhw6fDo28gbm8gZXZlbnRvIFwiJHtldmVudERhdGEudGl0bGV9XCJgLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBuZXdQYXJ0aWNpcGF0aW9uLFxyXG4gICAgICAgIG1lc3NhZ2U6XHJcbiAgICAgICAgICBpbml0aWFsU3RhdHVzID09PSAnYXByb3ZhZG8nXHJcbiAgICAgICAgICAgID8gJ0VudHJhZGEgY29uZmlybWFkYSBubyBldmVudG8uJ1xyXG4gICAgICAgICAgICA6ICdTb2xpY2l0YcOnw6NvIGVudmlhZGEgYW8gYW5maXRyacOjby4nLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBzZSBjYW5kaWRhdGFyIGFvIGV2ZW50bzonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4qyH77iPIERlY3JlbWVudGEgdmFnYSBkZSB1bSBldmVudG8gYXByb3ZhZG9cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZGVjcmVtZW50RXZlbnRWYWNhbmN5KFxyXG4gICAgZXZlbnRJZDogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBldmVudCwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgICAgLnNlbGVjdCgndmFnYXMnKVxyXG4gICAgICAgIC5lcSgnaWQnLCBldmVudElkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChmZXRjaEVycm9yIHx8ICFldmVudCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgICAgICAn4p2MIEVycm8gYW8gYnVzY2FyIGV2ZW50byBwYXJhIGRlY3JlbWVudGFyIHZhZ2E6JyxcclxuICAgICAgICAgIGZldGNoRXJyb3IsXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IGV2ZW50IGFzIHVua25vd24gYXMgRXZlbnQ7XHJcblxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgdHlwZW9mIGV2ZW50RGF0YS52YWdhcyA9PT0gJ251bWJlcicgJiZcclxuICAgICAgICBldmVudERhdGEudmFnYXMgIT09IG51bGwgJiZcclxuICAgICAgICBldmVudERhdGEudmFnYXMgIT09IHVuZGVmaW5lZFxyXG4gICAgICApIHtcclxuICAgICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICAgIHZhZ2FzOiBldmVudERhdGEudmFnYXMgPiAwID8gZXZlbnREYXRhLnZhZ2FzIC0gMSA6IDAsXHJcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gYW8gZGVjcmVtZW50YXIgdmFnYTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgICAgICBg4pyFIFZhZ2EgZGVjcmVtZW50YWRhLiBWYWdhcyByZXN0YW50ZXM6ICR7XHJcbiAgICAgICAgICAgICAgZXZlbnREYXRhLnZhZ2FzID4gMCA/IGV2ZW50RGF0YS52YWdhcyAtIDEgOiAwXHJcbiAgICAgICAgICAgIH1gLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgICAgJ+KdjCBFcnJvIGluZXNwZXJhZG8gYW8gZGVjcmVtZW50YXIgdmFnYSBkbyBldmVudG86JyxcclxuICAgICAgICBlcnJvcixcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOKchSBBcHJvdmFyIHBhcnRpY2lwYcOnw6NvIChhbmZpdHJpw6NvKVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBhcHByb3ZlUGFydGljaXBhdGlvbihcclxuICAgIHBhcnRpY2lwYXRpb25JZDogc3RyaW5nLFxyXG4gICAgZXZlbnRJZDogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICAgX2hvc3RJZD86IHN0cmluZyxcclxuICApOiBQcm9taXNlPFNlcnZpY2VSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SUIFthcHByb3ZlUGFydGljaXBhdGlvbl0gSW5pY2lhbmRvIGFwcm92YcOnw6NvOicsIHtcclxuICAgICAgICBwYXJ0aWNpcGF0aW9uSWQsXHJcbiAgICAgICAgZXZlbnRJZCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCB7IGRhdGE6IGV2ZW50LCBlcnJvcjogZXZlbnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgICAuc2VsZWN0KCd2YWdhcywgdGl0bGUsIHN0YXJ0X3RpbWUnKVxyXG4gICAgICAgIC5lcSgnaWQnLCBldmVudElkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChldmVudEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gYW8gYnVzY2FyIGV2ZW50bzonLCBldmVudEVycm9yKTtcclxuICAgICAgICB0aHJvdyBldmVudEVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBldmVudERhdGEgPSBldmVudCBhcyB1bmtub3duIGFzIEV2ZW50O1xyXG5cclxuICAgICAgLy8gc2UgZXN0aXZlciBhIG1lbm9zIGRlIDEgbWludXRvLCBibG9xdWVpYVxyXG4gICAgICBpZiAodGhpcy5pc0V2ZW50VG9vQ2xvc2UoZXZlbnREYXRhKSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiAnTsOjbyDDqSBwb3Nzw612ZWwgYXByb3ZhciBwYXJ0aWNpcGHDp8O1ZXMgdMOjbyBwZXJ0byBkbyBldmVudG8uJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBidXNjYSBwYXJ0aWNpcGHDp8OjbyBwcmEgcGVnYXIgbyB1c2VyXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogcGFydGljaXBhdGlvbiwgZXJyb3I6IHBhcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfcGFydGljaXBhbnRzJylcclxuICAgICAgICAuc2VsZWN0KCd1c2VyX2lkJylcclxuICAgICAgICAuZXEoJ2lkJywgcGFydGljaXBhdGlvbklkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChwYXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBidXNjYXIgcGFydGljaXBhw6fDo286JywgcGFydEVycm9yKTtcclxuICAgICAgICB0aHJvdyBwYXJ0RXJyb3I7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGF0dWFsaXphIHBhcnRpY2lwYcOnw6NvXHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudF9wYXJ0aWNpcGFudHMnKVxyXG4gICAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgICAgc3RhdHVzOiAnYXByb3ZhZG8nLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIHBhcnRpY2lwYXRpb25JZCk7XHJcblxyXG4gICAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBhdHVhbGl6YXIgcGFydGljaXBhw6fDo286JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgIHRocm93IHVwZGF0ZUVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBkZWNyZW1lbnRhIHZhZ2FcclxuICAgICAgYXdhaXQgdGhpcy5kZWNyZW1lbnRFdmVudFZhY2FuY3koZXZlbnRJZCk7XHJcblxyXG4gICAgICAvLyBub3RpZmljYSB1c3XDoXJpbyBhcHJvdmFkb1xyXG4gICAgICBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmNyZWF0ZUZvclVzZXIoe1xyXG4gICAgICAgIHRhcmdldF91c2VyX2lkOiAocGFydGljaXBhdGlvbiBhcyBhbnkpLnVzZXJfaWQsXHJcbiAgICAgICAgdGFyZ2V0X2V2ZW50X2lkOiB0b051bWJlcihldmVudElkKSxcclxuICAgICAgICBub3RpZmljYXRpb25fdHlwZTogJ2NhbmRpZGF0ZV9hcHByb3ZlZCcsXHJcbiAgICAgICAgdGl0bGU6ICfinIUgUGFydGljaXBhw6fDo28gQXByb3ZhZGEnLFxyXG4gICAgICAgIG1lc3NhZ2U6IGBTdWEgcGFydGljaXBhw6fDo28gZW0gXCIke2V2ZW50RGF0YS50aXRsZX1cIiBmb2kgYXByb3ZhZGEhYCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnUGFydGljaXBhw6fDo28gYXByb3ZhZGEhJyB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW2FwcHJvdmVQYXJ0aWNpcGF0aW9uXSBFcnJvOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDinYwgUmVqZWl0YXIgcGFydGljaXBhw6fDo28gKGFuZml0cmnDo28pXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIHJlamVjdFBhcnRpY2lwYXRpb24oXHJcbiAgICBwYXJ0aWNpcGF0aW9uSWQ6IHN0cmluZyxcclxuICAgIGV2ZW50SWQ6IHN0cmluZyB8IG51bWJlcixcclxuICAgIHJlYXNvbiA9ICcnLFxyXG4gICk6IFByb21pc2U8U2VydmljZVJlc3VsdD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBwYXJ0aWNpcGF0aW9uLCBlcnJvcjogcGFydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudF9wYXJ0aWNpcGFudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ3VzZXJfaWQnKVxyXG4gICAgICAgIC5lcSgnaWQnLCBwYXJ0aWNpcGF0aW9uSWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKHBhcnRFcnJvcikge1xyXG4gICAgICAgIHRocm93IHBhcnRFcnJvcjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBkYXRhOiBldmVudCwgZXJyb3I6IGV2ZW50RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgICAgLnNlbGVjdCgnc3RhcnRfdGltZSwgdGl0bGUsIGNyZWF0b3JfaWQsIGV2ZW50X3R5cGUnKVxyXG4gICAgICAgIC5lcSgnaWQnLCBldmVudElkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChldmVudEVycm9yKSB7XHJcbiAgICAgICAgdGhyb3cgZXZlbnRFcnJvcjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBzdGF0dXM6ICdyZWplaXRhZG8nLFxyXG4gICAgICAgICAgbW90aXZvX3JlamVpY2FvOiByZWFzb24sXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2lkJywgcGFydGljaXBhdGlvbklkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIHRocm93IHVwZGF0ZUVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmNyZWF0ZUZvclVzZXIoe1xyXG4gICAgICAgIHRhcmdldF91c2VyX2lkOiAocGFydGljaXBhdGlvbiBhcyBhbnkpLnVzZXJfaWQsXHJcbiAgICAgICAgdGFyZ2V0X2V2ZW50X2lkOiB0b051bWJlcihldmVudElkKSxcclxuICAgICAgICBub3RpZmljYXRpb25fdHlwZTogJ3BhcnRpY2lwYXRpb25fcmVqZWN0ZWQnLFxyXG4gICAgICAgIHRpdGxlOiAn4p2MIFBhcnRpY2lwYcOnw6NvIFJlamVpdGFkYScsXHJcbiAgICAgICAgbWVzc2FnZTogYFN1YSBjYW5kaWRhdHVyYSBwYXJhIFwiJHsoZXZlbnQgYXMgYW55KS50aXRsZX1cIiBmb2kgcmVqZWl0YWRhLiR7XHJcbiAgICAgICAgICByZWFzb24gPyBgIE1vdGl2bzogJHtyZWFzb259YCA6ICcnXHJcbiAgICAgICAgfWAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdQYXJ0aWNpcGHDp8OjbyByZWplaXRhZGEnLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyByZWplaXRhciBwYXJ0aWNpcGHDp8OjbzonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog8J+bkSBDYW5jZWxhciBwYXJ0aWNpcGHDp8OjbyAodXN1w6FyaW8gc2FpbmRvIGRvIGV2ZW50bylcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgY2FuY2VsUGFydGljaXBhdGlvbihcclxuICAgIHBhcnRpY2lwYXRpb25JZDogc3RyaW5nLFxyXG4gICAgZXZlbnRJZDogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgKTogUHJvbWlzZTxTZXJ2aWNlUmVzdWx0PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGV2ZW50LCBlcnJvcjogZXZlbnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgICAuc2VsZWN0KCdzdGFydF90aW1lLCB0aXRsZSwgY3JlYXRvcl9pZCwgZXZlbnRfdHlwZScpXHJcbiAgICAgICAgLmVxKCdpZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGV2ZW50RXJyb3IpIHtcclxuICAgICAgICB0aHJvdyBldmVudEVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB7IGRhdGE6IHBhcnRpY2lwYXRpb24sIGVycm9yOiBwYXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnNlbGVjdCgnc3RhdHVzJylcclxuICAgICAgICAuZXEoJ2lkJywgcGFydGljaXBhdGlvbklkKVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAocGFydEVycm9yKSB7XHJcbiAgICAgICAgdGhyb3cgcGFydEVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoKHBhcnRpY2lwYXRpb24gYXMgYW55KS5zdGF0dXMgIT09ICdhcHJvdmFkbycpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0FwZW5hcyBwYXJ0aWNpcGHDp8O1ZXMgYXByb3ZhZGFzIHBvZGVtIHNlciBjYW5jZWxhZGFzJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgoZXZlbnQgYXMgYW55KS5zdGFydF90aW1lKTtcclxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuICAgICAgY29uc3QgaG91cnNVbnRpbEV2ZW50ID1cclxuICAgICAgICAoc3RhcnRUaW1lLmdldFRpbWUoKSAtIG5vdy5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwKTtcclxuXHJcbiAgICAgIGNvbnN0IGlzTGF0ZUNhbmNlbGxhdGlvbiA9IGhvdXJzVW50aWxFdmVudCA8IDI7XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfcGFydGljaXBhbnRzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHN0YXR1czogJ2NhbmNlbGFkbycsXHJcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2lkJywgcGFydGljaXBhdGlvbklkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIHRocm93IHVwZGF0ZUVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBkZXZvbHZlIHZhZ2FcclxuICAgICAgYXdhaXQgdGhpcy5pbmNyZW1lbnRFdmVudFZhY2FuY3koZXZlbnRJZCk7XHJcblxyXG4gICAgICAvLyBub3RpZmljYSBkb25vXHJcbiAgICAgIGF3YWl0IE5vdGlmaWNhdGlvblNlcnZpY2UuY3JlYXRlRm9yVXNlcih7XHJcbiAgICAgICAgdGFyZ2V0X3VzZXJfaWQ6IChldmVudCBhcyBhbnkpLmNyZWF0b3JfaWQsXHJcbiAgICAgICAgdGFyZ2V0X2V2ZW50X2lkOiB0b051bWJlcihldmVudElkKSxcclxuICAgICAgICBub3RpZmljYXRpb25fdHlwZTogJ3BhcnRpY2lwYXRpb25fY2FuY2VsbGVkJyxcclxuICAgICAgICB0aXRsZTogJ+KdjCBQYXJ0aWNpcGFudGUgZGVzaXN0aXUnLFxyXG4gICAgICAgIG1lc3NhZ2U6IGBVbSBwYXJ0aWNpcGFudGUgY2FuY2Vsb3Ugc3VhIHByZXNlbsOnYSBlbSBcIiR7KGV2ZW50IGFzIGFueSkudGl0bGV9XCJgLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIOKchSBhanVzdGFkbzogdHVhIFdhaXRpbmdMaXN0U2VydmljZSBlc3BlcmEgc3RyaW5nXHJcbiAgICAgIGF3YWl0IFdhaXRpbmdMaXN0U2VydmljZS5wcm9jZXNzV2FpdGluZ0xpc3QoU3RyaW5nKGV2ZW50SWQpKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBtZXNzYWdlOiBpc0xhdGVDYW5jZWxsYXRpb25cclxuICAgICAgICAgID8gJ1BhcnRpY2lwYcOnw6NvIGNhbmNlbGFkYSwgbWFzIGZvaSBlbSBjaW1hIGRhIGhvcmEuJ1xyXG4gICAgICAgICAgOiAnUGFydGljaXBhw6fDo28gY2FuY2VsYWRhLicsXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIGNhbmNlbGFyIHBhcnRpY2lwYcOnw6NvOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDirIbvuI8gSW5jcmVtZW50YSB2YWdhIHF1YW5kbyBhbGd1w6ltIHNhaVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBpbmNyZW1lbnRFdmVudFZhY2FuY3koXHJcbiAgICBldmVudElkOiBzdHJpbmcgfCBudW1iZXIsXHJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGV2ZW50LCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgICAuc2VsZWN0KCd2YWdhcycpXHJcbiAgICAgICAgLmVxKCdpZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGZldGNoRXJyb3IgfHwgIWV2ZW50KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICAgICfinYwgRXJybyBhbyBidXNjYXIgZXZlbnRvIHBhcmEgaW5jcmVtZW50YXIgdmFnYTonLFxyXG4gICAgICAgICAgZmV0Y2hFcnJvcixcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgZXZlbnREYXRhID0gZXZlbnQgYXMgdW5rbm93biBhcyBFdmVudDtcclxuXHJcbiAgICAgIGlmIChcclxuICAgICAgICB0eXBlb2YgZXZlbnREYXRhLnZhZ2FzID09PSAnbnVtYmVyJyAmJlxyXG4gICAgICAgIGV2ZW50RGF0YS52YWdhcyAhPT0gbnVsbCAmJlxyXG4gICAgICAgIGV2ZW50RGF0YS52YWdhcyAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICkge1xyXG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgICAgdmFnYXM6IGV2ZW50RGF0YS52YWdhcyArIDEsXHJcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZCk7XHJcblxyXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gYW8gaW5jcmVtZW50YXIgdmFnYTonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgICAgICBg4pyFIFZhZ2EgaW5jcmVtZW50YWRhLiBWYWdhcyBkaXNwb27DrXZlaXM6ICR7XHJcbiAgICAgICAgICAgICAgZXZlbnREYXRhLnZhZ2FzICsgMVxyXG4gICAgICAgICAgICB9YCxcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFxyXG4gICAgICAgICfinYwgRXJybyBpbmVzcGVyYWRvIGFvIGluY3JlbWVudGFyIHZhZ2EgZG8gZXZlbnRvOicsXHJcbiAgICAgICAgZXJyb3IsXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDwn46vIEFjZWl0YXIgY29udml0ZSDigJxDcnVzaGVy4oCdXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGFjY2VwdENydXNoZXJJbnZpdGUoXHJcbiAgICBwYXJ0aWNpcGF0aW9uSWQ6IHN0cmluZyxcclxuICAgIGV2ZW50SWQ6IHN0cmluZyB8IG51bWJlcixcclxuICAgIHVzZXJJZDogc3RyaW5nLFxyXG4gICk6IFByb21pc2U8U2VydmljZVJlc3VsdD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBldmVudCwgZXJyb3I6IGV2ZW50RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgICAgLnNlbGVjdCgnZXZlbnRfdHlwZSwgdGl0bGUsIGNydXNoZXJfaW52aXRlZF91c2VyX2lkLCBjcmVhdG9yX2lkJylcclxuICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoZXZlbnRFcnJvcikge1xyXG4gICAgICAgIHRocm93IGV2ZW50RXJyb3I7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChldmVudC5ldmVudF90eXBlICE9PSAnY3J1c2hlcicpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0VzdGUgbsOjbyDDqSB1bSBldmVudG8gQ3J1c2hlcicsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGV2ZW50LmNydXNoZXJfaW52aXRlZF91c2VyX2lkICE9PSB1c2VySWQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ1ZvY8OqIG7Do28gZm9pIGNvbnZpZGFkbyBwYXJhIGVzdGUgZXZlbnRvJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfcGFydGljaXBhbnRzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHN0YXR1czogJ2Fwcm92YWRvJyxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCBwYXJ0aWNpcGF0aW9uSWQpXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIHRocm93IHVwZGF0ZUVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmNyZWF0ZUZvclVzZXIoe1xyXG4gICAgICAgIHRhcmdldF91c2VyX2lkOiBldmVudC5jcmVhdG9yX2lkLFxyXG4gICAgICAgIHRhcmdldF9ldmVudF9pZDogdG9OdW1iZXIoZXZlbnRJZCksXHJcbiAgICAgICAgbm90aWZpY2F0aW9uX3R5cGU6ICdjcnVzaGVyX2FjY2VwdGVkJyxcclxuICAgICAgICB0aXRsZTogJ/CfkpwgQ29udml0ZSBDcnVzaGVyIEFjZWl0byEnLFxyXG4gICAgICAgIG1lc3NhZ2U6IGBTZXUgY29udml0ZSBwYXJhIFwiJHtldmVudC50aXRsZX1cIiBmb2kgYWNlaXRvIWAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdDb252aXRlIGFjZWl0byEnLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBhY2VpdGFyIGNvbnZpdGUgQ3J1c2hlcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog8J+OryBSZWplaXRhciBjb252aXRlIOKAnENydXNoZXLigJ1cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgcmVqZWN0Q3J1c2hlckludml0ZShcclxuICAgIHBhcnRpY2lwYXRpb25JZDogc3RyaW5nLFxyXG4gICAgZXZlbnRJZDogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgICByZWFzb24gPSAnJyxcclxuICApOiBQcm9taXNlPFNlcnZpY2VSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXZlbnQsIGVycm9yOiBldmVudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2V2ZW50X3R5cGUsIHRpdGxlLCBjcnVzaGVyX2ludml0ZWRfdXNlcl9pZCwgY3JlYXRvcl9pZCcpXHJcbiAgICAgICAgLmVxKCdpZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGV2ZW50RXJyb3IpIHtcclxuICAgICAgICB0aHJvdyBldmVudEVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZXZlbnQuZXZlbnRfdHlwZSAhPT0gJ2NydXNoZXInKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdFc3RlIG7Do28gw6kgdW0gZXZlbnRvIENydXNoZXInLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChldmVudC5jcnVzaGVyX2ludml0ZWRfdXNlcl9pZCAhPT0gdXNlcklkKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6ICdWb2PDqiBuw6NvIGZvaSBjb252aWRhZG8gcGFyYSBlc3RlIGV2ZW50bycsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBzdGF0dXM6ICdyZWplaXRhZG8nLFxyXG4gICAgICAgICAgcmVqZWljYW9fbW90aXZvOiByZWFzb24gfHwgbnVsbCxcclxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCBwYXJ0aWNpcGF0aW9uSWQpXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKTtcclxuXHJcbiAgICAgIGlmICh1cGRhdGVFcnJvcikge1xyXG4gICAgICAgIHRocm93IHVwZGF0ZUVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmNyZWF0ZUZvclVzZXIoe1xyXG4gICAgICAgIHRhcmdldF91c2VyX2lkOiBldmVudC5jcmVhdG9yX2lkLFxyXG4gICAgICAgIHRhcmdldF9ldmVudF9pZDogdG9OdW1iZXIoZXZlbnRJZCksXHJcbiAgICAgICAgbm90aWZpY2F0aW9uX3R5cGU6ICdwYXJ0aWNpcGF0aW9uX3JlamVjdGVkJyxcclxuICAgICAgICB0aXRsZTogJ/CfkpQgQ29udml0ZSBDcnVzaGVyIFJlY3VzYWRvJyxcclxuICAgICAgICBtZXNzYWdlOiBgU2V1IGNvbnZpdGUgcGFyYSBcIiR7ZXZlbnQudGl0bGV9XCIgZm9pIHJlY3VzYWRvLiR7XHJcbiAgICAgICAgICByZWFzb24gPyBgIE1vdGl2bzogJHtyZWFzb259YCA6ICcnXHJcbiAgICAgICAgfWAsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdDb252aXRlIHJlY3VzYWRvJyxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gYW8gcmVqZWl0YXIgY29udml0ZSBDcnVzaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDwn5GAIFZlcmlmaWNhIHNlIHVtIHVzdcOhcmlvIMOpIG8gY29udmlkYWRvIGRvIGV2ZW50byBDcnVzaGVyXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGlzVXNlckNydXNoZXJJbnZpdGVlKFxyXG4gICAgZXZlbnRJZDogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHBhcnRpY2lwYXRpb24sIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudF9wYXJ0aWNpcGFudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2V2ZW50X2lkJylcclxuICAgICAgICAuZXEoJ2V2ZW50X2lkJywgZXZlbnRJZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IgfHwgIXBhcnRpY2lwYXRpb24pIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXZlbnQsIGVycm9yOiBldmVudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2V2ZW50X3R5cGUsIGNydXNoZXJfaW52aXRlZF91c2VyX2lkJylcclxuICAgICAgICAuZXEoJ2lkJywgcGFydGljaXBhdGlvbi5ldmVudF9pZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoZXZlbnRFcnJvcikge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIChcclxuICAgICAgICBldmVudC5ldmVudF90eXBlID09PSAnY3J1c2hlcicgJiZcclxuICAgICAgICBldmVudC5jcnVzaGVyX2ludml0ZWRfdXNlcl9pZCA9PT0gdXNlcklkXHJcbiAgICAgICk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyB2ZXJpZmljYXIgY29udml0ZSBDcnVzaGVyOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog8J+TpSBMaXN0YSBUT0RBUyBhcyBwYXJ0aWNpcGHDp8O1ZXMgZGUgdW0gZXZlbnRvIChwYXJhIGFuZml0cmnDo28pXHJcbiAgICog4pqg77iPIEFRVUkgZXN0YXZhIGRhbmRvIDQwNiBwb3JxdWUgdXNhdmEgaWQ9ZXEuPGV2ZW50bz5cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0RXZlbnRQYXJ0aWNpcGF0aW9ucyhcclxuICAgIGV2ZW50SWQ6IHN0cmluZyB8IG51bWJlcixcclxuICApOiBQcm9taXNlPFNlcnZpY2VSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogcGFydGljaXBhdGlvbnMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudF9wYXJ0aWNpcGFudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoXHJcbiAgICAgICAgICBgXHJcbiAgICAgICAgICBpZCxcclxuICAgICAgICAgIGV2ZW50X2lkLFxyXG4gICAgICAgICAgdXNlcl9pZCxcclxuICAgICAgICAgIHN0YXR1cyxcclxuICAgICAgICAgIHByZXNlbmNhX2NvbmZpcm1hZGEsXHJcbiAgICAgICAgICBjb21fYWNlc3NvLFxyXG4gICAgICAgICAgbWVuc2FnZW1fY2FuZGlkYXR1cmEsXHJcbiAgICAgICAgICBjcmVhdGVkX2F0LFxyXG4gICAgICAgICAgdXNlcjpwcm9maWxlcyFldmVudF9wYXJ0aWNpcGFudHNfdXNlcl9pZF9ma2V5IChcclxuICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lLFxyXG4gICAgICAgICAgICBhdmF0YXJfdXJsLFxyXG4gICAgICAgICAgICByZXB1dGF0aW9uX3N0YXJzXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgYCxcclxuICAgICAgICApXHJcbiAgICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHBhcnRpY2lwYXRpb25zIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIGJ1c2NhciBwYXJ0aWNpcGHDp8O1ZXM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfkaQgUGFydGljaXBhw6fDtWVzIGRlIHVtIHVzdcOhcmlvIGVtIHRvZG9zIG9zIGV2ZW50b3NcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ2V0VXNlclBhcnRpY2lwYXRpb25zKFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgKTogUHJvbWlzZTxTZXJ2aWNlUmVzdWx0PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudF9wYXJ0aWNpcGFudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoXHJcbiAgICAgICAgICBgXHJcbiAgICAgICAgICBpZCxcclxuICAgICAgICAgIGV2ZW50X2lkLFxyXG4gICAgICAgICAgc3RhdHVzLFxyXG4gICAgICAgICAgcHJlc2VuY2FfY29uZmlybWFkYSxcclxuICAgICAgICAgIGF2YWxpYWNhb19mZWl0YSxcclxuICAgICAgICAgIGNvbV9hY2Vzc28sXHJcbiAgICAgICAgICBldmVudHM6ZXZlbnRzIWlubmVyIChcclxuICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICBzdGFydF90aW1lLFxyXG4gICAgICAgICAgICBlbmRfdGltZSxcclxuICAgICAgICAgICAgc3RhdHVzLFxyXG4gICAgICAgICAgICBldmVudF90eXBlXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgYCxcclxuICAgICAgICApXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxyXG4gICAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIGJ1c2NhciBwYXJ0aWNpcGHDp8O1ZXMgZG8gdXN1w6FyaW86JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfk4wgVmVyIGRldGFsaGVzIGRlIHVtYSBwYXJ0aWNpcGHDp8OjbyBlc3BlY8OtZmljYVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBnZXRQYXJ0aWNpcGF0aW9uQnlJZChcclxuICAgIHBhcnRpY2lwYXRpb25JZDogc3RyaW5nLFxyXG4gICk6IFByb21pc2U8U2VydmljZVJlc3VsdD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfcGFydGljaXBhbnRzJylcclxuICAgICAgICAuc2VsZWN0KFxyXG4gICAgICAgICAgYFxyXG4gICAgICAgICAgaWQsXHJcbiAgICAgICAgICBldmVudF9pZCxcclxuICAgICAgICAgIHVzZXJfaWQsXHJcbiAgICAgICAgICBzdGF0dXMsXHJcbiAgICAgICAgICBwcmVzZW5jYV9jb25maXJtYWRhLFxyXG4gICAgICAgICAgY29tX2FjZXNzbyxcclxuICAgICAgICAgIGF2YWxpYWNhb19mZWl0YSxcclxuICAgICAgICAgIGV2ZW50czpldmVudHMhaW5uZXIgKFxyXG4gICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgICAgIHN0YXJ0X3RpbWUsXHJcbiAgICAgICAgICAgIGVuZF90aW1lLFxyXG4gICAgICAgICAgICBzdGF0dXNcclxuICAgICAgICAgICksXHJcbiAgICAgICAgICB1c2VyOnByb2ZpbGVzIWV2ZW50X3BhcnRpY2lwYW50c191c2VyX2lkX2ZrZXkgKFxyXG4gICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgdXNlcm5hbWUsXHJcbiAgICAgICAgICAgIGF2YXRhcl91cmxcclxuICAgICAgICAgIClcclxuICAgICAgICBgLFxyXG4gICAgICAgIClcclxuICAgICAgICAuZXEoJ2lkJywgcGFydGljaXBhdGlvbklkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIGJ1c2NhciBwYXJ0aWNpcGHDp8OjbzonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog4pyFIENvbmZpcm1hIHByZXNlbsOnYVxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBjb25maXJtUHJlc2VuY2UoXHJcbiAgICBwYXJ0aWNpcGF0aW9uSWQ6IHN0cmluZyxcclxuICApOiBQcm9taXNlPFNlcnZpY2VSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBwcmVzZW5jYV9jb25maXJtYWRhOiB0cnVlLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIHBhcnRpY2lwYXRpb25JZCk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBjb25maXJtYXIgcHJlc2Vuw6dhOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDwn5qqIExpYmVyYSBhY2Vzc28gZG8gcGFydGljaXBhbnRlIGRlbnRybyBkbyBldmVudG9cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZ3JhbnRBY2Nlc3MoXHJcbiAgICBwYXJ0aWNpcGF0aW9uSWQ6IHN0cmluZyxcclxuICApOiBQcm9taXNlPFNlcnZpY2VSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBjb21fYWNlc3NvOiB0cnVlLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIHBhcnRpY2lwYXRpb25JZCk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBhbyBsaWJlcmFyIGFjZXNzbzonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog8J+UkCBWYWxpZGEgc2VuaGEgZGUgZW50cmFkYSBkbyBldmVudG9cclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgdmFsaWRhdGVFdmVudEVudHJ5UGFzc3dvcmQoXHJcbiAgICBldmVudElkOiBzdHJpbmcgfCBudW1iZXIsXHJcbiAgICBwYXJ0aWNpcGFudElkOiBzdHJpbmcsXHJcbiAgICBwYXNzd29yZDogc3RyaW5nLFxyXG4gICk6IFByb21pc2U8e1xyXG4gICAgc3VjY2VzczogYm9vbGVhbjtcclxuICAgIGNhbkVudGVyOiBib29sZWFuO1xyXG4gICAgbWVzc2FnZTogc3RyaW5nO1xyXG4gICAgZXJyb3I/OiBzdHJpbmc7XHJcbiAgfT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgYPCflI0gVmFsaWRhbmRvIGVudHJhZGE6IHBhcnRpY2lwYW50ZSAke3BhcnRpY2lwYW50SWR9IG5vIGV2ZW50byAke2V2ZW50SWR9YCxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIDHvuI/ig6MgVmVyaWZpY2FyIHNlIHBhcnRpY2lwYW50ZSBlc3TDoSBhcHJvdmFkb1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHBhcnRpY2lwYXRpb24sIGVycm9yOiBwYXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIHN0YXR1cywgY29tX2FjZXNzbywgcHJlc2VuY2FfY29uZmlybWFkYScpXHJcbiAgICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgcGFydGljaXBhbnRJZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAocGFydEVycm9yIHx8ICFwYXJ0aWNpcGF0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgY2FuRW50ZXI6IGZhbHNlLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ1ZvY8OqIG7Do28gZXN0w6EgaW5zY3JpdG8gbmVzdGUgZXZlbnRvJyxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocGFydGljaXBhdGlvbi5zdGF0dXMgIT09ICdhcHJvdmFkbycpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBjYW5FbnRlcjogZmFsc2UsXHJcbiAgICAgICAgICBtZXNzYWdlOiBgU3VhIGluc2NyacOnw6NvIGVzdMOhIGNvbSBzdGF0dXM6ICR7cGFydGljaXBhdGlvbi5zdGF0dXN9YCxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyAy77iP4oOjIFZhbGlkYXIgYSBzZW5oYSB1c2FuZG8gbyBzZXJ2acOnbyBqw6EgZXhpc3RlbnRlXHJcbiAgICAgIGNvbnN0IHNlY3VyaXR5UmVzdWx0ID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2UudmFsaWRhdGVFbnRyeVBhc3N3b3JkKHtcclxuICAgICAgICBldmVudElkOiB0b051bWJlcihldmVudElkKSwgLy8g4pyFIGFqdXN0YWRvOiBvIHNlcnZpY2UgZXNwZXJhIG51bWJlclxyXG4gICAgICAgIHBhcnRpY2lwYW50SWQsXHJcbiAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCFzZWN1cml0eVJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgY2FuRW50ZXI6IGZhbHNlLFxyXG4gICAgICAgICAgbWVzc2FnZTogc2VjdXJpdHlSZXN1bHQubWVzc2FnZSB8fCAnU2VuaGEgaW52w6FsaWRhLicsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gM++4j+KDoyBTZW5oYSBjb3JyZXRhIOKGkiBtYXJjYXIgcHJlc2Vuw6dhXHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IHByZXNlbmNhRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBwcmVzZW5jYV9jb25maXJtYWRhOiB0cnVlLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgcGFydGljaXBhbnRJZCk7XHJcblxyXG4gICAgICBpZiAocHJlc2VuY2FFcnJvcikge1xyXG4gICAgICAgIHRocm93IHByZXNlbmNhRXJyb3I7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgIGDinIUgUGFydGljaXBhbnRlICR7cGFydGljaXBhbnRJZH0gYWdvcmEgdGVtIGFjZXNzbyBhbyBldmVudG8gJHtldmVudElkfWAsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgY2FuRW50ZXI6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTpcclxuICAgICAgICAgIHNlY3VyaXR5UmVzdWx0Lm1lc3NhZ2UgfHwgJ+KchSBBY2Vzc28gbGliZXJhZG8hIEJlbS12aW5kbyBhbyBldmVudG8uJyxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIHZhbGlkYXIgZW50cmFkYTonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgY2FuRW50ZXI6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdFcnJvIGFvIHByb2Nlc3NhciBzdWEgZW50cmFkYScsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIPCfk4ogRXN0YXTDrXN0aWNhcyBkZSBlbnRyYWRhXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGdldEV2ZW50RW50cnlTdGF0cyhcclxuICAgIGV2ZW50SWQ6IHN0cmluZyB8IG51bWJlcixcclxuICApOiBQcm9taXNlPFNlcnZpY2VSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogcGFydGljaXBhbnRzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfcGFydGljaXBhbnRzJylcclxuICAgICAgICAuc2VsZWN0KCdpZCwgY29tX2FjZXNzbycpXHJcbiAgICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHRvdGFsID0gcGFydGljaXBhbnRzLmxlbmd0aDtcclxuICAgICAgY29uc3Qgd2l0aEFjY2VzcyA9IHBhcnRpY2lwYW50cy5maWx0ZXIocCA9PiBwLmNvbV9hY2Vzc28pLmxlbmd0aDtcclxuICAgICAgY29uc3Qgd2l0aG91dEFjY2VzcyA9IHRvdGFsIC0gd2l0aEFjY2VzcztcclxuICAgICAgY29uc3QgcGVyY2VudGFnZSA9IHRvdGFsID4gMCA/ICh3aXRoQWNjZXNzIC8gdG90YWwpICogMTAwIDogMDtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICB0b3RhbFBhcnRpY2lwYW50czogdG90YWwsXHJcbiAgICAgICAgICBwYXJ0aWNpcGFudHNXaXRoQWNjZXNzOiB3aXRoQWNjZXNzLFxyXG4gICAgICAgICAgcGFydGljaXBhbnRzV2l0aG91dEFjY2Vzczogd2l0aG91dEFjY2VzcyxcclxuICAgICAgICAgIGFjY2Vzc1BlcmNlbnRhZ2U6IHBlcmNlbnRhZ2UsXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIG9idGVyIHN0YXRzIGRlIGVudHJhZGE6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDwn5SSIHZlcmlmaWNhIHNlIG8gdXN1w6FyaW8gcG9kZSBjcmlhciBtYWlzIGV2ZW50b3MgKHJlZ3JhIGV4dHJhIHN1YSlcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgY2FuVXNlckNyZWF0ZUV2ZW50KFxyXG4gICAgdXNlcklkOiBzdHJpbmcsXHJcbiAgKTogUHJvbWlzZTxTZXJ2aWNlUmVzdWx0PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xyXG5cclxuICAgICAgLy8gZXZlbnRvcyBob2plXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogdG9kYXlFdmVudHMsIGVycm9yOiB0b2RheUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudHMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuZXEoJ2NyZWF0b3JfaWQnLCB1c2VySWQpXHJcbiAgICAgICAgLmd0ZSgnc3RhcnRfdGltZScsIGAke3RvZGF5fVQwMDowMDowMGApXHJcbiAgICAgICAgLmx0ZSgnc3RhcnRfdGltZScsIGAke3RvZGF5fVQyMzo1OTo1OWApO1xyXG5cclxuICAgICAgaWYgKHRvZGF5RXJyb3IpIHtcclxuICAgICAgICB0aHJvdyB0b2RheUVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodG9kYXlFdmVudHMgJiYgdG9kYXlFdmVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiAnVm9jw6ogasOhIHRlbSB1bSBldmVudG8gaG9qZS4nLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGV2ZW50b3MgbsOjbyBjb25jbHXDrWRvc1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHVuZmluaXNoZWQsIGVycm9yOiB1bmZpbmlzaGVkRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIHRpdGxlJylcclxuICAgICAgICAuZXEoJ2NyZWF0b3JfaWQnLCB1c2VySWQpXHJcbiAgICAgICAgLmluKCdzdGF0dXMnLCBbXHJcbiAgICAgICAgICAnQWJlcnRvJyxcclxuICAgICAgICAgICdDb25maXJtYWRvJyxcclxuICAgICAgICAgICdFbSBBbmRhbWVudG8nLFxyXG4gICAgICAgICAgJ0ZpbmFsaXphZG8nLFxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgaWYgKHVuZmluaXNoZWRFcnJvcikge1xyXG4gICAgICAgIHRocm93IHVuZmluaXNoZWRFcnJvcjtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHVuZmluaXNoZWQgJiYgdW5maW5pc2hlZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6XHJcbiAgICAgICAgICAgICdWb2PDqiB0ZW0gZXZlbnRvcyBlbSBhYmVydG8uIENvbmNsdWEgb3UgY2FuY2VsZSBhbnRlcyBkZSBjcmlhciBvdXRyby4nLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICAn4p2MIEVycm8gYW8gdmVyaWZpY2FyIHNlIHVzdcOhcmlvIHBvZGUgY3JpYXIgZXZlbnRvOicsXHJcbiAgICAgICAgZXJyb3IsXHJcbiAgICAgICk7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUGFydGljaXBhdGlvblNlcnZpY2U7XHJcblxyXG4iXSwidmVyc2lvbiI6M30=