446e0d72505bdf12b3e8774f95762fd3
"use strict";
// src/services/PartnerEventService.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => ({
    supabase: {
        from: mockFrom,
        rpc: mockRpc,
    }
}));
jest.mock('./NotificationService', () => ({
    default: {
        notifyParticipationApproved: mockNotifyApproved,
        notifyParticipationRejected: mockNotifyRejected,
    },
}));
// --- 1. MOCKING DEPENDÊNCIAS (ANTES DAS IMPORTAÇÕES) ---
// Mock do Supabase
const mockFrom = jest.fn();
const mockRpc = jest.fn();
// Mock do NotificationService (default export)
const mockNotifyApproved = jest.fn(() => Promise.resolve({ success: true }));
const mockNotifyRejected = jest.fn(() => Promise.resolve({ success: true }));
const PartnerEventService_1 = tslib_1.__importDefault(require("./PartnerEventService"));
// --- 3. CONFIGURAÇÃO DOS TESTES ---
describe('PartnerEventService', () => {
    // Limpa todos os mocks antes de cada teste
    beforeEach(() => {
        jest.clearAllMocks();
        jest.useFakeTimers();
    });
    afterEach(() => {
        jest.useRealTimers();
    });
    // --- 4. TESTES DOS MÉTODOS ---
    describe('calculateEventStatus (Lógica Pura)', () => {
        const now = new Date('2025-10-10T10:00:00Z');
        beforeEach(() => {
            jest.setSystemTime(now);
        });
        const baseEvent = {
            id: '1',
            status: 'Aberto',
            start_time: '2025-10-10T12:00:00Z', // Em 2 horas
            end_time: '2025-10-10T14:00:00Z',
            vagas: 5,
        };
        it('deve manter Cancelado se já estiver Cancelado', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, status: 'Cancelado' }, now);
            expect(status).toBe('Cancelado');
        });
        it('deve manter Concluído se já estiver Concluído', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, status: 'Concluído' }, now);
            expect(status).toBe('Concluído');
        });
        it('deve ser Finalizado se o tempo de término já passou', () => {
            const pastEvent = { ...baseEvent, end_time: '2025-10-10T09:00:00Z' }; // Terminou 1h atrás
            const status = PartnerEventService_1.default.calculateEventStatus(pastEvent, now);
            expect(status).toBe('Finalizado');
        });
        it('deve ser Em Andamento se estiver dentro do horário', () => {
            const currentEvent = { ...baseEvent, start_time: '2025-10-10T09:00:00Z' }; // Começou 1h atrás
            const status = PartnerEventService_1.default.calculateEventStatus(currentEvent, now);
            expect(status).toBe('Em Andamento');
        });
        it('deve manter Confirmado se foi confirmado manually, mesmo com vagas', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, status: 'Confirmado' }, now);
            expect(status).toBe('Confirmado');
        });
        it('deve ser Confirmado se as vagas acabaram (vagas <= 0)', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, vagas: 0 }, now);
            expect(status).toBe('Confirmado');
        });
        it('deve ser Aberto se faltar mais de 5 minutos e tiver vagas', () => {
            const status = PartnerEventService_1.default.calculateEventStatus(baseEvent, now);
            expect(status).toBe('Aberto');
        });
        it('deve ser Confirmado se faltar menos de 5 minutos (e não estiver cheio)', () => {
            const closeEvent = { ...baseEvent, start_time: '2025-10-10T10:04:00Z' }; // Começa em 4 min
            const status = PartnerEventService_1.default.calculateEventStatus(closeEvent, now);
            expect(status).toBe('Confirmado');
        });
    });
    describe('confirmEvent', () => {
        it('deve chamar update com status Confirmado', async () => {
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                update: mockUpdate,
            });
            await PartnerEventService_1.default.confirmEvent('evt-123');
            expect(mockFrom).toHaveBeenCalledWith('events');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'Confirmado' }));
            expect(mockEq).toHaveBeenCalledWith('id', 'evt-123');
        });
    });
    describe('cancelEvent', () => {
        it('deve chamar update com status Cancelado e motivo', async () => {
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                update: mockUpdate,
            });
            await PartnerEventService_1.default.cancelEvent('evt-123', 'Motivo Teste');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({
                status: 'Cancelado',
                cancelamento_motivo: 'Motivo Teste',
            }));
            expect(mockEq).toHaveBeenCalledWith('id', 'evt-123');
        });
    });
    describe('getEventStats', () => {
        it('deve buscar e agregar estatísticas do evento', async () => {
            const mockEvent = { id: 'evt-1', title: 'Evento' };
            const mockParticipations = [
                { status: 'aprovado', presenca_confirmada: true, avaliacao_feita: true },
                { status: 'aprovado', presenca_confirmada: true, avaliacao_feita: false },
                { status: 'aprovado', presenca_confirmada: false, avaliacao_feita: false },
                { status: 'pendente', presenca_confirmada: false, avaliacao_feita: false },
            ];
            // Mock 1: SELECT do evento
            const mockSingle = jest.fn().mockResolvedValue({ data: mockEvent, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect1 = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: SELECT de participações
            const mockEq2 = jest.fn().mockResolvedValue({ data: mockParticipations, error: null });
            const mockSelect2 = jest.fn().mockReturnValue({ eq: mockEq2 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect1 }) // primeira chamada: evento
                .mockReturnValueOnce({ select: mockSelect2 }); // segunda chamada: participações
            const result = await PartnerEventService_1.default.getEventStats('evt-1');
            expect(result.success).toBe(true);
            expect(result.data?.event).toEqual(mockEvent);
            expect(result.data?.totalCandidaturas).toBe(4);
            expect(result.data?.aprovados).toBe(3);
            expect(result.data?.presentes).toBe(2);
            expect(result.data?.avaliacoes).toBe(1);
        });
    });
    describe('approveParticipation', () => {
        it('deve aprovar, decrementar vagas e notificar o usuário', async () => {
            const mockEvent = { vagas: 5, title: 'Evento Teste' };
            const mockParticipation = { user_id: 'user-abc' };
            // Mock 1: SELECT evento
            const mockSingle1 = jest.fn().mockResolvedValue({ data: mockEvent, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle1 });
            const mockSelect1 = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: SELECT participação
            const mockSingle2 = jest.fn().mockResolvedValue({ data: mockParticipation, error: null });
            const mockEq2 = jest.fn().mockReturnValue({ single: mockSingle2 });
            const mockSelect2 = jest.fn().mockReturnValue({ eq: mockEq2 });
            // Mock 3: UPDATE participação
            const mockEq3 = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq3 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect1 }) // buscar evento
                .mockReturnValueOnce({ select: mockSelect2 }) // buscar participação
                .mockReturnValueOnce({ update: mockUpdate }); // atualizar participação
            // Mock RPC decremento
            mockRpc.mockResolvedValue({ error: null });
            const result = await PartnerEventService_1.default.approveParticipation('part-123', '456');
            expect(result.success).toBe(true);
            // Verifica se a participação foi atualizada
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'aprovado' }));
            // Verifica se o RPC foi chamado
            expect(mockRpc).toHaveBeenCalledWith('decrement_event_vacancy', { event_id: '456' });
            // Verifica se a notificação foi enviada
            expect(mockNotifyApproved).toHaveBeenCalledWith('user-abc', 456, // O código faz parseInt()
            'Evento Teste');
        });
        it('deve falhar se não houver vagas', async () => {
            const mockEvent = { vagas: 0, title: 'Evento Lotado' };
            // Mock SELECT evento (lotado)
            const mockSingle = jest.fn().mockResolvedValue({ data: mockEvent, error: null });
            const mockEq = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({ select: mockSelect });
            const result = await PartnerEventService_1.default.approveParticipation('part-123', '456');
            expect(result.success).toBe(false);
            expect(result.error).toBe('Sem vagas disponíveis');
            // Garante que não tentou fazer nada depois
            expect(mockRpc).not.toHaveBeenCalled();
            expect(mockNotifyApproved).not.toHaveBeenCalled();
        });
    });
    describe('rejectParticipation', () => {
        it('deve rejeitar e notificar o usuário com motivo', async () => {
            const mockParticipation = {
                user_id: 'user-abc',
                event_id: 789,
                events: { title: 'Evento Rejeitado' },
            };
            // Mock 1: SELECT participação (com inner join)
            const mockSingle = jest.fn().mockResolvedValue({ data: mockParticipation, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: UPDATE participação
            const mockEq2 = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq2 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect }) // buscar participação
                .mockReturnValueOnce({ update: mockUpdate }); // atualizar participação
            const reason = 'Não se encaixa no perfil';
            const result = await PartnerEventService_1.default.rejectParticipation('part-123', reason);
            expect(result.success).toBe(true);
            // Verifica se o status foi atualizado com o motivo
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({
                status: 'rejeitado',
                motivo_rejeicao: reason,
            }));
            // Verifica se a notificação foi enviada
            expect(mockNotifyRejected).toHaveBeenCalledWith('user-abc', 789, 'Evento Rejeitado', reason);
        });
    });
    describe('getEventParticipations', () => {
        it('deve buscar participações com dados do usuário', async () => {
            const mockParticipations = [{ id: 'part-1', user: { username: 'Test' } }];
            const mockOrder = jest.fn().mockResolvedValue({ data: mockParticipations, error: null });
            const mockEq = jest.fn().mockReturnValue({ order: mockOrder });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                select: mockSelect,
            });
            const result = await PartnerEventService_1.default.getEventParticipations('evt-1');
            expect(mockFrom).toHaveBeenCalledWith('event_participants');
            expect(mockSelect).toHaveBeenCalledWith('*, user:profiles!event_participants_user_id_fkey(*)');
            expect(result.success).toBe(true);
            expect(result.data).toEqual(mockParticipations);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcUGFydG5lckV2ZW50U2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQSwyQ0FBMkM7OztBQVEzQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEMsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFLFFBQVE7UUFDZCxHQUFHLEVBQUUsT0FBTztLQUNiO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFNSixJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEMsT0FBTyxFQUFFO1FBQ1AsMkJBQTJCLEVBQUUsa0JBQWtCO1FBQy9DLDJCQUEyQixFQUFFLGtCQUFrQjtLQUNoRDtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBdEJKLDBEQUEwRDtBQUUxRCxtQkFBbUI7QUFDbkIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQzNCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQVMxQiwrQ0FBK0M7QUFDL0MsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzdFLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztBQWE3RSx3RkFBd0Q7QUFFeEQscUNBQXFDO0FBRXJDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFFbkMsMkNBQTJDO0lBQzNDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFD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Q0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQzVELE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxvQkFBb0IsQ0FDckMscURBQXFELENBQ3RELENBQUM7WUFDRixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXHNlcnZpY2VzXFxQYXJ0bmVyRXZlbnRTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL1BhcnRuZXJFdmVudFNlcnZpY2UudGVzdC50c1xyXG5cclxuLy8gLS0tIDEuIE1PQ0tJTkcgREVQRU5Ew4pOQ0lBUyAoQU5URVMgREFTIElNUE9SVEHDh8OVRVMpIC0tLVxyXG5cclxuLy8gTW9jayBkbyBTdXBhYmFzZVxyXG5jb25zdCBtb2NrRnJvbSA9IGplc3QuZm4oKTtcclxuY29uc3QgbW9ja1JwYyA9IGplc3QuZm4oKTtcclxuXHJcbmplc3QubW9jaygnLi4vbGliL3N1cGFiYXNlQ2xpZW50JywgKCkgPT4gKHtcclxuICBzdXBhYmFzZToge1xyXG4gICAgZnJvbTogbW9ja0Zyb20sXHJcbiAgICBycGM6IG1vY2tScGMsXHJcbiAgfVxyXG59KSk7XHJcblxyXG4vLyBNb2NrIGRvIE5vdGlmaWNhdGlvblNlcnZpY2UgKGRlZmF1bHQgZXhwb3J0KVxyXG5jb25zdCBtb2NrTm90aWZ5QXBwcm92ZWQgPSBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUgfSkpO1xyXG5jb25zdCBtb2NrTm90aWZ5UmVqZWN0ZWQgPSBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUgfSkpO1xyXG5cclxuamVzdC5tb2NrKCcuL05vdGlmaWNhdGlvblNlcnZpY2UnLCAoKSA9PiAoe1xyXG4gIGRlZmF1bHQ6IHtcclxuICAgIG5vdGlmeVBhcnRpY2lwYXRpb25BcHByb3ZlZDogbW9ja05vdGlmeUFwcHJvdmVkLFxyXG4gICAgbm90aWZ5UGFydGljaXBhdGlvblJlamVjdGVkOiBtb2NrTm90aWZ5UmVqZWN0ZWQsXHJcbiAgfSxcclxufSkpO1xyXG5cclxuLy8gLS0tIDIuIElNUE9SVEHDh8OVRVMgKERFUE9JUyBET1MgTU9DS1MpIC0tLVxyXG5cclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9saWIvc3VwYWJhc2VDbGllbnQnO1xyXG5pbXBvcnQgTm90aWZpY2F0aW9uU2VydmljZSBmcm9tICcuL05vdGlmaWNhdGlvblNlcnZpY2UnO1xyXG5pbXBvcnQgUGFydG5lckV2ZW50U2VydmljZSBmcm9tICcuL1BhcnRuZXJFdmVudFNlcnZpY2UnO1xyXG5cclxuLy8gLS0tIDMuIENPTkZJR1VSQcOHw4NPIERPUyBURVNURVMgLS0tXHJcblxyXG5kZXNjcmliZSgnUGFydG5lckV2ZW50U2VydmljZScsICgpID0+IHtcclxuXHJcbiAgLy8gTGltcGEgdG9kb3Mgb3MgbW9ja3MgYW50ZXMgZGUgY2FkYSB0ZXN0ZVxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIGplc3QudXNlUmVhbFRpbWVycygpO1xyXG4gIH0pO1xyXG5cclxuICAvLyAtLS0gNC4gVEVTVEVTIERPUyBNw4lUT0RPUyAtLS1cclxuXHJcbiAgZGVzY3JpYmUoJ2NhbGN1bGF0ZUV2ZW50U3RhdHVzIChMw7NnaWNhIFB1cmEpJywgKCkgPT4ge1xyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoJzIwMjUtMTAtMTBUMTA6MDA6MDBaJyk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIGplc3Quc2V0U3lzdGVtVGltZShub3cpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgYmFzZUV2ZW50ID0ge1xyXG4gICAgICBpZDogJzEnLFxyXG4gICAgICBzdGF0dXM6ICdBYmVydG8nIGFzIGNvbnN0LFxyXG4gICAgICBzdGFydF90aW1lOiAnMjAyNS0xMC0xMFQxMjowMDowMFonLCAvLyBFbSAyIGhvcmFzXHJcbiAgICAgIGVuZF90aW1lOiAnMjAyNS0xMC0xMFQxNDowMDowMFonLFxyXG4gICAgICB2YWdhczogNSxcclxuICAgIH07XHJcblxyXG4gICAgaXQoJ2RldmUgbWFudGVyIENhbmNlbGFkbyBzZSBqw6EgZXN0aXZlciBDYW5jZWxhZG8nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN0YXR1cyA9IFBhcnRuZXJFdmVudFNlcnZpY2UuY2FsY3VsYXRlRXZlbnRTdGF0dXMoeyAuLi5iYXNlRXZlbnQsIHN0YXR1czogJ0NhbmNlbGFkbycgfSwgbm93KTtcclxuICAgICAgZXhwZWN0KHN0YXR1cykudG9CZSgnQ2FuY2VsYWRvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBtYW50ZXIgQ29uY2x1w61kbyBzZSBqw6EgZXN0aXZlciBDb25jbHXDrWRvJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmNhbGN1bGF0ZUV2ZW50U3RhdHVzKHsgLi4uYmFzZUV2ZW50LCBzdGF0dXM6ICdDb25jbHXDrWRvJyB9LCBub3cpO1xyXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0JlKCdDb25jbHXDrWRvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBzZXIgRmluYWxpemFkbyBzZSBvIHRlbXBvIGRlIHTDqXJtaW5vIGrDoSBwYXNzb3UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhc3RFdmVudCA9IHsgLi4uYmFzZUV2ZW50LCBlbmRfdGltZTogJzIwMjUtMTAtMTBUMDk6MDA6MDBaJyB9OyAvLyBUZXJtaW5vdSAxaCBhdHLDoXNcclxuICAgICAgY29uc3Qgc3RhdHVzID0gUGFydG5lckV2ZW50U2VydmljZS5jYWxjdWxhdGVFdmVudFN0YXR1cyhwYXN0RXZlbnQsIG5vdyk7XHJcbiAgICAgIGV4cGVjdChzdGF0dXMpLnRvQmUoJ0ZpbmFsaXphZG8nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIHNlciBFbSBBbmRhbWVudG8gc2UgZXN0aXZlciBkZW50cm8gZG8gaG9yw6FyaW8nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9IHsgLi4uYmFzZUV2ZW50LCBzdGFydF90aW1lOiAnMjAyNS0xMC0xMFQwOTowMDowMFonIH07IC8vIENvbWXDp291IDFoIGF0csOhc1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmNhbGN1bGF0ZUV2ZW50U3RhdHVzKGN1cnJlbnRFdmVudCwgbm93KTtcclxuICAgICAgZXhwZWN0KHN0YXR1cykudG9CZSgnRW0gQW5kYW1lbnRvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBtYW50ZXIgQ29uZmlybWFkbyBzZSBmb2kgY29uZmlybWFkbyBtYW51YWxseSwgbWVzbW8gY29tIHZhZ2FzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmNhbGN1bGF0ZUV2ZW50U3RhdHVzKHsgLi4uYmFzZUV2ZW50LCBzdGF0dXM6ICdDb25maXJtYWRvJyB9LCBub3cpO1xyXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0JlKCdDb25maXJtYWRvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBzZXIgQ29uZmlybWFkbyBzZSBhcyB2YWdhcyBhY2FiYXJhbSAodmFnYXMgPD0gMCknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN0YXR1cyA9IFBhcnRuZXJFdmVudFNlcnZpY2UuY2FsY3VsYXRlRXZlbnRTdGF0dXMoeyAuLi5iYXNlRXZlbnQsIHZhZ2FzOiAwIH0sIG5vdyk7XHJcbiAgICAgIGV4cGVjdChzdGF0dXMpLnRvQmUoJ0NvbmZpcm1hZG8nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIHNlciBBYmVydG8gc2UgZmFsdGFyIG1haXMgZGUgNSBtaW51dG9zIGUgdGl2ZXIgdmFnYXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN0YXR1cyA9IFBhcnRuZXJFdmVudFNlcnZpY2UuY2FsY3VsYXRlRXZlbnRTdGF0dXMoYmFzZUV2ZW50LCBub3cpO1xyXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0JlKCdBYmVydG8nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIHNlciBDb25maXJtYWRvIHNlIGZhbHRhciBtZW5vcyBkZSA1IG1pbnV0b3MgKGUgbsOjbyBlc3RpdmVyIGNoZWlvKScsICgpID0+IHtcclxuICAgICAgY29uc3QgY2xvc2VFdmVudCA9IHsgLi4uYmFzZUV2ZW50LCBzdGFydF90aW1lOiAnMjAyNS0xMC0xMFQxMDowNDowMFonIH07IC8vIENvbWXDp2EgZW0gNCBtaW5cclxuICAgICAgY29uc3Qgc3RhdHVzID0gUGFydG5lckV2ZW50U2VydmljZS5jYWxjdWxhdGVFdmVudFN0YXR1cyhjbG9zZUV2ZW50LCBub3cpO1xyXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0JlKCdDb25maXJtYWRvJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NvbmZpcm1FdmVudCcsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIGNoYW1hciB1cGRhdGUgY29tIHN0YXR1cyBDb25maXJtYWRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0Zyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1cGRhdGU6IG1vY2tVcGRhdGUsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgYXdhaXQgUGFydG5lckV2ZW50U2VydmljZS5jb25maXJtRXZlbnQoJ2V2dC0xMjMnKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrRnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50cycpO1xyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBzdGF0dXM6ICdDb25maXJtYWRvJyB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QobW9ja0VxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaWQnLCAnZXZ0LTEyMycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjYW5jZWxFdmVudCcsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIGNoYW1hciB1cGRhdGUgY29tIHN0YXR1cyBDYW5jZWxhZG8gZSBtb3Rpdm8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEgfSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrRnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVwZGF0ZTogbW9ja1VwZGF0ZSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBhd2FpdCBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmNhbmNlbEV2ZW50KCdldnQtMTIzJywgJ01vdGl2byBUZXN0ZScpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIHN0YXR1czogJ0NhbmNlbGFkbycsXHJcbiAgICAgICAgICBjYW5jZWxhbWVudG9fbW90aXZvOiAnTW90aXZvIFRlc3RlJyxcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QobW9ja0VxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaWQnLCAnZXZ0LTEyMycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRFdmVudFN0YXRzJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgYnVzY2FyIGUgYWdyZWdhciBlc3RhdMOtc3RpY2FzIGRvIGV2ZW50bycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0V2ZW50ID0geyBpZDogJ2V2dC0xJywgdGl0bGU6ICdFdmVudG8nIH07XHJcbiAgICAgIGNvbnN0IG1vY2tQYXJ0aWNpcGF0aW9ucyA9IFtcclxuICAgICAgICB7IHN0YXR1czogJ2Fwcm92YWRvJywgcHJlc2VuY2FfY29uZmlybWFkYTogdHJ1ZSwgYXZhbGlhY2FvX2ZlaXRhOiB0cnVlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6ICdhcHJvdmFkbycsIHByZXNlbmNhX2NvbmZpcm1hZGE6IHRydWUsIGF2YWxpYWNhb19mZWl0YTogZmFsc2UgfSxcclxuICAgICAgICB7IHN0YXR1czogJ2Fwcm92YWRvJywgcHJlc2VuY2FfY29uZmlybWFkYTogZmFsc2UsIGF2YWxpYWNhb19mZWl0YTogZmFsc2UgfSxcclxuICAgICAgICB7IHN0YXR1czogJ3BlbmRlbnRlJywgcHJlc2VuY2FfY29uZmlybWFkYTogZmFsc2UsIGF2YWxpYWNhb19mZWl0YTogZmFsc2UgfSxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIC8vIE1vY2sgMTogU0VMRUNUIGRvIGV2ZW50b1xyXG4gICAgICBjb25zdCBtb2NrU2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja0V2ZW50LCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxMSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzaW5nbGU6IG1vY2tTaW5nbGUgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QxID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXExIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayAyOiBTRUxFQ1QgZGUgcGFydGljaXBhw6fDtWVzXHJcbiAgICAgIGNvbnN0IG1vY2tFcTIgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrUGFydGljaXBhdGlvbnMsIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0MiA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMiB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyBzZWxlY3Q6IG1vY2tTZWxlY3QxIH0pICAvLyBwcmltZWlyYSBjaGFtYWRhOiBldmVudG9cclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7IHNlbGVjdDogbW9ja1NlbGVjdDIgfSk7IC8vIHNlZ3VuZGEgY2hhbWFkYTogcGFydGljaXBhw6fDtWVzXHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmdldEV2ZW50U3RhdHMoJ2V2dC0xJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8uZXZlbnQpLnRvRXF1YWwobW9ja0V2ZW50KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy50b3RhbENhbmRpZGF0dXJhcykudG9CZSg0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy5hcHJvdmFkb3MpLnRvQmUoMyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8ucHJlc2VudGVzKS50b0JlKDIpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LmF2YWxpYWNvZXMpLnRvQmUoMSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2FwcHJvdmVQYXJ0aWNpcGF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgYXByb3ZhciwgZGVjcmVtZW50YXIgdmFnYXMgZSBub3RpZmljYXIgbyB1c3XDoXJpbycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0V2ZW50ID0geyB2YWdhczogNSwgdGl0bGU6ICdFdmVudG8gVGVzdGUnIH07XHJcbiAgICAgIGNvbnN0IG1vY2tQYXJ0aWNpcGF0aW9uID0geyB1c2VyX2lkOiAndXNlci1hYmMnIH07XHJcblxyXG4gICAgICAvLyBNb2NrIDE6IFNFTEVDVCBldmVudG9cclxuICAgICAgY29uc3QgbW9ja1NpbmdsZTEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrRXZlbnQsIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXExID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHNpbmdsZTogbW9ja1NpbmdsZTEgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QxID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXExIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayAyOiBTRUxFQ1QgcGFydGljaXBhw6fDo29cclxuICAgICAgY29uc3QgbW9ja1NpbmdsZTIgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrUGFydGljaXBhdGlvbiwgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tFcTIgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgc2luZ2xlOiBtb2NrU2luZ2xlMiB9KTtcclxuICAgICAgY29uc3QgbW9ja1NlbGVjdDIgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcTIgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIDM6IFVQREFURSBwYXJ0aWNpcGHDp8Ojb1xyXG4gICAgICBjb25zdCBtb2NrRXEzID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcTMgfSk7XHJcblxyXG4gICAgICBtb2NrRnJvbVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHsgc2VsZWN0OiBtb2NrU2VsZWN0MSB9KSAvLyBidXNjYXIgZXZlbnRvXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyBzZWxlY3Q6IG1vY2tTZWxlY3QyIH0pIC8vIGJ1c2NhciBwYXJ0aWNpcGHDp8Ojb1xyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHsgdXBkYXRlOiBtb2NrVXBkYXRlIH0pOyAgLy8gYXR1YWxpemFyIHBhcnRpY2lwYcOnw6NvXHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIFJQQyBkZWNyZW1lbnRvXHJcbiAgICAgIG1vY2tScGMubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBhcnRuZXJFdmVudFNlcnZpY2UuYXBwcm92ZVBhcnRpY2lwYXRpb24oJ3BhcnQtMTIzJywgJzQ1NicpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgYSBwYXJ0aWNpcGHDp8OjbyBmb2kgYXR1YWxpemFkYVxyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBzdGF0dXM6ICdhcHJvdmFkbycgfSlcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gUlBDIGZvaSBjaGFtYWRvXHJcbiAgICAgIGV4cGVjdChtb2NrUnBjKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZGVjcmVtZW50X2V2ZW50X3ZhY2FuY3knLCB7IGV2ZW50X2lkOiAnNDU2JyB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIGEgbm90aWZpY2HDp8OjbyBmb2kgZW52aWFkYVxyXG4gICAgICBleHBlY3QobW9ja05vdGlmeUFwcHJvdmVkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAndXNlci1hYmMnLFxyXG4gICAgICAgIDQ1NiwgLy8gTyBjw7NkaWdvIGZheiBwYXJzZUludCgpXHJcbiAgICAgICAgJ0V2ZW50byBUZXN0ZSdcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIGZhbGhhciBzZSBuw6NvIGhvdXZlciB2YWdhcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0V2ZW50ID0geyB2YWdhczogMCwgdGl0bGU6ICdFdmVudG8gTG90YWRvJyB9O1xyXG5cclxuICAgICAgLy8gTW9jayBTRUxFQ1QgZXZlbnRvIChsb3RhZG8pXHJcbiAgICAgIGNvbnN0IG1vY2tTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrRXZlbnQsIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgc2luZ2xlOiBtb2NrU2luZ2xlIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEgfSk7XHJcblxyXG4gICAgICBtb2NrRnJvbS5tb2NrUmV0dXJuVmFsdWUoeyBzZWxlY3Q6IG1vY2tTZWxlY3QgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmFwcHJvdmVQYXJ0aWNpcGF0aW9uKCdwYXJ0LTEyMycsICc0NTYnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ1NlbSB2YWdhcyBkaXNwb27DrXZlaXMnKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdhcmFudGUgcXVlIG7Do28gdGVudG91IGZhemVyIG5hZGEgZGVwb2lzXHJcbiAgICAgIGV4cGVjdChtb2NrUnBjKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QobW9ja05vdGlmeUFwcHJvdmVkKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZWplY3RQYXJ0aWNpcGF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgZSBub3RpZmljYXIgbyB1c3XDoXJpbyBjb20gbW90aXZvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUGFydGljaXBhdGlvbiA9IHtcclxuICAgICAgICB1c2VyX2lkOiAndXNlci1hYmMnLFxyXG4gICAgICAgIGV2ZW50X2lkOiA3ODksXHJcbiAgICAgICAgZXZlbnRzOiB7IHRpdGxlOiAnRXZlbnRvIFJlamVpdGFkbycgfSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIE1vY2sgMTogU0VMRUNUIHBhcnRpY2lwYcOnw6NvIChjb20gaW5uZXIgam9pbilcclxuICAgICAgY29uc3QgbW9ja1NpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tQYXJ0aWNpcGF0aW9uLCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxMSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzaW5nbGU6IG1vY2tTaW5nbGUgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcTEgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIDI6IFVQREFURSBwYXJ0aWNpcGHDp8Ojb1xyXG4gICAgICBjb25zdCBtb2NrRXEyID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcTIgfSk7XHJcblxyXG4gICAgICBtb2NrRnJvbVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHsgc2VsZWN0OiBtb2NrU2VsZWN0IH0pIC8vIGJ1c2NhciBwYXJ0aWNpcGHDp8Ojb1xyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHsgdXBkYXRlOiBtb2NrVXBkYXRlIH0pOyAvLyBhdHVhbGl6YXIgcGFydGljaXBhw6fDo29cclxuXHJcbiAgICAgIGNvbnN0IHJlYXNvbiA9ICdOw6NvIHNlIGVuY2FpeGEgbm8gcGVyZmlsJztcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUGFydG5lckV2ZW50U2VydmljZS5yZWplY3RQYXJ0aWNpcGF0aW9uKCdwYXJ0LTEyMycsIHJlYXNvbik7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIHN0YXR1cyBmb2kgYXR1YWxpemFkbyBjb20gbyBtb3Rpdm9cclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIHN0YXR1czogJ3JlamVpdGFkbycsXHJcbiAgICAgICAgICBtb3Rpdm9fcmVqZWljYW86IHJlYXNvbixcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgYSBub3RpZmljYcOnw6NvIGZvaSBlbnZpYWRhXHJcbiAgICAgIGV4cGVjdChtb2NrTm90aWZ5UmVqZWN0ZWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICd1c2VyLWFiYycsXHJcbiAgICAgICAgNzg5LFxyXG4gICAgICAgICdFdmVudG8gUmVqZWl0YWRvJyxcclxuICAgICAgICByZWFzb25cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0RXZlbnRQYXJ0aWNpcGF0aW9ucycsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIGJ1c2NhciBwYXJ0aWNpcGHDp8O1ZXMgY29tIGRhZG9zIGRvIHVzdcOhcmlvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUGFydGljaXBhdGlvbnMgPSBbeyBpZDogJ3BhcnQtMScsIHVzZXI6IHsgdXNlcm5hbWU6ICdUZXN0JyB9IH1dO1xyXG5cclxuICAgICAgY29uc3QgbW9ja09yZGVyID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja1BhcnRpY2lwYXRpb25zLCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IG9yZGVyOiBtb2NrT3JkZXIgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcSB9KTtcclxuICAgICAgXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBtb2NrU2VsZWN0LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBhcnRuZXJFdmVudFNlcnZpY2UuZ2V0RXZlbnRQYXJ0aWNpcGF0aW9ucygnZXZ0LTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrRnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50X3BhcnRpY2lwYW50cycpO1xyXG4gICAgICBleHBlY3QobW9ja1NlbGVjdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgJyosIHVzZXI6cHJvZmlsZXMhZXZlbnRfcGFydGljaXBhbnRzX3VzZXJfaWRfZmtleSgqKSdcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvRXF1YWwobW9ja1BhcnRpY2lwYXRpb25zKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxufSk7Il0sInZlcnNpb24iOjN9