{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\NotificationService.test.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\NotificationService.test.ts"],"sourcesContent":["// src/services/NotificationService.test.ts\r\n\r\nimport { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport NotificationService from './NotificationService';\r\n\r\n// --- 1. MOCKING DEPEND√äNCIAS (ANTES DAS IMPORTA√á√ïES) ---\r\n\r\n// Mock do Supabase\r\n// Definimos 'from' e 'rpc' que ser√£o mockados em cada teste\r\nconst mockSupabaseInstance = {\r\n  from: jest.fn(),\r\n  rpc: jest.fn(),\r\n};\r\n\r\njest.mock('@/lib/supabaseClient', () => ({\r\n  supabase: mockSupabaseInstance,\r\n}));\r\n\r\n// Typecast do mock para termos intellisense\r\nconst mockedSupabase = supabase as jest.Mocked<typeof supabase>;\r\n\r\n// --- 2. CONFIGURA√á√ÉO DOS TESTES ---\r\n\r\ndescribe('NotificationService', () => {\r\n\r\n  // Limpa todos os mocks antes de cada teste\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (mockedSupabase.from as jest.Mock).mockReset();\r\n    (mockedSupabase.rpc as jest.Mock).mockReset();\r\n  });\r\n\r\n  // --- 3. TESTES DOS M√âTODOS ---\r\n\r\n  describe('create (RLS)', () => {\r\n    it('deve chamar supabase.insert com os dados corretos', async () => {\r\n      const mockNotification = {\r\n        user_id: 'user-123',\r\n        event_id: 1,\r\n        notification_type: 'Novo Evento',\r\n        title: 'Teste',\r\n        message: 'Mensagem teste',\r\n      };\r\n      \r\n      const mockInsertSelect = jest.fn().mockImplementation(() => Promise.resolve({ data: { id: 1, ...mockNotification }, error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockReturnValue({\r\n        insert: jest.fn(() => ({\r\n          select: jest.fn(() => ({\r\n            single: mockInsertSelect,\r\n          })),\r\n        })),\r\n      });\r\n\r\n      const result = await NotificationService.create(mockNotification as any);\r\n\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('notifications');\r\n      expect(mockedSupabase.from('notifications').insert).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          ...mockNotification,\r\n          sent: false,\r\n        })\r\n      );\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toHaveProperty('id', 1);\r\n    });\r\n  });\r\n\r\n  describe('createForUser (RPC)', () => {\r\n    it('deve chamar supabase.rpc com os par√¢metros corretos', async () => {\r\n      const rpcParams = {\r\n        target_user_id: 'user-456',\r\n        target_event_id: 2,\r\n        notification_type: 'Candidatura Aprovada' as const,\r\n        title: 'Aprovado!',\r\n        message: 'Voc√™ foi aprovado.',\r\n        target_participation_id: 'part-789',\r\n      };\r\n\r\n      (mockedSupabase.rpc as jest.Mock).mockImplementation(() => Promise.resolve({ error: null }));\r\n\r\n      const result = await NotificationService.createForUser(rpcParams);\r\n\r\n      expect(mockedSupabase.rpc).toHaveBeenCalledWith('create_notification_for_user', rpcParams);\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('deve lidar com participation_id nulo no RPC', async () => {\r\n      (mockedSupabase.rpc as jest.Mock).mockImplementation(() => Promise.resolve({ error: null }));\r\n\r\n      await NotificationService.createForUser({\r\n        target_user_id: 'user-456',\r\n        target_event_id: 2,\r\n        notification_type: 'Candidatura Aprovada',\r\n        title: 'Aprovado!',\r\n        message: 'Voc√™ foi aprovado.',\r\n        // participation_id √© omitido\r\n      });\r\n\r\n      expect(mockedSupabase.rpc).toHaveBeenCalledWith('create_notification_for_user', \r\n        expect.objectContaining({\r\n          target_participation_id: null, // Verifica se foi definido como null\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Fun√ß√µes de Notifica√ß√£o (notify*)', () => {\r\n    // Espiona o m√©todo 'createForUser' que √© a base de todos\r\n    let spyCreateForUser: jest.SpiedFunction<typeof NotificationService.createForUser>;\r\n\r\n    beforeEach(() => {\r\n      // Espionamos o m√©todo e simulamos um retorno de sucesso\r\n      spyCreateForUser = jest.spyOn(NotificationService, 'createForUser')\r\n        .mockImplementation(() => Promise.resolve({ success: true }));\r\n    });\r\n\r\n    afterEach(() => {\r\n      // Restauramos o m√©todo original ap√≥s cada teste\r\n      spyCreateForUser.mockRestore();\r\n    });\r\n\r\n    it('notifyNewParticipation deve chamar createForUser corretamente', async () => {\r\n      await NotificationService.notifyNewParticipation('host-id', 1, 'part-id', 'Michael', 'Evento Teste');\r\n      \r\n      expect(spyCreateForUser).toHaveBeenCalledWith({\r\n        target_user_id: 'host-id',\r\n        target_event_id: 1,\r\n        notification_type: 'Candidatura Recebida',\r\n        title: 'üéâ Nova Candidatura!',\r\n        message: 'Michael se candidatou ao seu evento \"Evento Teste\"',\r\n        target_participation_id: 'part-id',\r\n      });\r\n    });\r\n\r\n    it('notifyParticipationApproved deve chamar createForUser corretamente', async () => {\r\n      await NotificationService.notifyParticipationApproved('user-id', 2, 'Evento Aprovado');\r\n      \r\n      expect(spyCreateForUser).toHaveBeenCalledWith({\r\n        target_user_id: 'user-id',\r\n        target_event_id: 2,\r\n        notification_type: 'Candidatura Aprovada',\r\n        title: '‚úÖ Voc√™ foi aprovado!',\r\n        message: 'Sua candidatura para \"Evento Aprovado\" foi aprovada!',\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('notifyUsersWithMatchingHashtags', () => {\r\n    it('deve notificar usu√°rios com hashtags correspondentes', async () => {\r\n      const profiles = [\r\n        { id: 'user-1', username: 'user1', hashtags: ['react', 'node'] },\r\n        { id: 'user-2', username: 'user2', hashtags: ['react', 'outro'] },\r\n        { id: 'user-3', username: 'user3', hashtags: ['python'] }, // n√£o deve notificar\r\n      ];\r\n      \r\n      const eventData = {\r\n        creator_id: 'host-id',\r\n        title: 'Evento de React',\r\n        hashtags: ['react', 'typescript'],\r\n        event_type: 'padrao',\r\n      };\r\n\r\n      // 1. Mock do SELECT de perfis\r\n      const mockSelectNotNeq = jest.fn().mockImplementation(() => Promise.resolve({ data: profiles, error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        select: jest.fn(() => ({\r\n          not: jest.fn(() => ({\r\n            neq: mockSelectNotNeq,\r\n          })),\r\n        })),\r\n      }));\r\n\r\n      // 2. Mock do INSERT de notifica√ß√µes\r\n      const mockInsert = jest.fn().mockImplementation(() => Promise.resolve({ error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        insert: mockInsert,\r\n      }));\r\n\r\n      const result = await NotificationService.notifyUsersWithMatchingHashtags(10, eventData);\r\n\r\n      expect(mockSelectNotNeq).toHaveBeenCalled();\r\n      expect(mockInsert).toHaveBeenCalled();\r\n      \r\n      // Verifica se apenas 2 usu√°rios (user-1, user-2) foram notificados\r\n      const insertedNotifications = mockInsert.mock.calls[0][0];\r\n      expect(insertedNotifications).toHaveLength(2);\r\n      expect(insertedNotifications[0].user_id).toBe('user-1');\r\n      expect(insertedNotifications[1].user_id).toBe('user-2');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data.notified).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('getUserNotifications', () => {\r\n    it('deve buscar notifica√ß√µes e orden√°-las', async () => {\r\n      const mockNotifications = [{ id: 1, message: 'Notifica√ß√£o 1' }];\r\n      \r\n      const mockSelectLimit = jest.fn().mockImplementation(() => Promise.resolve({ data: mockNotifications, error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockReturnValue({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            order: jest.fn(() => ({\r\n              limit: mockSelectLimit,\r\n            })),\r\n          })),\r\n        })),\r\n      });\r\n\r\n      const result = await NotificationService.getUserNotifications('user-id');\r\n\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('notifications');\r\n      expect(mockedSupabase.from('notifications').select).toHaveBeenCalledWith('*');\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toEqual(mockNotifications);\r\n    });\r\n  });\r\n\r\n  describe('markAsRead', () => {\r\n    it('deve chamar update para marcar como sent: true', async () => {\r\n      const mockUpdateEq = jest.fn().mockImplementation(() => Promise.resolve({ error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockReturnValue({\r\n        update: jest.fn(() => ({\r\n          eq: mockUpdateEq,\r\n        })),\r\n      });\r\n\r\n      await NotificationService.markAsRead(123);\r\n\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('notifications');\r\n      expect(mockedSupabase.from('notifications').update).toHaveBeenCalledWith({ sent: true });\r\n      expect(mockUpdateEq).toHaveBeenCalledWith('id', 123);\r\n    });\r\n  });\r\n\r\n  describe('getUnreadCount', () => {\r\n    it('deve retornar a contagem de notifica√ß√µes n√£o lidas', async () => {\r\n      // Mock para a contagem (head: true)\r\n      const mockSelectEq = jest.fn().mockImplementation(() => Promise.resolve({ count: 5, error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockReturnValue({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            eq: mockSelectEq,\r\n          })),\r\n        })),\r\n      });\r\n\r\n      const count = await NotificationService.getUnreadCount('user-id');\r\n\r\n      expect(mockedSupabase.from('notifications').select).toHaveBeenCalledWith('*', { count: 'exact', head: true });\r\n      expect(mockSelectEq).toHaveBeenCalledWith('sent', false);\r\n      expect(count).toBe(5);\r\n    });\r\n  });\r\n\r\n  describe('delete', () => {\r\n    it('deve chamar delete com o ID correto', async () => {\r\n      const mockDeleteEq = jest.fn().mockImplementation(() => Promise.resolve({ error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockReturnValue({\r\n        delete: jest.fn(() => ({\r\n          eq: mockDeleteEq,\r\n        })),\r\n      });\r\n\r\n      await NotificationService.delete(123);\r\n\r\n      expect(mockedSupabase.from).toHaveBeenCalledWith('notifications');\r\n      expect(mockDeleteEq).toHaveBeenCalledWith('id', 123);\r\n    });\r\n  });\r\n\r\n});\r\n"],"version":3}