{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\RatingService.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\RatingService.ts"],"sourcesContent":["// src/services/RatingService.ts\r\nimport { supabase } from '../lib/supabaseClient';\r\n\r\nexport type RatingType = 'host' | 'participant' | 'restaurant';\r\n\r\ninterface Rating {\r\n  id: string;\r\n  event_id: number;\r\n  rater_id: string;\r\n  rated_id: string;\r\n  rating_type: RatingType;\r\n  score: number;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\ninterface CreateRatingParams {\r\n  eventId: number;\r\n  raterId: string;\r\n  ratedId: string;\r\n  ratingType: RatingType;\r\n  score: number;\r\n}\r\n\r\ninterface RatingResult {\r\n  success: boolean;\r\n  data?: Rating;\r\n  error?: any;\r\n}\r\n\r\ninterface UserRatings {\r\n  success: boolean;\r\n  averageScore?: number;\r\n  totalRatings?: number;\r\n  hostRatings?: number;\r\n  participantRatings?: number;\r\n  error?: any;\r\n}\r\n\r\ninterface EventRatingsStatus {\r\n  success: boolean;\r\n  data?: {\r\n    totalParticipants: number;\r\n    hostRatingsReceived: number;\r\n    participantRatingsReceived: number;\r\n    restaurantRatingsReceived: number;\r\n    allRatingsComplete: boolean;\r\n    pendingRaters: Array<{\r\n      user_id: string;\r\n      username: string;\r\n      evaluated_host: boolean;\r\n      evaluated_participants: boolean;\r\n      evaluated_restaurant: boolean;\r\n    }>;\r\n  };\r\n  error?: any;\r\n}\r\n\r\nclass RatingService {\r\n  static async createRating(params: CreateRatingParams): Promise<RatingResult> {\r\n    try {\r\n      if (params.score < 1 || params.score > 5) {\r\n        return {\r\n          success: false,\r\n          error: 'Score deve estar entre 1 e 5'\r\n        };\r\n      }\r\n\r\n      if (!['host', 'participant', 'restaurant'].includes(params.ratingType)) {\r\n        return {\r\n          success: false,\r\n          error: 'Tipo de avalia√ß√£o inv√°lido'\r\n        };\r\n      }\r\n\r\n      const { data: existingRating, error: checkError } = await supabase\r\n        .from('ratings')\r\n        .select('id')\r\n        .eq('event_id', params.eventId)\r\n        .eq('rater_id', params.raterId)\r\n        .eq('rated_id', params.ratedId)\r\n        .eq('rating_type', params.ratingType)\r\n        .single();\r\n\r\n      if (checkError && checkError.code !== 'PGRST116') {\r\n        throw checkError;\r\n      }\r\n\r\n      if (existingRating) {\r\n        return this.updateRating(existingRating.id, params.score);\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('ratings')\r\n        .insert({\r\n          event_id: params.eventId,\r\n          rater_id: params.raterId,\r\n          rated_id: params.ratedId,\r\n          rating_type: params.ratingType,\r\n          score: params.score\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      await this.updateParticipationEvaluationFlag(params.eventId, params.raterId);\r\n\r\n      console.log(`‚úÖ Avalia√ß√£o criada: ${params.raterId} avaliou ${params.ratedId} com ${params.score} ‚≠ê`);\r\n      return { success: true, data: data as Rating };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao criar avalia√ß√£o:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  static async updateRating(ratingId: string, newScore: number): Promise<RatingResult> {\r\n    try {\r\n      if (newScore < 1 || newScore > 5) {\r\n        return {\r\n          success: false,\r\n          error: 'Score deve estar entre 1 e 5'\r\n        };\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('ratings')\r\n        .update({\r\n          score: newScore,\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', ratingId)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`‚úÖ Avalia√ß√£o atualizada: ${ratingId} ‚Üí ${newScore} ‚≠ê`);\r\n      return { success: true, data: data as Rating };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao atualizar avalia√ß√£o:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  static async getUserRatings(userId: string): Promise<UserRatings> {\r\n    try {\r\n      const { data: ratings, error } = await supabase\r\n        .from('ratings')\r\n        .select('*')\r\n        .eq('rated_id', userId);\r\n\r\n      if (error) throw error;\r\n\r\n      const ratingsList = (ratings || []) as Rating[];\r\n      const hostRatings = ratingsList.filter(r => r.rating_type === 'host');\r\n      const participantRatings = ratingsList.filter(r => r.rating_type === 'participant');\r\n\r\n      const allScores = ratingsList.map(r => r.score);\r\n      const averageScore = allScores.length > 0\r\n        ? Math.round((allScores.reduce((a, b) => a + b, 0) / allScores.length) * 10) / 10\r\n        : 0;\r\n\r\n      return {\r\n        success: true,\r\n        averageScore,\r\n        totalRatings: ratingsList.length,\r\n        hostRatings: hostRatings.length,\r\n        participantRatings: participantRatings.length\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao buscar avalia√ß√µes do usu√°rio:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  static async getEventRatings(eventId: number): Promise<RatingResult> {\r\n    try {\r\n      const { data: ratings, error } = await supabase\r\n        .from('ratings')\r\n        .select('*')\r\n        .eq('event_id', eventId)\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      return {\r\n        success: true,\r\n        data: ratings as any\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao buscar avalia√ß√µes do evento:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  // üîí NOVO: Verifica status completo de avalia√ß√µes incluindo restaurante\r\n  static async getEventRatingsStatus(eventId: number): Promise<EventRatingsStatus> {\r\n    try {\r\n      const { data: participants, error: participantsError } = await supabase\r\n        .from('event_participants')\r\n        .select('id, user_id, presenca_confirmada, profile:profiles!user_id(id, username)')\r\n        .eq('event_id', eventId)\r\n        .eq('presenca_confirmada', true);\r\n\r\n      if (participantsError) throw participantsError;\r\n\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('creator_id, partner_id')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) throw eventError;\r\n\r\n      const { data: allRatings, error: ratingsError } = await supabase\r\n        .from('ratings')\r\n        .select('rater_id, rated_id, rating_type')\r\n        .eq('event_id', eventId);\r\n\r\n      if (ratingsError) throw ratingsError;\r\n\r\n      const participantsList = (participants || []) as any[];\r\n      const ratingsList = (allRatings || []) as Rating[];\r\n\r\n      const hostRatingsReceived = ratingsList.filter(r => r.rating_type === 'host').length;\r\n      const participantRatingsReceived = ratingsList.filter(r => r.rating_type === 'participant').length;\r\n      const restaurantRatingsReceived = ratingsList.filter(r => r.rating_type === 'restaurant').length;\r\n\r\n      // üçΩÔ∏è Pega o ID do restaurante (partner_id)\r\n      const restaurantId = (event as any).partner_id;\r\n\r\n      const pendingRaters = participantsList\r\n        .map(p => {\r\n          const userId = p.user_id;\r\n          const username = p.profile?.username || 'Usu√°rio';\r\n\r\n          const raterRatings = ratingsList.filter(r => r.rater_id === userId);\r\n          const evaluatedHost = raterRatings.some(r => r.rating_type === 'host');\r\n          const evaluatedParticipants = raterRatings.some(r => r.rating_type === 'participant');\r\n          const evaluatedRestaurant = raterRatings.some(r => r.rating_type === 'restaurant' && r.rated_id === restaurantId);\r\n\r\n          return {\r\n            user_id: userId,\r\n            username: username,\r\n            evaluated_host: evaluatedHost,\r\n            evaluated_participants: evaluatedParticipants,\r\n            evaluated_restaurant: evaluatedRestaurant\r\n          };\r\n        })\r\n        .filter(p => !p.evaluated_host || !p.evaluated_participants || !p.evaluated_restaurant);\r\n\r\n      // ‚úÖ S√≥ completo se TODOS avaliaram TUDO e h√° participantes\r\n      const allRatingsComplete = pendingRaters.length === 0 && participantsList.length > 0;\r\n\r\n      return {\r\n        success: true,\r\n        data: {\r\n          totalParticipants: participantsList.length,\r\n          hostRatingsReceived,\r\n          participantRatingsReceived,\r\n          restaurantRatingsReceived,\r\n          allRatingsComplete,\r\n          pendingRaters\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao buscar status de avalia√ß√µes:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  static async hasUserRated(\r\n    eventId: number,\r\n    raterId: string,\r\n    ratedId: string,\r\n    ratingType: RatingType\r\n  ): Promise<boolean> {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('ratings')\r\n        .select('id')\r\n        .eq('event_id', eventId)\r\n        .eq('rater_id', raterId)\r\n        .eq('rated_id', ratedId)\r\n        .eq('rating_type', ratingType)\r\n        .maybeSingle();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return !!data;\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao verificar avalia√ß√£o:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  static async getRating(\r\n    eventId: number,\r\n    raterId: string,\r\n    ratedId: string,\r\n    ratingType: RatingType\r\n  ): Promise<Rating | null> {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('ratings')\r\n        .select('*')\r\n        .eq('event_id', eventId)\r\n        .eq('rater_id', raterId)\r\n        .eq('rated_id', ratedId)\r\n        .eq('rating_type', ratingType)\r\n        .maybeSingle();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data as Rating | null;\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao buscar avalia√ß√£o espec√≠fica:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // üîí CORRIGIDO: Verifica se TODAS as avalia√ß√µes REQUERIDAS foram feitas\r\n  static async updateParticipationEvaluationFlag(eventId: number, participantId: string): Promise<void> {\r\n    try {\r\n      const { data: participation, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('id, event_id')\r\n        .eq('event_id', eventId)\r\n        .eq('user_id', participantId)\r\n        .maybeSingle();\r\n\r\n      if (partError) throw partError;\r\n      if (!participation) return;\r\n\r\n      // 1. üîç Buscar evento para pegar partner_id (restaurante) E creator_id (host)\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('partner_id, creator_id')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) throw eventError;\r\n\r\n      // 2. üîç Verificar se h√° outros participantes (al√©m do pr√≥prio avaliador e do host)\r\n      const { count: otherParticipantsCount, error: countError } = await supabase\r\n        .from('event_participants')\r\n        .select('user_id', { count: 'exact', head: true })\r\n        .eq('event_id', eventId)\r\n        .eq('presenca_confirmada', true)                 // Que compareceram\r\n        .neq('user_id', participantId)                   // Que n√£o seja eu\r\n        .neq('user_id', event.creator_id);               // Que n√£o seja o host\r\n\r\n      if (countError) throw countError;\r\n\r\n      // 3. üéØ Definir o que √© obrigat√≥rio\r\n      const restaurantRatingRequired = !!event.partner_id;\r\n      const participantRatingsRequired = (otherParticipantsCount || 0) > 0;\r\n      \r\n      console.log(`[Avalia√ß√£o] Evento ${eventId} | User ${participantId}:`);\r\n      console.log(`- Restaurante √© obrigat√≥rio? ${restaurantRatingRequired} (ID: ${event.partner_id})`);\r\n      console.log(`- Participantes √© obrigat√≥rio? ${participantRatingsRequired} (Count: ${otherParticipantsCount})`);\r\n\r\n      // 4. üîç Buscar avalia√ß√µes existentes do usu√°rio\r\n      const { data: ratings, error: ratingsError } = await supabase\r\n        .from('ratings')\r\n        .select('rating_type, rated_id')\r\n        .eq('event_id', eventId)\r\n        .eq('rater_id', participantId);\r\n\r\n      if (ratingsError) throw ratingsError;\r\n      \r\n      const userRatings = ratings || [];\r\n\r\n      // 5. üö¶ Verificar o status de cada tipo de avalia√ß√£o\r\n      const hasHostRating = userRatings.some(r => r.rating_type === 'host');\r\n      \r\n      const hasParticipantRatings = !participantRatingsRequired || \r\n        userRatings.some(r => r.rating_type === 'participant');\r\n        \r\n      const hasRestaurantRating = !restaurantRatingRequired || \r\n        userRatings.some(r => r.rating_type === 'restaurant' && r.rated_id === event.partner_id);\r\n\r\n      console.log(`- Status: Host=${hasHostRating}, Participantes=${hasParticipantRatings}, Restaurante=${hasRestaurantRating}`);\r\n\r\n      // ‚úÖ S√≥ marca como conclu√≠do se TODAS as avalia√ß√µes REQUERIDAS foram feitas\r\n      if (hasHostRating && hasParticipantRatings && hasRestaurantRating) {\r\n        await supabase\r\n          .from('event_participants')\r\n          .update({ avaliacao_feita: true, updated_at: new Date().toISOString() })\r\n          .eq('id', participation.id);\r\n\r\n        console.log(`‚úÖ ${participantId} completou TODAS as avalia√ß√µes do evento ${eventId}`);\r\n      } else {\r\n        console.log(`‚è≥ ${participantId} ainda tem avalia√ß√µes pendentes para o evento ${eventId}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao atualizar flag de avalia√ß√£o:', error);\r\n    }\r\n  }\r\n\r\n  static async deleteRating(ratingId: string): Promise<RatingResult> {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('ratings')\r\n        .delete()\r\n        .eq('id', ratingId);\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`‚úÖ Avalia√ß√£o deletada: ${ratingId}`);\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao deletar avalia√ß√£o:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n}\r\n\r\nexport default RatingService;"],"version":3}