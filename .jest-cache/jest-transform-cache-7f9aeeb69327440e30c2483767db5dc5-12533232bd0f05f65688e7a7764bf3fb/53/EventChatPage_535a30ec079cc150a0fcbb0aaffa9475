88d0c5f0b6c3b0fed4d0527dfe3749cc
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
// src/features/shared/pages/EventChatPage.jsx
const react_1 = require("react");
const react_router_dom_1 = require("react-router-dom");
const react_helmet_async_1 = require("react-helmet-async");
const lucide_react_1 = require("lucide-react");
const AuthContext_1 = require("@/contexts/AuthContext");
const supabaseClient_1 = require("@/lib/supabaseClient");
const button_1 = require("@/features/shared/components/ui/button");
const input_1 = require("@/features/shared/components/ui/input");
const date_fns_1 = require("date-fns");
const locale_1 = require("date-fns/locale");
const SimpleDropdown_1 = require("@/features/shared/components/ui/SimpleDropdown");
const chatAvailability_1 = require("@/utils/chatAvailability");
const EventChatPage = () => {
    const { id } = (0, react_router_dom_1.useParams)();
    const eventId = parseInt(id, 10);
    const { user } = (0, AuthContext_1.useAuth)();
    const navigate = (0, react_router_dom_1.useNavigate)();
    const messagesEndRef = (0, react_1.useRef)(null);
    const [messages, setMessages] = (0, react_1.useState)([]);
    const [newMessage, setNewMessage] = (0, react_1.useState)('');
    const [loading, setLoading] = (0, react_1.useState)(true);
    const [error, setError] = (0, react_1.useState)(null);
    const [profileMap, setProfileMap] = (0, react_1.useState)(new Map());
    const [activeParticipantCount, setActiveParticipantCount] = (0, react_1.useState)(0);
    const [eventName, setEventName] = (0, react_1.useState)('');
    const [isCreator, setIsCreator] = (0, react_1.useState)(false);
    const [eventStatus, setEventStatus] = (0, react_1.useState)('Aberto');
    const [event, setEvent] = (0, react_1.useState)(null);
    const [isApprovedParticipant, setIsApprovedParticipant] = (0, react_1.useState)(false);
    const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
    };
    const getSenderProfile = (userId) => {
        return profileMap.get(userId) || { username: 'Usuário', full_name: '', avatar_url: null };
    };
    const getAvatarUrl = (profile) => {
        if (!profile || !profile.avatar_url) {
            const name = profile?.username || profile?.full_name || 'U';
            return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=8b5cf6&color=fff&size=40`;
        }
        try {
            const { data } = supabaseClient_1.supabase.storage.from('avatars').getPublicUrl(profile.avatar_url);
            return data.publicUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(profile.username || 'U')}&background=8b5cf6&color=fff&size=40`;
        }
        catch {
            return `https://ui-avatars.com/api/?name=${encodeURIComponent(profile.username || 'U')}&background=8b5cf6&color=fff&size=40`;
        }
    };
    (0, react_1.useEffect)(() => {
        if (!eventId || !user) {
            if (!eventId)
                setError('ID do evento inválido.');
            setLoading(false);
            return;
        }
        const loadChatData = async () => {
            setLoading(true);
            setError(null);
            try {
                const { data: eventData, error: eventError } = await supabaseClient_1.supabase
                    .from('events')
                    .select('id, title, creator_id, status, event_type, vagas')
                    .eq('id', eventId)
                    .single();
                if (eventError)
                    throw eventError;
                const { count: approvedCount, error: countError } = await supabaseClient_1.supabase
                    .from('event_participants')
                    .select('*', { count: 'exact', head: true })
                    .eq('event_id', eventId)
                    .eq('status', 'aprovado');
                if (countError)
                    throw countError;
                const eventWithCount = { ...eventData, approvedCount: approvedCount || 0 };
                setEvent(eventWithCount);
                setEventName(eventData.title);
                setEventStatus(eventData.status);
                const userIsCreator = eventData.creator_id === user.id;
                setIsCreator(userIsCreator);
                let userIsApproved = false;
                if (!userIsCreator) {
                    const { data: participation } = await supabaseClient_1.supabase
                        .from('event_participants')
                        .select('status')
                        .eq('event_id', eventId)
                        .eq('user_id', user.id)
                        .single();
                    userIsApproved = participation?.status === 'aprovado';
                }
                setIsApprovedParticipant(userIsApproved);
                const availability = (0, chatAvailability_1.isChatAvailable)(eventWithCount, userIsCreator, userIsApproved);
                if (!availability.available) {
                    setError(availability.reason);
                    setLoading(false);
                    return;
                }
                const { data: messagesData, error: messagesError } = await supabaseClient_1.supabase
                    .from('event_messages')
                    .select('*')
                    .eq('event_id', eventId)
                    .order('created_at', { ascending: true });
                if (messagesError)
                    throw messagesError;
                setMessages(messagesData);
                const senderIds = [...new Set(messagesData.map(msg => msg.user_id))];
                const { data: approvedParticipants, error: participantsError } = await supabaseClient_1.supabase
                    .from('event_participants')
                    .select('profile:profiles(id, username, avatar_url, full_name)')
                    .eq('event_id', eventId)
                    .eq('status', 'aprovado');
                if (participantsError)
                    throw participantsError;
                const newProfileMap = new Map();
                const approvedIds = [];
                approvedParticipants.forEach(p => {
                    if (p.profile) {
                        newProfileMap.set(p.profile.id, p.profile);
                        approvedIds.push(p.profile.id);
                    }
                });
                if (userIsCreator && !newProfileMap.has(user.id)) {
                    const { data: creatorProfile } = await supabaseClient_1.supabase
                        .from('profiles')
                        .select('id, username, avatar_url, full_name')
                        .eq('id', user.id)
                        .single();
                    if (creatorProfile)
                        newProfileMap.set(creatorProfile.id, creatorProfile);
                }
                const missingIds = senderIds.filter(id => !newProfileMap.has(id));
                if (missingIds.length > 0) {
                    const { data: _ } = await supabaseClient_1.supabase
                        .from('profiles')
                        .select('id, username, avatar_url, full_name')
                        .in('id', missingIds);
                    _?.forEach(p => newProfileMap.set(p.id, p));
                }
                setProfileMap(newProfileMap);
                let activeCount = approvedIds.length;
                if (userIsCreator && !approvedIds.includes(user.id))
                    activeCount++;
                setActiveParticipantCount(activeCount);
            }
            catch (err) {
                console.error('Erro ao carregar chat:', err);
                setError('Falha ao carregar o chat.');
            }
            finally {
                setLoading(false);
            }
        };
        loadChatData();
        const channel = supabaseClient_1.supabase
            .channel(`chat_room:${eventId}`)
            .on('postgres_changes', {
            event: 'INSERT',
            schema: 'public',
            table: 'event_messages',
            filter: `event_id=eq.${eventId}`,
        }, async (payload) => {
            const newMsg = payload.new;
            setMessages(prev => [...prev, newMsg]);
            const newSenderId = newMsg.user_id;
            if (!profileMap.has(newSenderId)) {
                const { data: newProfile } = await supabaseClient_1.supabase
                    .from('profiles')
                    .select('id, username, avatar_url, full_name')
                    .eq('id', newSenderId)
                    .single();
                if (newProfile) {
                    setProfileMap(prev => new Map(prev).set(newProfile.id, newProfile));
                }
            }
            scrollToBottom();
        })
            .subscribe();
        return () => {
            supabaseClient_1.supabase.removeChannel(channel);
        };
    }, [eventId, user, profileMap]);
    (0, react_1.useEffect)(() => {
        scrollToBottom();
    }, [messages]);
    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!newMessage.trim() || eventStatus === 'Concluído')
            return;
        try {
            const { error } = await supabaseClient_1.supabase
                .from('event_messages')
                .insert({
                event_id: eventId,
                user_id: user.id,
                content: newMessage.trim(),
            });
            if (error)
                throw error;
            setNewMessage('');
        }
        catch (err) {
            console.error('Erro ao enviar mensagem:', err);
        }
    };
    const handleDeleteMessage = async (messageId) => {
        if (!confirm('Apagar esta mensagem?'))
            return;
        try {
            const { error } = await supabaseClient_1.supabase
                .from('event_messages')
                .delete()
                .eq('id', messageId)
                .eq('user_id', user.id);
            if (error)
                throw error;
            setMessages(prev => prev.filter(m => m.id !== messageId));
        }
        catch (err) {
            console.error('Erro ao apagar mensagem:', err);
        }
    };
    if (loading) {
        return ((0, jsx_runtime_1.jsx)("div", { className: "flex items-center justify-center min-h-screen", children: (0, jsx_runtime_1.jsx)(lucide_react_1.Loader2, { className: "w-12 h-12 animate-spin text-purple-500" }) }));
    }
    if (error) {
        const isInstitutional = event?.event_type === 'institucional';
        return ((0, jsx_runtime_1.jsx)("div", { className: "flex items-center justify-center min-h-screen p-4", children: (0, jsx_runtime_1.jsxs)("div", { className: "text-center glass-effect rounded-2xl p-8 border border-white/10 max-w-md", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Lock, { className: "w-16 h-16 text-purple-500 mb-4 mx-auto" }), (0, jsx_runtime_1.jsx)("h2", { className: "text-2xl font-semibold text-white mb-3", children: "Chat n\u00E3o dispon\u00EDvel" }), (0, jsx_runtime_1.jsx)("p", { className: "text-white/70 mb-6", children: error }), isInstitutional && !isCreator && isApprovedParticipant && ((0, jsx_runtime_1.jsx)("div", { className: "bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 mb-6", children: (0, jsx_runtime_1.jsx)("p", { className: "text-blue-300 text-sm", children: "Evento Institucional: O chat ser\u00E1 liberado automaticamente assim que o primeiro participante for aprovado." }) })), !isInstitutional && !isCreator && isApprovedParticipant && event && ((0, jsx_runtime_1.jsxs)("div", { className: "bg-purple-500/10 border border-purple-500/30 rounded-lg p-4 mb-6", children: [(0, jsx_runtime_1.jsx)("p", { className: "text-purple-300 text-sm mb-2", children: "Progresso do evento:" }), (0, jsx_runtime_1.jsxs)("p", { className: "text-white text-lg font-semibold", children: [event.approvedCount, " / ", event.vagas, " vagas preenchidas"] }), (0, jsx_runtime_1.jsx)("p", { className: "text-white/60 text-xs mt-2", children: "O chat ser\u00E1 liberado quando todas as vagas forem preenchidas ou o evento for confirmado." })] })), (0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: () => navigate(`/event/${eventId}`), children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-4 h-4 mr-2" }), "Voltar ao Evento"] })] }) }));
    }
    return ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(react_helmet_async_1.Helmet, { children: (0, jsx_runtime_1.jsxs)("title", { children: ["Chat: ", eventName || 'Evento', " | Mesapra2"] }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col h-[calc(100vh-8rem)] bg-gray-900/50 rounded-2xl border border-white/10 overflow-hidden", children: [(0, jsx_runtime_1.jsxs)("header", { className: "flex items-center p-4 border-b border-white/10 bg-background/80 backdrop-blur-sm z-10", children: [(0, jsx_runtime_1.jsx)(react_router_dom_1.Link, { to: `/event/${eventId}`, className: "mr-4", children: (0, jsx_runtime_1.jsx)(button_1.Button, { variant: "ghost", size: "icon", children: (0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-5 h-5" }) }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex-1", children: [(0, jsx_runtime_1.jsx)("h1", { className: "text-lg font-semibold text-white truncate", children: eventName }), (0, jsx_runtime_1.jsxs)("p", { className: "text-xs text-white/50", children: [activeParticipantCount, " participantes", event?.event_type === 'institucional' && (0, jsx_runtime_1.jsx)("span", { className: "ml-2 text-purple-400", children: "\u2022 Institucional" })] })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex-1 p-4 overflow-y-auto space-y-4", children: [event?.event_type === 'institucional' && messages.length === 0 && ((0, jsx_runtime_1.jsx)("div", { className: "text-center py-8", children: (0, jsx_runtime_1.jsx)("div", { className: "inline-block p-4 rounded-lg bg-purple-500/10 border border-purple-500/30", children: (0, jsx_runtime_1.jsxs)("p", { className: "text-purple-300 text-sm", children: ["Chat liberado! Este \u00E9 um evento institucional.", (0, jsx_runtime_1.jsx)("br", {}), "Aproveite para interagir e tirar d\u00FAvidas com os outros participantes."] }) }) })), messages.map((msg) => {
                                const senderProfile = getSenderProfile(msg.user_id);
                                const isMe = msg.user_id === user.id;
                                return ((0, jsx_runtime_1.jsxs)("div", { className: `flex items-end gap-3 ${isMe ? 'justify-end' : 'justify-start'}`, children: [!isMe && ((0, jsx_runtime_1.jsx)("img", { src: getAvatarUrl(senderProfile), alt: senderProfile.username || 'Usuário', className: "w-8 h-8 rounded-full border border-white/10 flex-shrink-0 object-cover", onError: (e) => {
                                                e.target.src = `https://ui-avatars.com/api/?name=U&background=8b5cf6&color=fff&size=40`;
                                            } })), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-end gap-2", children: [(0, jsx_runtime_1.jsxs)("div", { className: `flex flex-col max-w-xs md:max-w-md p-3 rounded-lg ${isMe ? 'bg-purple-600 text-white rounded-br-none' : 'bg-gray-800 text-white/90 rounded-bl-none'}`, children: [!isMe && ((0, jsx_runtime_1.jsx)("span", { className: "text-xs font-semibold text-purple-300 mb-1", children: senderProfile.username || senderProfile.full_name || 'Usuário' })), (0, jsx_runtime_1.jsx)("p", { className: "text-sm whitespace-pre-wrap", children: msg.content }), (0, jsx_runtime_1.jsx)("span", { className: "text-xs text-white/50 mt-1 self-end", children: (0, date_fns_1.format)(new Date(msg.created_at), 'HH:mm', { locale: locale_1.ptBR }) })] }), (isMe || isCreator) && ((0, jsx_runtime_1.jsx)(SimpleDropdown_1.SimpleDropdown, { trigger: (0, jsx_runtime_1.jsx)(button_1.Button, { variant: "ghost", size: "icon", className: "h-6 w-6 opacity-0 hover:opacity-100 transition-opacity", children: (0, jsx_runtime_1.jsx)(lucide_react_1.MoreVertical, { className: "h-4 h-4" }) }), children: (0, jsx_runtime_1.jsxs)(SimpleDropdown_1.SimpleDropdownItem, { onClick: () => handleDeleteMessage(msg.id), className: "text-red-400", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Trash2, { className: "w-4 h-4 mr-2" }), "Apagar mensagem"] }) }))] }), isMe && ((0, jsx_runtime_1.jsx)("img", { src: getAvatarUrl(senderProfile), alt: "Voc\u00EA", className: "w-8 h-8 rounded-full border border-white/10 flex-shrink-0 object-cover", onError: (e) => {
                                                e.target.src = `https://ui-avatars.com/api/?name=U&background=8b5cf6&color=fff&size=40`;
                                            } }))] }, msg.id));
                            }), (0, jsx_runtime_1.jsx)("div", { ref: messagesEndRef })] }), (0, jsx_runtime_1.jsxs)("form", { onSubmit: handleSubmit, className: "p-4 border-t border-white/10 bg-background/80 backdrop-blur-sm", children: [eventStatus === 'Concluído' && ((0, jsx_runtime_1.jsx)("div", { className: "mb-3 p-2 rounded-lg bg-gray-700/50 border border-gray-600/50", children: (0, jsx_runtime_1.jsx)("p", { className: "text-gray-300 text-xs text-center", children: "Evento conclu\u00EDdo - Chat em modo leitura" }) })), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-3", children: [(0, jsx_runtime_1.jsx)(input_1.Input, { type: "text", value: newMessage, onChange: (e) => setNewMessage(e.target.value), placeholder: eventStatus === 'Concluído' ? 'Chat encerrado...' : 'Digite sua mensagem...', className: "flex-1 bg-gray-800 border-gray-700", autoComplete: "off", disabled: eventStatus === 'Concluído' }), (0, jsx_runtime_1.jsx)(button_1.Button, { type: "submit", size: "icon", className: "flex-shrink-0", disabled: !newMessage.trim() || eventStatus === 'Concluído', children: (0, jsx_runtime_1.jsx)(lucide_react_1.Send, { className: "w-5 h-5" }) })] })] })] })] }));
};
exports.default = EventChatPage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcc2hhcmVkXFxwYWdlc1xcRXZlbnRDaGF0UGFnZS5qc3giLCJtYXBwaW5ncyI6Ijs7O0FBQUEsOENBQThDO0FBQzlDLGlDQUFvRDtBQUNwRCx1REFBZ0U7QUFDaEUsMkRBQTRDO0FBQzVDLCtDQUFvRjtBQUNwRix3REFBaUQ7QUFDakQseURBQWdEO0FBQ2hELG1FQUFnRTtBQUNoRSxpRUFBOEQ7QUFDOUQsdUNBQWtDO0FBQ2xDLDRDQUF1QztBQUN2QyxtRkFBb0c7QUFDcEcsK0RBQTJEO0FBRTNELE1BQU0sYUFBYSxHQUFHLEdBQUcsRUFBRTtJQUN6QixNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBQSw0QkFBUyxHQUFFLENBQUM7SUFDM0IsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNqQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBQSxxQkFBTyxHQUFFLENBQUM7SUFDM0IsTUFBTSxRQUFRLEdBQUcsSUFBQSw4QkFBVyxHQUFFLENBQUM7SUFDL0IsTUFBTSxjQUFjLEdBQUcsSUFBQSxjQUFNLEVBQUMsSUFBSSxDQUFDLENBQUM7SUFFcEMsTUFBTSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDakQsTUFBTSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsSUFBSSxDQUFDLENBQUM7SUFDekMsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMs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QUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUM5QyxXQUFXLEVBQUUsV0FBVyxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLHdCQUF3QixFQUN6RixTQUFTLEVBQUMsb0NBQW9DLEVBQzlDLFlBQVksRUFBQyxLQUFLLEVBQ2xCLFFBQVEsRUFBRSxXQUFXLEtBQUssV0FBVyxHQUNyQyxFQUNGLHVCQUFDLGVBQU0sSUFDTCxJQUFJLEVBQUMsUUFBUSxFQUNiLElBQUksRUFBQyxNQUFNLEVBQ1gsU0FBUyxFQUFDLGVBQWUsRUFDekIsUUFBUSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLFdBQVcsS0FBSyxXQUFXLFlBRTNELHVCQUFDLG1CQUFJLElBQUMsU0FBUyxFQUFDLFNBQVMsR0FBRyxHQUNyQixJQUNMLElBQ0QsSUFDSCxJQUNMLENBQ0osQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGtCQUFlLGFBQWEsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXGZlYXR1cmVzXFxzaGFyZWRcXHBhZ2VzXFxFdmVudENoYXRQYWdlLmpzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvZmVhdHVyZXMvc2hhcmVkL3BhZ2VzL0V2ZW50Q2hhdFBhZ2UuanN4XHJcbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgdXNlUGFyYW1zLCB1c2VOYXZpZ2F0ZSwgTGluayB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xyXG5pbXBvcnQgeyBIZWxtZXQgfSBmcm9tICdyZWFjdC1oZWxtZXQtYXN5bmMnO1xyXG5pbXBvcnQgeyBTZW5kLCBBcnJvd0xlZnQsIExvYWRlcjIsIFRyYXNoMiwgTW9yZVZlcnRpY2FsLCBMb2NrIH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcclxuaW1wb3J0IHsgdXNlQXV0aCB9IGZyb20gJ0AvY29udGV4dHMvQXV0aENvbnRleHQnO1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJ0AvbGliL3N1cGFiYXNlQ2xpZW50JztcclxuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS9idXR0b24nO1xyXG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ0AvZmVhdHVyZXMvc2hhcmVkL2NvbXBvbmVudHMvdWkvaW5wdXQnO1xyXG5pbXBvcnQgeyBmb3JtYXQgfSBmcm9tICdkYXRlLWZucyc7XHJcbmltcG9ydCB7IHB0QlIgfSBmcm9tICdkYXRlLWZucy9sb2NhbGUnO1xyXG5pbXBvcnQgeyBTaW1wbGVEcm9wZG93biwgU2ltcGxlRHJvcGRvd25JdGVtIH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS9TaW1wbGVEcm9wZG93bic7XHJcbmltcG9ydCB7IGlzQ2hhdEF2YWlsYWJsZSB9IGZyb20gJ0AvdXRpbHMvY2hhdEF2YWlsYWJpbGl0eSc7XHJcblxyXG5jb25zdCBFdmVudENoYXRQYWdlID0gKCkgPT4ge1xyXG4gIGNvbnN0IHsgaWQgfSA9IHVzZVBhcmFtcygpO1xyXG4gIGNvbnN0IGV2ZW50SWQgPSBwYXJzZUludChpZCwgMTApO1xyXG4gIGNvbnN0IHsgdXNlciB9ID0gdXNlQXV0aCgpO1xyXG4gIGNvbnN0IG5hdmlnYXRlID0gdXNlTmF2aWdhdGUoKTtcclxuICBjb25zdCBtZXNzYWdlc0VuZFJlZiA9IHVzZVJlZihudWxsKTtcclxuXHJcbiAgY29uc3QgW21lc3NhZ2VzLCBzZXRNZXNzYWdlc10gPSB1c2VTdGF0ZShbXSk7XHJcbiAgY29uc3QgW25ld01lc3NhZ2UsIHNldE5ld01lc3NhZ2VdID0gdXNlU3RhdGUoJycpO1xyXG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xyXG4gIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgY29uc3QgW3Byb2ZpbGVNYXAsIHNldFByb2ZpbGVNYXBdID0gdXNlU3RhdGUobmV3IE1hcCgpKTtcclxuICBjb25zdCBbYWN0aXZlUGFydGljaXBhbnRDb3VudCwgc2V0QWN0aXZlUGFydGljaXBhbnRDb3VudF0gPSB1c2VTdGF0ZSgwKTtcclxuICBjb25zdCBbZXZlbnROYW1lLCBzZXRFdmVudE5hbWVdID0gdXNlU3RhdGUoJycpO1xyXG4gIGNvbnN0IFtpc0NyZWF0b3IsIHNldElzQ3JlYXRvcl0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgY29uc3QgW2V2ZW50U3RhdHVzLCBzZXRFdmVudFN0YXR1c10gPSB1c2VTdGF0ZSgnQWJlcnRvJyk7XHJcbiAgY29uc3QgW2V2ZW50LCBzZXRFdmVudF0gPSB1c2VTdGF0ZShudWxsKTtcclxuICBjb25zdCBbaXNBcHByb3ZlZFBhcnRpY2lwYW50LCBzZXRJc0FwcHJvdmVkUGFydGljaXBhbnRdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG5cclxuICBjb25zdCBzY3JvbGxUb0JvdHRvbSA9ICgpID0+IHtcclxuICAgIG1lc3NhZ2VzRW5kUmVmLmN1cnJlbnQ/LnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdzbW9vdGgnIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGdldFNlbmRlclByb2ZpbGUgPSAodXNlcklkKSA9PiB7XHJcbiAgICByZXR1cm4gcHJvZmlsZU1hcC5nZXQodXNlcklkKSB8fCB7IHVzZXJuYW1lOiAnVXN1w6FyaW8nLCBmdWxsX25hbWU6ICcnLCBhdmF0YXJfdXJsOiBudWxsIH07XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgZ2V0QXZhdGFyVXJsID0gKHByb2ZpbGUpID0+IHtcclxuICAgIGlmICghcHJvZmlsZSB8fCAhcHJvZmlsZS5hdmF0YXJfdXJsKSB7XHJcbiAgICAgIGNvbnN0IG5hbWUgPSBwcm9maWxlPy51c2VybmFtZSB8fCBwcm9maWxlPy5mdWxsX25hbWUgfHwgJ1UnO1xyXG4gICAgICByZXR1cm4gYGh0dHBzOi8vdWktYXZhdGFycy5jb20vYXBpLz9uYW1lPSR7ZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpfSZiYWNrZ3JvdW5kPThiNWNmNiZjb2xvcj1mZmYmc2l6ZT00MGA7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhIH0gPSBzdXBhYmFzZS5zdG9yYWdlLmZyb20oJ2F2YXRhcnMnKS5nZXRQdWJsaWNVcmwocHJvZmlsZS5hdmF0YXJfdXJsKTtcclxuICAgICAgcmV0dXJuIGRhdGEucHVibGljVXJsIHx8IGBodHRwczovL3VpLWF2YXRhcnMuY29tL2FwaS8/bmFtZT0ke2VuY29kZVVSSUNvbXBvbmVudChwcm9maWxlLnVzZXJuYW1lIHx8ICdVJyl9JmJhY2tncm91bmQ9OGI1Y2Y2JmNvbG9yPWZmZiZzaXplPTQwYDtcclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICByZXR1cm4gYGh0dHBzOi8vdWktYXZhdGFycy5jb20vYXBpLz9uYW1lPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHByb2ZpbGUudXNlcm5hbWUgfHwgJ1UnKX0mYmFja2dyb3VuZD04YjVjZjYmY29sb3I9ZmZmJnNpemU9NDBgO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoIWV2ZW50SWQgfHwgIXVzZXIpIHtcclxuICAgICAgaWYgKCFldmVudElkKSBzZXRFcnJvcignSUQgZG8gZXZlbnRvIGludsOhbGlkby4nKTtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBsb2FkQ2hhdERhdGEgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIHNldExvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIHNldEVycm9yKG51bGwpO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGV2ZW50RGF0YSwgZXJyb3I6IGV2ZW50RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgICAgIC5zZWxlY3QoJ2lkLCB0aXRsZSwgY3JlYXRvcl9pZCwgc3RhdHVzLCBldmVudF90eXBlLCB2YWdhcycpXHJcbiAgICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZClcclxuICAgICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKGV2ZW50RXJyb3IpIHRocm93IGV2ZW50RXJyb3I7XHJcblxyXG4gICAgICAgIGNvbnN0IHsgY291bnQ6IGFwcHJvdmVkQ291bnQsIGVycm9yOiBjb3VudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxyXG4gICAgICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgICAuZXEoJ3N0YXR1cycsICdhcHJvdmFkbycpO1xyXG5cclxuICAgICAgICBpZiAoY291bnRFcnJvcikgdGhyb3cgY291bnRFcnJvcjtcclxuXHJcbiAgICAgICAgY29uc3QgZXZlbnRXaXRoQ291bnQgPSB7IC4uLmV2ZW50RGF0YSwgYXBwcm92ZWRDb3VudDogYXBwcm92ZWRDb3VudCB8fCAwIH07XHJcbiAgICAgICAgc2V0RXZlbnQoZXZlbnRXaXRoQ291bnQpO1xyXG4gICAgICAgIHNldEV2ZW50TmFtZShldmVudERhdGEudGl0bGUpO1xyXG4gICAgICAgIHNldEV2ZW50U3RhdHVzKGV2ZW50RGF0YS5zdGF0dXMpO1xyXG5cclxuICAgICAgICBjb25zdCB1c2VySXNDcmVhdG9yID0gZXZlbnREYXRhLmNyZWF0b3JfaWQgPT09IHVzZXIuaWQ7XHJcbiAgICAgICAgc2V0SXNDcmVhdG9yKHVzZXJJc0NyZWF0b3IpO1xyXG5cclxuICAgICAgICBsZXQgdXNlcklzQXBwcm92ZWQgPSBmYWxzZTtcclxuICAgICAgICBpZiAoIXVzZXJJc0NyZWF0b3IpIHtcclxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogcGFydGljaXBhdGlvbiB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgLmZyb20oJ2V2ZW50X3BhcnRpY2lwYW50cycpXHJcbiAgICAgICAgICAgIC5zZWxlY3QoJ3N0YXR1cycpXHJcbiAgICAgICAgICAgIC5lcSgnZXZlbnRfaWQnLCBldmVudElkKVxyXG4gICAgICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgICAgdXNlcklzQXBwcm92ZWQgPSBwYXJ0aWNpcGF0aW9uPy5zdGF0dXMgPT09ICdhcHJvdmFkbyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldElzQXBwcm92ZWRQYXJ0aWNpcGFudCh1c2VySXNBcHByb3ZlZCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJpbGl0eSA9IGlzQ2hhdEF2YWlsYWJsZShldmVudFdpdGhDb3VudCwgdXNlcklzQ3JlYXRvciwgdXNlcklzQXBwcm92ZWQpO1xyXG4gICAgICAgIGlmICghYXZhaWxhYmlsaXR5LmF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgc2V0RXJyb3IoYXZhaWxhYmlsaXR5LnJlYXNvbik7XHJcbiAgICAgICAgICBzZXRMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogbWVzc2FnZXNEYXRhLCBlcnJvcjogbWVzc2FnZXNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdldmVudF9tZXNzYWdlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAgIC5lcSgnZXZlbnRfaWQnLCBldmVudElkKVxyXG4gICAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IHRydWUgfSk7XHJcblxyXG4gICAgICAgIGlmIChtZXNzYWdlc0Vycm9yKSB0aHJvdyBtZXNzYWdlc0Vycm9yO1xyXG4gICAgICAgIHNldE1lc3NhZ2VzKG1lc3NhZ2VzRGF0YSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNlbmRlcklkcyA9IFsuLi5uZXcgU2V0KG1lc3NhZ2VzRGF0YS5tYXAobXNnID0+IG1zZy51c2VyX2lkKSldO1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogYXBwcm92ZWRQYXJ0aWNpcGFudHMsIGVycm9yOiBwYXJ0aWNpcGFudHNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKCdldmVudF9wYXJ0aWNpcGFudHMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgncHJvZmlsZTpwcm9maWxlcyhpZCwgdXNlcm5hbWUsIGF2YXRhcl91cmwsIGZ1bGxfbmFtZSknKVxyXG4gICAgICAgICAgLmVxKCdldmVudF9pZCcsIGV2ZW50SWQpXHJcbiAgICAgICAgICAuZXEoJ3N0YXR1cycsICdhcHJvdmFkbycpO1xyXG5cclxuICAgICAgICBpZiAocGFydGljaXBhbnRzRXJyb3IpIHRocm93IHBhcnRpY2lwYW50c0Vycm9yO1xyXG5cclxuICAgICAgICBjb25zdCBuZXdQcm9maWxlTWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIGNvbnN0IGFwcHJvdmVkSWRzID0gW107XHJcblxyXG4gICAgICAgIGFwcHJvdmVkUGFydGljaXBhbnRzLmZvckVhY2gocCA9PiB7XHJcbiAgICAgICAgICBpZiAocC5wcm9maWxlKSB7XHJcbiAgICAgICAgICAgIG5ld1Byb2ZpbGVNYXAuc2V0KHAucHJvZmlsZS5pZCwgcC5wcm9maWxlKTtcclxuICAgICAgICAgICAgYXBwcm92ZWRJZHMucHVzaChwLnByb2ZpbGUuaWQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodXNlcklzQ3JlYXRvciAmJiAhbmV3UHJvZmlsZU1hcC5oYXModXNlci5pZCkpIHtcclxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogY3JlYXRvclByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAgIC5mcm9tKCdwcm9maWxlcycpXHJcbiAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCB1c2VybmFtZSwgYXZhdGFyX3VybCwgZnVsbF9uYW1lJylcclxuICAgICAgICAgICAgLmVxKCdpZCcsIHVzZXIuaWQpXHJcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgICAgIGlmIChjcmVhdG9yUHJvZmlsZSkgbmV3UHJvZmlsZU1hcC5zZXQoY3JlYXRvclByb2ZpbGUuaWQsIGNyZWF0b3JQcm9maWxlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1pc3NpbmdJZHMgPSBzZW5kZXJJZHMuZmlsdGVyKGlkID0+ICFuZXdQcm9maWxlTWFwLmhhcyhpZCkpO1xyXG4gICAgICAgIGlmIChtaXNzaW5nSWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogXyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAgICAgLnNlbGVjdCgnaWQsIHVzZXJuYW1lLCBhdmF0YXJfdXJsLCBmdWxsX25hbWUnKVxyXG4gICAgICAgICAgICAuaW4oJ2lkJywgbWlzc2luZ0lkcyk7XHJcblxyXG4gICAgICAgICAgXz8uZm9yRWFjaChwID0+IG5ld1Byb2ZpbGVNYXAuc2V0KHAuaWQsIHApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldFByb2ZpbGVNYXAobmV3UHJvZmlsZU1hcCk7XHJcblxyXG4gICAgICAgIGxldCBhY3RpdmVDb3VudCA9IGFwcHJvdmVkSWRzLmxlbmd0aDtcclxuICAgICAgICBpZiAodXNlcklzQ3JlYXRvciAmJiAhYXBwcm92ZWRJZHMuaW5jbHVkZXModXNlci5pZCkpIGFjdGl2ZUNvdW50Kys7XHJcbiAgICAgICAgc2V0QWN0aXZlUGFydGljaXBhbnRDb3VudChhY3RpdmVDb3VudCk7XHJcblxyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIGNhcnJlZ2FyIGNoYXQ6JywgZXJyKTtcclxuICAgICAgICBzZXRFcnJvcignRmFsaGEgYW8gY2FycmVnYXIgbyBjaGF0LicpO1xyXG4gICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGxvYWRDaGF0RGF0YSgpO1xyXG5cclxuICAgIGNvbnN0IGNoYW5uZWwgPSBzdXBhYmFzZVxyXG4gICAgICAuY2hhbm5lbChgY2hhdF9yb29tOiR7ZXZlbnRJZH1gKVxyXG4gICAgICAub24oXHJcbiAgICAgICAgJ3Bvc3RncmVzX2NoYW5nZXMnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGV2ZW50OiAnSU5TRVJUJyxcclxuICAgICAgICAgIHNjaGVtYTogJ3B1YmxpYycsXHJcbiAgICAgICAgICB0YWJsZTogJ2V2ZW50X21lc3NhZ2VzJyxcclxuICAgICAgICAgIGZpbHRlcjogYGV2ZW50X2lkPWVxLiR7ZXZlbnRJZH1gLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXN5bmMgKHBheWxvYWQpID0+IHtcclxuICAgICAgICAgIGNvbnN0IG5ld01zZyA9IHBheWxvYWQubmV3O1xyXG4gICAgICAgICAgc2V0TWVzc2FnZXMocHJldiA9PiBbLi4ucHJldiwgbmV3TXNnXSk7XHJcblxyXG4gICAgICAgICAgY29uc3QgbmV3U2VuZGVySWQgPSBuZXdNc2cudXNlcl9pZDtcclxuICAgICAgICAgIGlmICghcHJvZmlsZU1hcC5oYXMobmV3U2VuZGVySWQpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCB1c2VybmFtZSwgYXZhdGFyX3VybCwgZnVsbF9uYW1lJylcclxuICAgICAgICAgICAgICAuZXEoJ2lkJywgbmV3U2VuZGVySWQpXHJcbiAgICAgICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG5ld1Byb2ZpbGUpIHtcclxuICAgICAgICAgICAgICBzZXRQcm9maWxlTWFwKHByZXYgPT4gbmV3IE1hcChwcmV2KS5zZXQobmV3UHJvZmlsZS5pZCwgbmV3UHJvZmlsZSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTtcclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgICAgLnN1YnNjcmliZSgpO1xyXG5cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIHN1cGFiYXNlLnJlbW92ZUNoYW5uZWwoY2hhbm5lbCk7XHJcbiAgICB9O1xyXG4gIH0sIFtldmVudElkLCB1c2VyLCBwcm9maWxlTWFwXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBzY3JvbGxUb0JvdHRvbSgpO1xyXG4gIH0sIFttZXNzYWdlc10pO1xyXG5cclxuICBjb25zdCBoYW5kbGVTdWJtaXQgPSBhc3luYyAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgaWYgKCFuZXdNZXNzYWdlLnRyaW0oKSB8fCBldmVudFN0YXR1cyA9PT0gJ0NvbmNsdcOtZG8nKSByZXR1cm47XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfbWVzc2FnZXMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsXHJcbiAgICAgICAgICB1c2VyX2lkOiB1c2VyLmlkLFxyXG4gICAgICAgICAgY29udGVudDogbmV3TWVzc2FnZS50cmltKCksXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgICBzZXROZXdNZXNzYWdlKCcnKTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvIGFvIGVudmlhciBtZW5zYWdlbTonLCBlcnIpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZURlbGV0ZU1lc3NhZ2UgPSBhc3luYyAobWVzc2FnZUlkKSA9PiB7XHJcbiAgICBpZiAoIWNvbmZpcm0oJ0FwYWdhciBlc3RhIG1lbnNhZ2VtPycpKSByZXR1cm47XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRfbWVzc2FnZXMnKVxyXG4gICAgICAgIC5kZWxldGUoKVxyXG4gICAgICAgIC5lcSgnaWQnLCBtZXNzYWdlSWQpXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlci5pZCk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgICAgc2V0TWVzc2FnZXMocHJldiA9PiBwcmV2LmZpbHRlcihtID0+IG0uaWQgIT09IG1lc3NhZ2VJZCkpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gYW8gYXBhZ2FyIG1lbnNhZ2VtOicsIGVycik7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgaWYgKGxvYWRpbmcpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgbWluLWgtc2NyZWVuXCI+XHJcbiAgICAgICAgPExvYWRlcjIgY2xhc3NOYW1lPVwidy0xMiBoLTEyIGFuaW1hdGUtc3BpbiB0ZXh0LXB1cnBsZS01MDBcIiAvPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGNvbnN0IGlzSW5zdGl0dXRpb25hbCA9IGV2ZW50Py5ldmVudF90eXBlID09PSAnaW5zdGl0dWNpb25hbCc7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIG1pbi1oLXNjcmVlbiBwLTRcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRleHQtY2VudGVyIGdsYXNzLWVmZmVjdCByb3VuZGVkLTJ4bCBwLTggYm9yZGVyIGJvcmRlci13aGl0ZS8xMCBtYXgtdy1tZFwiPlxyXG4gICAgICAgICAgPExvY2sgY2xhc3NOYW1lPVwidy0xNiBoLTE2IHRleHQtcHVycGxlLTUwMCBtYi00IG14LWF1dG9cIiAvPlxyXG4gICAgICAgICAgPGgyIGNsYXNzTmFtZT1cInRleHQtMnhsIGZvbnQtc2VtaWJvbGQgdGV4dC13aGl0ZSBtYi0zXCI+Q2hhdCBuw6NvIGRpc3BvbsOtdmVsPC9oMj5cclxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtd2hpdGUvNzAgbWItNlwiPntlcnJvcn08L3A+XHJcblxyXG4gICAgICAgICAge2lzSW5zdGl0dXRpb25hbCAmJiAhaXNDcmVhdG9yICYmIGlzQXBwcm92ZWRQYXJ0aWNpcGFudCAmJiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYmctYmx1ZS01MDAvMTAgYm9yZGVyIGJvcmRlci1ibHVlLTUwMC8zMCByb3VuZGVkLWxnIHAtNCBtYi02XCI+XHJcbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC1ibHVlLTMwMCB0ZXh0LXNtXCI+XHJcbiAgICAgICAgICAgICAgICBFdmVudG8gSW5zdGl0dWNpb25hbDogTyBjaGF0IHNlcsOhIGxpYmVyYWRvIGF1dG9tYXRpY2FtZW50ZSBhc3NpbSBxdWUgbyBwcmltZWlybyBwYXJ0aWNpcGFudGUgZm9yIGFwcm92YWRvLlxyXG4gICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIHshaXNJbnN0aXR1dGlvbmFsICYmICFpc0NyZWF0b3IgJiYgaXNBcHByb3ZlZFBhcnRpY2lwYW50ICYmIGV2ZW50ICYmIChcclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJiZy1wdXJwbGUtNTAwLzEwIGJvcmRlciBib3JkZXItcHVycGxlLTUwMC8zMCByb3VuZGVkLWxnIHAtNCBtYi02XCI+XHJcbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC1wdXJwbGUtMzAwIHRleHQtc20gbWItMlwiPlByb2dyZXNzbyBkbyBldmVudG86PC9wPlxyXG4gICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtd2hpdGUgdGV4dC1sZyBmb250LXNlbWlib2xkXCI+XHJcbiAgICAgICAgICAgICAgICB7ZXZlbnQuYXBwcm92ZWRDb3VudH0gLyB7ZXZlbnQudmFnYXN9IHZhZ2FzIHByZWVuY2hpZGFzXHJcbiAgICAgICAgICAgICAgPC9wPlxyXG4gICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtd2hpdGUvNjAgdGV4dC14cyBtdC0yXCI+XHJcbiAgICAgICAgICAgICAgICBPIGNoYXQgc2Vyw6EgbGliZXJhZG8gcXVhbmRvIHRvZGFzIGFzIHZhZ2FzIGZvcmVtIHByZWVuY2hpZGFzIG91IG8gZXZlbnRvIGZvciBjb25maXJtYWRvLlxyXG4gICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIDxCdXR0b24gb25DbGljaz17KCkgPT4gbmF2aWdhdGUoYC9ldmVudC8ke2V2ZW50SWR9YCl9PlxyXG4gICAgICAgICAgICA8QXJyb3dMZWZ0IGNsYXNzTmFtZT1cInctNCBoLTQgbXItMlwiIC8+XHJcbiAgICAgICAgICAgIFZvbHRhciBhbyBFdmVudG9cclxuICAgICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPD5cclxuICAgICAgPEhlbG1ldD5cclxuICAgICAgICA8dGl0bGU+Q2hhdDoge2V2ZW50TmFtZSB8fCAnRXZlbnRvJ30gfCBNZXNhcHJhMjwvdGl0bGU+XHJcbiAgICAgIDwvSGVsbWV0PlxyXG5cclxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGgtW2NhbGMoMTAwdmgtOHJlbSldIGJnLWdyYXktOTAwLzUwIHJvdW5kZWQtMnhsIGJvcmRlciBib3JkZXItd2hpdGUvMTAgb3ZlcmZsb3ctaGlkZGVuXCI+XHJcbiAgICAgICAgPGhlYWRlciBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBwLTQgYm9yZGVyLWIgYm9yZGVyLXdoaXRlLzEwIGJnLWJhY2tncm91bmQvODAgYmFja2Ryb3AtYmx1ci1zbSB6LTEwXCI+XHJcbiAgICAgICAgICA8TGluayB0bz17YC9ldmVudC8ke2V2ZW50SWR9YH0gY2xhc3NOYW1lPVwibXItNFwiPlxyXG4gICAgICAgICAgICA8QnV0dG9uIHZhcmlhbnQ9XCJnaG9zdFwiIHNpemU9XCJpY29uXCI+XHJcbiAgICAgICAgICAgICAgPEFycm93TGVmdCBjbGFzc05hbWU9XCJ3LTUgaC01XCIgLz5cclxuICAgICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgICA8L0xpbms+XHJcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXgtMVwiPlxyXG4gICAgICAgICAgICA8aDEgY2xhc3NOYW1lPVwidGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtd2hpdGUgdHJ1bmNhdGVcIj57ZXZlbnROYW1lfTwvaDE+XHJcbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQteHMgdGV4dC13aGl0ZS81MFwiPlxyXG4gICAgICAgICAgICAgIHthY3RpdmVQYXJ0aWNpcGFudENvdW50fSBwYXJ0aWNpcGFudGVzXHJcbiAgICAgICAgICAgICAge2V2ZW50Py5ldmVudF90eXBlID09PSAnaW5zdGl0dWNpb25hbCcgJiYgPHNwYW4gY2xhc3NOYW1lPVwibWwtMiB0ZXh0LXB1cnBsZS00MDBcIj7igKIgSW5zdGl0dWNpb25hbDwvc3Bhbj59XHJcbiAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvaGVhZGVyPlxyXG5cclxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXgtMSBwLTQgb3ZlcmZsb3cteS1hdXRvIHNwYWNlLXktNFwiPlxyXG4gICAgICAgICAge2V2ZW50Py5ldmVudF90eXBlID09PSAnaW5zdGl0dWNpb25hbCcgJiYgbWVzc2FnZXMubGVuZ3RoID09PSAwICYmIChcclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWNlbnRlciBweS04XCI+XHJcbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJpbmxpbmUtYmxvY2sgcC00IHJvdW5kZWQtbGcgYmctcHVycGxlLTUwMC8xMCBib3JkZXIgYm9yZGVyLXB1cnBsZS01MDAvMzBcIj5cclxuICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtcHVycGxlLTMwMCB0ZXh0LXNtXCI+XHJcbiAgICAgICAgICAgICAgICAgIENoYXQgbGliZXJhZG8hIEVzdGUgw6kgdW0gZXZlbnRvIGluc3RpdHVjaW9uYWwuPGJyIC8+XHJcbiAgICAgICAgICAgICAgICAgIEFwcm92ZWl0ZSBwYXJhIGludGVyYWdpciBlIHRpcmFyIGTDunZpZGFzIGNvbSBvcyBvdXRyb3MgcGFydGljaXBhbnRlcy5cclxuICAgICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIHttZXNzYWdlcy5tYXAoKG1zZykgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzZW5kZXJQcm9maWxlID0gZ2V0U2VuZGVyUHJvZmlsZShtc2cudXNlcl9pZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzTWUgPSBtc2cudXNlcl9pZCA9PT0gdXNlci5pZDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgPGRpdiBrZXk9e21zZy5pZH0gY2xhc3NOYW1lPXtgZmxleCBpdGVtcy1lbmQgZ2FwLTMgJHtpc01lID8gJ2p1c3RpZnktZW5kJyA6ICdqdXN0aWZ5LXN0YXJ0J31gfT5cclxuICAgICAgICAgICAgICAgIHshaXNNZSAmJiAoXHJcbiAgICAgICAgICAgICAgICAgIDxpbWdcclxuICAgICAgICAgICAgICAgICAgICBzcmM9e2dldEF2YXRhclVybChzZW5kZXJQcm9maWxlKX1cclxuICAgICAgICAgICAgICAgICAgICBhbHQ9e3NlbmRlclByb2ZpbGUudXNlcm5hbWUgfHwgJ1VzdcOhcmlvJ31cclxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJ3LTggaC04IHJvdW5kZWQtZnVsbCBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIGZsZXgtc2hyaW5rLTAgb2JqZWN0LWNvdmVyXCJcclxuICAgICAgICAgICAgICAgICAgICBvbkVycm9yPXsoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuc3JjID0gYGh0dHBzOi8vdWktYXZhdGFycy5jb20vYXBpLz9uYW1lPVUmYmFja2dyb3VuZD04YjVjZjYmY29sb3I9ZmZmJnNpemU9NDBgO1xyXG4gICAgICAgICAgICAgICAgICAgIH19XHJcbiAgICAgICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgICAgICApfVxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWVuZCBnYXAtMlwiPlxyXG4gICAgICAgICAgICAgICAgICA8ZGl2XHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgZmxleCBmbGV4LWNvbCBtYXgtdy14cyBtZDptYXgtdy1tZCBwLTMgcm91bmRlZC1sZyAke1xyXG4gICAgICAgICAgICAgICAgICAgICAgaXNNZSA/ICdiZy1wdXJwbGUtNjAwIHRleHQtd2hpdGUgcm91bmRlZC1ici1ub25lJyA6ICdiZy1ncmF5LTgwMCB0ZXh0LXdoaXRlLzkwIHJvdW5kZWQtYmwtbm9uZSdcclxuICAgICAgICAgICAgICAgICAgICB9YH1cclxuICAgICAgICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAgICAgIHshaXNNZSAmJiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgdGV4dC1wdXJwbGUtMzAwIG1iLTFcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAge3NlbmRlclByb2ZpbGUudXNlcm5hbWUgfHwgc2VuZGVyUHJvZmlsZS5mdWxsX25hbWUgfHwgJ1VzdcOhcmlvJ31cclxuICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICApfVxyXG4gICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtc20gd2hpdGVzcGFjZS1wcmUtd3JhcFwiPnttc2cuY29udGVudH08L3A+XHJcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC14cyB0ZXh0LXdoaXRlLzUwIG10LTEgc2VsZi1lbmRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgIHtmb3JtYXQobmV3IERhdGUobXNnLmNyZWF0ZWRfYXQpLCAnSEg6bW0nLCB7IGxvY2FsZTogcHRCUiB9KX1cclxuICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgICAgICAgeyhpc01lIHx8IGlzQ3JlYXRvcikgJiYgKFxyXG4gICAgICAgICAgICAgICAgICAgIDxTaW1wbGVEcm9wZG93blxyXG4gICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcj17XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24gdmFyaWFudD1cImdob3N0XCIgc2l6ZT1cImljb25cIiBjbGFzc05hbWU9XCJoLTYgdy02IG9wYWNpdHktMCBob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHlcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICA8TW9yZVZlcnRpY2FsIGNsYXNzTmFtZT1cImgtNCBoLTRcIiAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICA+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8U2ltcGxlRHJvcGRvd25JdGVtIG9uQ2xpY2s9eygpID0+IGhhbmRsZURlbGV0ZU1lc3NhZ2UobXNnLmlkKX0gY2xhc3NOYW1lPVwidGV4dC1yZWQtNDAwXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxUcmFzaDIgY2xhc3NOYW1lPVwidy00IGgtNCBtci0yXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgQXBhZ2FyIG1lbnNhZ2VtXHJcbiAgICAgICAgICAgICAgICAgICAgICA8L1NpbXBsZURyb3Bkb3duSXRlbT5cclxuICAgICAgICAgICAgICAgICAgICA8L1NpbXBsZURyb3Bkb3duPlxyXG4gICAgICAgICAgICAgICAgICApfVxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICB7aXNNZSAmJiAoXHJcbiAgICAgICAgICAgICAgICAgIDxpbWdcclxuICAgICAgICAgICAgICAgICAgICBzcmM9e2dldEF2YXRhclVybChzZW5kZXJQcm9maWxlKX1cclxuICAgICAgICAgICAgICAgICAgICBhbHQ9XCJWb2PDqlwiXHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwidy04IGgtOCByb3VuZGVkLWZ1bGwgYm9yZGVyIGJvcmRlci13aGl0ZS8xMCBmbGV4LXNocmluay0wIG9iamVjdC1jb3ZlclwiXHJcbiAgICAgICAgICAgICAgICAgICAgb25FcnJvcj17KGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnNyYyA9IGBodHRwczovL3VpLWF2YXRhcnMuY29tL2FwaS8/bmFtZT1VJmJhY2tncm91bmQ9OGI1Y2Y2JmNvbG9yPWZmZiZzaXplPTQwYDtcclxuICAgICAgICAgICAgICAgICAgICB9fVxyXG4gICAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICAgKX1cclxuICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0pfVxyXG4gICAgICAgICAgPGRpdiByZWY9e21lc3NhZ2VzRW5kUmVmfSAvPlxyXG4gICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICA8Zm9ybSBvblN1Ym1pdD17aGFuZGxlU3VibWl0fSBjbGFzc05hbWU9XCJwLTQgYm9yZGVyLXQgYm9yZGVyLXdoaXRlLzEwIGJnLWJhY2tncm91bmQvODAgYmFja2Ryb3AtYmx1ci1zbVwiPlxyXG4gICAgICAgICAge2V2ZW50U3RhdHVzID09PSAnQ29uY2x1w61kbycgJiYgKFxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1iLTMgcC0yIHJvdW5kZWQtbGcgYmctZ3JheS03MDAvNTAgYm9yZGVyIGJvcmRlci1ncmF5LTYwMC81MFwiPlxyXG4gICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtZ3JheS0zMDAgdGV4dC14cyB0ZXh0LWNlbnRlclwiPlxyXG4gICAgICAgICAgICAgICAgRXZlbnRvIGNvbmNsdcOtZG8gLSBDaGF0IGVtIG1vZG8gbGVpdHVyYVxyXG4gICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICApfVxyXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtM1wiPlxyXG4gICAgICAgICAgICA8SW5wdXRcclxuICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXHJcbiAgICAgICAgICAgICAgdmFsdWU9e25ld01lc3NhZ2V9XHJcbiAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXROZXdNZXNzYWdlKGUudGFyZ2V0LnZhbHVlKX1cclxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17ZXZlbnRTdGF0dXMgPT09ICdDb25jbHXDrWRvJyA/ICdDaGF0IGVuY2VycmFkby4uLicgOiAnRGlnaXRlIHN1YSBtZW5zYWdlbS4uLid9XHJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiZmxleC0xIGJnLWdyYXktODAwIGJvcmRlci1ncmF5LTcwMFwiXHJcbiAgICAgICAgICAgICAgYXV0b0NvbXBsZXRlPVwib2ZmXCJcclxuICAgICAgICAgICAgICBkaXNhYmxlZD17ZXZlbnRTdGF0dXMgPT09ICdDb25jbHXDrWRvJ31cclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgPEJ1dHRvblxyXG4gICAgICAgICAgICAgIHR5cGU9XCJzdWJtaXRcIlxyXG4gICAgICAgICAgICAgIHNpemU9XCJpY29uXCJcclxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJmbGV4LXNocmluay0wXCJcclxuICAgICAgICAgICAgICBkaXNhYmxlZD17IW5ld01lc3NhZ2UudHJpbSgpIHx8IGV2ZW50U3RhdHVzID09PSAnQ29uY2x1w61kbyd9XHJcbiAgICAgICAgICAgID5cclxuICAgICAgICAgICAgICA8U2VuZCBjbGFzc05hbWU9XCJ3LTUgaC01XCIgLz5cclxuICAgICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Zvcm0+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC8+XHJcbiAgKTtcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEV2ZW50Q2hhdFBhZ2U7Il0sInZlcnNpb24iOjN9