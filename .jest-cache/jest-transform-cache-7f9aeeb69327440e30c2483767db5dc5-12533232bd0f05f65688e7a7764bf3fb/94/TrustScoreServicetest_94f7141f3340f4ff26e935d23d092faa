56eb6e1b9621013fe9da303ac457fc21
"use strict";
// src/services/TrustScoreService.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => ({
    supabase: {
        from: mockFrom,
    }
}));
// --- 1. MOCKING DEPENDÊNCIAS (ANTES DAS IMPORTAÇÕES) ---
// Mock do Supabase
const mockFrom = jest.fn();
const TrustScoreService_1 = tslib_1.__importDefault(require("./TrustScoreService"));
// --- 3. CONFIGURAÇÃO DOS TESTES ---
describe('TrustScoreService', () => {
    // Espiões para métodos privados que queremos verificar se foram chamados
    let spyLogChange;
    let spyLogBan;
    let spyLogUnban;
    let spyBanUser;
    beforeEach(() => {
        jest.clearAllMocks();
        // Espiamos os métodos de log (privados) e banUser
        spyLogChange = jest.spyOn(TrustScoreService_1.default, 'logTrustScoreChange')
            .mockResolvedValue(undefined);
        spyLogBan = jest.spyOn(TrustScoreService_1.default, 'logBanishment')
            .mockResolvedValue(undefined);
        spyLogUnban = jest.spyOn(TrustScoreService_1.default, 'logUnbanishment')
            .mockResolvedValue(undefined);
        spyBanUser = jest.spyOn(TrustScoreService_1.default, 'banUser')
            .mockResolvedValue({ success: true });
    });
    afterEach(() => {
        // Restauramos todos os espiões
        spyLogChange.mockRestore();
        spyLogBan.mockRestore();
        spyLogUnban.mockRestore();
        spyBanUser.mockRestore();
    });
    // --- 4. TESTES DOS MÉTODOS ---
    describe('getTrustScore', () => {
        it('deve retornar o score e o status de banido do usuário', async () => {
            const mockProfile = { trust_score: 3, is_banned: false };
            // Mock do SELECT
            const mockSingle = jest.fn().mockResolvedValue({ data: mockProfile, error: null });
            const mockEq = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                select: mockSelect,
            });
            const result = await TrustScoreService_1.default.getTrustScore('user-1');
            expect(result.success).toBe(true);
            expect(result.data?.trustScore).toBe(3);
            expect(result.data?.isBanned).toBe(false);
            expect(mockFrom).toHaveBeenCalledWith('profiles');
        });
        it('deve retornar score 5 (padrão) se o usuário não tiver score', async () => {
            const mockProfile = { trust_score: null, is_banned: false };
            const mockSingle = jest.fn().mockResolvedValue({ data: mockProfile, error: null });
            const mockEq = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                select: mockSelect,
            });
            const result = await TrustScoreService_1.default.getTrustScore('user-1');
            expect(result.success).toBe(true);
            expect(result.data?.trustScore).toBe(5);
        });
        it('deve retornar "Usuário não encontrado" em erro PGRST116', async () => {
            const mockSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { code: 'PGRST116' }
            });
            const mockEq = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                select: mockSelect,
            });
            const result = await TrustScoreService_1.default.getTrustScore('user-404');
            expect(result.success).toBe(false);
            expect(result.error).toBe('Usuário não encontrado');
        });
    });
    describe('penalizeNoShow', () => {
        it('deve reduzir o score em 1 e registrar o log', async () => {
            const mockProfile = { trust_score: 4 };
            // Mock 1: SELECT (para pegar score atual)
            const mockSingle1 = jest.fn().mockResolvedValue({ data: mockProfile, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle1 });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: UPDATE (para salvar novo score)
            const mockEq2 = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq2 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect }) // primeira chamada: buscar score
                .mockReturnValueOnce({ update: mockUpdate }); // segunda chamada: atualizar score
            const result = await TrustScoreService_1.default.penalizeNoShow('user-penalize');
            expect(result.success).toBe(true);
            expect(result.data?.newScore).toBe(3);
            expect(result.data?.wasBanned).toBe(false);
            // Verifica se o UPDATE foi chamado com o novo score
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ trust_score: 3 }));
            // Verifica se o Log foi chamado
            expect(spyLogChange).toHaveBeenCalledWith('user-penalize', 4, 3, 'no_show');
            // Garante que NÃO baniu
            expect(spyBanUser).not.toHaveBeenCalled();
        });
        it('deve reduzir o score para 0 e chamar banUser', async () => {
            const mockProfile = { trust_score: 1 };
            // Mock 1: SELECT
            const mockSingle = jest.fn().mockResolvedValue({ data: mockProfile, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: UPDATE
            const mockEq2 = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq2 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect })
                .mockReturnValueOnce({ update: mockUpdate });
            const result = await TrustScoreService_1.default.penalizeNoShow('user-banir');
            expect(result.success).toBe(true);
            expect(result.data?.newScore).toBe(0);
            expect(result.data?.wasBanned).toBe(true);
            // Verifica se o UPDATE foi chamado com 0
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ trust_score: 0 }));
            // Verifica se o Log foi chamado
            expect(spyLogChange).toHaveBeenCalledWith('user-banir', 1, 0, 'no_show');
            // VERIFICA SE O BANIMENTO FOI CHAMADO
            expect(spyBanUser).toHaveBeenCalledWith('user-banir', 'Trust score atingiu 0');
        });
    });
    describe('banUser', () => {
        it('deve banir o usuário e registrar o log', async () => {
            // Libera o spy para testar a implementação real
            spyBanUser.mockRestore();
            // Mock do UPDATE (banimento)
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                update: mockUpdate,
            });
            const result = await TrustScoreService_1.default.banUser('user-banir', 'Motivo teste');
            expect(result.success).toBe(true);
            // Verifica se o UPDATE foi chamado corretamente
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ is_banned: true, trust_score: 0 }));
            // Verifica se o log de banimento foi chamado
            expect(spyLogBan).toHaveBeenCalledWith('user-banir', 'Motivo teste');
        });
    });
    describe('unbanUserAfterPayment', () => {
        it('deve desbanir, resetar score, registrar pagamento e log', async () => {
            // Mock 1: UPDATE (unban)
            const mockEq1 = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: INSERT (payment)
            const mockInsert = jest.fn().mockResolvedValue({ error: null });
            mockFrom
                .mockReturnValueOnce({ update: mockUpdate }) // primeira chamada: unban
                .mockReturnValueOnce({ insert: mockInsert }); // segunda chamada: payment
            const result = await TrustScoreService_1.default.unbanUserAfterPayment('user-unban', 'pay-123');
            expect(result.success).toBe(true);
            expect(result.data?.newScore).toBe(5);
            // Verifica se o UPDATE (unban) foi chamado
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ is_banned: false, trust_score: 5 }));
            // Verifica se o INSERT (payment) foi chamado
            expect(mockInsert).toHaveBeenCalledWith(expect.objectContaining({ user_id: 'user-unban', stripe_payment_id: 'pay-123' }));
            // Verifica se o log de unban foi chamado
            expect(spyLogUnban).toHaveBeenCalledWith('user-unban', 'pay-123');
        });
    });
    describe('penalizeNoShowsForEvent', () => {
        // Espião específico para penalizeNoShow
        let spyPenalize;
        beforeEach(() => {
            spyPenalize = jest.spyOn(TrustScoreService_1.default, 'penalizeNoShow')
                .mockResolvedValue({ success: true });
        });
        afterEach(() => {
            spyPenalize.mockRestore();
        });
        it('deve chamar penalizeNoShow para cada usuário que não compareceu', async () => {
            const mockNoShows = [
                { id: 'part-1', user_id: 'user-A' },
                { id: 'part-2', user_id: 'user-B' },
            ];
            // Mock do SELECT (no-shows) - 4 .eq() encadeados
            const mockEq4 = jest.fn().mockResolvedValue({ data: mockNoShows, error: null });
            const mockEq3 = jest.fn().mockReturnValue({ eq: mockEq4 });
            const mockEq2 = jest.fn().mockReturnValue({ eq: mockEq3 });
            const mockEq1 = jest.fn().mockReturnValue({ eq: mockEq2 });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });
            mockFrom.mockReturnValue({
                select: mockSelect,
            });
            const result = await TrustScoreService_1.default.penalizeNoShowsForEvent(1);
            expect(result.success).toBe(true);
            expect(result.data?.penalized).toBe(2);
            // Verifica se o método de penalizar foi chamado 2x
            expect(spyPenalize).toHaveBeenCalledTimes(2);
            expect(spyPenalize).toHaveBeenCalledWith('user-A');
            expect(spyPenalize).toHaveBeenCalledWith('user-B');
        });
        it('não deve fazer nada se não houver no-shows', async () => {
            // Mock do SELECT (vazio)
            const mockEq4 = jest.fn().mockResolvedValue({ data: [], error: null });
            const mockEq3 = jest.fn().mockReturnValue({ eq: mockEq4 });
            const mockEq2 = jest.fn().mockReturnValue({ eq: mockEq3 });
            const mockEq1 = jest.fn().mockReturnValue({ eq: mockEq2 });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });
            mockFrom.mockReturnValue({
                select: mockSelect,
            });
            const result = await TrustScoreService_1.default.penalizeNoShowsForEvent(1);
            expect(result.success).toBe(true);
            expect(result.data?.penalized).toBe(0);
            // Garante que não penalizou ninguém
            expect(spyPenalize).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcVHJ1c3RTY29yZVNlcnZpY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUEseUNBQXlDOzs7QUFPekMsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3hDLFFBQVEsRUFBRTtRQUNSLElBQUksRUFBRSxRQUFRO0tBQ2Y7Q0FDRixDQUFDLENBQUMsQ0FBQztBQVRKLDBEQUEwRDtBQUUxRCxtQkFBbUI7QUFDbkIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBVzNCLG9GQUFvRDtBQUVwRCxxQ0FBcUM7QUFFckMsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUVqQyx5RUFBeUU7SUFDekUsSUFBSSxZQUFxQyxDQUFDO0lBQzFDLElBQUksU0FBa0MsQ0FBQztJQUN2QyxJQUFJLFdBQW9DLENBQUM7SUFDekMsSUFBSSxVQUFnRSxDQUFDO0lBRXJFLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsa0RBQWtEO1FBQ2xELFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLDJCQUF3QixFQUFFLHFCQUFxQixDQUFDO2FBQ3ZFLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRWhDLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLDJCQUF3QixFQUFFLGVBQWUsQ0FBQzthQUM5RCxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVoQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQywyQkFBd0IsRUFBRSxpQkFBaUIsQ0FBQzthQUNsRSxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVoQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQywyQkFBaUIsRUFBRSxTQUFTLENBQUM7YUFDbEQsaUJBQWlCLENBQUMsRUFBRSxPQUFPLEVBQUUs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TSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBRTlELFFBQVEsQ0FBQyxlQUFlLENBQUM7Z0JBQ3ZCLE1BQU0sRUFBRSxVQUFVO2FBQ25CLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sMkJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFbEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXZDLG9DQUFvQztZQUNwQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUVMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcc2VydmljZXNcXFRydXN0U2NvcmVTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL1RydXN0U2NvcmVTZXJ2aWNlLnRlc3QudHNcclxuXHJcbi8vIC0tLSAxLiBNT0NLSU5HIERFUEVORMOKTkNJQVMgKEFOVEVTIERBUyBJTVBPUlRBw4fDlUVTKSAtLS1cclxuXHJcbi8vIE1vY2sgZG8gU3VwYWJhc2VcclxuY29uc3QgbW9ja0Zyb20gPSBqZXN0LmZuKCk7XHJcblxyXG5qZXN0Lm1vY2soJy4uL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+ICh7XHJcbiAgc3VwYWJhc2U6IHtcclxuICAgIGZyb206IG1vY2tGcm9tLFxyXG4gIH1cclxufSkpO1xyXG5cclxuLy8gLS0tIDIuIElNUE9SVEHDh8OVRVMgKERFUE9JUyBET1MgTU9DS1MpIC0tLVxyXG5cclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9saWIvc3VwYWJhc2VDbGllbnQnO1xyXG5pbXBvcnQgVHJ1c3RTY29yZVNlcnZpY2UgZnJvbSAnLi9UcnVzdFNjb3JlU2VydmljZSc7XHJcblxyXG4vLyAtLS0gMy4gQ09ORklHVVJBw4fDg08gRE9TIFRFU1RFUyAtLS1cclxuXHJcbmRlc2NyaWJlKCdUcnVzdFNjb3JlU2VydmljZScsICgpID0+IHtcclxuXHJcbiAgLy8gRXNwacO1ZXMgcGFyYSBtw6l0b2RvcyBwcml2YWRvcyBxdWUgcXVlcmVtb3MgdmVyaWZpY2FyIHNlIGZvcmFtIGNoYW1hZG9zXHJcbiAgbGV0IHNweUxvZ0NoYW5nZTogamVzdC5TcGllZEZ1bmN0aW9uPGFueT47XHJcbiAgbGV0IHNweUxvZ0JhbjogamVzdC5TcGllZEZ1bmN0aW9uPGFueT47XHJcbiAgbGV0IHNweUxvZ1VuYmFuOiBqZXN0LlNwaWVkRnVuY3Rpb248YW55PjtcclxuICBsZXQgc3B5QmFuVXNlcjogamVzdC5TcGllZEZ1bmN0aW9uPHR5cGVvZiBUcnVzdFNjb3JlU2VydmljZS5iYW5Vc2VyPjtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuXHJcbiAgICAvLyBFc3BpYW1vcyBvcyBtw6l0b2RvcyBkZSBsb2cgKHByaXZhZG9zKSBlIGJhblVzZXJcclxuICAgIHNweUxvZ0NoYW5nZSA9IGplc3Quc3B5T24oVHJ1c3RTY29yZVNlcnZpY2UgYXMgYW55LCAnbG9nVHJ1c3RTY29yZUNoYW5nZScpXHJcbiAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICBcclxuICAgIHNweUxvZ0JhbiA9IGplc3Quc3B5T24oVHJ1c3RTY29yZVNlcnZpY2UgYXMgYW55LCAnbG9nQmFuaXNobWVudCcpXHJcbiAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICBcclxuICAgIHNweUxvZ1VuYmFuID0gamVzdC5zcHlPbihUcnVzdFNjb3JlU2VydmljZSBhcyBhbnksICdsb2dVbmJhbmlzaG1lbnQnKVxyXG4gICAgICAubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcclxuICAgICAgXHJcbiAgICBzcHlCYW5Vc2VyID0gamVzdC5zcHlPbihUcnVzdFNjb3JlU2VydmljZSwgJ2JhblVzZXInKVxyXG4gICAgICAubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlIH0pO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgLy8gUmVzdGF1cmFtb3MgdG9kb3Mgb3MgZXNwacO1ZXNcclxuICAgIHNweUxvZ0NoYW5nZS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgc3B5TG9nQmFuLm1vY2tSZXN0b3JlKCk7XHJcbiAgICBzcHlMb2dVbmJhbi5tb2NrUmVzdG9yZSgpO1xyXG4gICAgc3B5QmFuVXNlci5tb2NrUmVzdG9yZSgpO1xyXG4gIH0pO1xyXG5cclxuICAvLyAtLS0gNC4gVEVTVEVTIERPUyBNw4lUT0RPUyAtLS1cclxuXHJcbiAgZGVzY3JpYmUoJ2dldFRydXN0U2NvcmUnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBvIHNjb3JlIGUgbyBzdGF0dXMgZGUgYmFuaWRvIGRvIHVzdcOhcmlvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUHJvZmlsZSA9IHsgdHJ1c3Rfc2NvcmU6IDMsIGlzX2Jhbm5lZDogZmFsc2UgfTtcclxuXHJcbiAgICAgIC8vIE1vY2sgZG8gU0VMRUNUXHJcbiAgICAgIGNvbnN0IG1vY2tTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrUHJvZmlsZSwgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzaW5nbGU6IG1vY2tTaW5nbGUgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcSB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBtb2NrU2VsZWN0LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRydXN0U2NvcmVTZXJ2aWNlLmdldFRydXN0U2NvcmUoJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LnRydXN0U2NvcmUpLnRvQmUoMyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8uaXNCYW5uZWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QobW9ja0Zyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwcm9maWxlcycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgc2NvcmUgNSAocGFkcsOjbykgc2UgbyB1c3XDoXJpbyBuw6NvIHRpdmVyIHNjb3JlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUHJvZmlsZSA9IHsgdHJ1c3Rfc2NvcmU6IG51bGwsIGlzX2Jhbm5lZDogZmFsc2UgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1vY2tTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrUHJvZmlsZSwgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzaW5nbGU6IG1vY2tTaW5nbGUgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcSB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBtb2NrU2VsZWN0LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRydXN0U2NvcmVTZXJ2aWNlLmdldFRydXN0U2NvcmUoJ3VzZXItMScpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8udHJ1c3RTY29yZSkudG9CZSg1KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIHJldG9ybmFyIFwiVXN1w6FyaW8gbsOjbyBlbmNvbnRyYWRvXCIgZW0gZXJybyBQR1JTVDExNicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1NpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IFxyXG4gICAgICAgIGRhdGE6IG51bGwsIFxyXG4gICAgICAgIGVycm9yOiB7IGNvZGU6ICdQR1JTVDExNicgfSBcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzaW5nbGU6IG1vY2tTaW5nbGUgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcSB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBtb2NrU2VsZWN0LFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRydXN0U2NvcmVTZXJ2aWNlLmdldFRydXN0U2NvcmUoJ3VzZXItNDA0Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ1VzdcOhcmlvIG7Do28gZW5jb250cmFkbycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdwZW5hbGl6ZU5vU2hvdycsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIHJlZHV6aXIgbyBzY29yZSBlbSAxIGUgcmVnaXN0cmFyIG8gbG9nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUHJvZmlsZSA9IHsgdHJ1c3Rfc2NvcmU6IDQgfTtcclxuXHJcbiAgICAgIC8vIE1vY2sgMTogU0VMRUNUIChwYXJhIHBlZ2FyIHNjb3JlIGF0dWFsKVxyXG4gICAgICBjb25zdCBtb2NrU2luZ2xlMSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tQcm9maWxlLCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxMSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzaW5nbGU6IG1vY2tTaW5nbGUxIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXExIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayAyOiBVUERBVEUgKHBhcmEgc2FsdmFyIG5vdm8gc2NvcmUpXHJcbiAgICAgIGNvbnN0IG1vY2tFcTIgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMiB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyBzZWxlY3Q6IG1vY2tTZWxlY3QgfSkgLy8gcHJpbWVpcmEgY2hhbWFkYTogYnVzY2FyIHNjb3JlXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyB1cGRhdGU6IG1vY2tVcGRhdGUgfSk7IC8vIHNlZ3VuZGEgY2hhbWFkYTogYXR1YWxpemFyIHNjb3JlXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUcnVzdFNjb3JlU2VydmljZS5wZW5hbGl6ZU5vU2hvdygndXNlci1wZW5hbGl6ZScpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/Lm5ld1Njb3JlKS50b0JlKDMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/Lndhc0Jhbm5lZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIFVQREFURSBmb2kgY2hhbWFkbyBjb20gbyBub3ZvIHNjb3JlXHJcbiAgICAgIGV4cGVjdChtb2NrVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHRydXN0X3Njb3JlOiAzIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIExvZyBmb2kgY2hhbWFkb1xyXG4gICAgICBleHBlY3Qoc3B5TG9nQ2hhbmdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci1wZW5hbGl6ZScsIDQsIDMsICdub19zaG93Jyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBHYXJhbnRlIHF1ZSBOw4NPIGJhbml1XHJcbiAgICAgIGV4cGVjdChzcHlCYW5Vc2VyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgcmVkdXppciBvIHNjb3JlIHBhcmEgMCBlIGNoYW1hciBiYW5Vc2VyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUHJvZmlsZSA9IHsgdHJ1c3Rfc2NvcmU6IDEgfTtcclxuXHJcbiAgICAgIC8vIE1vY2sgMTogU0VMRUNUXHJcbiAgICAgIGNvbnN0IG1vY2tTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrUHJvZmlsZSwgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tFcTEgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgc2luZ2xlOiBtb2NrU2luZ2xlIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXExIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayAyOiBVUERBVEVcclxuICAgICAgY29uc3QgbW9ja0VxMiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEyIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb21cclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7IHNlbGVjdDogbW9ja1NlbGVjdCB9KVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHsgdXBkYXRlOiBtb2NrVXBkYXRlIH0pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJ1c3RTY29yZVNlcnZpY2UucGVuYWxpemVOb1Nob3coJ3VzZXItYmFuaXInKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy5uZXdTY29yZSkudG9CZSgwKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy53YXNCYW5uZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIFVQREFURSBmb2kgY2hhbWFkbyBjb20gMFxyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyB0cnVzdF9zY29yZTogMCB9KVxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBMb2cgZm9pIGNoYW1hZG9cclxuICAgICAgZXhwZWN0KHNweUxvZ0NoYW5nZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXItYmFuaXInLCAxLCAwLCAnbm9fc2hvdycpO1xyXG4gICAgICBcclxuICAgICAgLy8gVkVSSUZJQ0EgU0UgTyBCQU5JTUVOVE8gRk9JIENIQU1BRE9cclxuICAgICAgZXhwZWN0KHNweUJhblVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyLWJhbmlyJywgJ1RydXN0IHNjb3JlIGF0aW5naXUgMCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdiYW5Vc2VyJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgYmFuaXIgbyB1c3XDoXJpbyBlIHJlZ2lzdHJhciBvIGxvZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gTGliZXJhIG8gc3B5IHBhcmEgdGVzdGFyIGEgaW1wbGVtZW50YcOnw6NvIHJlYWxcclxuICAgICAgc3B5QmFuVXNlci5tb2NrUmVzdG9yZSgpOyBcclxuICAgICAgXHJcbiAgICAgIC8vIE1vY2sgZG8gVVBEQVRFIChiYW5pbWVudG8pXHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEgfSk7XHJcblxyXG4gICAgICBtb2NrRnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVwZGF0ZTogbW9ja1VwZGF0ZSxcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUcnVzdFNjb3JlU2VydmljZS5iYW5Vc2VyKCd1c2VyLWJhbmlyJywgJ01vdGl2byB0ZXN0ZScpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBVUERBVEUgZm9pIGNoYW1hZG8gY29ycmV0YW1lbnRlXHJcbiAgICAgIGV4cGVjdChtb2NrVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IGlzX2Jhbm5lZDogdHJ1ZSwgdHJ1c3Rfc2NvcmU6IDAgfSlcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gbG9nIGRlIGJhbmltZW50byBmb2kgY2hhbWFkb1xyXG4gICAgICBleHBlY3Qoc3B5TG9nQmFuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci1iYW5pcicsICdNb3Rpdm8gdGVzdGUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndW5iYW5Vc2VyQWZ0ZXJQYXltZW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgZGVzYmFuaXIsIHJlc2V0YXIgc2NvcmUsIHJlZ2lzdHJhciBwYWdhbWVudG8gZSBsb2cnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIE1vY2sgMTogVVBEQVRFICh1bmJhbilcclxuICAgICAgY29uc3QgbW9ja0VxMSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXExIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayAyOiBJTlNFUlQgKHBheW1lbnQpXHJcbiAgICAgIGNvbnN0IG1vY2tJbnNlcnQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyB1cGRhdGU6IG1vY2tVcGRhdGUgfSkgLy8gcHJpbWVpcmEgY2hhbWFkYTogdW5iYW5cclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7IGluc2VydDogbW9ja0luc2VydCB9KTsgLy8gc2VndW5kYSBjaGFtYWRhOiBwYXltZW50XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUcnVzdFNjb3JlU2VydmljZS51bmJhblVzZXJBZnRlclBheW1lbnQoJ3VzZXItdW5iYW4nLCAncGF5LTEyMycpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/Lm5ld1Njb3JlKS50b0JlKDUpO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBVUERBVEUgKHVuYmFuKSBmb2kgY2hhbWFkb1xyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBpc19iYW5uZWQ6IGZhbHNlLCB0cnVzdF9zY29yZTogNSB9KVxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBJTlNFUlQgKHBheW1lbnQpIGZvaSBjaGFtYWRvXHJcbiAgICAgIGV4cGVjdChtb2NrSW5zZXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHVzZXJfaWQ6ICd1c2VyLXVuYmFuJywgc3RyaXBlX3BheW1lbnRfaWQ6ICdwYXktMTIzJyB9KVxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBsb2cgZGUgdW5iYW4gZm9pIGNoYW1hZG9cclxuICAgICAgZXhwZWN0KHNweUxvZ1VuYmFuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci11bmJhbicsICdwYXktMTIzJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3BlbmFsaXplTm9TaG93c0ZvckV2ZW50JywgKCkgPT4ge1xyXG4gICAgXHJcbiAgICAvLyBFc3Bpw6NvIGVzcGVjw61maWNvIHBhcmEgcGVuYWxpemVOb1Nob3dcclxuICAgIGxldCBzcHlQZW5hbGl6ZTogamVzdC5TcGllZEZ1bmN0aW9uPHR5cGVvZiBUcnVzdFNjb3JlU2VydmljZS5wZW5hbGl6ZU5vU2hvdz47XHJcbiAgICBcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBzcHlQZW5hbGl6ZSA9IGplc3Quc3B5T24oVHJ1c3RTY29yZVNlcnZpY2UsICdwZW5hbGl6ZU5vU2hvdycpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9KTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgICBzcHlQZW5hbGl6ZS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgY2hhbWFyIHBlbmFsaXplTm9TaG93IHBhcmEgY2FkYSB1c3XDoXJpbyBxdWUgbsOjbyBjb21wYXJlY2V1JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTm9TaG93cyA9IFtcclxuICAgICAgICB7IGlkOiAncGFydC0xJywgdXNlcl9pZDogJ3VzZXItQScgfSxcclxuICAgICAgICB7IGlkOiAncGFydC0yJywgdXNlcl9pZDogJ3VzZXItQicgfSxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIC8vIE1vY2sgZG8gU0VMRUNUIChuby1zaG93cykgLSA0IC5lcSgpIGVuY2FkZWFkb3NcclxuICAgICAgY29uc3QgbW9ja0VxNCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tOb1Nob3dzLCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxMyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxNCB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxMiA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMyB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxMSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMiB9KTtcclxuICAgICAgY29uc3QgbW9ja1NlbGVjdCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMSB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBtb2NrU2VsZWN0LFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRydXN0U2NvcmVTZXJ2aWNlLnBlbmFsaXplTm9TaG93c0ZvckV2ZW50KDEpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LnBlbmFsaXplZCkudG9CZSgyKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gbcOpdG9kbyBkZSBwZW5hbGl6YXIgZm9pIGNoYW1hZG8gMnhcclxuICAgICAgZXhwZWN0KHNweVBlbmFsaXplKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XHJcbiAgICAgIGV4cGVjdChzcHlQZW5hbGl6ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXItQScpO1xyXG4gICAgICBleHBlY3Qoc3B5UGVuYWxpemUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyLUInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCduw6NvIGRldmUgZmF6ZXIgbmFkYSBzZSBuw6NvIGhvdXZlciBuby1zaG93cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gTW9jayBkbyBTRUxFQ1QgKHZhemlvKVxyXG4gICAgICBjb25zdCBtb2NrRXE0ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXEzID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXE0IH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXEyID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEzIH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXExID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEyIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXExIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBzZWxlY3Q6IG1vY2tTZWxlY3QsXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJ1c3RTY29yZVNlcnZpY2UucGVuYWxpemVOb1Nob3dzRm9yRXZlbnQoMSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8ucGVuYWxpemVkKS50b0JlKDApO1xyXG4gICAgICBcclxuICAgICAgLy8gR2FyYW50ZSBxdWUgbsOjbyBwZW5hbGl6b3UgbmluZ3XDqW1cclxuICAgICAgZXhwZWN0KHNweVBlbmFsaXplKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG59KTsiXSwidmVyc2lvbiI6M30=