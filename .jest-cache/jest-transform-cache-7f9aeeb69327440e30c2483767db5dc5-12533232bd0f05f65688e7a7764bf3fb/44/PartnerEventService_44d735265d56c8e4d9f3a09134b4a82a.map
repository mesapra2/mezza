{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\PartnerEventService.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\PartnerEventService.ts"],"sourcesContent":["import { supabase } from '../lib/supabaseClient';\r\nimport NotificationService from './NotificationService';\r\n\r\ntype EventStatus = 'Aberto' | 'Confirmado' | 'Em Andamento' | 'Finalizado' | 'Conclu√≠do' | 'Cancelado';\r\n\r\ninterface Event {\r\n  id: string;\r\n  status: EventStatus;\r\n  start_time: string;\r\n  end_time: string;\r\n  vagas: number;\r\n  cancelamento_motivo?: string;\r\n  updated_at?: string;\r\n  creator_id?: string;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface Participation {\r\n  id: string;\r\n  event_id: string;\r\n  status: string;\r\n  presenca_confirmada: boolean;\r\n  avaliacao_feita: boolean;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface UpdateResult {\r\n  success: boolean;\r\n  updated?: number;\r\n  error?: any;\r\n}\r\n\r\ninterface EventStats {\r\n  success: boolean;\r\n  data?: {\r\n    event: Event;\r\n    totalCandidaturas: number;\r\n    aprovados: number;\r\n    presentes: number;\r\n    avaliacoes: number;\r\n  };\r\n  error?: any;\r\n}\r\n\r\ninterface ServiceResult {\r\n  success: boolean;\r\n  error?: string | any;\r\n  message?: string;\r\n  participation?: Participation;\r\n  data?: any;\r\n  isLateCancellation?: boolean;\r\n  isAutoApproved?: boolean;\r\n}\r\n\r\n/**\r\n * Servi√ßo para gerenciar o ciclo de vida e status dos eventos\r\n * Baseado no White Paper V2.9\r\n */\r\nclass PartnerEventService {\r\n  \r\n  /**\r\n   * Verifica e atualiza status de todos os eventos ativos\r\n   * Deve ser chamado periodicamente (a cada minuto)\r\n   */\r\n  static async updateAllEventStatuses(): Promise<UpdateResult> {\r\n    try {\r\n      const now = new Date();\r\n      \r\n      // Busca eventos que n√£o est√£o Conclu√≠dos ou Cancelados\r\n      const { data: events, error } = await supabase\r\n        .from('events')\r\n        .select('*')\r\n        .not('status', 'in', '(Concluido,Cancelado)');\r\n\r\n      if (error) throw error;\r\n\r\n      const updates: Array<{ id: string; status: EventStatus; updated_at: string }> = [];\r\n\r\n      for (const event of (events as unknown as Event[])) {\r\n        const newStatus = this.calculateEventStatus(event, now);\r\n        \r\n        if (newStatus !== event.status) {\r\n          updates.push({\r\n            id: event.id,\r\n            status: newStatus,\r\n            updated_at: now.toISOString()\r\n          });\r\n        }\r\n      }\r\n\r\n      // Atualiza em batch\r\n      if (updates.length > 0) {\r\n        for (const update of updates) {\r\n          await supabase\r\n            .from('events')\r\n            .update({ status: update.status, updated_at: update.updated_at })\r\n            .eq('id', update.id);\r\n        }\r\n        \r\n        console.log(`‚úÖ ${updates.length} eventos atualizados`);\r\n      }\r\n\r\n      return { success: true, updated: updates.length };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao atualizar status de eventos:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calcula o status correto de um evento baseado nas regras de neg√≥cio\r\n   */\r\n  static calculateEventStatus(event: Event, now: Date = new Date()): EventStatus {\r\n    const startTime = new Date(event.start_time);\r\n    const endTime = new Date(event.end_time);\r\n\r\n    // Cancelado permanece cancelado\r\n    if (event.status === 'Cancelado') {\r\n      return 'Cancelado';\r\n    }\r\n\r\n    // Conclu√≠do permanece conclu√≠do\r\n    if (event.status === 'Conclu√≠do') {\r\n      return 'Conclu√≠do';\r\n    }\r\n\r\n    // Evento j√° terminou ‚Üí Finalizado (aguardando avalia√ß√µes)\r\n    if (now >= endTime) {\r\n      return 'Finalizado';\r\n    }\r\n\r\n    // Evento est√° acontecendo ‚Üí Em Andamento\r\n    if (now >= startTime && now < endTime) {\r\n      return 'Em Andamento';\r\n    }\r\n\r\n    // Evento futuro - verifica regras\r\n    if (now < startTime) {\r\n      // ‚úÖ REGRA CR√çTICA: Confirma√ß√£o manual √© permanente!\r\n      // Se o anfitri√£o confirmou manualmente, respeitar isso\r\n      if (event.status === 'Confirmado') {\r\n        return 'Confirmado';\r\n      }\r\n\r\n      // Se vagas preenchidas automaticamente ‚Üí Confirmado\r\n      if (event.vagas <= 0) {\r\n        return 'Confirmado';\r\n      }\r\n      \r\n      // Se ainda tem vagas e est√° no prazo ‚Üí Aberto\r\n      // Candidaturas aceitas at√© 5 minutos antes do in√≠cio\r\n      const fiveMinutesBefore = new Date(startTime.getTime() - 5 * 60 * 1000);\r\n      if (now < fiveMinutesBefore) {\r\n        return 'Aberto';\r\n      }\r\n      \r\n      // Menos de 5 minutos para come√ßar ‚Üí Confirmado automaticamente\r\n      return 'Confirmado';\r\n    }\r\n\r\n    return event.status; // Mant√©m status atual se nada mudou\r\n  }\r\n\r\n  /**\r\n   * Confirma manualmente um evento (anfitri√£o fecha inscri√ß√µes)\r\n   */\r\n  static async confirmEvent(eventId: string): Promise<UpdateResult> {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('events')\r\n        .update({ \r\n          status: 'Confirmado',\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', eventId);\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`‚úÖ Evento ${eventId} confirmado manualmente`);\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao confirmar evento:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancela um evento\r\n   */\r\n  static async cancelEvent(eventId: string, reason: string = ''): Promise<UpdateResult> {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('events')\r\n        .update({ \r\n          status: 'Cancelado',\r\n          ...(reason && { cancelamento_motivo: reason }), // S√≥ inclui se reason for fornecido\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', eventId);\r\n\r\n      if (error) throw error;\r\n\r\n      // TODO: Notificar participantes\r\n      // TODO: Aplicar pol√≠ticas de cancelamento\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao cancelar evento:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Marca evento como conclu√≠do ap√≥s todas avalia√ß√µes\r\n   */\r\n  static async completeEvent(eventId: string): Promise<UpdateResult> {\r\n    try {\r\n      // Verifica se todas avalia√ß√µes foram feitas\r\n      const { data: participations, error: participationsError } = await supabase\r\n        .from('event_participants')\r\n        .select('id, avaliacao_feita')\r\n        .eq('event_id', eventId)\r\n        .eq('presenca_confirmada', true);\r\n\r\n      if (participationsError) throw participationsError;\r\n\r\n      const allEvaluated = (participations as unknown as Participation[]).every(p => p.avaliacao_feita === true);\r\n\r\n      if (!allEvaluated) {\r\n        return { \r\n          success: false, \r\n          error: 'Nem todos os participantes avaliaram o evento' \r\n        };\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('events')\r\n        .update({ \r\n          status: 'Conclu√≠do',\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', eventId);\r\n\r\n      if (error) throw error;\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao concluir evento:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Obt√©m estat√≠sticas de um evento\r\n   */\r\n  static async getEventStats(eventId: string): Promise<EventStats> {\r\n    try {\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('*, creator:profiles!creator_id(*)')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) throw eventError;\r\n\r\n      const { data: participations, error: participationsError } = await supabase\r\n        .from('event_participants')\r\n        .select('*')\r\n        .eq('event_id', eventId);\r\n\r\n      if (participationsError) throw participationsError;\r\n\r\n      const participationsList = participations as unknown as Participation[];\r\n\r\n      return {\r\n        success: true,\r\n        data: {\r\n          event: event as unknown as Event,\r\n          totalCandidaturas: participationsList.length,\r\n          aprovados: participationsList.filter(p => p.status === 'aprovado').length,\r\n          presentes: participationsList.filter(p => p.presenca_confirmada === true).length,\r\n          avaliacoes: participationsList.filter(p => p.avaliacao_feita === true).length,\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao buscar estat√≠sticas:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Inicia monitoramento autom√°tico de status\r\n   * Atualiza a cada 1 minuto\r\n   */\r\n  static startAutoUpdate(): number {\r\n    // Executa imediatamente\r\n    this.updateAllEventStatuses();\r\n\r\n    // Depois executa a cada 1 minuto\r\n    const intervalId = setInterval(() => {\r\n      this.updateAllEventStatuses();\r\n    }, 60000); // 60 segundos\r\n\r\n    return intervalId as unknown as number;\r\n  }\r\n\r\n  /**\r\n   * Para o monitoramento autom√°tico\r\n   */\r\n  static stopAutoUpdate(intervalId: number): void {\r\n    if (intervalId) {\r\n      clearInterval(intervalId);\r\n    }\r\n  }\r\n\r\n  static async approveParticipation(participationId: string, eventId: string): Promise<ServiceResult> {\r\n    try {\r\n      console.log('üîî [approveParticipation] Iniciando aprova√ß√£o:', { participationId, eventId });\r\n\r\n      // 1. Buscar dados do evento\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('vagas, title')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) {\r\n        console.error('‚ùå Erro ao buscar evento:', eventError);\r\n        throw eventError;\r\n      }\r\n\r\n      if ((event as any).vagas <= 0) {\r\n        console.warn('‚ö†Ô∏è Sem vagas dispon√≠veis');\r\n        return { success: false, error: 'Sem vagas dispon√≠veis' };\r\n      }\r\n\r\n      // 2. Buscar dados do participante\r\n      const { data: participation, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('user_id')\r\n        .eq('id', participationId)\r\n        .single();\r\n\r\n      if (partError) {\r\n        console.error('‚ùå Erro ao buscar participa√ß√£o:', partError);\r\n        throw partError;\r\n      }\r\n\r\n      console.log('üìã Dados obtidos:', {\r\n        userId: (participation as any).user_id,\r\n        eventTitle: (event as any).title\r\n      });\r\n\r\n      // 3. Atualizar status da participa√ß√£o\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({ \r\n          status: 'aprovado',\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', participationId);\r\n\r\n      if (updateError) {\r\n        console.error('‚ùå Erro ao atualizar participa√ß√£o:', updateError);\r\n        throw updateError;\r\n      }\r\n\r\n      console.log('‚úÖ Status atualizado para aprovado');\r\n\r\n      // 4. Decrementar vagas\r\n      // Note: Using UserEventService's decrement, but since it's static, perhaps duplicate or import.\r\n      // For now, duplicate the code to avoid circular imports or complex deps.\r\n      const { error: decError } = await supabase.rpc('decrement_event_vacancy', { \r\n        event_id: eventId \r\n      });\r\n      \r\n      if (decError) {\r\n        const { data: eventData } = await supabase\r\n          .from('events')\r\n          .select('vagas')\r\n          .eq('id', eventId)\r\n          .single();\r\n        \r\n        if (eventData && eventData.vagas > 0) {\r\n          await supabase\r\n            .from('events')\r\n            .update({ vagas: eventData.vagas - 1 })\r\n            .eq('id', eventId);\r\n        }\r\n      }\r\n      console.log('‚úÖ Vaga decrementada');\r\n\r\n      // 5. üîî NOTIFICAR O PARTICIPANTE\r\n      console.log('üîî Enviando notifica√ß√£o ao participante...');\r\n      const notifResult = await NotificationService.notifyParticipationApproved(\r\n        (participation as any).user_id,\r\nparseInt(eventId, 10),        (event as any).title\r\n      );\r\n\r\n      if (notifResult.success) {\r\n        console.log('‚úÖ Notifica√ß√£o enviada com sucesso');\r\n      } else {\r\n        console.error('‚ö†Ô∏è Erro ao enviar notifica√ß√£o (aprova√ß√£o conclu√≠da):', notifResult.error);\r\n      }\r\n\r\n      return { \r\n        success: true, \r\n        message: 'Participa√ß√£o aprovada com sucesso!' \r\n      };\r\n\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao aprovar participa√ß√£o:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  static async rejectParticipation(participationId: string, reason?: string): Promise<ServiceResult> {\r\n    try {\r\n      const { data: participation } = await supabase\r\n        .from('event_participants')\r\n        .select('user_id, event_id, events!inner(title)')\r\n        .eq('id', participationId)\r\n        .single();\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({ \r\n          status: 'rejeitado',\r\n          motivo_rejeicao: reason,\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', participationId);\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      // Notificar o participante sobre rejei√ß√£o\r\n      const part = participation as any;\r\n      const notifResult = await NotificationService.notifyParticipationRejected(\r\n        part.user_id,\r\n        part.event_id, // Corrigido: mantido como string\r\n        part.events.title,\r\n        reason\r\n      );\r\n\r\n      if (!notifResult.success) {\r\n        console.error('‚ö†Ô∏è Erro ao enviar notifica√ß√£o de rejei√ß√£o:', notifResult.error);\r\n      }\r\n\r\n      return { success: true, message: 'Participa√ß√£o rejeitada' };\r\n\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao rejeitar participa√ß√£o:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  static async getEventParticipations(eventId: string): Promise<ServiceResult> {\r\n    try {\r\n      const { data: participations, error } = await supabase\r\n        .from('event_participants')\r\n        .select('*, user:profiles!event_participants_user_id_fkey(*)')\r\n        .eq('event_id', eventId)\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      return { success: true, data: participations };\r\n\r\n    } catch (error: any) {\r\n      console.error('‚ùå Erro ao buscar participa√ß√µes:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n}\r\n\r\nexport default PartnerEventService;"],"version":3}