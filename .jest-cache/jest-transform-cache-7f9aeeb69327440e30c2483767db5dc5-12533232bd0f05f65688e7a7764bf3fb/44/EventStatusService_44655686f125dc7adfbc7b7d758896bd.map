{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventStatusService.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventStatusService.ts"],"sourcesContent":["// src/services/EventStatusService.ts\r\n// ‚úÖ VERS√ÉO CORRIGIDA - Gera√ß√£o de senha 1 minuto antes\r\n\r\nimport { supabase } from '../lib/supabaseClient';\r\nimport EventSecurityService from './EventSecurityService';\r\nimport PushNotificationService from './PushNotificationService';\r\nimport TrustScoreService from './TrustScoreService';\r\n\r\ninterface Event {\r\n  id: number;\r\n  status: string;\r\n  start_time: string;\r\n  end_time: string;\r\n  creator_id: string;\r\n  title: string;\r\n  event_entry_password?: string;\r\n  entry_locked?: boolean;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface Participation {\r\n  id: string;\r\n  user_id: string;\r\n  event_id: number;\r\n  status: string;\r\n  presenca_confirmada: boolean;\r\n  avaliacao_feita: boolean;\r\n  [key: string]: any;\r\n}\r\n\r\nclass EventStatusService {\r\n  private static updateInterval: ReturnType<typeof setInterval> | null = null;\r\n\r\n  /**\r\n   * üéØ Atualiza status de TODOS os eventos\r\n   */\r\n  static async updateAllEventStatuses(): Promise<void> {\r\n    try {\r\n      const { data: events, error } = await supabase\r\n        .from('events')\r\n        .select('*')\r\n        .neq('status', 'Cancelado')\r\n        .neq('status', 'Conclu√≠do');\r\n\r\n      if (error) {\r\n        console.error('‚ùå Erro ao buscar eventos:', error);\r\n        return;\r\n      }\r\n\r\n      if (!events || events.length === 0) {\r\n        console.log('‚úÖ Nenhum evento para atualizar');\r\n        return;\r\n      }\r\n\r\n      console.log(`üîÑ Atualizando ${events.length} eventos...`);\r\n\r\n      for (const event of events) {\r\n        try {\r\n          await this.calculateEventStatus(event as Event);\r\n        } catch (eventError) {\r\n          console.error(`‚ùå Erro ao processar evento ${event.id}:`, eventError);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao atualizar todos os eventos:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üß† L√≥gica de status de UM evento\r\n   */\r\n  private static async calculateEventStatus(event: Event): Promise<void> {\r\n    const now = new Date();\r\n    const startTime = new Date(event.start_time);\r\n    const endTime = new Date(event.end_time);\r\n    const currentStatus = event.status;\r\n\r\n    // ============================================\r\n    // üéØ FASE 1: Evento futuro\r\n    // ============================================\r\n    if (now < startTime) {\r\n      // checa se falta 1 min ‚Üí gera senha ‚Üí envia push\r\n      await this.detectAndHandlePasswordGeneration(event, now, startTime);\r\n\r\n      // checa se precisa bloquear entrada pr√≥ximo do fim\r\n      await this.detectAndHandleEntryLocking(event, now, endTime);\r\n      return;\r\n    }\r\n\r\n    // ============================================\r\n    // üéØ FASE 2: Evento prestes a acabar\r\n    // ============================================\r\n    await this.detectAndHandleEntryLocking(event, now, endTime);\r\n\r\n    // ============================================\r\n    // üéØ FASE 3: Evento est√° acontecendo\r\n    // ============================================\r\n    if (now >= startTime && now < endTime && currentStatus !== 'Em Andamento') {\r\n      await this.updateEventStatus(event.id, 'Em Andamento');\r\n    }\r\n\r\n    // ============================================\r\n    // üéØ FASE 4: Evento terminou\r\n    // ============================================\r\n    if (now >= endTime && currentStatus !== 'Finalizado') {\r\n      console.log(`‚ÑπÔ∏è Evento ${event.id} terminou`);\r\n      await this.updateEventStatus(event.id, 'Finalizado');\r\n\r\n      // üìä Penalizar n√£o-presen√ßas\r\n      await TrustScoreService.penalizeNoShowsForEvent(event.id);\r\n\r\n      // üîç Verificar auto-conclus√£o\r\n      const shouldComplete = await this.shouldAutoCompleteEvent(event);\r\n      if (shouldComplete) {\r\n        await this.updateEventStatus(event.id, 'Conclu√≠do');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üé≤ Detecta \"falta 1 minuto\" ‚Üí Gera senha + Envia push\r\n   * ‚úÖ CORRIGIDO: Agora gera quando falta EXATAMENTE 1 minuto OU MENOS (se ainda n√£o foi gerada)\r\n   */\r\n  private static async detectAndHandlePasswordGeneration(\r\n    event: Event,\r\n    now: Date,\r\n    startTime: Date\r\n  ): Promise<void> {\r\n    try {\r\n      // j√° tem senha? n√£o faz nada\r\n      if (event.event_entry_password && event.event_entry_password.length > 0) {\r\n        return;\r\n      }\r\n\r\n      // falta quantos minutos?\r\n      const diffMs = startTime.getTime() - now.getTime();\r\n      const minutesUntilEvent = Math.floor(diffMs / (1000 * 60));\r\n\r\n      // s√≥ processa quem est√° at√© 5 min do in√≠cio (pra n√£o ficar logando demais)\r\n      if (minutesUntilEvent > 5) return;\r\n\r\n      // 1. Evento ainda n√£o come√ßou\r\n      if (now >= startTime) {\r\n        return;\r\n      }\r\n\r\n      // 2. Est√° dentro da janela de 1 minuto\r\n      const oneMinuteBeforeStart = new Date(startTime.getTime() - 60 * 1000);\r\n\r\n      // 3. Senha ainda n√£o foi gerada\r\n      const shouldGeneratePassword = now >= oneMinuteBeforeStart && now < startTime;\r\n\r\n      if (!shouldGeneratePassword) {\r\n        // Log apenas se estiver pr√≥ximo (nos √∫ltimos 5 minutos)\r\n        if (minutesUntilEvent <= 5 && minutesUntilEvent > 0) {\r\n          console.log(\r\n            `‚è≥ Evento ${event.id}: faltam ${minutesUntilEvent} minutos (senha ser√° gerada em 1 min)`\r\n          );\r\n        }\r\n        return;\r\n      }\r\n\r\n      console.log(`üé≤ Gerando senha para evento ${event.id} (faltam ${minutesUntilEvent} minutos)...`);\r\n\r\n      // 1Ô∏è‚É£ Gerar e salvar senha\r\n      const passwordResult = await EventSecurityService.generateAndSavePassword(event.id);\r\n\r\n      if (!passwordResult.success) {\r\n        console.error('‚ùå Erro ao gerar senha:', passwordResult.error);\r\n        return;\r\n      }\r\n\r\n      const password = passwordResult.password!;\r\n      console.log(`‚úÖ Senha gerada: ${password}`);\r\n\r\n      // 2Ô∏è‚É£ Buscar anfitri√£o\r\n      const { data: hostProfile, error: hostError } = await supabase\r\n        .from('profiles')\r\n        .select('username')\r\n        .eq('id', event.creator_id)\r\n        .single();\r\n\r\n      if (hostError) {\r\n        console.error('‚ùå Erro ao buscar anfitri√£o:', hostError);\r\n      }\r\n\r\n      // 3Ô∏è‚É£ Buscar participantes aprovados\r\n      const { data: participations, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('user_id')\r\n        .eq('event_id', event.id)\r\n        .eq('status', 'aprovado');\r\n\r\n      if (partError) {\r\n        console.error('‚ùå Erro ao buscar participantes:', partError);\r\n        return;\r\n      }\r\n\r\n      // 4Ô∏è‚É£ Enviar push para ANFITRI√ÉO (com senha)\r\n      console.log(`üì® Enviando SENHA para anfitri√£o ${event.creator_id}...`);\r\n      const hostResult = await PushNotificationService.sendPasswordToHost(\r\n        event.creator_id,\r\n        event.id,\r\n        password,\r\n        event.title\r\n      );\r\n\r\n      if (hostResult.success) {\r\n        console.log(`‚úÖ Senha enviada para anfitri√£o`);\r\n      } else {\r\n        console.error('‚ùå Erro ao enviar senha para anfitri√£o:', hostResult.error);\r\n      }\r\n\r\n      // 5Ô∏è‚É£ Enviar push para PARTICIPANTES (gen√©rica, sem senha)\r\n      if (participations && participations.length > 0) {\r\n        const participantIds = participations.map(p => p.user_id);\r\n        console.log(`üì® Enviando notifica√ß√£o de IN√çCIO para ${participantIds.length} participantes...`);\r\n        \r\n        const participantsResult = await PushNotificationService.sendEventStartNotificationToParticipants(\r\n          participantIds,\r\n          event.id,\r\n          event.title\r\n        );\r\n\r\n        if (participantsResult.success) {\r\n          console.log(`‚úÖ Notifica√ß√µes enviadas para participantes`);\r\n        } else {\r\n          console.error('‚ùå Erro ao enviar para participantes:', participantsResult.error);\r\n        }\r\n      }\r\n\r\n      console.log(`‚úÖ Processo de gera√ß√£o de senha completo para evento ${event.id}`);\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao processar gera√ß√£o de senha:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîí Bloqueia entrada 1 minuto antes do fim\r\n   */\r\n  private static async detectAndHandleEntryLocking(\r\n    event: Event,\r\n    now: Date,\r\n    endTime: Date\r\n  ): Promise<void> {\r\n    try {\r\n      // se j√° est√° bloqueado, n√£o faz nada\r\n      if (event.entry_locked) return;\r\n\r\n      const oneMinuteBeforeEnd = new Date(endTime.getTime() - 60 * 1000);\r\n      const timeUntilEnd = endTime.getTime() - now.getTime();\r\n      const minutesUntilEnd = Math.floor(timeUntilEnd / 1000 / 60);\r\n\r\n      // ‚úÖ Bloquear quando falta 1 minuto ou menos para terminar\r\n      if (now >= oneMinuteBeforeEnd && now < endTime) {\r\n        console.log(`üîí Bloqueando entrada do evento ${event.id} (faltam ${minutesUntilEnd} min para terminar)...`);\r\n\r\n        const lockResult = await EventSecurityService.lockEventEntry(event.id);\r\n        if (lockResult.success) {\r\n          console.log(`‚úÖ Entrada bloqueada para evento ${event.id}`);\r\n        } else {\r\n          console.error('‚ùå Erro ao bloquear entrada:', lockResult.error);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao processar bloqueio de entrada:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üí° Verifica auto-conclus√£o (7 dias OU todos avaliaram)\r\n   */\r\n  static async shouldAutoCompleteEvent(event: Event): Promise<boolean> {\r\n    let retries = 2;\r\n\r\n    while (retries > 0) {\r\n      try {\r\n        const endTime = new Date(event.end_time);\r\n        const now = new Date();\r\n        const daysSinceEnd = (now.getTime() - endTime.getTime()) / (1000 * 60 * 60 * 24);\r\n\r\n        // üí° Condi√ß√£o 1: Passou 7 dias? ‚Üí Conclu√≠do\r\n        if (daysSinceEnd >= 7) {\r\n          console.log(`‚úÖ Evento ${event.id} auto-conclu√≠do ap√≥s 7 dias`);\r\n          return true;\r\n        }\r\n\r\n        // üí° Condi√ß√£o 2: Todos que compareceram avaliaram?\r\n        const { data: participations, error: participationsError } = await supabase\r\n          .from('event_participants')\r\n          .select('id, avaliacao_feita, presenca_confirmada')\r\n          .eq('event_id', event.id)\r\n          .eq('status', 'aprovado');\r\n\r\n        if (participationsError) {\r\n          console.error('‚ùå Erro ao buscar participa√ß√µes:', participationsError);\r\n          return false;\r\n        }\r\n\r\n        if (!participations || participations.length === 0) {\r\n          console.log(`‚è≥ Evento ${event.id} sem participa√ß√µes aprovadas ainda`);\r\n          return false;\r\n        }\r\n\r\n        const presentParticipants = (participations as unknown as Participation[]).filter(\r\n          p => p.presenca_confirmada === true\r\n        );\r\n\r\n        if (presentParticipants.length === 0) {\r\n          console.log(`‚è≥ Evento ${event.id} ningu√©m compareceu`);\r\n          return false;\r\n        }\r\n\r\n        const allEvaluated = presentParticipants.every(p => p.avaliacao_feita === true);\r\n\r\n        if (allEvaluated) {\r\n          console.log(`‚úÖ Evento ${event.id} auto-conclu√≠do - TODOS avaliaram`);\r\n          return true;\r\n        }\r\n\r\n        const pendingCount = presentParticipants.filter(p => !p.avaliacao_feita).length;\r\n        console.log(`‚è≥ Evento ${event.id} aguardando ${pendingCount} avalia√ß√£o(√µes)`);\r\n        return false;\r\n      } catch (error) {\r\n        retries--;\r\n        if (retries === 0) {\r\n          console.error('‚ùå Erro ao verificar auto-complete ap√≥s 2 tentativas:', error);\r\n          return false;\r\n        } else {\r\n          console.warn(`‚ö†Ô∏è Erro ao verificar auto-complete. Tentando novamente...`);\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * üîÑ Atualiza o status de um evento\r\n   */\r\n  static async updateEventStatus(eventId: number, newStatus: string): Promise<void> {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('events')\r\n        .update({\r\n          status: newStatus,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', eventId);\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`‚úÖ Evento ${eventId} status atualizado para: ${newStatus}`);\r\n    } catch (error) {\r\n      console.error(`‚ùå Erro ao atualizar status do evento ${eventId}:`, error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üìä Obt√©m estat√≠sticas do evento\r\n   * (corrigido para usar event_id e j√° trazer o perfil do participante)\r\n   */\r\n  static async getEventStats(eventId: number): Promise<{\r\n    success: boolean;\r\n    data?: any;\r\n    error?: any;\r\n  }> {\r\n    try {\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('*')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) throw eventError;\r\n\r\n      const { data: participations, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select(`\r\n          id,\r\n          user_id,\r\n          event_id,\r\n          status,\r\n          presenca_confirmada,\r\n          com_acesso,\r\n          avaliacao_feita,\r\n          profiles:profiles!event_participants_user_id_fkey (\r\n            id,\r\n            username,\r\n            avatar_url,\r\n            full_name\r\n          )\r\n        `)\r\n        // üëá aqui estava dando 406 no frontend quando vinham UUIDs\r\n        .eq('event_id', eventId);\r\n\r\n      if (partError) throw partError;\r\n\r\n      return {\r\n        success: true,\r\n        data: {\r\n          event,\r\n          participants: participations || [],\r\n        },\r\n      };\r\n    } catch (error) {\r\n      console.error('Erro ao obter stats do evento:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  // ============================================\r\n  // üîÑ M√âTODOS DE AUTO-UPDATE\r\n  // ============================================\r\n\r\n  /**\r\n   * üöÄ Inicia atualiza√ß√£o autom√°tica de eventos\r\n   * @param intervalSeconds - Intervalo em segundos (padr√£o: 30)\r\n   */\r\n  static startAutoUpdate(intervalSeconds: number = 30): ReturnType<typeof setInterval> {\r\n    if (this.updateInterval) {\r\n      this.stopAutoUpdate();\r\n    }\r\n\r\n    console.log(`üîÑ Iniciando auto-update de eventos a cada ${intervalSeconds}s`);\r\n\r\n    // Executar imediatamente\r\n    this.updateAllEventStatuses();\r\n\r\n    // Depois executar a cada X segundos\r\n    this.updateInterval = setInterval(() => {\r\n      this.updateAllEventStatuses();\r\n    }, intervalSeconds * 1000);\r\n\r\n    return this.updateInterval;\r\n  }\r\n\r\n  /**\r\n   * üõë Para a atualiza√ß√£o autom√°tica\r\n   */\r\n  static stopAutoUpdate(): void {\r\n    if (this.updateInterval) {\r\n      clearInterval(this.updateInterval);\r\n      this.updateInterval = null;\r\n      console.log('üõë Auto-update de eventos parado');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîç Verifica se auto-update est√° rodando\r\n   */\r\n  static isAutoUpdateRunning(): boolean {\r\n    return this.updateInterval !== null;\r\n  }\r\n}\r\n\r\nexport default EventStatusService;\r\n"],"version":3}