a14395a0c6a030bfb2697926942c22f8
"use strict";
// src/services/PartnerEventService.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => ({
    supabase: {
        from: mockFrom,
        rpc: mockRpc,
    }
}));
// Mock do NotificationService (default export)
jest.mock('./NotificationService', () => ({
    __esModule: true,
    default: {
        notifyParticipationApproved: jest.fn(() => Promise.resolve({ success: true })),
        notifyParticipationRejected: jest.fn(() => Promise.resolve({ success: true })),
    },
}));
// --- 1. MOCKING DEPENDÊNCIAS (ANTES DAS IMPORTAÇÕES) ---
// Mock do Supabase
const mockFrom = jest.fn();
const mockRpc = jest.fn();
const NotificationService_1 = tslib_1.__importDefault(require("./NotificationService"));
const PartnerEventService_1 = tslib_1.__importDefault(require("./PartnerEventService"));
// --- 3. CONFIGURAÇÃO DOS TESTES ---
describe('PartnerEventService', () => {
    // Limpa todos os mocks antes de cada teste
    beforeEach(() => {
        jest.clearAllMocks();
        jest.useFakeTimers();
    });
    afterEach(() => {
        jest.useRealTimers();
    });
    // --- 4. TESTES DOS MÉTODOS ---
    describe('calculateEventStatus (Lógica Pura)', () => {
        const now = new Date('2025-10-10T10:00:00Z');
        beforeEach(() => {
            jest.setSystemTime(now);
        });
        const baseEvent = {
            id: '1',
            status: 'Aberto',
            start_time: '2025-10-10T12:00:00Z', // Em 2 horas
            end_time: '2025-10-10T14:00:00Z',
            vagas: 5,
        };
        it('deve manter Cancelado se já estiver Cancelado', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, status: 'Cancelado' }, now);
            expect(status).toBe('Cancelado');
        });
        it('deve manter Concluído se já estiver Concluído', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, status: 'Concluído' }, now);
            expect(status).toBe('Concluído');
        });
        it('deve ser Finalizado se o tempo de término já passou', () => {
            const pastEvent = { ...baseEvent, end_time: '2025-10-10T09:00:00Z' }; // Terminou 1h atrás
            const status = PartnerEventService_1.default.calculateEventStatus(pastEvent, now);
            expect(status).toBe('Finalizado');
        });
        it('deve ser Em Andamento se estiver dentro do horário', () => {
            const currentEvent = { ...baseEvent, start_time: '2025-10-10T09:00:00Z' }; // Começou 1h atrás
            const status = PartnerEventService_1.default.calculateEventStatus(currentEvent, now);
            expect(status).toBe('Em Andamento');
        });
        it('deve manter Confirmado se foi confirmado manually, mesmo com vagas', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, status: 'Confirmado' }, now);
            expect(status).toBe('Confirmado');
        });
        it('deve ser Confirmado se as vagas acabaram (vagas <= 0)', () => {
            const status = PartnerEventService_1.default.calculateEventStatus({ ...baseEvent, vagas: 0 }, now);
            expect(status).toBe('Confirmado');
        });
        it('deve ser Aberto se faltar mais de 5 minutos e tiver vagas', () => {
            const status = PartnerEventService_1.default.calculateEventStatus(baseEvent, now);
            expect(status).toBe('Aberto');
        });
        it('deve ser Confirmado se faltar menos de 5 minutos (e não estiver cheio)', () => {
            const closeEvent = { ...baseEvent, start_time: '2025-10-10T10:04:00Z' }; // Começa em 4 min
            const status = PartnerEventService_1.default.calculateEventStatus(closeEvent, now);
            expect(status).toBe('Confirmado');
        });
    });
    describe('confirmEvent', () => {
        it('deve chamar update com status Confirmado', async () => {
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                update: mockUpdate,
            });
            await PartnerEventService_1.default.confirmEvent('evt-123');
            expect(mockFrom).toHaveBeenCalledWith('events');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'Confirmado' }));
            expect(mockEq).toHaveBeenCalledWith('id', 'evt-123');
        });
    });
    describe('cancelEvent', () => {
        it('deve chamar update com status Cancelado e motivo', async () => {
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                update: mockUpdate,
            });
            await PartnerEventService_1.default.cancelEvent('evt-123', 'Motivo Teste');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({
                status: 'Cancelado',
                cancelamento_motivo: 'Motivo Teste',
            }));
            expect(mockEq).toHaveBeenCalledWith('id', 'evt-123');
        });
    });
    describe('getEventStats', () => {
        it('deve buscar e agregar estatísticas do evento', async () => {
            const mockEvent = { id: 'evt-1', title: 'Evento' };
            const mockParticipations = [
                { status: 'aprovado', presenca_confirmada: true, avaliacao_feita: true },
                { status: 'aprovado', presenca_confirmada: true, avaliacao_feita: false },
                { status: 'aprovado', presenca_confirmada: false, avaliacao_feita: false },
                { status: 'pendente', presenca_confirmada: false, avaliacao_feita: false },
            ];
            // Mock 1: SELECT do evento
            const mockSingle = jest.fn().mockResolvedValue({ data: mockEvent, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect1 = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: SELECT de participações
            const mockEq2 = jest.fn().mockResolvedValue({ data: mockParticipations, error: null });
            const mockSelect2 = jest.fn().mockReturnValue({ eq: mockEq2 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect1 }) // primeira chamada: evento
                .mockReturnValueOnce({ select: mockSelect2 }); // segunda chamada: participações
            const result = await PartnerEventService_1.default.getEventStats('evt-1');
            expect(result.success).toBe(true);
            expect(result.data?.event).toEqual(mockEvent);
            expect(result.data?.totalCandidaturas).toBe(4);
            expect(result.data?.aprovados).toBe(3);
            expect(result.data?.presentes).toBe(2);
            expect(result.data?.avaliacoes).toBe(1);
        });
    });
    describe('approveParticipation', () => {
        it('deve aprovar, decrementar vagas e notificar o usuário', async () => {
            const mockEvent = { vagas: 5, title: 'Evento Teste' };
            const mockParticipation = { user_id: 'user-abc' };
            // Mock 1: SELECT evento
            const mockSingle1 = jest.fn().mockResolvedValue({ data: mockEvent, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle1 });
            const mockSelect1 = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: SELECT participação
            const mockSingle2 = jest.fn().mockResolvedValue({ data: mockParticipation, error: null });
            const mockEq2 = jest.fn().mockReturnValue({ single: mockSingle2 });
            const mockSelect2 = jest.fn().mockReturnValue({ eq: mockEq2 });
            // Mock 3: UPDATE participação
            const mockEq3 = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq3 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect1 }) // buscar evento
                .mockReturnValueOnce({ select: mockSelect2 }) // buscar participação
                .mockReturnValueOnce({ update: mockUpdate }); // atualizar participação
            // Mock RPC decremento
            mockRpc.mockResolvedValue({ error: null });
            const result = await PartnerEventService_1.default.approveParticipation('part-123', '456');
            expect(result.success).toBe(true);
            // Verifica se a participação foi atualizada
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'aprovado' }));
            // Verifica se o RPC foi chamado
            expect(mockRpc).toHaveBeenCalledWith('decrement_event_vacancy', { event_id: '456' });
            // Verifica se a notificação foi enviada
            expect(NotificationService_1.default.notifyParticipationApproved).toHaveBeenCalledWith('user-abc', 456, // O código faz parseInt()
            'Evento Teste');
        });
        it('deve falhar se não houver vagas', async () => {
            const mockEvent = { vagas: 0, title: 'Evento Lotado' };
            // Mock SELECT evento (lotado)
            const mockSingle = jest.fn().mockResolvedValue({ data: mockEvent, error: null });
            const mockEq = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({ select: mockSelect });
            const result = await PartnerEventService_1.default.approveParticipation('part-123', '456');
            expect(result.success).toBe(false);
            expect(result.error).toBe('Sem vagas disponíveis');
            // Garante que não tentou fazer nada depois
            expect(mockRpc).not.toHaveBeenCalled();
            expect(NotificationService_1.default.notifyParticipationApproved).not.toHaveBeenCalled();
        });
    });
    describe('rejectParticipation', () => {
        it('deve rejeitar e notificar o usuário com motivo', async () => {
            const mockParticipation = {
                user_id: 'user-abc',
                event_id: 789,
                events: { title: 'Evento Rejeitado' },
            };
            // Mock 1: SELECT participação (com inner join)
            const mockSingle = jest.fn().mockResolvedValue({ data: mockParticipation, error: null });
            const mockEq1 = jest.fn().mockReturnValue({ single: mockSingle });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq1 });
            // Mock 2: UPDATE participação
            const mockEq2 = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq2 });
            mockFrom
                .mockReturnValueOnce({ select: mockSelect }) // buscar participação
                .mockReturnValueOnce({ update: mockUpdate }); // atualizar participação
            const reason = 'Não se encaixa no perfil';
            const result = await PartnerEventService_1.default.rejectParticipation('part-123', reason);
            expect(result.success).toBe(true);
            // Verifica se o status foi atualizado com o motivo
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({
                status: 'rejeitado',
                motivo_rejeicao: reason,
            }));
            // Verifica se a notificação foi enviada
            expect(NotificationService_1.default.notifyParticipationRejected).toHaveBeenCalledWith('user-abc', 789, 'Evento Rejeitado', reason);
        });
    });
    describe('getEventParticipations', () => {
        it('deve buscar participações com dados do usuário', async () => {
            const mockParticipations = [{ id: 'part-1', user: { username: 'Test' } }];
            const mockOrder = jest.fn().mockResolvedValue({ data: mockParticipations, error: null });
            const mockEq = jest.fn().mockReturnValue({ order: mockOrder });
            const mockSelect = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                select: mockSelect,
            });
            const result = await PartnerEventService_1.default.getEventParticipations('evt-1');
            expect(mockFrom).toHaveBeenCalledWith('event_participants');
            expect(mockSelect).toHaveBeenCalledWith('*, user:profiles!event_participants_user_id_fkey(*)');
            expect(result.success).toBe(true);
            expect(result.data).toEqual(mockParticipations);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcUGFydG5lckV2ZW50U2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQSwyQ0FBMkM7OztBQVEzQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEMsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFLFFBQVE7UUFDZCxHQUFHLEVBQUUsT0FBTztLQUNiO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFFSiwrQ0FBK0M7QUFDL0MsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3hDLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLE9BQU8sRUFBRTtRQUNQLDJCQUEyQixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzlFLDJCQUEyQixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0tBQy9FO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFwQkosMERBQTBEO0FBRTFELG1CQUFtQjtBQUNuQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDM0IsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBcUIxQix3RkFBd0Q7QUFDeEQsd0ZBQXdEO0FBRXhELHFDQUFxQztBQUVyQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBRW5DLDJDQUEyQztJQUMzQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixD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LENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUM1RCxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsb0JBQW9CLENBQ3JDLHFEQUFxRCxDQUN0RCxDQUFDO1lBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcUGFydG5lckV2ZW50U2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2aWNlcy9QYXJ0bmVyRXZlbnRTZXJ2aWNlLnRlc3QudHNcclxuXHJcbi8vIC0tLSAxLiBNT0NLSU5HIERFUEVORMOKTkNJQVMgKEFOVEVTIERBUyBJTVBPUlRBw4fDlUVTKSAtLS1cclxuXHJcbi8vIE1vY2sgZG8gU3VwYWJhc2VcclxuY29uc3QgbW9ja0Zyb20gPSBqZXN0LmZuKCk7XHJcbmNvbnN0IG1vY2tScGMgPSBqZXN0LmZuKCk7XHJcblxyXG5qZXN0Lm1vY2soJy4uL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+ICh7XHJcbiAgc3VwYWJhc2U6IHtcclxuICAgIGZyb206IG1vY2tGcm9tLFxyXG4gICAgcnBjOiBtb2NrUnBjLFxyXG4gIH1cclxufSkpO1xyXG5cclxuLy8gTW9jayBkbyBOb3RpZmljYXRpb25TZXJ2aWNlIChkZWZhdWx0IGV4cG9ydClcclxuamVzdC5tb2NrKCcuL05vdGlmaWNhdGlvblNlcnZpY2UnLCAoKSA9PiAoe1xyXG4gIF9fZXNNb2R1bGU6IHRydWUsXHJcbiAgZGVmYXVsdDoge1xyXG4gICAgbm90aWZ5UGFydGljaXBhdGlvbkFwcHJvdmVkOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUgfSkpLFxyXG4gICAgbm90aWZ5UGFydGljaXBhdGlvblJlamVjdGVkOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUgfSkpLFxyXG4gIH0sXHJcbn0pKTtcclxuXHJcbi8vIC0tLSAyLiBJTVBPUlRBw4fDlUVTIChERVBPSVMgRE9TIE1PQ0tTKSAtLS1cclxuXHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vbGliL3N1cGFiYXNlQ2xpZW50JztcclxuaW1wb3J0IE5vdGlmaWNhdGlvblNlcnZpY2UgZnJvbSAnLi9Ob3RpZmljYXRpb25TZXJ2aWNlJztcclxuaW1wb3J0IFBhcnRuZXJFdmVudFNlcnZpY2UgZnJvbSAnLi9QYXJ0bmVyRXZlbnRTZXJ2aWNlJztcclxuXHJcbi8vIC0tLSAzLiBDT05GSUdVUkHDh8ODTyBET1MgVEVTVEVTIC0tLVxyXG5cclxuZGVzY3JpYmUoJ1BhcnRuZXJFdmVudFNlcnZpY2UnLCAoKSA9PiB7XHJcblxyXG4gIC8vIExpbXBhIHRvZG9zIG9zIG1vY2tzIGFudGVzIGRlIGNhZGEgdGVzdGVcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgamVzdC51c2VGYWtlVGltZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgLy8gLS0tIDQuIFRFU1RFUyBET1MgTcOJVE9ET1MgLS0tXHJcblxyXG4gIGRlc2NyaWJlKCdjYWxjdWxhdGVFdmVudFN0YXR1cyAoTMOzZ2ljYSBQdXJhKScsICgpID0+IHtcclxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCcyMDI1LTEwLTEwVDEwOjAwOjAwWicpO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBqZXN0LnNldFN5c3RlbVRpbWUobm93KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGJhc2VFdmVudCA9IHtcclxuICAgICAgaWQ6ICcxJyxcclxuICAgICAgc3RhdHVzOiAnQWJlcnRvJyBhcyBjb25zdCxcclxuICAgICAgc3RhcnRfdGltZTogJzIwMjUtMTAtMTBUMTI6MDA6MDBaJywgLy8gRW0gMiBob3Jhc1xyXG4gICAgICBlbmRfdGltZTogJzIwMjUtMTAtMTBUMTQ6MDA6MDBaJyxcclxuICAgICAgdmFnYXM6IDUsXHJcbiAgICB9O1xyXG5cclxuICAgIGl0KCdkZXZlIG1hbnRlciBDYW5jZWxhZG8gc2UgasOhIGVzdGl2ZXIgQ2FuY2VsYWRvJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmNhbGN1bGF0ZUV2ZW50U3RhdHVzKHsgLi4uYmFzZUV2ZW50LCBzdGF0dXM6ICdDYW5jZWxhZG8nIH0sIG5vdyk7XHJcbiAgICAgIGV4cGVjdChzdGF0dXMpLnRvQmUoJ0NhbmNlbGFkbycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgbWFudGVyIENvbmNsdcOtZG8gc2UgasOhIGVzdGl2ZXIgQ29uY2x1w61kbycsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3RhdHVzID0gUGFydG5lckV2ZW50U2VydmljZS5jYWxjdWxhdGVFdmVudFN0YXR1cyh7IC4uLmJhc2VFdmVudCwgc3RhdHVzOiAnQ29uY2x1w61kbycgfSwgbm93KTtcclxuICAgICAgZXhwZWN0KHN0YXR1cykudG9CZSgnQ29uY2x1w61kbycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgc2VyIEZpbmFsaXphZG8gc2UgbyB0ZW1wbyBkZSB0w6lybWlubyBqw6EgcGFzc291JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXN0RXZlbnQgPSB7IC4uLmJhc2VFdmVudCwgZW5kX3RpbWU6ICcyMDI1LTEwLTEwVDA5OjAwOjAwWicgfTsgLy8gVGVybWlub3UgMWggYXRyw6FzXHJcbiAgICAgIGNvbnN0IHN0YXR1cyA9IFBhcnRuZXJFdmVudFNlcnZpY2UuY2FsY3VsYXRlRXZlbnRTdGF0dXMocGFzdEV2ZW50LCBub3cpO1xyXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0JlKCdGaW5hbGl6YWRvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBzZXIgRW0gQW5kYW1lbnRvIHNlIGVzdGl2ZXIgZGVudHJvIGRvIGhvcsOhcmlvJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjdXJyZW50RXZlbnQgPSB7IC4uLmJhc2VFdmVudCwgc3RhcnRfdGltZTogJzIwMjUtMTAtMTBUMDk6MDA6MDBaJyB9OyAvLyBDb21lw6dvdSAxaCBhdHLDoXNcclxuICAgICAgY29uc3Qgc3RhdHVzID0gUGFydG5lckV2ZW50U2VydmljZS5jYWxjdWxhdGVFdmVudFN0YXR1cyhjdXJyZW50RXZlbnQsIG5vdyk7XHJcbiAgICAgIGV4cGVjdChzdGF0dXMpLnRvQmUoJ0VtIEFuZGFtZW50bycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgbWFudGVyIENvbmZpcm1hZG8gc2UgZm9pIGNvbmZpcm1hZG8gbWFudWFsbHksIG1lc21vIGNvbSB2YWdhcycsICgpID0+IHtcclxuICAgICAgY29uc3Qgc3RhdHVzID0gUGFydG5lckV2ZW50U2VydmljZS5jYWxjdWxhdGVFdmVudFN0YXR1cyh7IC4uLmJhc2VFdmVudCwgc3RhdHVzOiAnQ29uZmlybWFkbycgfSwgbm93KTtcclxuICAgICAgZXhwZWN0KHN0YXR1cykudG9CZSgnQ29uZmlybWFkbycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgc2VyIENvbmZpcm1hZG8gc2UgYXMgdmFnYXMgYWNhYmFyYW0gKHZhZ2FzIDw9IDApJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmNhbGN1bGF0ZUV2ZW50U3RhdHVzKHsgLi4uYmFzZUV2ZW50LCB2YWdhczogMCB9LCBub3cpO1xyXG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0JlKCdDb25maXJtYWRvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBzZXIgQWJlcnRvIHNlIGZhbHRhciBtYWlzIGRlIDUgbWludXRvcyBlIHRpdmVyIHZhZ2FzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmNhbGN1bGF0ZUV2ZW50U3RhdHVzKGJhc2VFdmVudCwgbm93KTtcclxuICAgICAgZXhwZWN0KHN0YXR1cykudG9CZSgnQWJlcnRvJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBzZXIgQ29uZmlybWFkbyBzZSBmYWx0YXIgbWVub3MgZGUgNSBtaW51dG9zIChlIG7Do28gZXN0aXZlciBjaGVpbyknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNsb3NlRXZlbnQgPSB7IC4uLmJhc2VFdmVudCwgc3RhcnRfdGltZTogJzIwMjUtMTAtMTBUMTA6MDQ6MDBaJyB9OyAvLyBDb21lw6dhIGVtIDQgbWluXHJcbiAgICAgIGNvbnN0IHN0YXR1cyA9IFBhcnRuZXJFdmVudFNlcnZpY2UuY2FsY3VsYXRlRXZlbnRTdGF0dXMoY2xvc2VFdmVudCwgbm93KTtcclxuICAgICAgZXhwZWN0KHN0YXR1cykudG9CZSgnQ29uZmlybWFkbycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjb25maXJtRXZlbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSBjaGFtYXIgdXBkYXRlIGNvbSBzdGF0dXMgQ29uZmlybWFkbycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0VxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcSB9KTtcclxuICAgICAgXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgdXBkYXRlOiBtb2NrVXBkYXRlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGF3YWl0IFBhcnRuZXJFdmVudFNlcnZpY2UuY29uZmlybUV2ZW50KCdldnQtMTIzJyk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja0Zyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudHMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgc3RhdHVzOiAnQ29uZmlybWFkbycgfSlcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KG1vY2tFcSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2lkJywgJ2V2dC0xMjMnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY2FuY2VsRXZlbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSBjaGFtYXIgdXBkYXRlIGNvbSBzdGF0dXMgQ2FuY2VsYWRvIGUgbW90aXZvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0Zyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1cGRhdGU6IG1vY2tVcGRhdGUsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgYXdhaXQgUGFydG5lckV2ZW50U2VydmljZS5jYW5jZWxFdmVudCgnZXZ0LTEyMycsICdNb3Rpdm8gVGVzdGUnKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICBzdGF0dXM6ICdDYW5jZWxhZG8nLFxyXG4gICAgICAgICAgY2FuY2VsYW1lbnRvX21vdGl2bzogJ01vdGl2byBUZXN0ZScsXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KG1vY2tFcSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2lkJywgJ2V2dC0xMjMnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0RXZlbnRTdGF0cycsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIGJ1c2NhciBlIGFncmVnYXIgZXN0YXTDrXN0aWNhcyBkbyBldmVudG8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tFdmVudCA9IHsgaWQ6ICdldnQtMScsIHRpdGxlOiAnRXZlbnRvJyB9O1xyXG4gICAgICBjb25zdCBtb2NrUGFydGljaXBhdGlvbnMgPSBbXHJcbiAgICAgICAgeyBzdGF0dXM6ICdhcHJvdmFkbycsIHByZXNlbmNhX2NvbmZpcm1hZGE6IHRydWUsIGF2YWxpYWNhb19mZWl0YTogdHJ1ZSB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiAnYXByb3ZhZG8nLCBwcmVzZW5jYV9jb25maXJtYWRhOiB0cnVlLCBhdmFsaWFjYW9fZmVpdGE6IGZhbHNlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6ICdhcHJvdmFkbycsIHByZXNlbmNhX2NvbmZpcm1hZGE6IGZhbHNlLCBhdmFsaWFjYW9fZmVpdGE6IGZhbHNlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6ICdwZW5kZW50ZScsIHByZXNlbmNhX2NvbmZpcm1hZGE6IGZhbHNlLCBhdmFsaWFjYW9fZmVpdGE6IGZhbHNlIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICAvLyBNb2NrIDE6IFNFTEVDVCBkbyBldmVudG9cclxuICAgICAgY29uc3QgbW9ja1NpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tFdmVudCwgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tFcTEgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgc2luZ2xlOiBtb2NrU2luZ2xlIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0MSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMSB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIE1vY2sgMjogU0VMRUNUIGRlIHBhcnRpY2lwYcOnw7Vlc1xyXG4gICAgICBjb25zdCBtb2NrRXEyID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja1BhcnRpY2lwYXRpb25zLCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1NlbGVjdDIgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcTIgfSk7XHJcblxyXG4gICAgICBtb2NrRnJvbVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHsgc2VsZWN0OiBtb2NrU2VsZWN0MSB9KSAgLy8gcHJpbWVpcmEgY2hhbWFkYTogZXZlbnRvXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyBzZWxlY3Q6IG1vY2tTZWxlY3QyIH0pOyAvLyBzZWd1bmRhIGNoYW1hZGE6IHBhcnRpY2lwYcOnw7Vlc1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUGFydG5lckV2ZW50U2VydmljZS5nZXRFdmVudFN0YXRzKCdldnQtMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LmV2ZW50KS50b0VxdWFsKG1vY2tFdmVudCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8udG90YWxDYW5kaWRhdHVyYXMpLnRvQmUoNCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8uYXByb3ZhZG9zKS50b0JlKDMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LnByZXNlbnRlcykudG9CZSgyKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy5hdmFsaWFjb2VzKS50b0JlKDEpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdhcHByb3ZlUGFydGljaXBhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIGFwcm92YXIsIGRlY3JlbWVudGFyIHZhZ2FzIGUgbm90aWZpY2FyIG8gdXN1w6FyaW8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tFdmVudCA9IHsgdmFnYXM6IDUsIHRpdGxlOiAnRXZlbnRvIFRlc3RlJyB9O1xyXG4gICAgICBjb25zdCBtb2NrUGFydGljaXBhdGlvbiA9IHsgdXNlcl9pZDogJ3VzZXItYWJjJyB9O1xyXG5cclxuICAgICAgLy8gTW9jayAxOiBTRUxFQ1QgZXZlbnRvXHJcbiAgICAgIGNvbnN0IG1vY2tTaW5nbGUxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja0V2ZW50LCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja0VxMSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzaW5nbGU6IG1vY2tTaW5nbGUxIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0MSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMSB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIE1vY2sgMjogU0VMRUNUIHBhcnRpY2lwYcOnw6NvXHJcbiAgICAgIGNvbnN0IG1vY2tTaW5nbGUyID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja1BhcnRpY2lwYXRpb24sIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXEyID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHNpbmdsZTogbW9ja1NpbmdsZTIgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tTZWxlY3QyID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEyIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayAzOiBVUERBVEUgcGFydGljaXBhw6fDo29cclxuICAgICAgY29uc3QgbW9ja0VxMyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEzIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb21cclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7IHNlbGVjdDogbW9ja1NlbGVjdDEgfSkgLy8gYnVzY2FyIGV2ZW50b1xyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHsgc2VsZWN0OiBtb2NrU2VsZWN0MiB9KSAvLyBidXNjYXIgcGFydGljaXBhw6fDo29cclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7IHVwZGF0ZTogbW9ja1VwZGF0ZSB9KTsgIC8vIGF0dWFsaXphciBwYXJ0aWNpcGHDp8Ojb1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayBSUEMgZGVjcmVtZW50b1xyXG4gICAgICBtb2NrUnBjLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmFwcHJvdmVQYXJ0aWNpcGF0aW9uKCdwYXJ0LTEyMycsICc0NTYnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIGEgcGFydGljaXBhw6fDo28gZm9pIGF0dWFsaXphZGFcclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgc3RhdHVzOiAnYXByb3ZhZG8nIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIFJQQyBmb2kgY2hhbWFkb1xyXG4gICAgICBleHBlY3QobW9ja1JwYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2RlY3JlbWVudF9ldmVudF92YWNhbmN5JywgeyBldmVudF9pZDogJzQ1NicgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBhIG5vdGlmaWNhw6fDo28gZm9pIGVudmlhZGFcclxuICAgICAgZXhwZWN0KE5vdGlmaWNhdGlvblNlcnZpY2Uubm90aWZ5UGFydGljaXBhdGlvbkFwcHJvdmVkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAndXNlci1hYmMnLFxyXG4gICAgICAgIDQ1NiwgLy8gTyBjw7NkaWdvIGZheiBwYXJzZUludCgpXHJcbiAgICAgICAgJ0V2ZW50byBUZXN0ZSdcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIGZhbGhhciBzZSBuw6NvIGhvdXZlciB2YWdhcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0V2ZW50ID0geyB2YWdhczogMCwgdGl0bGU6ICdFdmVudG8gTG90YWRvJyB9O1xyXG5cclxuICAgICAgLy8gTW9jayBTRUxFQ1QgZXZlbnRvIChsb3RhZG8pXHJcbiAgICAgIGNvbnN0IG1vY2tTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBtb2NrRXZlbnQsIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgc2luZ2xlOiBtb2NrU2luZ2xlIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEgfSk7XHJcblxyXG4gICAgICBtb2NrRnJvbS5tb2NrUmV0dXJuVmFsdWUoeyBzZWxlY3Q6IG1vY2tTZWxlY3QgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmFwcHJvdmVQYXJ0aWNpcGF0aW9uKCdwYXJ0LTEyMycsICc0NTYnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ1NlbSB2YWdhcyBkaXNwb27DrXZlaXMnKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdhcmFudGUgcXVlIG7Do28gdGVudG91IGZhemVyIG5hZGEgZGVwb2lzXHJcbiAgICAgIGV4cGVjdChtb2NrUnBjKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QoTm90aWZpY2F0aW9uU2VydmljZS5ub3RpZnlQYXJ0aWNpcGF0aW9uQXBwcm92ZWQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3JlamVjdFBhcnRpY2lwYXRpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSByZWplaXRhciBlIG5vdGlmaWNhciBvIHVzdcOhcmlvIGNvbSBtb3Rpdm8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tQYXJ0aWNpcGF0aW9uID0ge1xyXG4gICAgICAgIHVzZXJfaWQ6ICd1c2VyLWFiYycsXHJcbiAgICAgICAgZXZlbnRfaWQ6IDc4OSxcclxuICAgICAgICBldmVudHM6IHsgdGl0bGU6ICdFdmVudG8gUmVqZWl0YWRvJyB9LFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gTW9jayAxOiBTRUxFQ1QgcGFydGljaXBhw6fDo28gKGNvbSBpbm5lciBqb2luKVxyXG4gICAgICBjb25zdCBtb2NrU2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja1BhcnRpY2lwYXRpb24sIGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrRXExID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHNpbmdsZTogbW9ja1NpbmdsZSB9KTtcclxuICAgICAgY29uc3QgbW9ja1NlbGVjdCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMSB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIE1vY2sgMjogVVBEQVRFIHBhcnRpY2lwYcOnw6NvXHJcbiAgICAgIGNvbnN0IG1vY2tFcTIgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxMiB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyBzZWxlY3Q6IG1vY2tTZWxlY3QgfSkgLy8gYnVzY2FyIHBhcnRpY2lwYcOnw6NvXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyB1cGRhdGU6IG1vY2tVcGRhdGUgfSk7IC8vIGF0dWFsaXphciBwYXJ0aWNpcGHDp8Ojb1xyXG5cclxuICAgICAgY29uc3QgcmVhc29uID0gJ07Do28gc2UgZW5jYWl4YSBubyBwZXJmaWwnO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQYXJ0bmVyRXZlbnRTZXJ2aWNlLnJlamVjdFBhcnRpY2lwYXRpb24oJ3BhcnQtMTIzJywgcmVhc29uKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gc3RhdHVzIGZvaSBhdHVhbGl6YWRvIGNvbSBvIG1vdGl2b1xyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgc3RhdHVzOiAncmVqZWl0YWRvJyxcclxuICAgICAgICAgIG1vdGl2b19yZWplaWNhbzogcmVhc29uLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBhIG5vdGlmaWNhw6fDo28gZm9pIGVudmlhZGFcclxuICAgICAgZXhwZWN0KE5vdGlmaWNhdGlvblNlcnZpY2Uubm90aWZ5UGFydGljaXBhdGlvblJlamVjdGVkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAndXNlci1hYmMnLFxyXG4gICAgICAgIDc4OSxcclxuICAgICAgICAnRXZlbnRvIFJlamVpdGFkbycsXHJcbiAgICAgICAgcmVhc29uXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldEV2ZW50UGFydGljaXBhdGlvbnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSBidXNjYXIgcGFydGljaXBhw6fDtWVzIGNvbSBkYWRvcyBkbyB1c3XDoXJpbycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1BhcnRpY2lwYXRpb25zID0gW3sgaWQ6ICdwYXJ0LTEnLCB1c2VyOiB7IHVzZXJuYW1lOiAnVGVzdCcgfSB9XTtcclxuXHJcbiAgICAgIGNvbnN0IG1vY2tPcmRlciA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IG1vY2tQYXJ0aWNpcGF0aW9ucywgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBvcmRlcjogbW9ja09yZGVyIH0pO1xyXG4gICAgICBjb25zdCBtb2NrU2VsZWN0ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEgfSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrRnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdDogbW9ja1NlbGVjdCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQYXJ0bmVyRXZlbnRTZXJ2aWNlLmdldEV2ZW50UGFydGljaXBhdGlvbnMoJ2V2dC0xJyk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja0Zyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudF9wYXJ0aWNpcGFudHMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tTZWxlY3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICcqLCB1c2VyOnByb2ZpbGVzIWV2ZW50X3BhcnRpY2lwYW50c191c2VyX2lkX2ZrZXkoKiknXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhKS50b0VxdWFsKG1vY2tQYXJ0aWNpcGF0aW9ucyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==