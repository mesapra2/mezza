{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\WaitingListService.test.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\WaitingListService.test.ts"],"sourcesContent":["// src/services/WaitingListService.test.ts\r\n\r\nimport { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';\r\nimport { supabase } from '../lib/supabaseClient';\r\nimport NotificationService from '../services/NotificationService';\r\nimport ParticipationService from '../services/ParticipationService';\r\nimport waitingListService from './WaitingListService'; // É uma instância!\r\n\r\n// --- 1. MOCKING DEPENDÊNCIAS ---\r\n\r\n// Mock do Supabase\r\nconst mockSupabaseInstance = {\r\n  from: jest.fn(),\r\n};\r\n\r\njest.mock('../lib/supabaseClient', () => ({\r\n  supabase: mockSupabaseInstance,\r\n}));\r\n\r\n// Mock dos Serviços (são estáticos)\r\njest.mock('../services/NotificationService', () => ({\r\n  createForUser: jest.fn(() => Promise.resolve({ success: true })),\r\n}));\r\njest.mock('../services/ParticipationService', () => ({\r\n  applyToEvent: jest.fn(() => Promise.resolve({ success: true, isAutoApproved: true })),\r\n}));\r\n\r\n// Typecast dos mocks para intellisense\r\nconst mockedSupabase = supabase as jest.Mocked<typeof supabase>;\r\nconst mockedNotificationService = NotificationService as jest.Mocked<typeof NotificationService>;\r\nconst mockedParticipationService = ParticipationService as jest.Mocked<typeof ParticipationService>;\r\n\r\n// --- 2. CONFIGURAÇÃO DOS TESTES ---\r\n\r\ndescribe('WaitingListService', () => {\r\n\r\n  // Espiões para os MÉTODOS DA INSTÂNCIA\r\n  let spyReorganize: jest.SpiedFunction<any>; // Privado\r\n  let spyRemoveFromList: jest.SpiedFunction<typeof waitingListService.removeFromWaitingList>;\r\n  let spyGetWaitingList: jest.SpiedFunction<typeof waitingListService.getWaitingList>;\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (mockedSupabase.from as jest.Mock).mockReset();\r\n\r\n    // Espiamos os métodos da *instância*\r\n    spyReorganize = jest.spyOn(waitingListService as any, 'reorganizePositions')\r\n      .mockImplementation(() => Promise.resolve());\r\n      \r\n    spyRemoveFromList = jest.spyOn(waitingListService, 'removeFromWaitingList')\r\n      .mockImplementation(() => Promise.resolve(true));\r\n      \r\n    spyGetWaitingList = jest.spyOn(waitingListService, 'getWaitingList')\r\n      .mockImplementation(() => Promise.resolve([]));\r\n  });\r\n\r\n  afterEach(() => {\r\n    // Restauramos os espiões\r\n    spyReorganize.mockRestore();\r\n    spyRemoveFromList.mockRestore();\r\n    spyGetWaitingList.mockRestore();\r\n  });\r\n\r\n  // --- 3. TESTES DOS MÉTODOS ---\r\n\r\n  describe('addToWaitingList', () => {\r\n    const userId = 'user-1';\r\n    const eventId = 'evt-1';\r\n\r\n    it('deve adicionar um novo usuário e notificar', async () => {\r\n      const mockLastEntry = { position: 2 };\r\n      const mockNewEntry = { user_id: userId, event_id: eventId, position: 3 };\r\n\r\n      // 1. Mock SELECT (verificar existente) - Não acha\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            eq: jest.fn(() => ({\r\n              single: jest.fn().mockImplementation(() => Promise.resolve({ data: null, error: { code: 'PGRST116' } })),\r\n            })),\r\n          })),\r\n        })),\r\n      }));\r\n      \r\n      // 2. Mock SELECT (última posição) - Acha posição 2\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            order: jest.fn(() => ({\r\n              limit: jest.fn(() => ({\r\n                single: jest.fn().mockImplementation(() => Promise.resolve({ data: mockLastEntry, error: null })),\r\n              })),\r\n            })),\r\n          })),\r\n        })),\r\n      }));\r\n      \r\n      // 3. Mock INSERT (novo usuário)\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        insert: jest.fn(() => ({\r\n          select: jest.fn(() => ({\r\n            single: jest.fn().mockImplementation(() => Promise.resolve({ data: mockNewEntry, error: null })),\r\n          })),\r\n        })),\r\n      }));\r\n      \r\n      const result = await waitingListService.addToWaitingList(userId, eventId);\r\n\r\n      expect(result).toEqual(mockNewEntry);\r\n      \r\n      // Verifica se o insert foi chamado com a posição correta (2 + 1 = 3)\r\n      expect(mockedSupabase.from('waiting_list').insert).toHaveBeenCalledWith(\r\n        expect.objectContaining({ position: 3 })\r\n      );\r\n      \r\n      // Verifica se notificou o usuário\r\n      expect(mockedNotificationService.createForUser).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          target_user_id: userId,\r\n          message: expect.stringContaining('posição 3'),\r\n        })\r\n      );\r\n    });\r\n    \r\n    it('deve retornar o usuário existente se ele já estiver na lista', async () => {\r\n      const mockExistingEntry = { user_id: userId, event_id: eventId, position: 1 };\r\n\r\n      // 1. Mock SELECT (verificar existente) - ACHA\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            eq: jest.fn(() => ({\r\n              single: jest.fn().mockImplementation(() => Promise.resolve({ data: mockExistingEntry, error: null })),\r\n            })),\r\n          })),\r\n        })),\r\n      }));\r\n\r\n      const result = await waitingListService.addToWaitingList(userId, eventId);\r\n      \r\n      expect(result).toEqual(mockExistingEntry);\r\n      \r\n      // Garante que não tentou buscar posição nem inserir\r\n      expect(mockedSupabase.from('waiting_list').insert).not.toHaveBeenCalled();\r\n      expect(mockedNotificationService.createForUser).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('removeFromWaitingList', () => {\r\n    it('deve deletar o usuário e chamar reorganizePositions', async () => {\r\n      // Libera o spy para testar a implementação real\r\n      spyRemoveFromList.mockRestore(); \r\n      \r\n      // 1. Mock DELETE\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        delete: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            eq: jest.fn().mockImplementation(() => Promise.resolve({ error: null })),\r\n          })),\r\n        })),\r\n      }));\r\n\r\n      const result = await waitingListService.removeFromWaitingList('user-1', 'evt-1');\r\n\r\n      expect(result).toBe(true);\r\n      expect(mockedSupabase.from('waiting_list').delete).toHaveBeenCalled();\r\n      \r\n      // Verifica se chamou o método interno (que está espionado)\r\n      expect(spyReorganize).toHaveBeenCalledWith('evt-1');\r\n    });\r\n  });\r\n\r\n  describe('processWaitingList', () => {\r\n    it('deve notificar, aplicar e remover o próximo da fila', async () => {\r\n      const mockNextInLine = { id: 'wl-1', user_id: 'user-next', event_id: 'evt-1', position: 1 };\r\n      \r\n      // 1. Mock SELECT (próximo da fila)\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            eq: jest.fn(() => ({\r\n              order: jest.fn(() => ({\r\n                limit: jest.fn(() => ({\r\n                  single: jest.fn().mockImplementation(() => Promise.resolve({ data: mockNextInLine, error: null })),\r\n                })),\r\n              })),\r\n            })),\r\n          })),\r\n        })),\r\n      }));\r\n      \r\n      // 2. Mock UPDATE (marcar como notificado)\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        update: jest.fn(() => ({\r\n          eq: jest.fn().mockImplementation(() => Promise.resolve({ error: null })),\r\n        })),\r\n      }));\r\n      \r\n      // Mock do ParticipationService (já mockado no setup)\r\n      // Mock do removeFromWaitingList (já espionado e mockado no setup)\r\n      \r\n      await waitingListService.processWaitingList('evt-1');\r\n      \r\n      // Verifica se marcou como notificado\r\n      expect(mockedSupabase.from('waiting_list').update).toHaveBeenCalledWith({ notified: true });\r\n      \r\n      // Verifica se tentou aplicar para o evento\r\n      expect(mockedParticipationService.applyToEvent).toHaveBeenCalledWith(\r\n        'evt-1',\r\n        'user-next',\r\n        expect.any(String)\r\n      );\r\n      \r\n      // Verifica se removeu da lista (pois applyToEvent foi mockado como sucesso)\r\n      expect(spyRemoveFromList).toHaveBeenCalledWith('user-next', 'evt-1');\r\n    });\r\n\r\n    it('NÃO deve remover da lista se a aprovação não for automática', async () => {\r\n      // Altera o mock do ParticipationService para este teste\r\n      (mockedParticipationService.applyToEvent as jest.Mock).mockImplementationOnce(() => \r\n        Promise.resolve({ success: true, isAutoApproved: false }) // NÃO foi auto-aprovado\r\n      );\r\n\r\n      const mockNextInLine = { id: 'wl-1', user_id: 'user-next', event_id: 'evt-1' };\r\n      \r\n      // 1. Mock SELECT (próximo da fila)\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            eq: jest.fn(() => ({\r\n              order: jest.fn(() => ({\r\n                limit: jest.fn(() => ({\r\n                  single: jest.fn().mockImplementation(() => Promise.resolve({ data: mockNextInLine, error: null })),\r\n                })),\r\n              })),\r\n            })),\r\n          })),\r\n        })),\r\n      }));\r\n      \r\n      // 2. Mock UPDATE (marcar como notificado)\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        update: jest.fn(() => ({\r\n          eq: jest.fn().mockImplementation(() => Promise.resolve({ error: null })),\r\n        })),\r\n      }));\r\n      \r\n      await waitingListService.processWaitingList('evt-1');\r\n      \r\n      expect(mockedParticipationService.applyToEvent).toHaveBeenCalled();\r\n      \r\n      // GARANTE que NÃO removeu da lista\r\n      expect(spyRemoveFromList).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('reorganizePositions (private)', () => {\r\n    it('deve atualizar posições fora de ordem', async () => {\r\n      // Libera os spies para testar a implementação real\r\n      spyReorganize.mockRestore();\r\n      spyGetWaitingList.mockRestore(); \r\n      \r\n      const mockList = [\r\n        { id: 'entry-A', position: 1 },\r\n        { id: 'entry-B', position: 3 }, // Posição errada\r\n        { id: 'entry-C', position: 4 }, // Posição errada\r\n      ];\r\n\r\n      // 1. Mock do getWaitingList (interno)\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        select: jest.fn(() => ({\r\n          eq: jest.fn(() => ({\r\n            order: jest.fn().mockImplementation(() => Promise.resolve({ data: mockList, error: null })),\r\n          })),\r\n        })),\r\n      }));\r\n      \r\n      // 2. Mock do UPDATE (para entry-B)\r\n      const mockUpdateB = jest.fn().mockImplementation(() => Promise.resolve({ error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        update: jest.fn(() => ({\r\n          eq: mockUpdateB,\r\n        })),\r\n      }));\r\n      \r\n      // 3. Mock do UPDATE (para entry-C)\r\n      const mockUpdateC = jest.fn().mockImplementation(() => Promise.resolve({ error: null }));\r\n      (mockedSupabase.from as jest.Mock).mockImplementationOnce(() => ({\r\n        update: jest.fn(() => ({\r\n          eq: mockUpdateC,\r\n        })),\r\n      }));\r\n      \r\n      // Chama o método privado (precisa do 'as any')\r\n      await (waitingListService as any).reorganizePositions('evt-1');\r\n\r\n      // Deve ter chamado o update 2x (B e C)\r\n      expect(mockedSupabase.from('waiting_list').update).toHaveBeenCalledTimes(2);\r\n      \r\n      // Verifica se B foi corrigido para 2\r\n      expect(mockUpdateB).toHaveBeenCalledWith('id', 'entry-B');\r\n      expect(mockedSupabase.from('waiting_list').update).toHaveBeenCalledWith({ position: 2 });\r\n      \r\n      // Verifica se C foi corrigido para 3\r\n      expect(mockUpdateC).toHaveBeenCalledWith('id', 'entry-C');\r\n      expect(mockedSupabase.from('waiting_list').update).toHaveBeenCalledWith({ position: 3 });\r\n    });\r\n  });\r\n\r\n});\r\n"],"version":3}