4b97344044dd8bc6836fd95451df38bd
"use strict";
// src/services/WaitingListService.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const globals_1 = require("@jest/globals");
globals_1.jest.mock('../lib/supabaseClient', () => ({
    supabase: mockSupabaseInstance,
}));
// Mock dos Serviços (são estáticos)
globals_1.jest.mock('../services/NotificationService', () => ({
    createForUser: globals_1.jest.fn(() => Promise.resolve({ success: true })),
}));
globals_1.jest.mock('../services/ParticipationService', () => ({
    applyToEvent: globals_1.jest.fn(() => Promise.resolve({ success: true, isAutoApproved: true })),
}));
const supabaseClient_1 = require("../lib/supabaseClient");
const NotificationService_1 = tslib_1.__importDefault(require("../services/NotificationService"));
const ParticipationService_1 = tslib_1.__importDefault(require("../services/ParticipationService"));
const WaitingListService_1 = tslib_1.__importDefault(require("./WaitingListService")); // É uma instância!
// --- 1. MOCKING DEPENDÊNCIAS ---
// Mock do Supabase
const mockSupabaseInstance = {
    from: globals_1.jest.fn(),
};
// Typecast dos mocks para intellisense
const mockedSupabase = supabaseClient_1.supabase;
const mockedNotificationService = NotificationService_1.default;
const mockedParticipationService = ParticipationService_1.default;
// --- 2. CONFIGURAÇÃO DOS TESTES ---
(0, globals_1.describe)('WaitingListService', () => {
    // Espiões para os MÉTODOS DA INSTÂNCIA
    let spyReorganize; // Privado
    let spyRemoveFromList;
    let spyGetWaitingList;
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        mockedSupabase.from.mockReset();
        // Espiamos os métodos da *instância*
        spyReorganize = globals_1.jest.spyOn(WaitingListService_1.default, 'reorganizePositions')
            .mockImplementation(() => Promise.resolve());
        spyRemoveFromList = globals_1.jest.spyOn(WaitingListService_1.default, 'removeFromWaitingList')
            .mockImplementation(() => Promise.resolve(true));
        spyGetWaitingList = globals_1.jest.spyOn(WaitingListService_1.default, 'getWaitingList')
            .mockImplementation(() => Promise.resolve([]));
    });
    (0, globals_1.afterEach)(() => {
        // Restauramos os espiões
        spyReorganize.mockRestore();
        spyRemoveFromList.mockRestore();
        spyGetWaitingList.mockRestore();
    });
    // --- 3. TESTES DOS MÉTODOS ---
    (0, globals_1.describe)('addToWaitingList', () => {
        const userId = 'user-1';
        const eventId = 'evt-1';
        (0, globals_1.it)('deve adicionar um novo usuário e notificar', async () => {
            const mockLastEntry = { position: 2 };
            const mockNewEntry = { user_id: userId, event_id: eventId, position: 3 };
            // 1. Mock SELECT (verificar existente) - Não acha
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        eq: globals_1.jest.fn(() => ({
                            single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: null, error: { code: 'PGRST116' } })),
                        })),
                    })),
                })),
            }));
            // 2. Mock SELECT (última posição) - Acha posição 2
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        order: globals_1.jest.fn(() => ({
                            limit: globals_1.jest.fn(() => ({
                                single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockLastEntry, error: null })),
                            })),
                        })),
                    })),
                })),
            }));
            // 3. Mock INSERT (novo usuário)
            mockedSupabase.from.mockImplementationOnce(() => ({
                insert: globals_1.jest.fn(() => ({
                    select: globals_1.jest.fn(() => ({
                        single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockNewEntry, error: null })),
                    })),
                })),
            }));
            const result = await WaitingListService_1.default.addToWaitingList(userId, eventId);
            (0, globals_1.expect)(result).toEqual(mockNewEntry);
            // Verifica se o insert foi chamado com a posição correta (2 + 1 = 3)
            (0, globals_1.expect)(mockedSupabase.from('waiting_list').insert).toHaveBeenCalledWith(globals_1.expect.objectContaining({ position: 3 }));
            // Verifica se notificou o usuário
            (0, globals_1.expect)(mockedNotificationService.createForUser).toHaveBeenCalledWith(globals_1.expect.objectContaining({
                target_user_id: userId,
                message: globals_1.expect.stringContaining('posição 3'),
            }));
        });
        (0, globals_1.it)('deve retornar o usuário existente se ele já estiver na lista', async () => {
            const mockExistingEntry = { user_id: userId, event_id: eventId, position: 1 };
            // 1. Mock SELECT (verificar existente) - ACHA
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        eq: globals_1.jest.fn(() => ({
                            single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockExistingEntry, error: null })),
                        })),
                    })),
                })),
            }));
            const result = await WaitingListService_1.default.addToWaitingList(userId, eventId);
            (0, globals_1.expect)(result).toEqual(mockExistingEntry);
            // Garante que não tentou buscar posição nem inserir
            (0, globals_1.expect)(mockedSupabase.from('waiting_list').insert).not.toHaveBeenCalled();
            (0, globals_1.expect)(mockedNotificationService.createForUser).not.toHaveBeenCalled();
        });
    });
    (0, globals_1.describe)('removeFromWaitingList', () => {
        (0, globals_1.it)('deve deletar o usuário e chamar reorganizePositions', async () => {
            // Libera o spy para testar a implementação real
            spyRemoveFromList.mockRestore();
            // 1. Mock DELETE
            mockedSupabase.from.mockImplementationOnce(() => ({
                delete: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
                    })),
                })),
            }));
            const result = await WaitingListService_1.default.removeFromWaitingList('user-1', 'evt-1');
            (0, globals_1.expect)(result).toBe(true);
            (0, globals_1.expect)(mockedSupabase.from('waiting_list').delete).toHaveBeenCalled();
            // Verifica se chamou o método interno (que está espionado)
            (0, globals_1.expect)(spyReorganize).toHaveBeenCalledWith('evt-1');
        });
    });
    (0, globals_1.describe)('processWaitingList', () => {
        (0, globals_1.it)('deve notificar, aplicar e remover o próximo da fila', async () => {
            const mockNextInLine = { id: 'wl-1', user_id: 'user-next', event_id: 'evt-1', position: 1 };
            // 1. Mock SELECT (próximo da fila)
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        eq: globals_1.jest.fn(() => ({
                            order: globals_1.jest.fn(() => ({
                                limit: globals_1.jest.fn(() => ({
                                    single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockNextInLine, error: null })),
                                })),
                            })),
                        })),
                    })),
                })),
            }));
            // 2. Mock UPDATE (marcar como notificado)
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
                })),
            }));
            // Mock do ParticipationService (já mockado no setup)
            // Mock do removeFromWaitingList (já espionado e mockado no setup)
            await WaitingListService_1.default.processWaitingList('evt-1');
            // Verifica se marcou como notificado
            (0, globals_1.expect)(mockedSupabase.from('waiting_list').update).toHaveBeenCalledWith({ notified: true });
            // Verifica se tentou aplicar para o evento
            (0, globals_1.expect)(mockedParticipationService.applyToEvent).toHaveBeenCalledWith('evt-1', 'user-next', globals_1.expect.any(String));
            // Verifica se removeu da lista (pois applyToEvent foi mockado como sucesso)
            (0, globals_1.expect)(spyRemoveFromList).toHaveBeenCalledWith('user-next', 'evt-1');
        });
        (0, globals_1.it)('NÃO deve remover da lista se a aprovação não for automática', async () => {
            // Altera o mock do ParticipationService para este teste
            mockedParticipationService.applyToEvent.mockImplementationOnce(() => Promise.resolve({ success: true, isAutoApproved: false }) // NÃO foi auto-aprovado
            );
            const mockNextInLine = { id: 'wl-1', user_id: 'user-next', event_id: 'evt-1' };
            // 1. Mock SELECT (próximo da fila)
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        eq: globals_1.jest.fn(() => ({
                            order: globals_1.jest.fn(() => ({
                                limit: globals_1.jest.fn(() => ({
                                    single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockNextInLine, error: null })),
                                })),
                            })),
                        })),
                    })),
                })),
            }));
            // 2. Mock UPDATE (marcar como notificado)
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
                })),
            }));
            await WaitingListService_1.default.processWaitingList('evt-1');
            (0, globals_1.expect)(mockedParticipationService.applyToEvent).toHaveBeenCalled();
            // GARANTE que NÃO removeu da lista
            (0, globals_1.expect)(spyRemoveFromList).not.toHaveBeenCalled();
        });
    });
    (0, globals_1.describe)('reorganizePositions (private)', () => {
        (0, globals_1.it)('deve atualizar posições fora de ordem', async () => {
            // Libera os spies para testar a implementação real
            spyReorganize.mockRestore();
            spyGetWaitingList.mockRestore();
            const mockList = [
                { id: 'entry-A', position: 1 },
                { id: 'entry-B', position: 3 }, // Posição errada
                { id: 'entry-C', position: 4 }, // Posição errada
            ];
            // 1. Mock do getWaitingList (interno)
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        order: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockList, error: null })),
                    })),
                })),
            }));
            // 2. Mock do UPDATE (para entry-B)
            const mockUpdateB = globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null }));
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: mockUpdateB,
                })),
            }));
            // 3. Mock do UPDATE (para entry-C)
            const mockUpdateC = globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null }));
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: mockUpdateC,
                })),
            }));
            // Chama o método privado (precisa do 'as any')
            await WaitingListService_1.default.reorganizePositions('evt-1');
            // Deve ter chamado o update 2x (B e C)
            (0, globals_1.expect)(mockedSupabase.from('waiting_list').update).toHaveBeenCalledTimes(2);
            // Verifica se B foi corrigido para 2
            (0, globals_1.expect)(mockUpdateB).toHaveBeenCalledWith('id', 'entry-B');
            (0, globals_1.expect)(mockedSupabase.from('waiting_list').update).toHaveBeenCalledWith({ position: 2 });
            // Verifica se C foi corrigido para 3
            (0, globals_1.expect)(mockUpdateC).toHaveBeenCalledWith('id', 'entry-C');
            (0, globals_1.expect)(mockedSupabase.from('waiting_list').update).toHaveBeenCalledWith({ position: 3 });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcV2FpdGluZ0xpc3RTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBLDBDQUEwQzs7O0FBRTFDLDJDQUFrRjtBQWFsRixjQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEMsUUFBUSxFQUFFLG9CQUFvQjtDQUMvQixDQUFDLENBQUMsQ0FBQztBQUVKLG9DQUFvQztBQUNwQyxjQUFJLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDbEQsYUFBYSxFQUFFLGNBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0NBQ2pFLENBQUMsQ0FBQyxDQUFDO0FBQ0osY0FBSSxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ25ELFlBQVksRUFBRSxjQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0NBQ3RGLENBQUMsQ0FBQyxDQUFDO0FBdEJKLDBEQUFpRDtBQUNqRCxrR0FBa0U7QUFDbEUsb0dBQW9FO0FBQ3BFLHNGQUFzRCxDQUFDLG1CQUFtQjtBQUUxRSxrQ0FBa0M7QUFFbEMsbUJBQW1CO0FBQ25CLE1BQU0sb0JBQW9CLEdBQUc7SUFDM0IsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDaEIsQ0FBQztBQWNGLHVDQUF1QztBQUN2QyxNQUFNLGNBQWMsR0FBRyx5QkFBd0MsQ0FBQztBQUNoRSxNQUFNLHlCQUF5QixHQUFHLDZCQUE4RCxDQUFDO0FBQ2pHLE1BQU0sMEJBQTBCLEdBQUcsOEJBQWdFLENBQUM7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Vk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcV2FpdGluZ0xpc3RTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL1dhaXRpbmdMaXN0U2VydmljZS50ZXN0LnRzXHJcblxyXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgamVzdCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vbGliL3N1cGFiYXNlQ2xpZW50JztcclxuaW1wb3J0IE5vdGlmaWNhdGlvblNlcnZpY2UgZnJvbSAnLi4vc2VydmljZXMvTm90aWZpY2F0aW9uU2VydmljZSc7XHJcbmltcG9ydCBQYXJ0aWNpcGF0aW9uU2VydmljZSBmcm9tICcuLi9zZXJ2aWNlcy9QYXJ0aWNpcGF0aW9uU2VydmljZSc7XHJcbmltcG9ydCB3YWl0aW5nTGlzdFNlcnZpY2UgZnJvbSAnLi9XYWl0aW5nTGlzdFNlcnZpY2UnOyAvLyDDiSB1bWEgaW5zdMOibmNpYSFcclxuXHJcbi8vIC0tLSAxLiBNT0NLSU5HIERFUEVORMOKTkNJQVMgLS0tXHJcblxyXG4vLyBNb2NrIGRvIFN1cGFiYXNlXHJcbmNvbnN0IG1vY2tTdXBhYmFzZUluc3RhbmNlID0ge1xyXG4gIGZyb206IGplc3QuZm4oKSxcclxufTtcclxuXHJcbmplc3QubW9jaygnLi4vbGliL3N1cGFiYXNlQ2xpZW50JywgKCkgPT4gKHtcclxuICBzdXBhYmFzZTogbW9ja1N1cGFiYXNlSW5zdGFuY2UsXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgZG9zIFNlcnZpw6dvcyAoc8OjbyBlc3TDoXRpY29zKVxyXG5qZXN0Lm1vY2soJy4uL3NlcnZpY2VzL05vdGlmaWNhdGlvblNlcnZpY2UnLCAoKSA9PiAoe1xyXG4gIGNyZWF0ZUZvclVzZXI6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgc3VjY2VzczogdHJ1ZSB9KSksXHJcbn0pKTtcclxuamVzdC5tb2NrKCcuLi9zZXJ2aWNlcy9QYXJ0aWNpcGF0aW9uU2VydmljZScsICgpID0+ICh7XHJcbiAgYXBwbHlUb0V2ZW50OiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUsIGlzQXV0b0FwcHJvdmVkOiB0cnVlIH0pKSxcclxufSkpO1xyXG5cclxuLy8gVHlwZWNhc3QgZG9zIG1vY2tzIHBhcmEgaW50ZWxsaXNlbnNlXHJcbmNvbnN0IG1vY2tlZFN1cGFiYXNlID0gc3VwYWJhc2UgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIHN1cGFiYXNlPjtcclxuY29uc3QgbW9ja2VkTm90aWZpY2F0aW9uU2VydmljZSA9IE5vdGlmaWNhdGlvblNlcnZpY2UgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIE5vdGlmaWNhdGlvblNlcnZpY2U+O1xyXG5jb25zdCBtb2NrZWRQYXJ0aWNpcGF0aW9uU2VydmljZSA9IFBhcnRpY2lwYXRpb25TZXJ2aWNlIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBQYXJ0aWNpcGF0aW9uU2VydmljZT47XHJcblxyXG4vLyAtLS0gMi4gQ09ORklHVVJBw4fDg08gRE9TIFRFU1RFUyAtLS1cclxuXHJcbmRlc2NyaWJlKCdXYWl0aW5nTGlzdFNlcnZpY2UnLCAoKSA9PiB7XHJcblxyXG4gIC8vIEVzcGnDtWVzIHBhcmEgb3MgTcOJVE9ET1MgREEgSU5TVMOCTkNJQVxyXG4gIGxldCBzcHlSZW9yZ2FuaXplOiBqZXN0LlNwaWVkRnVuY3Rpb248YW55PjsgLy8gUHJpdmFkb1xyXG4gIGxldCBzcHlSZW1vdmVGcm9tTGlzdDogamVzdC5TcGllZEZ1bmN0aW9uPHR5cGVvZiB3YWl0aW5nTGlzdFNlcnZpY2UucmVtb3ZlRnJvbVdhaXRpbmdMaXN0PjtcclxuICBsZXQgc3B5R2V0V2FpdGluZ0xpc3Q6IGplc3QuU3BpZWRGdW5jdGlvbjx0eXBlb2Ygd2FpdGluZ0xpc3RTZXJ2aWNlLmdldFdhaXRpbmdMaXN0PjtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja1Jlc2V0KCk7XHJcblxyXG4gICAgLy8gRXNwaWFtb3Mgb3MgbcOpdG9kb3MgZGEgKmluc3TDom5jaWEqXHJcbiAgICBzcHlSZW9yZ2FuaXplID0gamVzdC5zcHlPbih3YWl0aW5nTGlzdFNlcnZpY2UgYXMgYW55LCAncmVvcmdhbml6ZVBvc2l0aW9ucycpXHJcbiAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpO1xyXG4gICAgICBcclxuICAgIHNweVJlbW92ZUZyb21MaXN0ID0gamVzdC5zcHlPbih3YWl0aW5nTGlzdFNlcnZpY2UsICdyZW1vdmVGcm9tV2FpdGluZ0xpc3QnKVxyXG4gICAgICAubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKSk7XHJcbiAgICAgIFxyXG4gICAgc3B5R2V0V2FpdGluZ0xpc3QgPSBqZXN0LnNweU9uKHdhaXRpbmdMaXN0U2VydmljZSwgJ2dldFdhaXRpbmdMaXN0JylcclxuICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoW10pKTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIC8vIFJlc3RhdXJhbW9zIG9zIGVzcGnDtWVzXHJcbiAgICBzcHlSZW9yZ2FuaXplLm1vY2tSZXN0b3JlKCk7XHJcbiAgICBzcHlSZW1vdmVGcm9tTGlzdC5tb2NrUmVzdG9yZSgpO1xyXG4gICAgc3B5R2V0V2FpdGluZ0xpc3QubW9ja1Jlc3RvcmUoKTtcclxuICB9KTtcclxuXHJcbiAgLy8gLS0tIDMuIFRFU1RFUyBET1MgTcOJVE9ET1MgLS0tXHJcblxyXG4gIGRlc2NyaWJlKCdhZGRUb1dhaXRpbmdMaXN0JywgKCkgPT4ge1xyXG4gICAgY29uc3QgdXNlcklkID0gJ3VzZXItMSc7XHJcbiAgICBjb25zdCBldmVudElkID0gJ2V2dC0xJztcclxuXHJcbiAgICBpdCgnZGV2ZSBhZGljaW9uYXIgdW0gbm92byB1c3XDoXJpbyBlIG5vdGlmaWNhcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0xhc3RFbnRyeSA9IHsgcG9zaXRpb246IDIgfTtcclxuICAgICAgY29uc3QgbW9ja05ld0VudHJ5ID0geyB1c2VyX2lkOiB1c2VySWQsIGV2ZW50X2lkOiBldmVudElkLCBwb3NpdGlvbjogMyB9O1xyXG5cclxuICAgICAgLy8gMS4gTW9jayBTRUxFQ1QgKHZlcmlmaWNhciBleGlzdGVudGUpIC0gTsOjbyBhY2hhXHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogbnVsbCwgZXJyb3I6IHsgY29kZTogJ1BHUlNUMTE2JyB9IH0pKSxcclxuICAgICAgICAgICAgfSkpLFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgLy8gMi4gTW9jayBTRUxFQ1QgKMO6bHRpbWEgcG9zacOnw6NvKSAtIEFjaGEgcG9zacOnw6NvIDJcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBvcmRlcjogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgIGxpbWl0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogbW9ja0xhc3RFbnRyeSwgZXJyb3I6IG51bGwgfSkpLFxyXG4gICAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgICAgfSkpLFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgLy8gMy4gTW9jayBJTlNFUlQgKG5vdm8gdXN1w6FyaW8pXHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIGluc2VydDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiBtb2NrTmV3RW50cnksIGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICAgIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdhaXRpbmdMaXN0U2VydmljZS5hZGRUb1dhaXRpbmdMaXN0KHVzZXJJZCwgZXZlbnRJZCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tOZXdFbnRyeSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIGluc2VydCBmb2kgY2hhbWFkbyBjb20gYSBwb3Npw6fDo28gY29ycmV0YSAoMiArIDEgPSAzKVxyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2UuZnJvbSgnd2FpdGluZ19saXN0JykuaW5zZXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHBvc2l0aW9uOiAzIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBub3RpZmljb3UgbyB1c3XDoXJpb1xyXG4gICAgICBleHBlY3QobW9ja2VkTm90aWZpY2F0aW9uU2VydmljZS5jcmVhdGVGb3JVc2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICB0YXJnZXRfdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgICAgbWVzc2FnZTogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ3Bvc2nDp8OjbyAzJyksXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBvIHVzdcOhcmlvIGV4aXN0ZW50ZSBzZSBlbGUgasOhIGVzdGl2ZXIgbmEgbGlzdGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tFeGlzdGluZ0VudHJ5ID0geyB1c2VyX2lkOiB1c2VySWQsIGV2ZW50X2lkOiBldmVudElkLCBwb3NpdGlvbjogMSB9O1xyXG5cclxuICAgICAgLy8gMS4gTW9jayBTRUxFQ1QgKHZlcmlmaWNhciBleGlzdGVudGUpIC0gQUNIQVxyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGRhdGE6IG1vY2tFeGlzdGluZ0VudHJ5LCBlcnJvcjogbnVsbCB9KSksXHJcbiAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdhaXRpbmdMaXN0U2VydmljZS5hZGRUb1dhaXRpbmdMaXN0KHVzZXJJZCwgZXZlbnRJZCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tFeGlzdGluZ0VudHJ5KTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdhcmFudGUgcXVlIG7Do28gdGVudG91IGJ1c2NhciBwb3Npw6fDo28gbmVtIGluc2VyaXJcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20oJ3dhaXRpbmdfbGlzdCcpLmluc2VydCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZE5vdGlmaWNhdGlvblNlcnZpY2UuY3JlYXRlRm9yVXNlcikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncmVtb3ZlRnJvbVdhaXRpbmdMaXN0JywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgZGVsZXRhciBvIHVzdcOhcmlvIGUgY2hhbWFyIHJlb3JnYW5pemVQb3NpdGlvbnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIExpYmVyYSBvIHNweSBwYXJhIHRlc3RhciBhIGltcGxlbWVudGHDp8OjbyByZWFsXHJcbiAgICAgIHNweVJlbW92ZUZyb21MaXN0Lm1vY2tSZXN0b3JlKCk7IFxyXG4gICAgICBcclxuICAgICAgLy8gMS4gTW9jayBERUxFVEVcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgZGVsZXRlOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBlcnJvcjogbnVsbCB9KSksXHJcbiAgICAgICAgICB9KSksXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3YWl0aW5nTGlzdFNlcnZpY2UucmVtb3ZlRnJvbVdhaXRpbmdMaXN0KCd1c2VyLTEnLCAnZXZ0LTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKCd3YWl0aW5nX2xpc3QnKS5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIGNoYW1vdSBvIG3DqXRvZG8gaW50ZXJubyAocXVlIGVzdMOhIGVzcGlvbmFkbylcclxuICAgICAgZXhwZWN0KHNweVJlb3JnYW5pemUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldnQtMScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdwcm9jZXNzV2FpdGluZ0xpc3QnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSBub3RpZmljYXIsIGFwbGljYXIgZSByZW1vdmVyIG8gcHLDs3hpbW8gZGEgZmlsYScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja05leHRJbkxpbmUgPSB7IGlkOiAnd2wtMScsIHVzZXJfaWQ6ICd1c2VyLW5leHQnLCBldmVudF9pZDogJ2V2dC0xJywgcG9zaXRpb246IDEgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIDEuIE1vY2sgU0VMRUNUIChwcsOzeGltbyBkYSBmaWxhKVxyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgb3JkZXI6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICAgIGxpbWl0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiBtb2NrTmV4dEluTGluZSwgZXJyb3I6IG51bGwgfSkpLFxyXG4gICAgICAgICAgICAgICAgfSkpLFxyXG4gICAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgICAgfSkpLFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgLy8gMi4gTW9jayBVUERBVEUgKG1hcmNhciBjb21vIG5vdGlmaWNhZG8pXHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZXJyb3I6IG51bGwgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayBkbyBQYXJ0aWNpcGF0aW9uU2VydmljZSAoasOhIG1vY2thZG8gbm8gc2V0dXApXHJcbiAgICAgIC8vIE1vY2sgZG8gcmVtb3ZlRnJvbVdhaXRpbmdMaXN0IChqw6EgZXNwaW9uYWRvIGUgbW9ja2FkbyBubyBzZXR1cClcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IHdhaXRpbmdMaXN0U2VydmljZS5wcm9jZXNzV2FpdGluZ0xpc3QoJ2V2dC0xJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBtYXJjb3UgY29tbyBub3RpZmljYWRvXHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKCd3YWl0aW5nX2xpc3QnKS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgbm90aWZpZWQ6IHRydWUgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSB0ZW50b3UgYXBsaWNhciBwYXJhIG8gZXZlbnRvXHJcbiAgICAgIGV4cGVjdChtb2NrZWRQYXJ0aWNpcGF0aW9uU2VydmljZS5hcHBseVRvRXZlbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICdldnQtMScsXHJcbiAgICAgICAgJ3VzZXItbmV4dCcsXHJcbiAgICAgICAgZXhwZWN0LmFueShTdHJpbmcpXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSByZW1vdmV1IGRhIGxpc3RhIChwb2lzIGFwcGx5VG9FdmVudCBmb2kgbW9ja2FkbyBjb21vIHN1Y2Vzc28pXHJcbiAgICAgIGV4cGVjdChzcHlSZW1vdmVGcm9tTGlzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXItbmV4dCcsICdldnQtMScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ07Dg08gZGV2ZSByZW1vdmVyIGRhIGxpc3RhIHNlIGEgYXByb3Zhw6fDo28gbsOjbyBmb3IgYXV0b23DoXRpY2EnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFsdGVyYSBvIG1vY2sgZG8gUGFydGljaXBhdGlvblNlcnZpY2UgcGFyYSBlc3RlIHRlc3RlXHJcbiAgICAgIChtb2NrZWRQYXJ0aWNpcGF0aW9uU2VydmljZS5hcHBseVRvRXZlbnQgYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+IFxyXG4gICAgICAgIFByb21pc2UucmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUsIGlzQXV0b0FwcHJvdmVkOiBmYWxzZSB9KSAvLyBOw4NPIGZvaSBhdXRvLWFwcm92YWRvXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCBtb2NrTmV4dEluTGluZSA9IHsgaWQ6ICd3bC0xJywgdXNlcl9pZDogJ3VzZXItbmV4dCcsIGV2ZW50X2lkOiAnZXZ0LTEnIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyAxLiBNb2NrIFNFTEVDVCAocHLDs3hpbW8gZGEgZmlsYSlcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgIG9yZGVyOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgICBsaW1pdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogbW9ja05leHRJbkxpbmUsIGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgICAgICB9KSksXHJcbiAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIC8vIDIuIE1vY2sgVVBEQVRFIChtYXJjYXIgY29tbyBub3RpZmljYWRvKVxyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IHdhaXRpbmdMaXN0U2VydmljZS5wcm9jZXNzV2FpdGluZ0xpc3QoJ2V2dC0xJyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QobW9ja2VkUGFydGljaXBhdGlvblNlcnZpY2UuYXBwbHlUb0V2ZW50KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBHQVJBTlRFIHF1ZSBOw4NPIHJlbW92ZXUgZGEgbGlzdGFcclxuICAgICAgZXhwZWN0KHNweVJlbW92ZUZyb21MaXN0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZW9yZ2FuaXplUG9zaXRpb25zIChwcml2YXRlKScsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIGF0dWFsaXphciBwb3Npw6fDtWVzIGZvcmEgZGUgb3JkZW0nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIExpYmVyYSBvcyBzcGllcyBwYXJhIHRlc3RhciBhIGltcGxlbWVudGHDp8OjbyByZWFsXHJcbiAgICAgIHNweVJlb3JnYW5pemUubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgc3B5R2V0V2FpdGluZ0xpc3QubW9ja1Jlc3RvcmUoKTsgXHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBtb2NrTGlzdCA9IFtcclxuICAgICAgICB7IGlkOiAnZW50cnktQScsIHBvc2l0aW9uOiAxIH0sXHJcbiAgICAgICAgeyBpZDogJ2VudHJ5LUInLCBwb3NpdGlvbjogMyB9LCAvLyBQb3Npw6fDo28gZXJyYWRhXHJcbiAgICAgICAgeyBpZDogJ2VudHJ5LUMnLCBwb3NpdGlvbjogNCB9LCAvLyBQb3Npw6fDo28gZXJyYWRhXHJcbiAgICAgIF07XHJcblxyXG4gICAgICAvLyAxLiBNb2NrIGRvIGdldFdhaXRpbmdMaXN0IChpbnRlcm5vKVxyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIG9yZGVyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGRhdGE6IG1vY2tMaXN0LCBlcnJvcjogbnVsbCB9KSksXHJcbiAgICAgICAgICB9KSksXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9KSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyAyLiBNb2NrIGRvIFVQREFURSAocGFyYSBlbnRyeS1CKVxyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlQiA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZXJyb3I6IG51bGwgfSkpO1xyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBtb2NrVXBkYXRlQixcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIC8vIDMuIE1vY2sgZG8gVVBEQVRFIChwYXJhIGVudHJ5LUMpXHJcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGVDID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBlcnJvcjogbnVsbCB9KSk7XHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IG1vY2tVcGRhdGVDLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hhbWEgbyBtw6l0b2RvIHByaXZhZG8gKHByZWNpc2EgZG8gJ2FzIGFueScpXHJcbiAgICAgIGF3YWl0ICh3YWl0aW5nTGlzdFNlcnZpY2UgYXMgYW55KS5yZW9yZ2FuaXplUG9zaXRpb25zKCdldnQtMScpO1xyXG5cclxuICAgICAgLy8gRGV2ZSB0ZXIgY2hhbWFkbyBvIHVwZGF0ZSAyeCAoQiBlIEMpXHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKCd3YWl0aW5nX2xpc3QnKS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIEIgZm9pIGNvcnJpZ2lkbyBwYXJhIDJcclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGVCKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaWQnLCAnZW50cnktQicpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2UuZnJvbSgnd2FpdGluZ19saXN0JykudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IHBvc2l0aW9uOiAyIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgQyBmb2kgY29ycmlnaWRvIHBhcmEgM1xyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZUMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpZCcsICdlbnRyeS1DJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKCd3YWl0aW5nX2xpc3QnKS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgcG9zaXRpb246IDMgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=