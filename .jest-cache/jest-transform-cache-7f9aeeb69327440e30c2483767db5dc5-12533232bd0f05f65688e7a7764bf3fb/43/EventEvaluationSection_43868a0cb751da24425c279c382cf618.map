{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\features\\shared\\components\\events\\EventEvaluationSection.jsx","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\features\\shared\\components\\events\\EventEvaluationSection.jsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Star, Camera } from 'lucide-react';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport EventRating from './EventRating';\r\nimport RestaurantRating from './RestaurantRating';\r\nimport EventPhotoUpload from './EventPhotoUpload';\r\n\r\nconst EventEvaluationSection = ({\r\n  eventId,\r\n  isCreator,\r\n  isParticipant,\r\n  userId,\r\n  creator,\r\n  participants,\r\n  event\r\n}) => {\r\n  const [userRatings, setUserRatings] = useState({\r\n    hostRating: false,\r\n    restaurantRating: false,\r\n    photosUploaded: false\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const checkUserRatings = useCallback(async () => {\r\n    if (!eventId || !userId) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Verifica se j√° avaliou o anfitri√£o\r\n      const { data: hostRating } = await supabase\r\n        .from('ratings')\r\n        .select('id')\r\n        .eq('event_id', eventId)\r\n        .eq('from_user_id', userId)\r\n        .eq('to_user_id', creator?.id)\r\n        .eq('rating_type', 'host')\r\n        .maybeSingle();\r\n\r\n      // Verifica se j√° avaliou o restaurante\r\n      let restaurantRatingExists = false;\r\n      if (event?.partner_id) {\r\n        const { data: restaurantRating } = await supabase\r\n          .from('restaurant_ratings')\r\n          .select('id')\r\n          .eq('event_id', eventId)\r\n          .eq('user_id', userId)\r\n          .eq('restaurant_id', event.partner_id)\r\n          .maybeSingle();\r\n\r\n        restaurantRatingExists = !!restaurantRating;\r\n      }\r\n\r\n      // Verifica se j√° enviou fotos\r\n      const { data: photos } = await supabase\r\n        .from('event_photos')\r\n        .select('id')\r\n        .eq('event_id', eventId)\r\n        .eq('user_id', userId)\r\n        .limit(1);\r\n\r\n      setUserRatings({\r\n        hostRating: !!hostRating,\r\n        restaurantRating: restaurantRatingExists,\r\n        photosUploaded: (photos?.length || 0) > 0\r\n      });\r\n    } catch (error) {\r\n      console.error('Erro ao verificar avalia√ß√µes:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [eventId, userId, creator?.id, event?.partner_id]);\r\n\r\n  useEffect(() => {\r\n    checkUserRatings();\r\n  }, [checkUserRatings]);\r\n\r\n  if (loading) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"glass-effect rounded-2xl p-6 border border-purple-500/30 bg-purple-500/10\">\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <Star className=\"w-6 h-6 text-yellow-400\" />\r\n          <h2 className=\"text-2xl font-bold text-white\">\r\n            {isCreator ? 'Avalie Participantes e Restaurante' : 'Avalia√ß√µes do Evento'}\r\n          </h2>\r\n        </div>\r\n        <p className=\"text-white/70 text-sm\">\r\n          {isCreator\r\n            ? 'Como anfitri√£o, voc√™ pode avaliar a experi√™ncia com os participantes e o restaurante.'\r\n            : 'Compartilhe suas fotos e avalia√ß√µes sobre este evento incr√≠vel!'}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Para PARTICIPANTES */}\r\n      {!isCreator && isParticipant && (\r\n        <>\r\n          {/* Upload de Fotos */}\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Camera className={`w-5 h-5 ${userRatings.photosUploaded ? 'text-green-400' : 'text-blue-400'}`} />\r\n              <h3 className=\"text-xl font-semibold text-white\">\r\n                Compartilhe suas Fotos\r\n                {userRatings.photosUploaded && <span className=\"text-green-400 ml-2\">‚úÖ</span>}\r\n              </h3>\r\n            </div>\r\n            <EventPhotoUpload eventId={eventId} />\r\n          </div>\r\n\r\n          {/* Rating do Anfitri√£o */}\r\n          {creator && !userRatings.hostRating && (\r\n            <EventRating\r\n              eventId={eventId}\r\n              hostId={creator.id}\r\n              hostName={creator.username || creator.full_name}\r\n              onAllRatingsComplete={checkUserRatings}\r\n            />\r\n          )}\r\n\r\n          {userRatings.hostRating && (\r\n            <div className=\"glass-effect rounded-2xl p-6 border border-green-500/20 bg-green-500/5\">\r\n              <p className=\"text-green-200 text-sm flex items-center gap-2\">\r\n                <Star className=\"w-4 h-4 text-green-400\" />\r\n                ‚úÖ Voc√™ j√° avaliou o anfitri√£o\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Rating do Restaurante */}\r\n          {event?.partner && !userRatings.restaurantRating && (\r\n            <RestaurantRating\r\n              eventId={eventId}\r\n              restaurantId={event.partner.id}\r\n              restaurantName={event.partner.name}\r\n              onRatingSubmit={checkUserRatings}\r\n            />\r\n          )}\r\n\r\n          {userRatings.restaurantRating && (\r\n            <div className=\"glass-effect rounded-2xl p-6 border border-green-500/20 bg-green-500/5\">\r\n              <p className=\"text-green-200 text-sm flex items-center gap-2\">\r\n                <Star className=\"w-4 h-4 text-green-400\" />\r\n                ‚úÖ Voc√™ j√° avaliou o restaurante\r\n              </p>\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n\r\n      {/* Para ANFITRI√ÉO */}\r\n      {isCreator && (\r\n        <>\r\n          {/* Rating dos Participantes */}\r\n          {participants && participants.length > 0 && (\r\n            <EventRating\r\n              eventId={eventId}\r\n              hostId={userId}\r\n              hostName=\"Voc√™\"\r\n              onAllRatingsComplete={checkUserRatings}\r\n            />\r\n          )}\r\n\r\n          {/* Rating do Restaurante */}\r\n          {event?.partner && (\r\n            <RestaurantRating\r\n              eventId={eventId}\r\n              restaurantId={event.partner.id}\r\n              restaurantName={event.partner.name}\r\n              onRatingSubmit={checkUserRatings}\r\n            />\r\n          )}\r\n        </>\r\n      )}\r\n\r\n      {/* Resumo de Conclus√£o */}\r\n      {!isCreator && isParticipant && (\r\n        <div className=\"glass-effect rounded-2xl p-4 border border-white/10 text-center\">\r\n          <p className=\"text-white/70 text-sm\">\r\n            {userRatings.hostRating && userRatings.restaurantRating\r\n              ? 'üéâ Voc√™ completou todas as avalia√ß√µes! Obrigado por participar!'\r\n              : '‚è≥ Complete as avalia√ß√µes para concluir seu feedback'}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nEventEvaluationSection.propTypes = {\r\n  eventId: PropTypes.number.isRequired,\r\n  isCreator: PropTypes.bool.isRequired,\r\n  isParticipant: PropTypes.bool.isRequired,\r\n  userId: PropTypes.string.isRequired,\r\n  creator: PropTypes.object,\r\n  participants: PropTypes.array,\r\n  event: PropTypes.object\r\n};\r\n\r\nexport default EventEvaluationSection;"],"version":3}