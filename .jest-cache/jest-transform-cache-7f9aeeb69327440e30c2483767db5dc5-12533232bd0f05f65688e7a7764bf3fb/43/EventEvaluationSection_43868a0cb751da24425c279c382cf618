2e3cbe9768d4e936c98dc55b90b1aabf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const prop_types_1 = tslib_1.__importDefault(require("prop-types"));
const lucide_react_1 = require("lucide-react");
const supabaseClient_1 = require("@/lib/supabaseClient");
const EventRating_1 = tslib_1.__importDefault(require("./EventRating"));
const RestaurantRating_1 = tslib_1.__importDefault(require("./RestaurantRating"));
const EventPhotoUpload_1 = tslib_1.__importDefault(require("./EventPhotoUpload"));
const EventEvaluationSection = ({ eventId, isCreator, isParticipant, userId, creator, participants, event }) => {
    const [userRatings, setUserRatings] = (0, react_1.useState)({
        hostRating: false,
        restaurantRating: false,
        photosUploaded: false
    });
    const [loading, setLoading] = (0, react_1.useState)(true);
    const checkUserRatings = (0, react_1.useCallback)(async () => {
        if (!eventId || !userId) {
            setLoading(false);
            return;
        }
        try {
            setLoading(true);
            // Verifica se j√° avaliou o anfitri√£o
            const { data: hostRating } = await supabaseClient_1.supabase
                .from('ratings')
                .select('id')
                .eq('event_id', eventId)
                .eq('from_user_id', userId)
                .eq('to_user_id', creator?.id)
                .eq('rating_type', 'host')
                .maybeSingle();
            // Verifica se j√° avaliou o restaurante
            let restaurantRatingExists = false;
            if (event?.partner_id) {
                const { data: restaurantRating } = await supabaseClient_1.supabase
                    .from('restaurant_ratings')
                    .select('id')
                    .eq('event_id', eventId)
                    .eq('user_id', userId)
                    .eq('restaurant_id', event.partner_id)
                    .maybeSingle();
                restaurantRatingExists = !!restaurantRating;
            }
            // Verifica se j√° enviou fotos
            const { data: photos } = await supabaseClient_1.supabase
                .from('event_photos')
                .select('id')
                .eq('event_id', eventId)
                .eq('user_id', userId)
                .limit(1);
            setUserRatings({
                hostRating: !!hostRating,
                restaurantRating: restaurantRatingExists,
                photosUploaded: (photos?.length || 0) > 0
            });
        }
        catch (error) {
            console.error('Erro ao verificar avalia√ß√µes:', error);
        }
        finally {
            setLoading(false);
        }
    }, [eventId, userId, creator?.id, event?.partner_id]);
    (0, react_1.useEffect)(() => {
        checkUserRatings();
    }, [checkUserRatings]);
    if (loading) {
        return null;
    }
    return ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "glass-effect rounded-2xl p-6 border border-purple-500/30 bg-purple-500/10", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-3 mb-4", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Star, { className: "w-6 h-6 text-yellow-400" }), (0, jsx_runtime_1.jsx)("h2", { className: "text-2xl font-bold text-white", children: isCreator ? 'Avalie Participantes e Restaurante' : 'Avalia√ß√µes do Evento' })] }), (0, jsx_runtime_1.jsx)("p", { className: "text-white/70 text-sm", children: isCreator
                            ? 'Como anfitri√£o, voc√™ pode avaliar a experi√™ncia com os participantes e o restaurante.'
                            : 'Compartilhe suas fotos e avalia√ß√µes sobre este evento incr√≠vel!' })] }), !isCreator && isParticipant && ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsxs)("div", { className: "space-y-4", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Camera, { className: `w-5 h-5 ${userRatings.photosUploaded ? 'text-green-400' : 'text-blue-400'}` }), (0, jsx_runtime_1.jsxs)("h3", { className: "text-xl font-semibold text-white", children: ["Compartilhe suas Fotos", userRatings.photosUploaded && (0, jsx_runtime_1.jsx)("span", { className: "text-green-400 ml-2", children: "\u2705" })] })] }), (0, jsx_runtime_1.jsx)(EventPhotoUpload_1.default, { eventId: eventId })] }), creator && !userRatings.hostRating && ((0, jsx_runtime_1.jsx)(EventRating_1.default, { eventId: eventId, hostId: creator.id, hostName: creator.username || creator.full_name, onAllRatingsComplete: checkUserRatings })), userRatings.hostRating && ((0, jsx_runtime_1.jsx)("div", { className: "glass-effect rounded-2xl p-6 border border-green-500/20 bg-green-500/5", children: (0, jsx_runtime_1.jsxs)("p", { className: "text-green-200 text-sm flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Star, { className: "w-4 h-4 text-green-400" }), "\u2705 Voc\u00EA j\u00E1 avaliou o anfitri\u00E3o"] }) })), event?.partner && !userRatings.restaurantRating && ((0, jsx_runtime_1.jsx)(RestaurantRating_1.default, { eventId: eventId, restaurantId: event.partner.id, restaurantName: event.partner.name, onRatingSubmit: checkUserRatings })), userRatings.restaurantRating && ((0, jsx_runtime_1.jsx)("div", { className: "glass-effect rounded-2xl p-6 border border-green-500/20 bg-green-500/5", children: (0, jsx_runtime_1.jsxs)("p", { className: "text-green-200 text-sm flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Star, { className: "w-4 h-4 text-green-400" }), "\u2705 Voc\u00EA j\u00E1 avaliou o restaurante"] }) }))] })), isCreator && ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [participants && participants.length > 0 && ((0, jsx_runtime_1.jsx)(EventRating_1.default, { eventId: eventId, hostId: userId, hostName: "Voc\u00EA", onAllRatingsComplete: checkUserRatings })), event?.partner && ((0, jsx_runtime_1.jsx)(RestaurantRating_1.default, { eventId: eventId, restaurantId: event.partner.id, restaurantName: event.partner.name, onRatingSubmit: checkUserRatings }))] })), !isCreator && isParticipant && ((0, jsx_runtime_1.jsx)("div", { className: "glass-effect rounded-2xl p-4 border border-white/10 text-center", children: (0, jsx_runtime_1.jsx)("p", { className: "text-white/70 text-sm", children: userRatings.hostRating && userRatings.restaurantRating
                        ? 'üéâ Voc√™ completou todas as avalia√ß√µes! Obrigado por participar!'
                        : '‚è≥ Complete as avalia√ß√µes para concluir seu feedback' }) }))] }));
};
EventEvaluationSection.propTypes = {
    eventId: prop_types_1.default.number.isRequired,
    isCreator: prop_types_1.default.bool.isRequired,
    isParticipant: prop_types_1.default.bool.isRequired,
    userId: prop_types_1.default.string.isRequired,
    creator: prop_types_1.default.object,
    participants: prop_types_1.default.array,
    event: prop_types_1.default.object
};
exports.default = EventEvaluationSection;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcc2hhcmVkXFxjb21wb25lbnRzXFxldmVudHNcXEV2ZW50RXZhbHVhdGlvblNlY3Rpb24uanN4IiwibWFwcGluZ3MiOiI7Ozs7QUFBQSxpQ0FBeUQ7QUFDekQsb0VBQW1DO0FBQ25DLCtDQUE0QztBQUM1Qyx5REFBZ0Q7QUFDaEQsd0VBQXdDO0FBQ3hDLGtGQUFrRDtBQUNsRCxrRkFBa0Q7QUFFbEQsTUFBTSxzQkFBc0IsR0FBRyxDQUFDLEVBQzlCLE9BQU8sRUFDUCxTQUFTLEVBQ1QsYUFBYSxFQUNiLE1BQU0sRUFDTixPQUFPLEVBQ1AsWUFBWSxFQUNaLEtBQUssRUFDTixFQUFFLEVBQUU7SUFDSCxNQUFNLENBQUMsV0FBVyxFQUFFLGNBQWMsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQztRQUM3QyxVQUFVLEVBQUUsS0FBSztRQUNqQixnQkFBZ0IsRUFBRSxLQUFLO1FBQ3ZCLGNBQWMsRUFBRSxLQUFLO0tBQ3RCLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBRTdDLE1BQU0sZ0JBQWdCLEdBQUcsSUFBQSxtQkFBVyxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQzlDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUN4QixVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEIsT0FBTztRQUNULENBQUM7UUFFRCxJQUFJLENBQUM7WUFDSCxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFakIscUNBQXFDO1lBQ3JDLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLEdBQUcsTUFBTSx5QkFBUTtpQkFDeEMsSUFBSSxDQUFDLFNBQVMsQ0FBQztpQkFDZixNQUFNLENBQUMsSUFBSSxDQUFDO2lCQUNaLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDO2lCQUN2QixFQUFFLENBQUMsY0FBYyxFQUFFLE1BQU0sQ0FBQztpQkFDMUIsRUFBRSxDQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUFDO2lCQUM3QixFQUFFLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQztpQkFDekIsV0FBVyxFQUFFLENBQUM7WUFFakIsdUNBQXVDO1lBQ3ZDLElBQUksc0JBQXNCLEdBQUcsS0FBSyxDQUFDO1lBQ25DLElBQUksS0FBSyxFQUFFLFVBQVUsRUFBRSxDQUFDO2dCQUN0QixNQUFNLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLEdBQUcsTUFBTSx5QkFBUTtxQkFDOUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDO3FCQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDO3FCQUNaLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDO3FCQUN2QixFQUFFLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQztxQkFDckIsRUFBRSxDQUFDLGVBQWUsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDO3FCQUNyQyxXQUFXLEVBQUUsQ0FBQztnQkFFakIsc0JBQXNCLEdBQUcsQ0FBQyxDQUFDLGdCQUFnQixDQUFDO1lBQzlDLENBQUM7WUFFRCw4QkFBOEI7WUFDOUIsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsR0FBRyxNQUFNLHlCQUFRO2lCQUNwQyxJQUFJLENBQUMsY0FBYyxDQUFDO2lCQUNwQixNQUFNLENBQUMsSUFBSSxDQUFDO2lCQUNaLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDO2lCQUN2QixFQUFFLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQztpQkFDckIsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRVosY0FBYyxDQUFDO2dCQUNiLFVBQVUsRUFBRSxDQUFDLENBQUMsVUFBVTtnQkFDeEIsZ0JBQWdCLEVBQUUsc0JBQXNCO2dCQUN4QyxjQUFjLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUM7YUFDMUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLCtCQUErQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3hELENBQUM7Z0JBQVMsQ0FBQztZQUNULFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNwQixDQUFDO0lBQ0gsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0lBRXRELElBQUEsaUJBQVMsRUFBQyxHQUFHLEVBQUU7UUFDYixnQkFBZ0IsRUFBRSxDQUFDO0lBQ3JCLENBQUMsRUFBRSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztJQUV2QixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ1osT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsT0FBTyxDQUNMLGlDQUFLLFNBQVMsRUFBQyxXQUFXLGFBRXhCLGlDQUFLLFNBQVMsRUFBQywyRUFBMkUsYUFDeEYsaUNBQUssU0FBUyxFQUFDLDhCQUE4QixhQUMzQyx1QkFBQyxtQkFBSSxJQUFDLFNBQVMsRUFBQyx5QkFBeUIsR0FBRyxFQUM1QywrQkFBSSxTQUFTLEVBQUMsK0JBQStCLFlBQzFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsb0NBQW9DLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixHQUN2RSxJQUNELEVBQ04sOEJBQUcsU0FBUyxFQUFDLHVCQUF1QixZQUNqQyxTQUFTOzRCQUNSLENBQUMsQ0FBQyx1RkFBdUY7NEJBQ3pGLENBQUMsQ0FBQyxpRUFBaUUsR0FDbkUsSUFDQSxFQUdMLENBQUMsU0FBUyxJQUFJLGFBQWEsSUFBSSxDQUM5Qiw2REFFRSxpQ0FBSyxTQUFTLEVBQUMsV0FBVyxhQUN4QixpQ0FBSyxTQUFTLEVBQUMseUJBQXlCLGFBQ3RDLHVCQUFDLHFCQUFNLElBQUMsU0FBUyxFQUFFLFdBQVcsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGVBQWUsRUFBRSxHQUFJLEVBQ25HLGdDQUFJLFNBQVMsRUFBQyxrQ0FBa0MsdUNBRTdDLFdBQVcsQ0FBQyxjQUFjLElBQUksaUNBQU0sU0FBUyxFQUFDLHFCQUFxQix1QkFBUyxJQUMxRSxJQUNELEVBQ04sdUJBQUMsMEJBQWdCLElBQUMsT0FBTyxFQUFFLE9BQU8sR0FBSSxJQUNsQyxFQUdMLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLElBQUksQ0FDckMsdUJBQUMscUJBQVcsSUFDVixPQUFPLEVBQUUsT0FBTyxFQUNoQixNQUFNLEVBQUUsT0FBTyxDQUFDLEVBQUUsRUFDbEIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRLElBQUksT0FBTyxDQUFDLFNBQVMsRUFDL0Msb0JBQW9CLEVBQUUsZ0JBQWdCLEdBQ3RDLENBQ0gsRUFFQSxXQUFXLENBQUMsVUFBVSxJQUFJLENBQ3pCLGdDQUFLLFNBQVMsRUFBQyx3RUFBd0UsWUFDckYsK0JBQUcsU0FBUyxFQUFDLGdEQUFnRCxhQUMzRCx1QkFBQyxtQkFBSSxJQUFDLFNBQVMsRUFBQyx3QkFBd0IsR0FBRyx5REFFekMsR0FDQSxDQUNQLEVBR0EsS0FBSyxFQUFFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsSUFBSSxDQUNsRCx1QkFBQywwQkFBZ0IsSUFDZixPQUFPLEVBQUUsT0FBTyxFQUNoQixZQUFZLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQzlCLGNBQWMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksRUFDbEMsY0FBYyxFQUFFLGdCQUFnQixHQUNoQyxDQUNILEVBRUEsV0FBVyxDQUFDLGdCQUFnQixJQUFJLENBQy9CLGdDQUFLLFNBQVMsRUFBQyx3RUFBd0UsWUFDckYsK0JBQUcsU0FBUyxFQUFDLGdEQUFnRCxhQUMzRCx1QkFBQyxtQkFBSSxJQUFDLFNBQVMsRUFBQyx3QkFBd0IsR0FBRyxzREFFekMsR0FDQSxDQUNQLElBQ0EsQ0FDSixFQUdBLFNBQVMsSUFBSSxDQUNaLDZEQUVHLFlBQVksSUFBSSxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUMxQyx1QkFBQyxxQkFBVyxJQUNWLE9BQU8sRUFBRSxPQUFPLEVBQ2hCLE1BQU0sRUFBRSxNQUFNLEVBQ2QsUUFBUSxFQUFDLFdBQU0sRUFDZixvQkFBb0IsRUFBRSxnQkFBZ0IsR0FDdEMsQ0FDSCxFQUdBLEtBQUssRUFBRSxPQUFPLElBQUksQ0FDakIsdUJBQUMsMEJBQWdCLElBQ2YsT0FBTyxFQUFFLE9BQU8sRUFDaEIsWUFBWSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUM5QixjQUFjLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQ2xDLGNBQWMsRUFBRSxnQkFBZ0IsR0FDaEMsQ0FDSCxJQUNBLENBQ0osRUFHQSxDQUFDLFNBQVMsSUFBSSxhQUFhLElBQUksQ0FDOUIsZ0NBQUssU0FBUyxFQUFDLGlFQUFpRSxZQUM5RSw4QkFBRyxTQUFTLEVBQUMsdUJBQXVCLFlBQ2pDLFdBQVcsQ0FBQyxVQUFVLElBQUksV0FBVyxDQUFDLGdCQUFnQjt3QkFDckQsQ0FBQyxDQUFDLGlFQUFpRTt3QkFDbkUsQ0FBQyxDQUFDLHFEQUFxRCxHQUN2RCxHQUNBLENBQ1AsSUFDRyxDQUNQLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixzQkFBc0IsQ0FBQyxTQUFTLEdBQUc7SUFDakMsT0FBTyxFQUFFLG9CQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7SUFDcEMsU0FBUyxFQUFFLG9CQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7SUFDcEMsYUFBYSxFQUFFLG9CQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7SUFDeEMsTUFBTSxFQUFFLG9CQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7SUFDbkMsT0FBTyxFQUFFLG9CQUFTLENBQUMsTUFBTTtJQUN6QixZQUFZLEVBQUUsb0JBQVMsQ0FBQyxLQUFLO0lBQzdCLEtBQUssRUFBRSxvQkFBUyxDQUFDLE1BQU07Q0FDeEIsQ0FBQztBQUVGLGtCQUFlLHNCQUFzQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcZmVhdHVyZXNcXHNoYXJlZFxcY29tcG9uZW50c1xcZXZlbnRzXFxFdmVudEV2YWx1YXRpb25TZWN0aW9uLmpzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0LCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcclxuaW1wb3J0IHsgU3RhciwgQ2FtZXJhIH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICdAL2xpYi9zdXBhYmFzZUNsaWVudCc7XHJcbmltcG9ydCBFdmVudFJhdGluZyBmcm9tICcuL0V2ZW50UmF0aW5nJztcclxuaW1wb3J0IFJlc3RhdXJhbnRSYXRpbmcgZnJvbSAnLi9SZXN0YXVyYW50UmF0aW5nJztcclxuaW1wb3J0IEV2ZW50UGhvdG9VcGxvYWQgZnJvbSAnLi9FdmVudFBob3RvVXBsb2FkJztcclxuXHJcbmNvbnN0IEV2ZW50RXZhbHVhdGlvblNlY3Rpb24gPSAoe1xyXG4gIGV2ZW50SWQsXHJcbiAgaXNDcmVhdG9yLFxyXG4gIGlzUGFydGljaXBhbnQsXHJcbiAgdXNlcklkLFxyXG4gIGNyZWF0b3IsXHJcbiAgcGFydGljaXBhbnRzLFxyXG4gIGV2ZW50XHJcbn0pID0+IHtcclxuICBjb25zdCBbdXNlclJhdGluZ3MsIHNldFVzZXJSYXRpbmdzXSA9IHVzZVN0YXRlKHtcclxuICAgIGhvc3RSYXRpbmc6IGZhbHNlLFxyXG4gICAgcmVzdGF1cmFudFJhdGluZzogZmFsc2UsXHJcbiAgICBwaG90b3NVcGxvYWRlZDogZmFsc2VcclxuICB9KTtcclxuICBjb25zdCBbbG9hZGluZywgc2V0TG9hZGluZ10gPSB1c2VTdGF0ZSh0cnVlKTtcclxuXHJcbiAgY29uc3QgY2hlY2tVc2VyUmF0aW5ncyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIGlmICghZXZlbnRJZCB8fCAhdXNlcklkKSB7XHJcbiAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgc2V0TG9hZGluZyh0cnVlKTtcclxuXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIGrDoSBhdmFsaW91IG8gYW5maXRyacOjb1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGhvc3RSYXRpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3JhdGluZ3MnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuZXEoJ2V2ZW50X2lkJywgZXZlbnRJZClcclxuICAgICAgICAuZXEoJ2Zyb21fdXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAuZXEoJ3RvX3VzZXJfaWQnLCBjcmVhdG9yPy5pZClcclxuICAgICAgICAuZXEoJ3JhdGluZ190eXBlJywgJ2hvc3QnKVxyXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgLy8gVmVyaWZpY2Egc2UgasOhIGF2YWxpb3UgbyByZXN0YXVyYW50ZVxyXG4gICAgICBsZXQgcmVzdGF1cmFudFJhdGluZ0V4aXN0cyA9IGZhbHNlO1xyXG4gICAgICBpZiAoZXZlbnQ/LnBhcnRuZXJfaWQpIHtcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHJlc3RhdXJhbnRSYXRpbmcgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncmVzdGF1cmFudF9yYXRpbmdzJylcclxuICAgICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAgIC5lcSgnZXZlbnRfaWQnLCBldmVudElkKVxyXG4gICAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxyXG4gICAgICAgICAgLmVxKCdyZXN0YXVyYW50X2lkJywgZXZlbnQucGFydG5lcl9pZClcclxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgICAgICByZXN0YXVyYW50UmF0aW5nRXhpc3RzID0gISFyZXN0YXVyYW50UmF0aW5nO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBqw6EgZW52aW91IGZvdG9zXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogcGhvdG9zIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdldmVudF9waG90b3MnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuZXEoJ2V2ZW50X2lkJywgZXZlbnRJZClcclxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXHJcbiAgICAgICAgLmxpbWl0KDEpO1xyXG5cclxuICAgICAgc2V0VXNlclJhdGluZ3Moe1xyXG4gICAgICAgIGhvc3RSYXRpbmc6ICEhaG9zdFJhdGluZyxcclxuICAgICAgICByZXN0YXVyYW50UmF0aW5nOiByZXN0YXVyYW50UmF0aW5nRXhpc3RzLFxyXG4gICAgICAgIHBob3Rvc1VwbG9hZGVkOiAocGhvdG9zPy5sZW5ndGggfHwgMCkgPiAwXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJybyBhbyB2ZXJpZmljYXIgYXZhbGlhw6fDtWVzOicsIGVycm9yKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH0sIFtldmVudElkLCB1c2VySWQsIGNyZWF0b3I/LmlkLCBldmVudD8ucGFydG5lcl9pZF0pO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgY2hlY2tVc2VyUmF0aW5ncygpO1xyXG4gIH0sIFtjaGVja1VzZXJSYXRpbmdzXSk7XHJcblxyXG4gIGlmIChsb2FkaW5nKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICA8ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktNlwiPlxyXG4gICAgICB7LyogSGVhZGVyICovfVxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImdsYXNzLWVmZmVjdCByb3VuZGVkLTJ4bCBwLTYgYm9yZGVyIGJvcmRlci1wdXJwbGUtNTAwLzMwIGJnLXB1cnBsZS01MDAvMTBcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGdhcC0zIG1iLTRcIj5cclxuICAgICAgICAgIDxTdGFyIGNsYXNzTmFtZT1cInctNiBoLTYgdGV4dC15ZWxsb3ctNDAwXCIgLz5cclxuICAgICAgICAgIDxoMiBjbGFzc05hbWU9XCJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC13aGl0ZVwiPlxyXG4gICAgICAgICAgICB7aXNDcmVhdG9yID8gJ0F2YWxpZSBQYXJ0aWNpcGFudGVzIGUgUmVzdGF1cmFudGUnIDogJ0F2YWxpYcOnw7VlcyBkbyBFdmVudG8nfVxyXG4gICAgICAgICAgPC9oMj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LXdoaXRlLzcwIHRleHQtc21cIj5cclxuICAgICAgICAgIHtpc0NyZWF0b3JcclxuICAgICAgICAgICAgPyAnQ29tbyBhbmZpdHJpw6NvLCB2b2PDqiBwb2RlIGF2YWxpYXIgYSBleHBlcmnDqm5jaWEgY29tIG9zIHBhcnRpY2lwYW50ZXMgZSBvIHJlc3RhdXJhbnRlLidcclxuICAgICAgICAgICAgOiAnQ29tcGFydGlsaGUgc3VhcyBmb3RvcyBlIGF2YWxpYcOnw7VlcyBzb2JyZSBlc3RlIGV2ZW50byBpbmNyw612ZWwhJ31cclxuICAgICAgICA8L3A+XHJcbiAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgey8qIFBhcmEgUEFSVElDSVBBTlRFUyAqL31cclxuICAgICAgeyFpc0NyZWF0b3IgJiYgaXNQYXJ0aWNpcGFudCAmJiAoXHJcbiAgICAgICAgPD5cclxuICAgICAgICAgIHsvKiBVcGxvYWQgZGUgRm90b3MgKi99XHJcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktNFwiPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGdhcC0yXCI+XHJcbiAgICAgICAgICAgICAgPENhbWVyYSBjbGFzc05hbWU9e2B3LTUgaC01ICR7dXNlclJhdGluZ3MucGhvdG9zVXBsb2FkZWQgPyAndGV4dC1ncmVlbi00MDAnIDogJ3RleHQtYmx1ZS00MDAnfWB9IC8+XHJcbiAgICAgICAgICAgICAgPGgzIGNsYXNzTmFtZT1cInRleHQteGwgZm9udC1zZW1pYm9sZCB0ZXh0LXdoaXRlXCI+XHJcbiAgICAgICAgICAgICAgICBDb21wYXJ0aWxoZSBzdWFzIEZvdG9zXHJcbiAgICAgICAgICAgICAgICB7dXNlclJhdGluZ3MucGhvdG9zVXBsb2FkZWQgJiYgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC1ncmVlbi00MDAgbWwtMlwiPuKchTwvc3Bhbj59XHJcbiAgICAgICAgICAgICAgPC9oMz5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDxFdmVudFBob3RvVXBsb2FkIGV2ZW50SWQ9e2V2ZW50SWR9IC8+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuXHJcbiAgICAgICAgICB7LyogUmF0aW5nIGRvIEFuZml0cmnDo28gKi99XHJcbiAgICAgICAgICB7Y3JlYXRvciAmJiAhdXNlclJhdGluZ3MuaG9zdFJhdGluZyAmJiAoXHJcbiAgICAgICAgICAgIDxFdmVudFJhdGluZ1xyXG4gICAgICAgICAgICAgIGV2ZW50SWQ9e2V2ZW50SWR9XHJcbiAgICAgICAgICAgICAgaG9zdElkPXtjcmVhdG9yLmlkfVxyXG4gICAgICAgICAgICAgIGhvc3ROYW1lPXtjcmVhdG9yLnVzZXJuYW1lIHx8IGNyZWF0b3IuZnVsbF9uYW1lfVxyXG4gICAgICAgICAgICAgIG9uQWxsUmF0aW5nc0NvbXBsZXRlPXtjaGVja1VzZXJSYXRpbmdzfVxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICAgKX1cclxuXHJcbiAgICAgICAgICB7dXNlclJhdGluZ3MuaG9zdFJhdGluZyAmJiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2xhc3MtZWZmZWN0IHJvdW5kZWQtMnhsIHAtNiBib3JkZXIgYm9yZGVyLWdyZWVuLTUwMC8yMCBiZy1ncmVlbi01MDAvNVwiPlxyXG4gICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtZ3JlZW4tMjAwIHRleHQtc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTJcIj5cclxuICAgICAgICAgICAgICAgIDxTdGFyIGNsYXNzTmFtZT1cInctNCBoLTQgdGV4dC1ncmVlbi00MDBcIiAvPlxyXG4gICAgICAgICAgICAgICAg4pyFIFZvY8OqIGrDoSBhdmFsaW91IG8gYW5maXRyacOjb1xyXG4gICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIHsvKiBSYXRpbmcgZG8gUmVzdGF1cmFudGUgKi99XHJcbiAgICAgICAgICB7ZXZlbnQ/LnBhcnRuZXIgJiYgIXVzZXJSYXRpbmdzLnJlc3RhdXJhbnRSYXRpbmcgJiYgKFxyXG4gICAgICAgICAgICA8UmVzdGF1cmFudFJhdGluZ1xyXG4gICAgICAgICAgICAgIGV2ZW50SWQ9e2V2ZW50SWR9XHJcbiAgICAgICAgICAgICAgcmVzdGF1cmFudElkPXtldmVudC5wYXJ0bmVyLmlkfVxyXG4gICAgICAgICAgICAgIHJlc3RhdXJhbnROYW1lPXtldmVudC5wYXJ0bmVyLm5hbWV9XHJcbiAgICAgICAgICAgICAgb25SYXRpbmdTdWJtaXQ9e2NoZWNrVXNlclJhdGluZ3N9XHJcbiAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIHt1c2VyUmF0aW5ncy5yZXN0YXVyYW50UmF0aW5nICYmIChcclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJnbGFzcy1lZmZlY3Qgcm91bmRlZC0yeGwgcC02IGJvcmRlciBib3JkZXItZ3JlZW4tNTAwLzIwIGJnLWdyZWVuLTUwMC81XCI+XHJcbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC1ncmVlbi0yMDAgdGV4dC1zbSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMlwiPlxyXG4gICAgICAgICAgICAgICAgPFN0YXIgY2xhc3NOYW1lPVwidy00IGgtNCB0ZXh0LWdyZWVuLTQwMFwiIC8+XHJcbiAgICAgICAgICAgICAgICDinIUgVm9jw6ogasOhIGF2YWxpb3UgbyByZXN0YXVyYW50ZVxyXG4gICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICApfVxyXG4gICAgICAgIDwvPlxyXG4gICAgICApfVxyXG5cclxuICAgICAgey8qIFBhcmEgQU5GSVRSScODTyAqL31cclxuICAgICAge2lzQ3JlYXRvciAmJiAoXHJcbiAgICAgICAgPD5cclxuICAgICAgICAgIHsvKiBSYXRpbmcgZG9zIFBhcnRpY2lwYW50ZXMgKi99XHJcbiAgICAgICAgICB7cGFydGljaXBhbnRzICYmIHBhcnRpY2lwYW50cy5sZW5ndGggPiAwICYmIChcclxuICAgICAgICAgICAgPEV2ZW50UmF0aW5nXHJcbiAgICAgICAgICAgICAgZXZlbnRJZD17ZXZlbnRJZH1cclxuICAgICAgICAgICAgICBob3N0SWQ9e3VzZXJJZH1cclxuICAgICAgICAgICAgICBob3N0TmFtZT1cIlZvY8OqXCJcclxuICAgICAgICAgICAgICBvbkFsbFJhdGluZ3NDb21wbGV0ZT17Y2hlY2tVc2VyUmF0aW5nc31cclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgICl9XHJcblxyXG4gICAgICAgICAgey8qIFJhdGluZyBkbyBSZXN0YXVyYW50ZSAqL31cclxuICAgICAgICAgIHtldmVudD8ucGFydG5lciAmJiAoXHJcbiAgICAgICAgICAgIDxSZXN0YXVyYW50UmF0aW5nXHJcbiAgICAgICAgICAgICAgZXZlbnRJZD17ZXZlbnRJZH1cclxuICAgICAgICAgICAgICByZXN0YXVyYW50SWQ9e2V2ZW50LnBhcnRuZXIuaWR9XHJcbiAgICAgICAgICAgICAgcmVzdGF1cmFudE5hbWU9e2V2ZW50LnBhcnRuZXIubmFtZX1cclxuICAgICAgICAgICAgICBvblJhdGluZ1N1Ym1pdD17Y2hlY2tVc2VyUmF0aW5nc31cclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgICl9XHJcbiAgICAgICAgPC8+XHJcbiAgICAgICl9XHJcblxyXG4gICAgICB7LyogUmVzdW1vIGRlIENvbmNsdXPDo28gKi99XHJcbiAgICAgIHshaXNDcmVhdG9yICYmIGlzUGFydGljaXBhbnQgJiYgKFxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2xhc3MtZWZmZWN0IHJvdW5kZWQtMnhsIHAtNCBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHRleHQtY2VudGVyXCI+XHJcbiAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LXdoaXRlLzcwIHRleHQtc21cIj5cclxuICAgICAgICAgICAge3VzZXJSYXRpbmdzLmhvc3RSYXRpbmcgJiYgdXNlclJhdGluZ3MucmVzdGF1cmFudFJhdGluZ1xyXG4gICAgICAgICAgICAgID8gJ/CfjokgVm9jw6ogY29tcGxldG91IHRvZGFzIGFzIGF2YWxpYcOnw7VlcyEgT2JyaWdhZG8gcG9yIHBhcnRpY2lwYXIhJ1xyXG4gICAgICAgICAgICAgIDogJ+KPsyBDb21wbGV0ZSBhcyBhdmFsaWHDp8O1ZXMgcGFyYSBjb25jbHVpciBzZXUgZmVlZGJhY2snfVxyXG4gICAgICAgICAgPC9wPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICApfVxyXG4gICAgPC9kaXY+XHJcbiAgKTtcclxufTtcclxuXHJcbkV2ZW50RXZhbHVhdGlvblNlY3Rpb24ucHJvcFR5cGVzID0ge1xyXG4gIGV2ZW50SWQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcclxuICBpc0NyZWF0b3I6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXHJcbiAgaXNQYXJ0aWNpcGFudDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcclxuICB1c2VySWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcclxuICBjcmVhdG9yOiBQcm9wVHlwZXMub2JqZWN0LFxyXG4gIHBhcnRpY2lwYW50czogUHJvcFR5cGVzLmFycmF5LFxyXG4gIGV2ZW50OiBQcm9wVHlwZXMub2JqZWN0XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBFdmVudEV2YWx1YXRpb25TZWN0aW9uOyJdLCJ2ZXJzaW9uIjozfQ==