{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\ProtectedRoutes.test.jsx","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\ProtectedRoutes.test.jsx"],"sourcesContent":["/* eslint-env jest */\r\nimport React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport { MemoryRouter, Routes, Route } from 'react-router-dom';\r\n// ✅ CORREÇÃO: Alterado para caminho relativo\r\nimport { useAuth } from './contexts/AuthContext.jsx';\r\nimport {\r\n  ProtectedRoute,\r\n  ProtectedUserRoute,\r\n  ProtectedPartnerRoute,\r\n} from './ProtectedRoutes.jsx'; // ✅ CORREÇÃO: Alterado para caminho relativo\r\n\r\n// --- Mocks ---\r\n\r\n// Mock do hook useAuth\r\n// ✅ CORREÇÃO: Usando caminho relativo no mock também\r\njest.mock('./contexts/AuthContext.jsx', () => ({\r\n  useAuth: jest.fn(),\r\n}));\r\n\r\n// Componentes \"filho\" e de \"destino\" para testar o roteamento\r\nconst TestChildComponent = () => <div>Componente Filho Protegido</div>;\r\nconst LoginComponent = () => <div>Página de Login</div>;\r\nconst UserDashboard = () => <div>Dashboard do Usuário</div>;\r\nconst PartnerDashboard = () => <div>Dashboard do Parceiro</div>;\r\n\r\n// --- Helper de Renderização ---\r\n\r\n/**\r\n * Renderiza os componentes de rota dentro de um MemoryRouter\r\n * para simular a navegação.\r\n * @param authState - O estado mockado para o useAuth\r\n * @param initialEntry - A rota inicial que o usuário está tentando acessar\r\n */\r\nconst renderRoutes = (authState, initialEntry = '/protected') => {\r\n  // Define o valor de retorno do mock do useAuth\r\n  useAuth.mockReturnValue(authState);\r\n\r\n  return render(\r\n    <MemoryRouter initialEntries={[initialEntry]}>\r\n      <Routes>\r\n        {/* Rota pública */}\r\n        <Route path=\"/login\" element={<LoginComponent />} />\r\n\r\n        {/* Rota para Dashboard de Usuário */}\r\n        <Route path=\"/dashboard\" element={<UserDashboard />} />\r\n\r\n        {/* Rota para Dashboard de Parceiro */}\r\n        <Route path=\"/partner/dashboard\" element={<PartnerDashboard />} />\r\n\r\n        {/* --- Rotas Protegidas --- */}\r\n\r\n        {/* 1. Teste do <ProtectedRoute> com <Outlet /> */}\r\n        <Route element={<ProtectedRoute />}>\r\n          <Route\r\n            path=\"/protected-outlet\"\r\n            element={<TestChildComponent />}\r\n          />\r\n        </Route>\r\n\r\n        {/* 2. Teste do <ProtectedUserRoute> */}\r\n        <Route\r\n          path=\"/protected-user\"\r\n          element={\r\n            <ProtectedUserRoute>\r\n              <TestChildComponent />\r\n            </ProtectedUserRoute>\r\n          }\r\n        />\r\n\r\n        {/* 3. Teste do <ProtectedPartnerRoute> */}\r\n        <Route\r\n          path=\"/protected-partner\"\r\n          element={\r\n            <ProtectedPartnerRoute>\r\n              <TestChildComponent />\r\n            </ProtectedPartnerRoute>\r\n          }\r\n        />\r\n      </Routes>\r\n    </MemoryRouter>,\r\n  );\r\n};\r\n\r\n// --- Test Suites ---\r\n\r\ndescribe('ProtectedRoutes', () => {\r\n  beforeEach(() => {\r\n    // Limpa o mock antes de cada teste\r\n    useAuth.mockClear();\r\n  });\r\n\r\n  // --- Testes para <ProtectedRoute> ---\r\n  describe('ProtectedRoute', () => {\r\n    it('deve renderizar o loading spinner enquanto \"loading\" é true', () => {\r\n      const authState = { user: null, loading: true, profile: null };\r\n      renderRoutes(authState, '/protected-outlet');\r\n\r\n      // Verifica se o spinner (com role 'progressbar') está visível\r\n      expect(screen.getByRole('progressbar')).toBeInTheDocument();\r\n      // Verifica se o componente filho NÃO está visível\r\n      expect(screen.queryByText('Componente Filho Protegido')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('deve renderizar o loading spinner enquanto \"profile\" não está carregado (mesmo com user)', () => {\r\n      const authState = { user: { id: '123' }, loading: false, profile: null };\r\n      renderRoutes(authState, '/protected-outlet');\r\n\r\n      expect(screen.getByRole('progressbar')).toBeInTheDocument();\r\n    });\r\n\r\n    it('deve redirecionar para /login se não houver usuário e não estiver carregando', () => {\r\n      const authState = { user: null, loading: false, profile: null };\r\n      renderRoutes(authState, '/protected-outlet');\r\n\r\n      // Verifica se foi redirecionado para a página de login\r\n      expect(screen.getByText('Página de Login')).toBeInTheDocument();\r\n      // Verifica se o componente filho NÃO está visível\r\n      expect(screen.queryByText('Componente Filho Protegido')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('deve renderizar o componente filho (via Outlet) se o usuário estiver autenticado', () => {\r\n      const authState = { user: { id: '123' }, loading: false, profile: { id: 'p123' } };\r\n      renderRoutes(authState, '/protected-outlet');\r\n\r\n      // Verifica se o componente filho está visível\r\n      expect(screen.getByText('Componente Filho Protegido')).toBeInTheDocument();\r\n      // Verifica se a página de login NÃO está visível\r\n      expect(screen.queryByText('Página de Login')).not.toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  // --- Testes para <ProtectedUserRoute> ---\r\n  describe('ProtectedUserRoute', () => {\r\n    it('deve renderizar o filho se o usuário for comum (não-parceiro)', () => {\r\n      const authState = {\r\n        user: { id: '123' },\r\n        loading: false,\r\n        profile: { id: 'p123', profile_type: 'user', partner_id: null },\r\n      };\r\n      renderRoutes(authState, '/protected-user');\r\n\r\n      expect(screen.getByText('Componente Filho Protegido')).toBeInTheDocument();\r\n    });\r\n\r\n    it('deve redirecionar para /partner/dashboard se o usuário for parceiro', () => {\r\n      const authState = {\r\n        user: { id: '123' },\r\n        loading: false,\r\n        profile: { id: 'p123', profile_type: 'partner' },\r\n      };\r\n      renderRoutes(authState, '/protected-user');\r\n\r\n      // Verifica se foi redirecionado para o dashboard de parceiro\r\n      expect(screen.getByText('Dashboard do Parceiro')).toBeInTheDocument();\r\n      // Verifica se o componente filho NÃO está visível\r\n      expect(screen.queryByText('Componente Filho Protegido')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('deve redirecionar para /login se o usuário não estiver logado', () => {\r\n      const authState = { user: null, loading: false, profile: null };\r\n      renderRoutes(authState, '/protected-user');\r\n\r\n      // O <ProtectedRoute> interno deve redirecionar para /login\r\n      expect(screen.getByText('Página de Login')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  // --- Testes para <ProtectedPartnerRoute> ---\r\n  describe('ProtectedPartnerRoute', () => {\r\n    it('deve renderizar o filho se o usuário for parceiro', () => {\r\n      const authState = {\r\n        user: { id: '123' },\r\n        loading: false,\r\n        profile: { id: 'p123', profile_type: 'partner' },\r\n      };\r\n      renderRoutes(authState, '/protected-partner');\r\n\r\n      expect(screen.getByText('Componente Filho Protegido')).toBeInTheDocument();\r\n    });\r\n\r\n    it('deve redirecionar para /dashboard se o usuário NÃO for parceiro', () => {\r\n      const authState = {\r\n        user: { id: '123' },\r\n        loading: false,\r\n        profile: { id: 'p123', profile_type: 'user', partner_id: null },\r\n      };\r\n      renderRoutes(authState, '/protected-partner');\r\n\r\n      // Verifica se foi redirecionado para o dashboard de usuário\r\n      expect(screen.getByText('Dashboard do Usuário')).toBeInTheDocument();\r\n      // Verifica se o componente filho NÃO está visível\r\n      expect(screen.queryByText('Componente Filho Protegido')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('deve redirecionar para /login se o usuário não estiver logado', () => {\r\n      const authState = { user: null, loading: false, profile: null };\r\n      renderRoutes(authState, '/protected-partner');\r\n\r\n      // O <ProtectedRoute> interno deve redirecionar para /login\r\n      expect(screen.getByText('Página de Login')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n\r\n"],"version":3}