{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\WaitingListService.test.ts","mappings":";AAAA,0CAA0C;;;AAE1C,2CAAkF;AASlF,mBAAmB;AACnB,cAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,GAAG,EAAE,CAAC,CAAC;IACxC,QAAQ,EAAE;QACR,IAAI,EAAE,QAAQ;KACf;CACF,CAAC,CAAC,CAAC;AAEJ,2EAA2E;AAC3E,cAAI,CAAC,IAAI,CAAC,iCAAiC,EAAE,GAAG,EAAE;IAChD,OAAO;QACL,UAAU,EAAE,IAAI;QAChB,OAAO,EAAE;YACP,aAAa,EAAE,iBAAiB;SACjC;KACF,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,+BAA+B;AAC/B,cAAI,CAAC,IAAI,CAAC,kCAAkC,EAAE,GAAG,EAAE;IACjD,OAAO;QACL,UAAU,EAAE,IAAI;QAChB,OAAO,EAAE;YACP,YAAY,EAAE,gBAAgB;SAC/B;KACF,CAAC;AACJ,CAAC,CAAC,CAAC;AAhCH,kDAAkD;AAElD,MAAM,QAAQ,GAAG,cAAI,CAAC,EAAE,EAAE,CAAC;AAE3B,MAAM,iBAAiB,GAAG,cAAI,CAAC,EAAE,EAAE,CAAC;AACpC,MAAM,gBAAgB,GAAG,cAAI,CAAC,EAAE,EAAE,CAAC;AA6BnC,uCAAuC;AACvC,sFAAsD;AAEtD,4CAA4C;AAE5C,MAAM,eAAe,GAAG,CAAC,aAAkB,EAAE,EAAE,CAAC,CAAC;IAC/C,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;QAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;YAC5B,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;gBAC5B,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,aAAa,CAAC;aACnD,CAAC;SACH,CAAC;KACH,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,oBAAoB,GAAG,CAAC,aAAkB,EAAE,EAAE,CAAC,CAAC;IACpD,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;QAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;YAC5B,KAAK,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;gBAC/B,KAAK,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;oBAC/B,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,aAAa,CAAC;iBACnD,CAAC;aACH,CAAC;SACH,CAAC;KACH,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,eAAe,GAAG,CAAC,aAAkB,EAAE,EAAE,CAAC,CAAC;IAC/C,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;QAChC,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;YAChC,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,aAAa,CAAC;SACnD,CAAC;KACH,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,eAAe,GAAG,CAAC,aAAkB,EAAE,EAAE,CAAC,CAAC;IAC/C,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;QAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;YAC5B,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,aAAa,CAAC;SAC/C,CAAC;KACH,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,eAAe,GAAG,CAAC,aAAkB,EAAE,EAAE,CAAC,CAAC;IAC/C,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;QAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,aAAa,CAAC;KAC/C,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,mBAAmB,GAAG,CAAC,aAAkB,EAAE,EAAE,CAAC,CAAC;IACnD,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;QAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;YAC5B,KAAK,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,aAAa,CAAC;SAClD,CAAC;KACH,CAAC;CACH,CAAC,CAAC;AAEH,MAAM,sBAAsB,GAAG,CAAC,aAAkB,EAAE,EAAE,CAAC,CAAC;IACtD,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;QAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;YAC5B,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;gBAC5B,KAAK,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;oBAC/B,KAAK,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;wBAC/B,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,aAAa,CAAC;qBACnD,CAAC;iBACH,CAAC;aACH,CAAC;SACH,CAAC;KACH,CAAC;CACH,CAAC,CAAC;AAEH,oBAAoB;AAEpB,IAAA,kBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE;IAClC,IAAI,aAAkB,CAAC;IACvB,IAAI,iBAAsB,CAAC;IAC3B,IAAI,iBAAsB,CAAC;IAE3B,IAAA,oBAAU,EAAC,GAAG,EAAE;QACd,wBAAwB;QACxB,cAAI,CAAC,aAAa,EAAE,CAAC;QAErB,2BAA2B;QAC3B,QAAQ,CAAC,SAAS,EAAE,CAAC;QACrB,iBAAiB,CAAC,SAAS,EAAE,CAAC;QAC9B,gBAAgB,CAAC,SAAS,EAAE,CAAC;QAE7B,oCAAoC;QACpC,iBAAiB,CAAC,iBAAiB,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QACvD,gBAAgB,CAAC,iBAAiB,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC,CAAC;QAE5E,gBAAgB;QAChB,aAAa,GAAG,cAAI,CAAC,KAAK,CAAC,4BAAyB,EAAE,qBAAqB,CAAC;aACzE,iBAAiB,CAAC,SAAS,CAAC,CAAC;QAEhC,iBAAiB,GAAG,cAAI,CAAC,KAAK,CAAC,4BAAkB,EAAE,uBAAuB,CAAC;aACxE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAE3B,iBAAiB,GAAG,cAAI,CAAC,KAAK,CAAC,4BAAkB,EAAE,gBAAgB,CAAC;aACjE,iBAAiB,CAAC,EAAE,CAAC,CAAC;IAC3B,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAS,EAAC,GAAG,EAAE;QACb,aAAa,EAAE,WAAW,EAAE,CAAC;QAC7B,iBAAiB,EAAE,WAAW,EAAE,CAAC;QACjC,iBAAiB,EAAE,WAAW,EAAE,CAAC;IACnC,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,kBAAkB,EAAE,GAAG,EAAE;QAChC,MAAM,MAAM,GAAG,QAAQ,CAAC;QACxB,MAAM,OAAO,GAAG,OAAO,CAAC;QAExB,IAAA,YAAE,EAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;YAC1D,MAAM,aAAa,GAAG,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC;YACtC,MAAM,YAAY,GAAG,EAAE,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC;YAEzE,oDAAoD;YACpD,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,CAC7D,CAAC;YAEF,gCAAgC;YAChC,QAAQ,CAAC,mBAAmB,CAC1B,oBAAoB,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAC3D,CAAC;YAEF,iBAAiB;YACjB,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACrD,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;YAE1E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YACrC,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YACnD,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,oBAAoB,CAC5C,gBAAM,CAAC,gBAAgB,CAAC;gBACtB,cAAc,EAAE,MAAM;gBACtB,OAAO,EAAE,gBAAM,CAAC,gBAAgB,CAAC,WAAW,CAAC;aAC9C,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,8DAA8D,EAAE,KAAK,IAAI,EAAE;YAC5E,MAAM,iBAAiB,GAAG,EAAE,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC;YAE9E,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,iBAAiB,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAC1D,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;YAE1E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;YAC1C,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,wDAAwD,EAAE,KAAK,IAAI,EAAE;YACtE,MAAM,YAAY,GAAG,EAAE,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC;YAEzE,sBAAsB;YACtB,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,CAC7D,CAAC;YAEF,wBAAwB;YACxB,QAAQ,CAAC,mBAAmB,CAC1B,oBAAoB,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,CAClE,CAAC;YAEF,SAAS;YACT,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACrD,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;YAE1E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YACrC,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YACnD,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,oBAAoB,CAC5C,gBAAM,CAAC,gBAAgB,CAAC;gBACtB,OAAO,EAAE,gBAAM,CAAC,gBAAgB,CAAC,WAAW,CAAC;aAC9C,CAAC,CACH,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,8CAA8C,EAAE,KAAK,IAAI,EAAE;YAC5D,sBAAsB;YACtB,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,CAC7D,CAAC;YAEF,iBAAiB;YACjB,QAAQ,CAAC,mBAAmB,CAC1B,oBAAoB,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAC7D,CAAC;YAEF,kBAAkB;YAClB,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,OAAO,EAAE,eAAe,EAAE,EAAE,CAAC,CACrE,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;YAE1E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,CAAC;QAC5B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,uBAAuB,EAAE,GAAG,EAAE;QACrC,IAAA,YAAE,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE;YACnE,iBAAiB,CAAC,WAAW,EAAE,CAAC;YAEhC,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACjC,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,qBAAqB,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAEjF,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC1B,IAAA,gBAAM,EAAC,aAAa,CAAC,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QACtD,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;YACnD,iBAAiB,CAAC,WAAW,EAAE,CAAC;YAEhC,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,KAAK,EAAE,EAAE,OAAO,EAAE,gBAAgB,EAAE,EAAE,CAAC,CAC1D,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,qBAAqB,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAEjF,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,oBAAoB,EAAE,GAAG,EAAE;QAClC,IAAA,YAAE,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE;YACnE,MAAM,cAAc,GAAG;gBACrB,EAAE,EAAE,MAAM;gBACV,OAAO,EAAE,WAAW;gBACpB,QAAQ,EAAE,OAAO;gBACjB,QAAQ,EAAE,CAAC;aACZ,CAAC;YAEF,iBAAiB;YACjB,QAAQ,CAAC,mBAAmB,CAC1B,sBAAsB,CAAC,EAAE,IAAI,EAAE,cAAc,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAC9D,CAAC;YAEF,kBAAkB;YAClB,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACjC,CAAC;YAEF,MAAM,4BAAkB,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;YAErD,IAAA,gBAAM,EAAC,gBAAgB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAClD,IAAA,gBAAM,EAAC,gBAAgB,CAAC,CAAC,oBAAoB,CAC3C,OAAO,EACP,WAAW,EACX,gBAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CACnB,CAAC;YACF,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,oBAAoB,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;QACvE,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,6DAA6D,EAAE,KAAK,IAAI,EAAE;YAC3E,2DAA2D;YAC3D,gBAAgB,CAAC,qBAAqB,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,cAAc,EAAE,KAAK,EAAE,CAAC,CAAC;YAEjF,MAAM,cAAc,GAAG;gBACrB,EAAE,EAAE,MAAM;gBACV,OAAO,EAAE,WAAW;gBACpB,QAAQ,EAAE,OAAO;gBACjB,QAAQ,EAAE,CAAC;aACZ,CAAC;YAEF,QAAQ,CAAC,mBAAmB,CAC1B,sBAAsB,CAAC,EAAE,IAAI,EAAE,cAAc,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAC9D,CAAC;YAEF,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACjC,CAAC;YAEF,MAAM,4BAAkB,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;YAErD,IAAA,gBAAM,EAAC,gBAAgB,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;YAClD,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE;YAC1E,QAAQ,CAAC,mBAAmB,CAC1B,sBAAsB,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,CACpE,CAAC;YAEF,MAAM,4BAAkB,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;YAErD,IAAA,gBAAM,EAAC,gBAAgB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;YAChD,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,iDAAiD,EAAE,KAAK,IAAI,EAAE;YAC/D,gBAAgB,CAAC,qBAAqB,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,cAAc,EAAE,KAAK,EAAE,CAAC,CAAC;YAElF,MAAM,cAAc,GAAG;gBACrB,EAAE,EAAE,MAAM;gBACV,OAAO,EAAE,WAAW;gBACpB,QAAQ,EAAE,OAAO;gBACjB,QAAQ,EAAE,CAAC;aACZ,CAAC;YAEF,QAAQ,CAAC,mBAAmB,CAC1B,sBAAsB,CAAC,EAAE,IAAI,EAAE,cAAc,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAC9D,CAAC;YAEF,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACjC,CAAC;YAEF,MAAM,4BAAkB,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;YAErD,IAAA,gBAAM,EAAC,gBAAgB,CAAC,CAAC,gBAAgB,EAAE,CAAC;YAC5C,IAAA,gBAAM,EAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACnD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,+BAA+B,EAAE,GAAG,EAAE;QAC7C,IAAA,YAAE,EAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;YACrD,aAAa,CAAC,WAAW,EAAE,CAAC;YAC5B,iBAAiB,CAAC,WAAW,EAAE,CAAC;YAEhC,MAAM,QAAQ,GAAG;gBACf,EAAE,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,EAAE;gBAC9B,EAAE,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,EAAE;gBAC9B,EAAE,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,EAAE;aAC/B,CAAC;YAEF,iBAAiB;YACjB,QAAQ,CAAC,mBAAmB,CAC1B,mBAAmB,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACrD,CAAC;YAEF,iBAAiB;YACjB,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACjC,CAAC;YAEF,iBAAiB;YACjB,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACjC,CAAC;YAEF,MAAO,4BAA0B,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;YAE/D,uBAAuB;YACvB,IAAA,gBAAM,EAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE;YACpE,aAAa,CAAC,WAAW,EAAE,CAAC;YAC5B,iBAAiB,CAAC,WAAW,EAAE,CAAC;YAEhC,MAAM,QAAQ,GAAG;gBACf,EAAE,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,EAAE;gBAC9B,EAAE,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,EAAE;gBAC9B,EAAE,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,EAAE;aAC/B,CAAC;YAEF,QAAQ,CAAC,mBAAmB,CAC1B,mBAAmB,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACrD,CAAC;YAEF,MAAO,4BAA0B,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;YAE/D,4BAA4B;YAC5B,IAAA,gBAAM,EAAC,QAAQ,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,IAAA,YAAE,EAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;YAC1D,iBAAiB,CAAC,WAAW,EAAE,CAAC;YAEhC,MAAM,QAAQ,GAAG;gBACf,EAAE,EAAE,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE;gBACjE,EAAE,EAAE,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE;aAClE,CAAC;YAEF,QAAQ,CAAC,mBAAmB,CAC1B,mBAAmB,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACrD,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;YAEhE,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACnC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE;QAC/B,IAAA,YAAE,EAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;YAChE,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACvD,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,eAAe,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAE3E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,uDAAuD,EAAE,KAAK,IAAI,EAAE;YACrE,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,CAC7D,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,eAAe,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAE3E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,iBAAiB,EAAE,GAAG,EAAE;QAC/B,IAAA,YAAE,EAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;YAClD,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CACxD,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,eAAe,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAE3E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACzB,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE;YACpE,QAAQ,CAAC,mBAAmB,CAC1B,eAAe,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,CAAC,CAC7D,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,eAAe,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YAE3E,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,IAAA,YAAE,EAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;YAC1D,QAAQ,CAAC,mBAAmB,CAAC;gBAC3B,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;oBAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;iBAC3D,CAAC;aACH,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;YAErE,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACzB,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,QAAQ,CAAC,mBAAmB,CAAC;gBAC3B,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;oBAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE,CAAC;iBAC9E,CAAC;aACH,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;YAErE,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACzB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,kBAAkB,EAAE,GAAG,EAAE;QAChC,IAAA,YAAE,EAAC,oCAAoC,EAAE,KAAK,IAAI,EAAE;YAClD,QAAQ,CAAC,mBAAmB,CAAC;gBAC3B,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;oBAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;iBACjD,CAAC;aACH,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;YAElE,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;YACnD,QAAQ,CAAC,mBAAmB,CAAC;gBAC3B,MAAM,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,eAAe,CAAC;oBAChC,EAAE,EAAE,cAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,EAAE,KAAK,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE,CAAC;iBACjE,CAAC;aACH,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,4BAAkB,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;YAElE,IAAA,gBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\WaitingListService.test.ts"],"sourcesContent":["// src/services/WaitingListService.test.ts\r\n\r\nimport { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';\r\n\r\n// --- 1. CRIAR MOCKS ANTES DE QUALQUER IMPORT ---\r\n\r\nconst mockFrom = jest.fn();\r\n\r\nconst mockCreateForUser = jest.fn();\r\nconst mockApplyToEvent = jest.fn();\r\n\r\n// Mock do Supabase\r\njest.mock('../lib/supabaseClient', () => ({\r\n  supabase: {\r\n    from: mockFrom,\r\n  },\r\n}));\r\n\r\n// Mock do NotificationService - Note que estamos mockando o módulo inteiro\r\njest.mock('../services/NotificationService', () => {\r\n  return {\r\n    __esModule: true,\r\n    default: {\r\n      createForUser: mockCreateForUser,\r\n    },\r\n  };\r\n});\r\n\r\n// Mock do ParticipationService\r\njest.mock('../services/ParticipationService', () => {\r\n  return {\r\n    __esModule: true,\r\n    default: {\r\n      applyToEvent: mockApplyToEvent,\r\n    },\r\n  };\r\n});\r\n\r\n// Importar APÓS definir todos os mocks\r\nimport waitingListService from './WaitingListService';\r\n\r\n// --- 2. HELPERS PARA CRIAR CHAIN MOCKS ---\r\n\r\nconst mockSelectChain = (resolvedValue: any) => ({\r\n  select: jest.fn().mockReturnValue({\r\n    eq: jest.fn().mockReturnValue({\r\n      eq: jest.fn().mockReturnValue({\r\n        single: jest.fn().mockResolvedValue(resolvedValue),\r\n      }),\r\n    }),\r\n  }),\r\n});\r\n\r\nconst mockSelectOrderChain = (resolvedValue: any) => ({\r\n  select: jest.fn().mockReturnValue({\r\n    eq: jest.fn().mockReturnValue({\r\n      order: jest.fn().mockReturnValue({\r\n        limit: jest.fn().mockReturnValue({\r\n          single: jest.fn().mockResolvedValue(resolvedValue),\r\n        }),\r\n      }),\r\n    }),\r\n  }),\r\n});\r\n\r\nconst mockInsertChain = (resolvedValue: any) => ({\r\n  insert: jest.fn().mockReturnValue({\r\n    select: jest.fn().mockReturnValue({\r\n      single: jest.fn().mockResolvedValue(resolvedValue),\r\n    }),\r\n  }),\r\n});\r\n\r\nconst mockDeleteChain = (resolvedValue: any) => ({\r\n  delete: jest.fn().mockReturnValue({\r\n    eq: jest.fn().mockReturnValue({\r\n      eq: jest.fn().mockResolvedValue(resolvedValue),\r\n    }),\r\n  }),\r\n});\r\n\r\nconst mockUpdateChain = (resolvedValue: any) => ({\r\n  update: jest.fn().mockReturnValue({\r\n    eq: jest.fn().mockResolvedValue(resolvedValue),\r\n  }),\r\n});\r\n\r\nconst mockListSelectChain = (resolvedValue: any) => ({\r\n  select: jest.fn().mockReturnValue({\r\n    eq: jest.fn().mockReturnValue({\r\n      order: jest.fn().mockResolvedValue(resolvedValue),\r\n    }),\r\n  }),\r\n});\r\n\r\nconst mockComplexSelectChain = (resolvedValue: any) => ({\r\n  select: jest.fn().mockReturnValue({\r\n    eq: jest.fn().mockReturnValue({\r\n      eq: jest.fn().mockReturnValue({\r\n        order: jest.fn().mockReturnValue({\r\n          limit: jest.fn().mockReturnValue({\r\n            single: jest.fn().mockResolvedValue(resolvedValue),\r\n          }),\r\n        }),\r\n      }),\r\n    }),\r\n  }),\r\n});\r\n\r\n// --- 3. TESTES ---\r\n\r\ndescribe('WaitingListService', () => {\r\n  let spyReorganize: any;\r\n  let spyRemoveFromList: any;\r\n  let spyGetWaitingList: any;\r\n\r\n  beforeEach(() => {\r\n    // Limpar todos os mocks\r\n    jest.clearAllMocks();\r\n    \r\n    // Reset completo dos mocks\r\n    mockFrom.mockReset();\r\n    mockCreateForUser.mockReset();\r\n    mockApplyToEvent.mockReset();\r\n\r\n    // Reconfigurar comportamento padrão\r\n    mockCreateForUser.mockResolvedValue({ success: true });\r\n    mockApplyToEvent.mockResolvedValue({ success: true, isAutoApproved: true });\r\n\r\n    // Criar espiões\r\n    spyReorganize = jest.spyOn(waitingListService as any, 'reorganizePositions')\r\n      .mockResolvedValue(undefined);\r\n\r\n    spyRemoveFromList = jest.spyOn(waitingListService, 'removeFromWaitingList')\r\n      .mockResolvedValue(true);\r\n\r\n    spyGetWaitingList = jest.spyOn(waitingListService, 'getWaitingList')\r\n      .mockResolvedValue([]);\r\n  });\r\n\r\n  afterEach(() => {\r\n    spyReorganize?.mockRestore();\r\n    spyRemoveFromList?.mockRestore();\r\n    spyGetWaitingList?.mockRestore();\r\n  });\r\n\r\n  describe('addToWaitingList', () => {\r\n    const userId = 'user-1';\r\n    const eventId = 'evt-1';\r\n\r\n    it('deve adicionar um novo usuário e notificar', async () => {\r\n      const mockLastEntry = { position: 2 };\r\n      const mockNewEntry = { user_id: userId, event_id: eventId, position: 3 };\r\n\r\n      // Mock 1: SELECT verificar existente (não encontra)\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: null, error: { code: 'PGRST116' } })\r\n      );\r\n\r\n      // Mock 2: SELECT última posição\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectOrderChain({ data: mockLastEntry, error: null })\r\n      );\r\n\r\n      // Mock 3: INSERT\r\n      mockFrom.mockReturnValueOnce(\r\n        mockInsertChain({ data: mockNewEntry, error: null })\r\n      );\r\n\r\n      const result = await waitingListService.addToWaitingList(userId, eventId);\r\n\r\n      expect(result).toEqual(mockNewEntry);\r\n      expect(mockCreateForUser).toHaveBeenCalledTimes(1);\r\n      expect(mockCreateForUser).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          target_user_id: userId,\r\n          message: expect.stringContaining('posição 3'),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('deve retornar o usuário existente se ele já estiver na lista', async () => {\r\n      const mockExistingEntry = { user_id: userId, event_id: eventId, position: 1 };\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: mockExistingEntry, error: null })\r\n      );\r\n\r\n      const result = await waitingListService.addToWaitingList(userId, eventId);\r\n\r\n      expect(result).toEqual(mockExistingEntry);\r\n      expect(mockCreateForUser).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('deve criar posição 1 quando não há entradas anteriores', async () => {\r\n      const mockNewEntry = { user_id: userId, event_id: eventId, position: 1 };\r\n\r\n      // Não existe na lista\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: null, error: { code: 'PGRST116' } })\r\n      );\r\n\r\n      // Não há última posição\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectOrderChain({ data: null, error: { code: 'PGRST116' } })\r\n      );\r\n\r\n      // INSERT\r\n      mockFrom.mockReturnValueOnce(\r\n        mockInsertChain({ data: mockNewEntry, error: null })\r\n      );\r\n\r\n      const result = await waitingListService.addToWaitingList(userId, eventId);\r\n\r\n      expect(result).toEqual(mockNewEntry);\r\n      expect(mockCreateForUser).toHaveBeenCalledTimes(1);\r\n      expect(mockCreateForUser).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          message: expect.stringContaining('posição 1'),\r\n        })\r\n      );\r\n    });\r\n\r\n    it('deve retornar null em caso de erro no insert', async () => {\r\n      // Não existe na lista\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: null, error: { code: 'PGRST116' } })\r\n      );\r\n\r\n      // Última posição\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectOrderChain({ data: { position: 1 }, error: null })\r\n      );\r\n\r\n      // INSERT com erro\r\n      mockFrom.mockReturnValueOnce(\r\n        mockInsertChain({ data: null, error: { message: 'Insert failed' } })\r\n      );\r\n\r\n      const result = await waitingListService.addToWaitingList(userId, eventId);\r\n\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('removeFromWaitingList', () => {\r\n    it('deve deletar o usuário e chamar reorganizePositions', async () => {\r\n      spyRemoveFromList.mockRestore();\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockDeleteChain({ error: null })\r\n      );\r\n\r\n      const result = await waitingListService.removeFromWaitingList('user-1', 'evt-1');\r\n\r\n      expect(result).toBe(true);\r\n      expect(spyReorganize).toHaveBeenCalledWith('evt-1');\r\n    });\r\n\r\n    it('deve retornar false em caso de erro', async () => {\r\n      spyRemoveFromList.mockRestore();\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockDeleteChain({ error: { message: 'Database error' } })\r\n      );\r\n\r\n      const result = await waitingListService.removeFromWaitingList('user-1', 'evt-1');\r\n\r\n      expect(result).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('processWaitingList', () => {\r\n    it('deve notificar, aplicar e remover o próximo da fila', async () => {\r\n      const mockNextInLine = {\r\n        id: 'wl-1',\r\n        user_id: 'user-next',\r\n        event_id: 'evt-1',\r\n        position: 1,\r\n      };\r\n\r\n      // SELECT próximo\r\n      mockFrom.mockReturnValueOnce(\r\n        mockComplexSelectChain({ data: mockNextInLine, error: null })\r\n      );\r\n\r\n      // UPDATE notified\r\n      mockFrom.mockReturnValueOnce(\r\n        mockUpdateChain({ error: null })\r\n      );\r\n\r\n      await waitingListService.processWaitingList('evt-1');\r\n\r\n      expect(mockApplyToEvent).toHaveBeenCalledTimes(1);\r\n      expect(mockApplyToEvent).toHaveBeenCalledWith(\r\n        'evt-1',\r\n        'user-next',\r\n        expect.any(String)\r\n      );\r\n      expect(spyRemoveFromList).toHaveBeenCalledWith('user-next', 'evt-1');\r\n    });\r\n\r\n    it('NÃO deve remover da lista se a aprovação não for automática', async () => {\r\n      // Alterar comportamento do mock para este teste específico\r\n      mockApplyToEvent.mockResolvedValueOnce({ success: true, isAutoApproved: false });\r\n\r\n      const mockNextInLine = {\r\n        id: 'wl-1',\r\n        user_id: 'user-next',\r\n        event_id: 'evt-1',\r\n        position: 1,\r\n      };\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockComplexSelectChain({ data: mockNextInLine, error: null })\r\n      );\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockUpdateChain({ error: null })\r\n      );\r\n\r\n      await waitingListService.processWaitingList('evt-1');\r\n\r\n      expect(mockApplyToEvent).toHaveBeenCalledTimes(1);\r\n      expect(spyRemoveFromList).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('deve retornar sem fazer nada se não houver ninguém na fila', async () => {\r\n      mockFrom.mockReturnValueOnce(\r\n        mockComplexSelectChain({ data: null, error: { code: 'PGRST116' } })\r\n      );\r\n\r\n      await waitingListService.processWaitingList('evt-1');\r\n\r\n      expect(mockApplyToEvent).not.toHaveBeenCalled();\r\n      expect(spyRemoveFromList).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('NÃO deve remover da lista se a aplicação falhar', async () => {\r\n      mockApplyToEvent.mockResolvedValueOnce({ success: false, isAutoApproved: false });\r\n\r\n      const mockNextInLine = {\r\n        id: 'wl-1',\r\n        user_id: 'user-next',\r\n        event_id: 'evt-1',\r\n        position: 1,\r\n      };\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockComplexSelectChain({ data: mockNextInLine, error: null })\r\n      );\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockUpdateChain({ error: null })\r\n      );\r\n\r\n      await waitingListService.processWaitingList('evt-1');\r\n\r\n      expect(mockApplyToEvent).toHaveBeenCalled();\r\n      expect(spyRemoveFromList).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('reorganizePositions (private)', () => {\r\n    it('deve atualizar posições fora de ordem', async () => {\r\n      spyReorganize.mockRestore();\r\n      spyGetWaitingList.mockRestore();\r\n\r\n      const mockList = [\r\n        { id: 'entry-A', position: 1 },\r\n        { id: 'entry-B', position: 3 },\r\n        { id: 'entry-C', position: 4 },\r\n      ];\r\n\r\n      // getWaitingList\r\n      mockFrom.mockReturnValueOnce(\r\n        mockListSelectChain({ data: mockList, error: null })\r\n      );\r\n\r\n      // UPDATE entry-B\r\n      mockFrom.mockReturnValueOnce(\r\n        mockUpdateChain({ error: null })\r\n      );\r\n\r\n      // UPDATE entry-C\r\n      mockFrom.mockReturnValueOnce(\r\n        mockUpdateChain({ error: null })\r\n      );\r\n\r\n      await (waitingListService as any).reorganizePositions('evt-1');\r\n\r\n      // 1 select + 2 updates\r\n      expect(mockFrom).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    it('não deve atualizar se as posições estiverem corretas', async () => {\r\n      spyReorganize.mockRestore();\r\n      spyGetWaitingList.mockRestore();\r\n\r\n      const mockList = [\r\n        { id: 'entry-A', position: 1 },\r\n        { id: 'entry-B', position: 2 },\r\n        { id: 'entry-C', position: 3 },\r\n      ];\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockListSelectChain({ data: mockList, error: null })\r\n      );\r\n\r\n      await (waitingListService as any).reorganizePositions('evt-1');\r\n\r\n      // Apenas 1 chamada (select)\r\n      expect(mockFrom).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('getWaitingList', () => {\r\n    it('deve retornar a lista ordenada por posição', async () => {\r\n      spyGetWaitingList.mockRestore();\r\n\r\n      const mockList = [\r\n        { id: 'wl-1', user_id: 'user-1', event_id: 'evt-1', position: 1 },\r\n        { id: 'wl-2', user_id: 'user-2', event_id: 'evt-1', position: 2 },\r\n      ];\r\n\r\n      mockFrom.mockReturnValueOnce(\r\n        mockListSelectChain({ data: mockList, error: null })\r\n      );\r\n\r\n      const result = await waitingListService.getWaitingList('evt-1');\r\n\r\n      expect(result).toEqual(mockList);\r\n    });\r\n  });\r\n\r\n  describe('isInWaitingList', () => {\r\n    it('deve retornar true se o usuário estiver na lista', async () => {\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: { id: 'wl-1' }, error: null })\r\n      );\r\n\r\n      const result = await waitingListService.isInWaitingList('user-1', 'evt-1');\r\n\r\n      expect(result).toBe(true);\r\n    });\r\n\r\n    it('deve retornar false se o usuário não estiver na lista', async () => {\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: null, error: { code: 'PGRST116' } })\r\n      );\r\n\r\n      const result = await waitingListService.isInWaitingList('user-1', 'evt-1');\r\n\r\n      expect(result).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('getUserPosition', () => {\r\n    it('deve retornar a posição do usuário', async () => {\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: { position: 3 }, error: null })\r\n      );\r\n\r\n      const result = await waitingListService.getUserPosition('user-1', 'evt-1');\r\n\r\n      expect(result).toBe(3);\r\n    });\r\n\r\n    it('deve retornar null se o usuário não estiver na lista', async () => {\r\n      mockFrom.mockReturnValueOnce(\r\n        mockSelectChain({ data: null, error: { code: 'PGRST116' } })\r\n      );\r\n\r\n      const result = await waitingListService.getUserPosition('user-1', 'evt-1');\r\n\r\n      expect(result).toBe(null);\r\n    });\r\n  });\r\n\r\n  describe('getWaitingListCount', () => {\r\n    it('deve retornar o número de pessoas na lista', async () => {\r\n      mockFrom.mockReturnValueOnce({\r\n        select: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockResolvedValue({ count: 5, error: null }),\r\n        }),\r\n      });\r\n\r\n      const result = await waitingListService.getWaitingListCount('evt-1');\r\n\r\n      expect(result).toBe(5);\r\n    });\r\n\r\n    it('deve retornar 0 se houver erro', async () => {\r\n      mockFrom.mockReturnValueOnce({\r\n        select: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockResolvedValue({ count: null, error: { message: 'Error' } }),\r\n        }),\r\n      });\r\n\r\n      const result = await waitingListService.getWaitingListCount('evt-1');\r\n\r\n      expect(result).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('clearWaitingList', () => {\r\n    it('deve limpar toda a lista de espera', async () => {\r\n      mockFrom.mockReturnValueOnce({\r\n        delete: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockResolvedValue({ error: null }),\r\n        }),\r\n      });\r\n\r\n      const result = await waitingListService.clearWaitingList('evt-1');\r\n\r\n      expect(result).toBe(true);\r\n    });\r\n\r\n    it('deve retornar false em caso de erro', async () => {\r\n      mockFrom.mockReturnValueOnce({\r\n        delete: jest.fn().mockReturnValue({\r\n          eq: jest.fn().mockResolvedValue({ error: { message: 'Error' } }),\r\n        }),\r\n      });\r\n\r\n      const result = await waitingListService.clearWaitingList('evt-1');\r\n\r\n      expect(result).toBe(false);\r\n    });\r\n  });\r\n});"],"version":3}