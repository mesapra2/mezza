{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\features\\shared\\components\\events\\EventRating.jsx","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\features\\shared\\components\\events\\EventRating.jsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Star, Check, Clock } from 'lucide-react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useToast } from '@/features/shared/components/ui/use-toast';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport RatingService from '@/services/RatingService';\r\nimport RatingModal from './RatingModal';\r\n\r\n// 1. CORREÇÃO: 'hostName' removido, pois não estava sendo usado.\r\nconst EventRating = ({ eventId, hostId, onAllRatingsComplete }) => {\r\n  const { user } = useAuth();\r\n  // 2. CORREÇÃO: 'toast' agora será usado nos blocos 'catch'.\r\n  const { toast } = useToast();\r\n\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [hostData, setHostData] = useState(null);\r\n  const [participants, setParticipants] = useState([]);\r\n  const [ratedStatus, setRatedStatus] = useState({});\r\n  const [selectedRatingModal, setSelectedRatingModal] = useState(null);\r\n\r\n  const loadRatingData = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n\r\n      const { data: host, error: hostError } = await supabase\r\n        .from('profiles')\r\n        .select('id, username, avatar_url, reputation_stars')\r\n        .eq('id', hostId)\r\n        .single();\r\n\r\n      if (hostError) throw hostError;\r\n      setHostData(host);\r\n\r\n      const { data: eventParticipants, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select(`\r\n          id,\r\n          participant_id,\r\n          status,\r\n          presenca_confirmada,\r\n          participant:profiles(id, username, avatar_url, reputation_stars)\r\n        `)\r\n        .eq('event_id', eventId)\r\n        .eq('presenca_confirmada', true)\r\n        .not('participant_id', 'eq', user.id);\r\n\r\n      if (partError) throw partError;\r\n\r\n      const validParticipants = (eventParticipants || []).filter(\r\n        p => p.participant && p.participant_id !== hostId\r\n      );\r\n\r\n      setParticipants(validParticipants);\r\n\r\n      // 3. CORREÇÃO (IMPORTANTE): Removemos a chamada do loadRatingStatus daqui\r\n      // para quebrar o loop infinito de dependência.\r\n      // await loadRatingStatus(); \r\n    } catch (err) {\r\n      console.error('Erro ao carregar dados de avaliação:', err);\r\n      setError('Erro ao carregar dados. Tente novamente.');\r\n      // 2. CORREÇÃO: Usando o 'toast' no erro.\r\n      toast({\r\n        title: 'Erro ao carregar dados',\r\n        description: 'Não foi possível buscar os participantes para avaliação.',\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  // 4. CORREÇÃO: Adicionado 'toast' às dependências. 'loadRatingStatus' foi removido.\r\n  }, [eventId, hostId, user.id, toast]);\r\n\r\n  const loadRatingStatus = useCallback(async () => {\r\n    try {\r\n      const status = {};\r\n\r\n      if (hostData) {\r\n        const hasHostRating = await RatingService.hasUserRated(\r\n          eventId,\r\n          user.id,\r\n          hostId,\r\n          'host'\r\n        );\r\n        status[`host-${hostId}`] = hasHostRating;\r\n      }\r\n\r\n      for (const p of participants) {\r\n        const hasParticipantRating = await RatingService.hasUserRated(\r\n          eventId,\r\n          user.id,\r\n          p.participant_id,\r\n          'participant'\r\n        );\r\n        status[`participant-${p.participant_id}`] = hasParticipantRating;\r\n      }\r\n\r\n      setRatedStatus(status);\r\n    } catch (error) {\r\n      console.error('Erro ao carregar status de avaliações:', error);\r\n      // 2. CORREÇÃO: Usando o 'toast' no erro.\r\n      toast({\r\n        title: 'Erro ao verificar status',\r\n        description: 'Não foi possível verificar suas avaliações pendentes.',\r\n        variant: 'destructive',\r\n      });\r\n    }\r\n  // 5. CORREÇÃO: Adicionado 'toast' às dependências.\r\n  }, [eventId, hostData, hostId, participants, user.id, toast]);\r\n\r\n  // useEffect 1: Busca os dados principais (participantes e host)\r\n  useEffect(() => {\r\n    if (eventId && user) {\r\n      loadRatingData();\r\n    }\r\n  }, [eventId, user, loadRatingData]);\r\n\r\n  // 6. CORREÇÃO (IMPORTANTE): Novo useEffect para carregar o STATUS das avaliações.\r\n  // Ele só roda DEPOIS que 'hostData' ou 'participants' forem carregados,\r\n  // quebrando o ciclo de dependência.\r\n  useEffect(() => {\r\n    if (hostData || participants.length > 0) {\r\n      loadRatingStatus();\r\n    }\r\n  }, [hostData, participants, loadRatingStatus]);\r\n\r\n\r\n  const handleRatingClick = (targetUser, ratingType) => {\r\n    setSelectedRatingModal({\r\n      targetUser,\r\n      ratingType,\r\n      ratedId: targetUser.id,\r\n      ratedName: targetUser.username\r\n    });\r\n  };\r\n\r\n  const handleRatingSubmit = async () => {\r\n    // Recarrega o status após uma avaliação ser submetida\r\n    await loadRatingStatus();\r\n\r\n    // NOTA: É preciso checar o 'ratedStatus' atualizado.\r\n    // O 'loadRatingStatus' atualiza o estado, mas o 'ratedStatus'\r\n    // nesta função ainda será o antigo. Precisamos de uma lógica\r\n    // um pouco diferente para verificar 'allRated'\r\n    \r\n    // Vamos re-checar o status aqui\r\n    const status = {};\r\n    if (hostData) {\r\n      const hasHostRating = await RatingService.hasUserRated(eventId, user.id, hostId, 'host');\r\n      status[`host-${hostId}`] = hasHostRating;\r\n    }\r\n    for (const p of participants) {\r\n      const hasParticipantRating = await RatingService.hasUserRated(eventId, user.id, p.participant_id, 'participant');\r\n      status[`participant-${p.participant_id}`] = hasParticipantRating;\r\n    }\r\n    setRatedStatus(status); // Atualiza o estado para a UI\r\n\r\n    // Verifica com o status recém-buscado\r\n    const allRated = participants.every(p =>\r\n      status[`participant-${p.participant_id}`]\r\n    ) && status[`host-${hostId}`];\r\n\r\n    if (allRated && onAllRatingsComplete) {\r\n      onAllRatingsComplete();\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-white/60 text-center py-8\">Carregando avaliações...</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"bg-red-500/10 border border-red-500/20 rounded-2xl p-6 text-center\">\r\n        <p className=\"text-red-200\">{error}</p>\r\n        <button\r\n          onClick={() => loadRatingData()}\r\n          className=\"mt-4 px-4 py-2 bg-red-600/50 hover:bg-red-600 text-white rounded-lg transition-colors\"\r\n        >\r\n          Tentar Novamente\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const hostRated = ratedStatus[`host-${hostId}`];\r\n  const participantsRated = participants.filter(p =>\r\n    ratedStatus[`participant-${p.participant_id}`]\r\n  );\r\n  const allRated = hostRated && participantsRated.length === participants.length;\r\n  \r\n  // Evita divisão por zero se não houver participantes + host\r\n  const totalToRate = participants.length + (hostData ? 1 : 0);\r\n  const totalRated = participantsRated.length + (hostRated ? 1 : 0);\r\n  const percentage = totalToRate > 0 ? (totalRated / totalToRate) * 100 : 100;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"glass-effect rounded-2xl p-6 border border-white/10\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-xl font-bold text-white\">Avaliações do Evento</h2>\r\n          {totalToRate > 0 && (\r\n            <span className=\"text-sm font-semibold px-3 py-1 rounded-full bg-purple-600/30 text-purple-200 border border-purple-500/30\">\r\n              {totalRated} / {totalToRate}\r\n            </span>\r\n          )}\r\n        </div>\r\n\r\n        {totalToRate > 0 && (\r\n          <div className=\"w-full bg-white/10 rounded-full h-2 overflow-hidden\">\r\n            <div\r\n              className=\"bg-gradient-to-r from-yellow-400 to-yellow-600 h-full transition-all duration-500\"\r\n              style={{\r\n                width: `${percentage}%`\r\n              }}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {allRated && totalToRate > 0 && (\r\n          <div className=\"mt-4 bg-green-500/10 border border-green-500/20 rounded-lg p-3\">\r\n            <p className=\"text-sm text-green-200 flex items-center gap-2\">\r\n              <Check size={16} className=\"text-green-400\" />\r\n              Você completou todas as avaliações!\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {hostData && (\r\n        <div className=\"glass-effect rounded-2xl p-6 border border-white/10 hover:border-white/20 transition-all\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4 flex-1\">\r\n              <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 p-1 flex-shrink-0\">\r\n                {hostData.avatar_url ? (\r\n                  <img\r\n                    src={hostData.avatar_url}\r\n                    alt={hostData.username}\r\n                    className=\"w-full h-full rounded-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  <div className=\"w-full h-full rounded-full bg-white/10 flex items-center justify-center text-white font-semibold\">\r\n                    {hostData.username?.[0]?.toUpperCase()}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"flex-1\">\r\n                <h3 className=\"text-lg font-bold text-white\">{hostData.username}</h3>\r\n                <p className=\"text-sm text-white/60\">Anfitrião do evento</p>\r\n                <div className=\"flex items-center gap-2 mt-2\">\r\n                  <div className=\"flex gap-1\">\r\n                    {[...Array(5)].map((_, i) => (\r\n                      <Star\r\n                        key={i}\r\n                        size={16}\r\n                        className={\r\n                          i < Math.floor(hostData.reputation_stars || 0)\r\n                            ? 'fill-yellow-400 text-yellow-400'\r\n                            : 'text-white/20'\r\n                        }\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                  <span className=\"text-sm text-white/60\">\r\n                    {hostData.reputation_stars || '0'} estrelas\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex flex-col items-end gap-2\">\r\n              {hostRated ? (\r\n                <div className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-green-500/10 border border-green-500/20\">\r\n                  <Check size={18} className=\"text-green-400\" />\r\n                  <span className=\"text-sm font-semibold text-green-200\">Avaliado</span>\r\n                </div>\r\n              ) : (\r\n                <button\r\n                  onClick={() => handleRatingClick(hostData, 'host')}\r\n                  className=\"px-4 py-2 rounded-lg bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-semibold transition-all hover:shadow-lg active:scale-95\"\r\n                >\r\n                  Avaliar\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {participants.length > 0 && (\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"flex-1 h-px bg-white/10\" />\r\n          <span className=\"text-xs font-semibold text-white/50 px-2\">PARTICIPANTES</span>\r\n          <div className=\"flex-1 h-px bg-white/10\" />\r\n        </div>\r\n      )}\r\n\r\n      {participants.length > 0 ? (\r\n        <div className=\"space-y-3\">\r\n          {participants.map((participation) => {\r\n            const participant = participation.participant;\r\n            const isRated = ratedStatus[`participant-${participant.id}`];\r\n\r\n            return (\r\n              <div\r\n                key={participant.id}\r\n                className=\"glass-effect rounded-2xl p-4 border border-white/10 hover:border-white/20 transition-all\"\r\n              >\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3 flex-1\">\r\n                    <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-cyan-400 p-1 flex-shrink-0\">\r\n                      {participant.avatar_url ? (\r\n                        <img\r\n                          src={participant.avatar_url}\r\n                          alt={participant.username}\r\n                          className=\"w-full h-full rounded-full object-cover\"\r\n                        />\r\n                      ) : (\r\n                        <div className=\"w-full h-full rounded-full bg-white/10 flex items-center justify-center text-white font-semibold text-sm\">\r\n                          {participant.username?.[0]?.toUpperCase()}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <h4 className=\"font-semibold text-white truncate\">{participant.username}</h4>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"flex gap-0.5\">\r\n                          {[...Array(5)].map((_, i) => (\r\n                            <Star\r\n                              key={i}\r\n                              size={12}\r\n                              className={\r\n                                i < Math.floor(participant.reputation_stars || 0)\r\n                                  ? 'fill-yellow-400 text-yellow-400'\r\n                                  : 'text-white/20'\r\n                              }\r\n                            />\r\n                          ))}\r\n                        </div>\r\n                        <span className=\"text-xs text-white/60\">\r\n                          {participant.reputation_stars || '0'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {isRated ? (\r\n                    <div className=\"flex items-center gap-1.5 px-2 py-1 rounded-lg bg-green-500/10 border border-green-500/20 flex-shrink-0\">\r\n                      <Check size={14} className=\"text-green-400\" />\r\n                      <span className=\"text-xs font-semibold text-green-200\">Avaliado</span>\r\n                    </div>\r\n                  ) : (\r\n                    <button\r\n                      onClick={() => handleRatingClick(participant, 'participant')}\r\n                      className=\"px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 text-white font-semibold text-sm transition-colors flex-shrink-0\"\r\n                    >\r\n                      Avaliar\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-8 text-white/60\">\r\n          <Clock size={32} className=\"mx-auto mb-3 opacity-50\" />\r\n          <p>Nenhum outro participante confirmou presença</p>\r\n        </div>\r\n      )}\r\n\r\n      {selectedRatingModal && (\r\n        <RatingModal\r\n          isOpen={true}\r\n          onClose={() => setSelectedRatingModal(null)}\r\n          eventId={eventId}\r\n          raterId={user.id}\r\n          ratedId={selectedRatingModal.ratedId}\r\n          ratedName={selectedRatingModal.ratedName}\r\n          ratingType={selectedRatingModal.ratingType}\r\n          onRatingSubmit={handleRatingSubmit}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// 7. CORREÇÃO: Removido 'hostName' dos propTypes.\r\nEventRating.propTypes = {\r\n  eventId: PropTypes.number.isRequired,\r\n  hostId: PropTypes.string.isRequired,\r\n  onAllRatingsComplete: PropTypes.func\r\n};\r\n\r\nexport default EventRating;"],"version":3}