bc26d35f59fbd9ba2e7213a173dfd6c0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthProvider = exports.useAuth = void 0;
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
// src/contexts/AuthContext.jsx
const react_1 = require("react");
const prop_types_1 = tslib_1.__importDefault(require("prop-types"));
const use_toast_js_1 = require("@/features/shared/components/ui/use-toast.js");
const supabaseClient_1 = require("@/lib/supabaseClient");
const react_router_dom_1 = require("react-router-dom");
const userTypes_1 = require("@/config/userTypes");
const AuthContext = (0, react_1.createContext)(null);
const useAuth = () => {
    const context = (0, react_1.useContext)(AuthContext);
    if (!context) {
        throw new Error('useAuth deve ser usado dentro de um AuthProvider');
    }
    return context;
};
exports.useAuth = useAuth;
// ðŸŽ¯ FunÃ§Ã£o helper para mensagens de erro amigÃ¡veis
const getErrorMessage = (error) => {
    if (error.message === 'Email not confirmed') {
        return 'Por favor, confirme seu email antes de fazer login. Verifique sua caixa de entrada e spam.';
    }
    if (error.message === 'Invalid login credentials') {
        return 'Email ou senha incorretos.';
    }
    if (error.message.includes('User already registered')) {
        return 'Este email jÃ¡ estÃ¡ cadastrado. FaÃ§a login ou recupere sua senha.';
    }
    return error.message;
};
const AuthProvider = ({ children }) => {
    const [user, setUser] = (0, react_1.useState)(null);
    const [loading, setLoading] = (0, react_1.useState)(true);
    const [profile, setProfile] = (0, react_1.useState)(null);
    const { toast } = (0, use_toast_js_1.useToast)();
    const navigate = (0, react_router_dom_1.useNavigate)();
    // FunÃ§Ã£o para buscar o perfil
    const getProfile = (0, react_1.useCallback)(async (currentUser) => {
        if (!currentUser)
            return null;
        console.log(`ðŸ“„ [getProfile] Buscando perfil para ${currentUser.id}`);
        try {
            const { data: profileData, error } = await supabaseClient_1.supabase
                .from('profiles')
                .select(`
          id, username, bio, avatar_url, photos, hashtags_interesse,
          is_premium, profile_type, partner_id,
          theme, profile_visibility, notification_prefs,
          phone, phone_verified
        `)
                .eq('id', currentUser.id)
                .maybeSingle();
            if (error && error.code !== 'PGRST116')
                throw error;
            if (!profileData)
                return null;
            profileData.theme = profileData.theme || 'system';
            profileData.profile_visibility = profileData.profile_visibility || 'public';
            profileData.notification_prefs = profileData.notification_prefs || { emailEventUpdates: true, pushNewMessages: true };
            // âœ… SE FOR PARCEIRO, BUSCAR DADOS DO PARTNER
            if (profileData.profile_type === userTypes_1.PROFILE_TYPES.PARTNER && profileData.partner_id) {
                console.log(`ðŸ¢ Buscando dados do partner: ${profileData.partner_id}`);
                const { data: partnerData, error: partnerError } = await supabaseClient_1.supabase
                    .from('partners')
                    .select('id, name, email, plan, is_premium, capacity')
                    .eq('id', profileData.partner_id)
                    .single();
                if (!partnerError && partnerData) {
                    console.log('âœ… Dados do partner:', partnerData);
                    profileData.partner_data = partnerData;
                    profileData.isPremiumPartner = partnerData.is_premium === true;
                    console.log('ðŸ” Status Premium:', {
                        partnerId: partnerData.id,
                        partnerName: partnerData.name,
                        plan: partnerData.plan,
                        isPremium: partnerData.is_premium,
                        isPremiumPartner: profileData.isPremiumPartner,
                    });
                }
                else if (partnerError) {
                    console.error(`âŒ Erro ao buscar dados do parceiro ${profileData.partner_id}:`, partnerError);
                }
            }
            const enrichedProfile = {
                ...profileData,
                isPartner: profileData.profile_type === userTypes_1.PROFILE_TYPES.PARTNER || profileData.partner_id != null,
                isPremium: profileData.is_premium || false,
                userType: (0, userTypes_1.getUserType)(profileData)
            };
            console.log('âœ… Perfil carregado:', enrichedProfile.username, '| Phone:', enrichedProfile.phone || 'sem telefone');
            return enrichedProfile;
        }
        catch (error) {
            console.error('âŒ Erro em getProfile:', error);
            toast({ variant: "destructive", title: "Erro ao buscar perfil", description: error.message });
            return null;
        }
    }, [toast]);
    // FunÃ§Ã£o para criar o perfil se nÃ£o existir
    const createProfileIfNotExists = (0, react_1.useCallback)(async (currentUser) => {
        if (!currentUser)
            return null;
        console.log(`[createProfile] Verificando/Criando perfil para ${currentUser.id}`);
        try {
            let profileData = await getProfile(currentUser);
            if (!profileData) {
                console.log(`â„¹ï¸ [createProfile] Perfil nÃ£o existe para ${currentUser.id}. Criando...`);
                const profileType = currentUser.user_metadata?.profile_type || userTypes_1.PROFILE_TYPES.USER;
                const newProfileData = {
                    id: currentUser.id,
                    username: currentUser.user_metadata?.full_name || currentUser.email?.split('@')[0] || `user_${currentUser.id.substring(0, 5)}`,
                    updated_at: new Date().toISOString(),
                    theme: 'system',
                    profile_visibility: 'public',
                    notification_prefs: { emailEventUpdates: true, pushNewMessages: true },
                    profile_type: profileType,
                };
                const { error: insertError } = await supabaseClient_1.supabase.from('profiles').insert(newProfileData);
                if (insertError)
                    throw insertError;
                console.log(`âœ… [createProfile] Perfil criado para ${currentUser.id}`);
                toast({ title: "Perfil criado!", description: "Bem-vindo!" });
                profileData = await getProfile(currentUser);
            }
            else {
                console.log(`âœ… [createProfile] Perfil jÃ¡ existe para ${currentUser.id}`);
            }
            return profileData;
        }
        catch (error) {
            console.error('âŒ Erro em createProfileIfNotExists:', error);
            toast({ variant: "destructive", title: "Erro ao criar/verificar perfil", description: error.message });
            return null;
        }
    }, [getProfile, toast]);
    // Efeito principal para auth state change e inicializaÃ§Ã£o
    (0, react_1.useEffect)(() => {
        let mounted = true;
        console.log('[Auth Effect Init] Montando e buscando sessÃ£o inicial...');
        setLoading(true);
        const initializeAuth = async () => {
            try {
                const { data: { session }, error: sessionError } = await supabaseClient_1.supabase.auth.getSession();
                if (sessionError)
                    throw sessionError;
                if (!mounted)
                    return;
                console.log('[Auth Effect Init] SessÃ£o inicial:', session ? `User ${session.user.id}` : 'Nenhuma');
                const initialUser = session?.user ?? null;
                setUser(initialUser);
                if (initialUser) {
                    const initialProfile = await createProfileIfNotExists(initialUser);
                    if (mounted) {
                        setProfile(initialProfile);
                        const currentPath = window.location.pathname;
                        // âœ… NÃƒO redireciona se estiver em /verify-phone ou se for usuÃ¡rio antigo sem telefone
                        if (initialProfile && ['/', '/login', '/register'].includes(currentPath)) {
                            const targetRoute = initialProfile.isPartner ? '/partner/dashboard' : '/dashboard';
                            console.log(`[Auth Effect Init] Navegando para rota inicial: ${targetRoute}`);
                            navigate(targetRoute, { replace: true });
                        }
                    }
                }
                else if (mounted) {
                    setProfile(null);
                }
            }
            catch (err) {
                console.error('âŒ Erro na inicializaÃ§Ã£o do Auth:', err);
                if (mounted) {
                    setUser(null);
                    setProfile(null);
                }
            }
            finally {
                if (mounted) {
                    console.log('[Auth Effect Init] Carregamento inicial concluÃ­do.');
                    setLoading(false);
                }
            }
        };
        initializeAuth();
        const { data: { subscription } } = supabaseClient_1.supabase.auth.onAuthStateChange(async (_event, session) => {
            if (!mounted)
                return;
            console.log(`[AuthStateChange] Evento: ${_event}`, session ? `User ${session.user.id}` : 'Nenhuma sessÃ£o');
            const currentUser = session?.user ?? null;
            setUser(prevUser => {
                if (prevUser?.id === currentUser?.id) {
                    if (_event === 'USER_UPDATED') {
                        console.log('[AuthStateChange] Evento USER_UPDATED, recarregando perfil...');
                    }
                    return prevUser;
                }
                if (currentUser) {
                    console.log('[AuthStateChange] UsuÃ¡rio alterado/logado, buscando/criando perfil...');
                    createProfileIfNotExists(currentUser).then(p => mounted && setProfile(p));
                }
                else {
                    console.log('[AuthStateChange] UsuÃ¡rio deslogado, limpando perfil.');
                    setProfile(null);
                    console.log('[AuthStateChange] Navegando para /login apÃ³s logout.');
                    navigate('/login', { replace: true });
                }
                return currentUser;
            });
        });
        return () => {
            console.log('[Auth Effect Init] Desmontando...');
            mounted = false;
            subscription?.unsubscribe();
        };
    }, [createProfileIfNotExists, navigate]);
    const login = (0, react_1.useCallback)(async (email, password) => {
        setLoading(true);
        try {
            const { data, error } = await supabaseClient_1.supabase.auth.signInWithPassword({ email, password });
            if (error)
                throw error;
            toast({ title: "Login realizado com sucesso!", description: "Bem-vindo de volta!" });
            return data.user;
        }
        catch (error) {
            console.error('âŒ Erro no login:', error);
            const friendlyMessage = getErrorMessage(error);
            toast({
                variant: "destructive",
                title: error.message === 'Email not confirmed' ? "Email nÃ£o confirmado" : "Erro de Login",
                description: friendlyMessage,
                duration: 8000
            });
            setLoading(false);
            throw error;
        }
    }, [toast]);
    const signInWithGoogle = (0, react_1.useCallback)(async () => {
        setLoading(true);
        try {
            const { error } = await supabaseClient_1.supabase.auth.signInWithOAuth({
                provider: 'google',
                options: { redirectTo: window.location.origin }
            });
            if (error)
                throw error;
            console.log('âœ… Redirecionando para Google...');
        }
        catch (error) {
            console.error('âŒ Erro no login com Google:', error);
            toast({ variant: "destructive", title: "Erro com Login Google", description: error.message });
            setLoading(false);
            throw error;
        }
    }, [toast]);
    const signInWithApple = (0, react_1.useCallback)(async () => {
        setLoading(true);
        try {
            const { error } = await supabaseClient_1.supabase.auth.signInWithOAuth({
                provider: 'apple',
                options: {
                    redirectTo: window.location.origin,
                    scopes: 'name email'
                }
            });
            if (error)
                throw error;
            console.log('âœ… Redirecionando para Apple...');
        }
        catch (error) {
            console.error('âŒ Erro no login com Apple:', error);
            toast({ variant: "destructive", title: "Erro com Login Apple", description: error.message });
            setLoading(false);
            throw error;
        }
    }, [toast]);
    const signInWithFacebook = (0, react_1.useCallback)(async () => {
        setLoading(true);
        try {
            const { error } = await supabaseClient_1.supabase.auth.signInWithOAuth({
                provider: 'facebook',
                options: {
                    redirectTo: window.location.origin,
                    scopes: 'email public_profile'
                }
            });
            if (error)
                throw error;
            console.log('âœ… Redirecionando para Facebook...');
        }
        catch (error) {
            console.error('âŒ Erro no login com Facebook:', error);
            toast({ variant: "destructive", title: "Erro com Login Facebook", description: error.message });
            setLoading(false);
            throw error;
        }
    }, [toast]);
    const register = (0, react_1.useCallback)(async (userData) => {
        setLoading(true);
        try {
            const { data, error } = await supabaseClient_1.supabase.auth.signUp({
                email: userData.email,
                password: userData.password,
                options: {
                    data: {
                        full_name: userData.name,
                        profile_type: userData.profile_type || userTypes_1.PROFILE_TYPES.USER
                    },
                    emailRedirectTo: `${window.location.origin}/login`
                }
            });
            if (error)
                throw error;
            // Verifica se precisa confirmar email
            const needsEmailConfirmation = data.user && !data.session;
            if (needsEmailConfirmation) {
                toast({
                    title: "Cadastro realizado! ðŸ“§",
                    description: "Enviamos um email de confirmaÃ§Ã£o. Por favor, verifique sua caixa de entrada (e spam) antes de fazer login.",
                    duration: 10000
                });
                setLoading(false);
            }
            else {
                toast({
                    title: "Cadastro realizado com sucesso!",
                    description: `Bem-vindo(a), ${userData.name}!`
                });
            }
            return data.user;
        }
        catch (error) {
            console.error('âŒ Erro no registro:', error);
            const friendlyMessage = getErrorMessage(error);
            toast({
                variant: "destructive",
                title: "Erro de Cadastro",
                description: friendlyMessage
            });
            setLoading(false);
            throw error;
        }
    }, [toast]);
    const logout = (0, react_1.useCallback)(async () => {
        console.log('[Logout] Iniciando logout...');
        try {
            const { error } = await supabaseClient_1.supabase.auth.signOut();
            if (error)
                throw error;
            toast({ title: "Logout realizado!", description: "AtÃ© logo!" });
            console.log('[Logout] Logout concluÃ­do no Supabase.');
        }
        catch (error) {
            console.error('âŒ Erro no logout:', error);
            toast({ variant: "destructive", title: "Erro ao Sair", description: error.message });
        }
    }, [toast]);
    const updateProfile = (0, react_1.useCallback)(async (updates) => {
        if (!user) {
            toast({ variant: "destructive", title: "Erro", description: "UsuÃ¡rio nÃ£o autenticado." });
            return null;
        }
        console.log(`[updateProfile] Atualizando perfil para ${user.id}:`, updates);
        try {
            const { data, error } = await supabaseClient_1.supabase
                .from('profiles')
                .update({ ...updates, updated_at: new Date().toISOString() })
                .eq('id', user.id)
                .select()
                .single();
            if (error)
                throw error;
            console.log('âœ… Perfil atualizado no DB:', data);
            toast({ title: "Sucesso!", description: "Seu perfil foi atualizado." });
            const updatedProfileData = {
                ...profile,
                ...data,
                isPartner: data.profile_type === userTypes_1.PROFILE_TYPES.PARTNER || data.partner_id != null,
                isPremium: data.is_premium || false,
                userType: (0, userTypes_1.getUserType)(data),
                isPremiumPartner: profile?.partner_data?.is_premium === true
            };
            setProfile(updatedProfileData);
            console.log('âœ… Estado do perfil atualizado localmente.');
            return updatedProfileData;
        }
        catch (error) {
            console.error('âŒ Erro ao atualizar perfil:', error);
            toast({ variant: "destructive", title: "Erro", description: "NÃ£o foi possÃ­vel salvar as alteraÃ§Ãµes." });
            throw error;
        }
    }, [user, toast, profile]);
    const uploadAvatar = (0, react_1.useCallback)(async (file, isAdditionalPhoto = false) => {
        if (!user || !file) {
            toast({ variant: "destructive", title: "Erro", description: "UsuÃ¡rio nÃ£o logado ou arquivo invÃ¡lido." });
            return null;
        }
        console.log(`[uploadAvatar] Iniciando upload (${isAdditionalPhoto ? 'photo' : 'avatar'}) para ${user.id}`);
        try {
            const fileExt = file.name.split('.').pop();
            const timestamp = Date.now();
            const fileName = `${user.id}-${isAdditionalPhoto ? 'photo' : 'avatar'}-${timestamp}.${fileExt}`;
            const bucket = isAdditionalPhoto ? 'photos' : 'avatars';
            const options = {
                cacheControl: '3600',
                upsert: true,
                contentType: file.type || 'application/octet-stream'
            };
            console.log(`[uploadAvatar] Enviando para bucket '${bucket}', arquivo '${fileName}'`);
            const { data, error } = await supabaseClient_1.supabase.storage.from(bucket).upload(fileName, file, options);
            if (error)
                throw error;
            console.log(`âœ… Upload bem-sucedido. Path:`, data?.path);
            return data?.path ?? null;
        }
        catch (error) {
            console.error('âŒ Erro detalhado no upload:', error);
            toast({ variant: "destructive", title: "Erro no Upload", description: `NÃ£o foi possÃ­vel enviar sua foto. Detalhes: ${error.message}` });
            return null;
        }
    }, [user, toast]);
    const value = (0, react_1.useMemo)(() => ({
        user,
        loading,
        profile,
        login,
        register,
        logout,
        signInWithGoogle,
        signInWithApple,
        signInWithFacebook,
        updateProfile,
        uploadAvatar,
    }), [user, loading, profile, login, register, logout, signInWithGoogle, signInWithApple, signInWithFacebook, updateProfile, uploadAvatar]);
    return ((0, jsx_runtime_1.jsx)(AuthContext.Provider, { value: value, children: loading ? ((0, jsx_runtime_1.jsx)("div", { className: "w-screen h-screen flex items-center justify-center bg-background", children: (0, jsx_runtime_1.jsx)("div", { className: "animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary" }) })) : (children) }));
};
exports.AuthProvider = AuthProvider;
exports.AuthProvider.propTypes = {
    children: prop_types_1.default.node.isRequired,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxjb250ZXh0c1xcQXV0aENvbnRleHQuanN4IiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsK0JBQStCO0FBQy9CLGlDQUE2RjtBQUM3RixvRUFBbUM7QUFDbkMsK0VBQXdFO0FBQ3hFLHlEQUFnRDtBQUNoRCx1REFBK0M7QUFDL0Msa0RBQWdFO0FBRWhFLE1BQU0sV0FBVyxHQUFHLElBQUEscUJBQWEsRUFBQyxJQUFJLENBQUMsQ0FBQztBQUVqQyxNQUFNLE9BQU8sR0FBRyxHQUFHLEVBQUU7SUFDMUIsTUFBTSxPQUFPLEdBQUcsSUFBQSxrQkFBVSxFQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3hDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsa0RBQWtELENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBQ0QsT0FBTyxPQUFPLENBQUM7QUFDakIsQ0FBQyxDQUFDO0FBTlcsUUFBQSxPQUFPLFdBTWxCO0FBRUYsb0RBQW9EO0FBQ3BELE1BQU0sZUFBZSxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUU7SUFDaEMsSUFBSSxLQUFLLENBQUMsT0FBTyxLQUFLLHFCQUFxQixFQUFFLENBQUM7UUFDNUMsT0FBTyw0RkFBNEYsQ0FBQztJQUN0RyxDQUFDO0lBQ0QsSUFBSSxLQUFLLENBQUMsT0FBTyxLQUFLLDJCQUEyQixFQUFFLENBQUM7UUFDbEQsT0FBTyw0QkFBNEIsQ0FBQztJQUN0QyxDQUFDO0lBQ0QsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLENBQUM7UUFDdEQsT0FBTyxrRUFBa0UsQ0FBQztJQUM1RSxDQUFDO0lBQ0QsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDO0FBQ3ZCLENBQUMsQ0FBQztBQUVLLE1BQU0sWUFBWSxHQUFHLENBQUMsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFO0lBQzNDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLEdB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QUFFLGVBQWUsRUFBRSxrQkFBa0IsRUFBRSxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQztJQUUzSSxPQUFPLENBQ0wsdUJBQUMsV0FBVyxDQUFDLFFBQVEsSUFBQyxLQUFLLEVBQUUsS0FBSyxZQUMvQixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQ1QsZ0NBQUssU0FBUyxFQUFDLGtFQUFrRSxZQUMvRSxnQ0FBSyxTQUFTLEVBQUMsMEVBQTBFLEdBQU8sR0FDNUYsQ0FDUCxDQUFDLENBQUMsQ0FBQyxDQUNGLFFBQVEsQ0FDVCxHQUNvQixDQUN4QixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBemFXLFFBQUEsWUFBWSxnQkF5YXZCO0FBRUYsb0JBQVksQ0FBQyxTQUFTLEdBQUc7SUFDdkIsUUFBUSxFQUFFLG9CQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7Q0FDcEMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXGNvbnRleHRzXFxBdXRoQ29udGV4dC5qc3giXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2NvbnRleHRzL0F1dGhDb250ZXh0LmpzeFxyXG5pbXBvcnQgeyBjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VTdGF0ZSwgdXNlRWZmZWN0LCB1c2VDYWxsYmFjaywgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcclxuaW1wb3J0IHsgdXNlVG9hc3QgfSBmcm9tICdAL2ZlYXR1cmVzL3NoYXJlZC9jb21wb25lbnRzL3VpL3VzZS10b2FzdC5qcyc7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnQC9saWIvc3VwYWJhc2VDbGllbnQnO1xyXG5pbXBvcnQgeyB1c2VOYXZpZ2F0ZSB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xyXG5pbXBvcnQgeyBnZXRVc2VyVHlwZSwgUFJPRklMRV9UWVBFUyB9IGZyb20gJ0AvY29uZmlnL3VzZXJUeXBlcyc7XHJcblxyXG5jb25zdCBBdXRoQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQobnVsbCk7XHJcblxyXG5leHBvcnQgY29uc3QgdXNlQXV0aCA9ICgpID0+IHtcclxuICBjb25zdCBjb250ZXh0ID0gdXNlQ29udGV4dChBdXRoQ29udGV4dCk7XHJcbiAgaWYgKCFjb250ZXh0KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3VzZUF1dGggZGV2ZSBzZXIgdXNhZG8gZGVudHJvIGRlIHVtIEF1dGhQcm92aWRlcicpO1xyXG4gIH1cclxuICByZXR1cm4gY29udGV4dDtcclxufTtcclxuXHJcbi8vIPCfjq8gRnVuw6fDo28gaGVscGVyIHBhcmEgbWVuc2FnZW5zIGRlIGVycm8gYW1pZ8OhdmVpc1xyXG5jb25zdCBnZXRFcnJvck1lc3NhZ2UgPSAoZXJyb3IpID0+IHtcclxuICBpZiAoZXJyb3IubWVzc2FnZSA9PT0gJ0VtYWlsIG5vdCBjb25maXJtZWQnKSB7XHJcbiAgICByZXR1cm4gJ1BvciBmYXZvciwgY29uZmlybWUgc2V1IGVtYWlsIGFudGVzIGRlIGZhemVyIGxvZ2luLiBWZXJpZmlxdWUgc3VhIGNhaXhhIGRlIGVudHJhZGEgZSBzcGFtLic7XHJcbiAgfVxyXG4gIGlmIChlcnJvci5tZXNzYWdlID09PSAnSW52YWxpZCBsb2dpbiBjcmVkZW50aWFscycpIHtcclxuICAgIHJldHVybiAnRW1haWwgb3Ugc2VuaGEgaW5jb3JyZXRvcy4nO1xyXG4gIH1cclxuICBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnVXNlciBhbHJlYWR5IHJlZ2lzdGVyZWQnKSkge1xyXG4gICAgcmV0dXJuICdFc3RlIGVtYWlsIGrDoSBlc3TDoSBjYWRhc3RyYWRvLiBGYcOnYSBsb2dpbiBvdSByZWN1cGVyZSBzdWEgc2VuaGEuJztcclxuICB9XHJcbiAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgQXV0aFByb3ZpZGVyID0gKHsgY2hpbGRyZW4gfSkgPT4ge1xyXG4gIGNvbnN0IFt1c2VyLCBzZXRVc2VyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xyXG4gIGNvbnN0IFtwcm9maWxlLCBzZXRQcm9maWxlXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIGNvbnN0IHsgdG9hc3QgfSA9IHVzZVRvYXN0KCk7XHJcbiAgY29uc3QgbmF2aWdhdGUgPSB1c2VOYXZpZ2F0ZSgpO1xyXG5cclxuICAvLyBGdW7Dp8OjbyBwYXJhIGJ1c2NhciBvIHBlcmZpbFxyXG4gIGNvbnN0IGdldFByb2ZpbGUgPSB1c2VDYWxsYmFjayhhc3luYyAoY3VycmVudFVzZXIpID0+IHtcclxuICAgIGlmICghY3VycmVudFVzZXIpIHJldHVybiBudWxsO1xyXG4gICAgY29uc29sZS5sb2coYPCfk4QgW2dldFByb2ZpbGVdIEJ1c2NhbmRvIHBlcmZpbCBwYXJhICR7Y3VycmVudFVzZXIuaWR9YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGVEYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgncHJvZmlsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICAgaWQsIHVzZXJuYW1lLCBiaW8sIGF2YXRhcl91cmwsIHBob3RvcywgaGFzaHRhZ3NfaW50ZXJlc3NlLFxyXG4gICAgICAgICAgaXNfcHJlbWl1bSwgcHJvZmlsZV90eXBlLCBwYXJ0bmVyX2lkLFxyXG4gICAgICAgICAgdGhlbWUsIHByb2ZpbGVfdmlzaWJpbGl0eSwgbm90aWZpY2F0aW9uX3ByZWZzLFxyXG4gICAgICAgICAgcGhvbmUsIHBob25lX3ZlcmlmaWVkXHJcbiAgICAgICAgYClcclxuICAgICAgICAuZXEoJ2lkJywgY3VycmVudFVzZXIuaWQpXHJcbiAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuY29kZSAhPT0gJ1BHUlNUMTE2JykgdGhyb3cgZXJyb3I7XHJcbiAgICAgIGlmICghcHJvZmlsZURhdGEpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgcHJvZmlsZURhdGEudGhlbWUgPSBwcm9maWxlRGF0YS50aGVtZSB8fCAnc3lzdGVtJztcclxuICAgICAgcHJvZmlsZURhdGEucHJvZmlsZV92aXNpYmlsaXR5ID0gcHJvZmlsZURhdGEucHJvZmlsZV92aXNpYmlsaXR5IHx8ICdwdWJsaWMnO1xyXG4gICAgICBwcm9maWxlRGF0YS5ub3RpZmljYXRpb25fcHJlZnMgPSBwcm9maWxlRGF0YS5ub3RpZmljYXRpb25fcHJlZnMgfHwgeyBlbWFpbEV2ZW50VXBkYXRlczogdHJ1ZSwgcHVzaE5ld01lc3NhZ2VzOiB0cnVlIH07XHJcblxyXG4gICAgICAvLyDinIUgU0UgRk9SIFBBUkNFSVJPLCBCVVNDQVIgREFET1MgRE8gUEFSVE5FUlxyXG4gICAgICBpZiAocHJvZmlsZURhdGEucHJvZmlsZV90eXBlID09PSBQUk9GSUxFX1RZUEVTLlBBUlRORVIgJiYgcHJvZmlsZURhdGEucGFydG5lcl9pZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIEJ1c2NhbmRvIGRhZG9zIGRvIHBhcnRuZXI6ICR7cHJvZmlsZURhdGEucGFydG5lcl9pZH1gKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHBhcnRuZXJEYXRhLCBlcnJvcjogcGFydG5lckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ3BhcnRuZXJzJylcclxuICAgICAgICAgIC5zZWxlY3QoJ2lkLCBuYW1lLCBlbWFpbCwgcGxhbiwgaXNfcHJlbWl1bSwgY2FwYWNpdHknKVxyXG4gICAgICAgICAgLmVxKCdpZCcsIHByb2ZpbGVEYXRhLnBhcnRuZXJfaWQpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKCFwYXJ0bmVyRXJyb3IgJiYgcGFydG5lckRhdGEpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgRGFkb3MgZG8gcGFydG5lcjonLCBwYXJ0bmVyRGF0YSk7XHJcbiAgICAgICAgICBwcm9maWxlRGF0YS5wYXJ0bmVyX2RhdGEgPSBwYXJ0bmVyRGF0YTtcclxuICAgICAgICAgIHByb2ZpbGVEYXRhLmlzUHJlbWl1bVBhcnRuZXIgPSBwYXJ0bmVyRGF0YS5pc19wcmVtaXVtID09PSB0cnVlO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBTdGF0dXMgUHJlbWl1bTonLCB7XHJcbiAgICAgICAgICAgIHBhcnRuZXJJZDogcGFydG5lckRhdGEuaWQsXHJcbiAgICAgICAgICAgIHBhcnRuZXJOYW1lOiBwYXJ0bmVyRGF0YS5uYW1lLFxyXG4gICAgICAgICAgICBwbGFuOiBwYXJ0bmVyRGF0YS5wbGFuLFxyXG4gICAgICAgICAgICBpc1ByZW1pdW06IHBhcnRuZXJEYXRhLmlzX3ByZW1pdW0sXHJcbiAgICAgICAgICAgIGlzUHJlbWl1bVBhcnRuZXI6IHByb2ZpbGVEYXRhLmlzUHJlbWl1bVBhcnRuZXIsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHBhcnRuZXJFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm8gYW8gYnVzY2FyIGRhZG9zIGRvIHBhcmNlaXJvICR7cHJvZmlsZURhdGEucGFydG5lcl9pZH06YCwgcGFydG5lckVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGVucmljaGVkUHJvZmlsZSA9IHtcclxuICAgICAgICAuLi5wcm9maWxlRGF0YSxcclxuICAgICAgICBpc1BhcnRuZXI6IHByb2ZpbGVEYXRhLnByb2ZpbGVfdHlwZSA9PT0gUFJPRklMRV9UWVBFUy5QQVJUTkVSIHx8IHByb2ZpbGVEYXRhLnBhcnRuZXJfaWQgIT0gbnVsbCxcclxuICAgICAgICBpc1ByZW1pdW06IHByb2ZpbGVEYXRhLmlzX3ByZW1pdW0gfHwgZmFsc2UsXHJcbiAgICAgICAgdXNlclR5cGU6IGdldFVzZXJUeXBlKHByb2ZpbGVEYXRhKVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc29sZS5sb2coJ+KchSBQZXJmaWwgY2FycmVnYWRvOicsIGVucmljaGVkUHJvZmlsZS51c2VybmFtZSwgJ3wgUGhvbmU6JywgZW5yaWNoZWRQcm9maWxlLnBob25lIHx8ICdzZW0gdGVsZWZvbmUnKTtcclxuICAgICAgcmV0dXJuIGVucmljaGVkUHJvZmlsZTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGVtIGdldFByb2ZpbGU6JywgZXJyb3IpO1xyXG4gICAgICB0b2FzdCh7IHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgdGl0bGU6IFwiRXJybyBhbyBidXNjYXIgcGVyZmlsXCIsIGRlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9LCBbdG9hc3RdKTtcclxuXHJcbiAgLy8gRnVuw6fDo28gcGFyYSBjcmlhciBvIHBlcmZpbCBzZSBuw6NvIGV4aXN0aXJcclxuICBjb25zdCBjcmVhdGVQcm9maWxlSWZOb3RFeGlzdHMgPSB1c2VDYWxsYmFjayhhc3luYyAoY3VycmVudFVzZXIpID0+IHtcclxuICAgIGlmICghY3VycmVudFVzZXIpIHJldHVybiBudWxsO1xyXG4gICAgY29uc29sZS5sb2coYFtjcmVhdGVQcm9maWxlXSBWZXJpZmljYW5kby9DcmlhbmRvIHBlcmZpbCBwYXJhICR7Y3VycmVudFVzZXIuaWR9YCk7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgcHJvZmlsZURhdGEgPSBhd2FpdCBnZXRQcm9maWxlKGN1cnJlbnRVc2VyKTtcclxuICAgICAgaWYgKCFwcm9maWxlRGF0YSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDihLnvuI8gW2NyZWF0ZVByb2ZpbGVdIFBlcmZpbCBuw6NvIGV4aXN0ZSBwYXJhICR7Y3VycmVudFVzZXIuaWR9LiBDcmlhbmRvLi4uYCk7XHJcbiAgICAgICAgY29uc3QgcHJvZmlsZVR5cGUgPSBjdXJyZW50VXNlci51c2VyX21ldGFkYXRhPy5wcm9maWxlX3R5cGUgfHwgUFJPRklMRV9UWVBFUy5VU0VSO1xyXG4gICAgICAgIGNvbnN0IG5ld1Byb2ZpbGVEYXRhID0ge1xyXG4gICAgICAgICAgaWQ6IGN1cnJlbnRVc2VyLmlkLFxyXG4gICAgICAgICAgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLnVzZXJfbWV0YWRhdGE/LmZ1bGxfbmFtZSB8fCBjdXJyZW50VXNlci5lbWFpbD8uc3BsaXQoJ0AnKVswXSB8fCBgdXNlcl8ke2N1cnJlbnRVc2VyLmlkLnN1YnN0cmluZygwLCA1KX1gLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgdGhlbWU6ICdzeXN0ZW0nLFxyXG4gICAgICAgICAgcHJvZmlsZV92aXNpYmlsaXR5OiAncHVibGljJyxcclxuICAgICAgICAgIG5vdGlmaWNhdGlvbl9wcmVmczogeyBlbWFpbEV2ZW50VXBkYXRlczogdHJ1ZSwgcHVzaE5ld01lc3NhZ2VzOiB0cnVlIH0sXHJcbiAgICAgICAgICBwcm9maWxlX3R5cGU6IHByb2ZpbGVUeXBlLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLmluc2VydChuZXdQcm9maWxlRGF0YSk7XHJcbiAgICAgICAgaWYgKGluc2VydEVycm9yKSB0aHJvdyBpbnNlcnRFcnJvcjtcclxuICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFtjcmVhdGVQcm9maWxlXSBQZXJmaWwgY3JpYWRvIHBhcmEgJHtjdXJyZW50VXNlci5pZH1gKTtcclxuICAgICAgICB0b2FzdCh7IHRpdGxlOiBcIlBlcmZpbCBjcmlhZG8hXCIsIGRlc2NyaXB0aW9uOiBcIkJlbS12aW5kbyFcIiB9KTtcclxuICAgICAgICBwcm9maWxlRGF0YSA9IGF3YWl0IGdldFByb2ZpbGUoY3VycmVudFVzZXIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgW2NyZWF0ZVByb2ZpbGVdIFBlcmZpbCBqw6EgZXhpc3RlIHBhcmEgJHtjdXJyZW50VXNlci5pZH1gKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcHJvZmlsZURhdGE7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBlbSBjcmVhdGVQcm9maWxlSWZOb3RFeGlzdHM6JywgZXJyb3IpO1xyXG4gICAgICB0b2FzdCh7IHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgdGl0bGU6IFwiRXJybyBhbyBjcmlhci92ZXJpZmljYXIgcGVyZmlsXCIsIGRlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9LCBbZ2V0UHJvZmlsZSwgdG9hc3RdKTtcclxuXHJcbiAgLy8gRWZlaXRvIHByaW5jaXBhbCBwYXJhIGF1dGggc3RhdGUgY2hhbmdlIGUgaW5pY2lhbGl6YcOnw6NvXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGxldCBtb3VudGVkID0gdHJ1ZTtcclxuICAgIGNvbnNvbGUubG9nKCdbQXV0aCBFZmZlY3QgSW5pdF0gTW9udGFuZG8gZSBidXNjYW5kbyBzZXNzw6NvIGluaWNpYWwuLi4nKTtcclxuICAgIHNldExvYWRpbmcodHJ1ZSk7XHJcblxyXG4gICAgY29uc3QgaW5pdGlhbGl6ZUF1dGggPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSwgZXJyb3I6IHNlc3Npb25FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uKCk7XHJcbiAgICAgICAgICAgIGlmIChzZXNzaW9uRXJyb3IpIHRocm93IHNlc3Npb25FcnJvcjtcclxuICAgICAgICAgICAgaWYgKCFtb3VudGVkKSByZXR1cm47XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQXV0aCBFZmZlY3QgSW5pdF0gU2Vzc8OjbyBpbmljaWFsOicsIHNlc3Npb24gPyBgVXNlciAke3Nlc3Npb24udXNlci5pZH1gIDogJ05lbmh1bWEnKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxVc2VyID0gc2Vzc2lvbj8udXNlciA/PyBudWxsO1xyXG4gICAgICAgICAgICBzZXRVc2VyKGluaXRpYWxVc2VyKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbml0aWFsVXNlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5pdGlhbFByb2ZpbGUgPSBhd2FpdCBjcmVhdGVQcm9maWxlSWZOb3RFeGlzdHMoaW5pdGlhbFVzZXIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1vdW50ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRQcm9maWxlKGluaXRpYWxQcm9maWxlKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDinIUgTsODTyByZWRpcmVjaW9uYSBzZSBlc3RpdmVyIGVtIC92ZXJpZnktcGhvbmUgb3Ugc2UgZm9yIHVzdcOhcmlvIGFudGlnbyBzZW0gdGVsZWZvbmVcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbFByb2ZpbGUgJiYgWycvJywgJy9sb2dpbicsICcvcmVnaXN0ZXInXS5pbmNsdWRlcyhjdXJyZW50UGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0Um91dGUgPSBpbml0aWFsUHJvZmlsZS5pc1BhcnRuZXIgPyAnL3BhcnRuZXIvZGFzaGJvYXJkJyA6ICcvZGFzaGJvYXJkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtBdXRoIEVmZmVjdCBJbml0XSBOYXZlZ2FuZG8gcGFyYSByb3RhIGluaWNpYWw6ICR7dGFyZ2V0Um91dGV9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlKHRhcmdldFJvdXRlLCB7IHJlcGxhY2U6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1vdW50ZWQpIHtcclxuICAgICAgICAgICAgICAgIHNldFByb2ZpbGUobnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gbmEgaW5pY2lhbGl6YcOnw6NvIGRvIEF1dGg6JywgZXJyKTtcclxuICAgICAgICAgICAgaWYgKG1vdW50ZWQpIHtcclxuICAgICAgICAgICAgICAgIHNldFVzZXIobnVsbCk7XHJcbiAgICAgICAgICAgICAgICBzZXRQcm9maWxlKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgaWYgKG1vdW50ZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQXV0aCBFZmZlY3QgSW5pdF0gQ2FycmVnYW1lbnRvIGluaWNpYWwgY29uY2x1w61kby4nKTtcclxuICAgICAgICAgICAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpbml0aWFsaXplQXV0aCgpO1xyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogeyBzdWJzY3JpcHRpb24gfSB9ID0gc3VwYWJhc2UuYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZShhc3luYyAoX2V2ZW50LCBzZXNzaW9uKSA9PiB7XHJcbiAgICAgICAgaWYgKCFtb3VudGVkKSByZXR1cm47XHJcbiAgICAgICAgY29uc29sZS5sb2coYFtBdXRoU3RhdGVDaGFuZ2VdIEV2ZW50bzogJHtfZXZlbnR9YCwgc2Vzc2lvbiA/IGBVc2VyICR7c2Vzc2lvbi51c2VyLmlkfWAgOiAnTmVuaHVtYSBzZXNzw6NvJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gc2Vzc2lvbj8udXNlciA/PyBudWxsO1xyXG5cclxuICAgICAgICBzZXRVc2VyKHByZXZVc2VyID0+IHtcclxuICAgICAgICAgICAgaWYgKHByZXZVc2VyPy5pZCA9PT0gY3VycmVudFVzZXI/LmlkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2V2ZW50ID09PSAnVVNFUl9VUERBVEVEJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQXV0aFN0YXRlQ2hhbmdlXSBFdmVudG8gVVNFUl9VUERBVEVELCByZWNhcnJlZ2FuZG8gcGVyZmlsLi4uJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJldlVzZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoU3RhdGVDaGFuZ2VdIFVzdcOhcmlvIGFsdGVyYWRvL2xvZ2FkbywgYnVzY2FuZG8vY3JpYW5kbyBwZXJmaWwuLi4nKTtcclxuICAgICAgICAgICAgICAgIGNyZWF0ZVByb2ZpbGVJZk5vdEV4aXN0cyhjdXJyZW50VXNlcikudGhlbihwID0+IG1vdW50ZWQgJiYgc2V0UHJvZmlsZShwKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW0F1dGhTdGF0ZUNoYW5nZV0gVXN1w6FyaW8gZGVzbG9nYWRvLCBsaW1wYW5kbyBwZXJmaWwuJyk7XHJcbiAgICAgICAgICAgICAgICBzZXRQcm9maWxlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoU3RhdGVDaGFuZ2VdIE5hdmVnYW5kbyBwYXJhIC9sb2dpbiBhcMOzcyBsb2dvdXQuJyk7XHJcbiAgICAgICAgICAgICAgICBuYXZpZ2F0ZSgnL2xvZ2luJywgeyByZXBsYWNlOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50VXNlcjtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoIEVmZmVjdCBJbml0XSBEZXNtb250YW5kby4uLicpO1xyXG4gICAgICAgIG1vdW50ZWQgPSBmYWxzZTtcclxuICAgICAgICBzdWJzY3JpcHRpb24/LnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9O1xyXG4gIH0sIFtjcmVhdGVQcm9maWxlSWZOb3RFeGlzdHMsIG5hdmlnYXRlXSk7XHJcblxyXG4gIGNvbnN0IGxvZ2luID0gdXNlQ2FsbGJhY2soYXN5bmMgKGVtYWlsLCBwYXNzd29yZCkgPT4ge1xyXG4gICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHsgZW1haWwsIHBhc3N3b3JkIH0pO1xyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgICB0b2FzdCh7IHRpdGxlOiBcIkxvZ2luIHJlYWxpemFkbyBjb20gc3VjZXNzbyFcIiwgZGVzY3JpcHRpb246IFwiQmVtLXZpbmRvIGRlIHZvbHRhIVwiIH0pO1xyXG4gICAgICByZXR1cm4gZGF0YS51c2VyO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gbm8gbG9naW46JywgZXJyb3IpO1xyXG4gICAgICBjb25zdCBmcmllbmRseU1lc3NhZ2UgPSBnZXRFcnJvck1lc3NhZ2UoZXJyb3IpO1xyXG4gICAgICB0b2FzdCh7IFxyXG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgXHJcbiAgICAgICAgdGl0bGU6IGVycm9yLm1lc3NhZ2UgPT09ICdFbWFpbCBub3QgY29uZmlybWVkJyA/IFwiRW1haWwgbsOjbyBjb25maXJtYWRvXCIgOiBcIkVycm8gZGUgTG9naW5cIiwgXHJcbiAgICAgICAgZGVzY3JpcHRpb246IGZyaWVuZGx5TWVzc2FnZSxcclxuICAgICAgICBkdXJhdGlvbjogODAwMFxyXG4gICAgICB9KTtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sIFt0b2FzdF0pO1xyXG5cclxuICBjb25zdCBzaWduSW5XaXRoR29vZ2xlID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aE9BdXRoKHtcclxuICAgICAgICBwcm92aWRlcjogJ2dvb2dsZScsXHJcbiAgICAgICAgb3B0aW9uczogeyByZWRpcmVjdFRvOiB3aW5kb3cubG9jYXRpb24ub3JpZ2luIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgUmVkaXJlY2lvbmFuZG8gcGFyYSBHb29nbGUuLi4nKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIG5vIGxvZ2luIGNvbSBHb29nbGU6JywgZXJyb3IpO1xyXG4gICAgICB0b2FzdCh7IHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgdGl0bGU6IFwiRXJybyBjb20gTG9naW4gR29vZ2xlXCIsIGRlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgICBzZXRMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfSwgW3RvYXN0XSk7XHJcblxyXG4gIGNvbnN0IHNpZ25JbldpdGhBcHBsZSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIHNldExvYWRpbmcodHJ1ZSk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhPQXV0aCh7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdhcHBsZScsXHJcbiAgICAgICAgb3B0aW9uczogeyBcclxuICAgICAgICAgIHJlZGlyZWN0VG86IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXHJcbiAgICAgICAgICBzY29wZXM6ICduYW1lIGVtYWlsJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgUmVkaXJlY2lvbmFuZG8gcGFyYSBBcHBsZS4uLicpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gbm8gbG9naW4gY29tIEFwcGxlOicsIGVycm9yKTtcclxuICAgICAgdG9hc3QoeyB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsIHRpdGxlOiBcIkVycm8gY29tIExvZ2luIEFwcGxlXCIsIGRlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgICBzZXRMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfSwgW3RvYXN0XSk7XHJcblxyXG4gIGNvbnN0IHNpZ25JbldpdGhGYWNlYm9vayA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIHNldExvYWRpbmcodHJ1ZSk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhPQXV0aCh7XHJcbiAgICAgICAgcHJvdmlkZXI6ICdmYWNlYm9vaycsXHJcbiAgICAgICAgb3B0aW9uczogeyBcclxuICAgICAgICAgIHJlZGlyZWN0VG86IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXHJcbiAgICAgICAgICBzY29wZXM6ICdlbWFpbCBwdWJsaWNfcHJvZmlsZSdcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIFJlZGlyZWNpb25hbmRvIHBhcmEgRmFjZWJvb2suLi4nKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIG5vIGxvZ2luIGNvbSBGYWNlYm9vazonLCBlcnJvcik7XHJcbiAgICAgIHRvYXN0KHsgdmFyaWFudDogXCJkZXN0cnVjdGl2ZVwiLCB0aXRsZTogXCJFcnJvIGNvbSBMb2dpbiBGYWNlYm9va1wiLCBkZXNjcmlwdGlvbjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sIFt0b2FzdF0pO1xyXG5cclxuICBjb25zdCByZWdpc3RlciA9IHVzZUNhbGxiYWNrKGFzeW5jICh1c2VyRGF0YSkgPT4ge1xyXG4gICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnblVwKHtcclxuICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXHJcbiAgICAgICAgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkLFxyXG4gICAgICAgIG9wdGlvbnM6IHsgXHJcbiAgICAgICAgICBkYXRhOiB7IFxyXG4gICAgICAgICAgICBmdWxsX25hbWU6IHVzZXJEYXRhLm5hbWUsIFxyXG4gICAgICAgICAgICBwcm9maWxlX3R5cGU6IHVzZXJEYXRhLnByb2ZpbGVfdHlwZSB8fCBQUk9GSUxFX1RZUEVTLlVTRVIgXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZW1haWxSZWRpcmVjdFRvOiBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9sb2dpbmBcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIHByZWNpc2EgY29uZmlybWFyIGVtYWlsXHJcbiAgICAgIGNvbnN0IG5lZWRzRW1haWxDb25maXJtYXRpb24gPSBkYXRhLnVzZXIgJiYgIWRhdGEuc2Vzc2lvbjtcclxuICAgICAgXHJcbiAgICAgIGlmIChuZWVkc0VtYWlsQ29uZmlybWF0aW9uKSB7XHJcbiAgICAgICAgdG9hc3QoeyBcclxuICAgICAgICAgIHRpdGxlOiBcIkNhZGFzdHJvIHJlYWxpemFkbyEg8J+Tp1wiLCBcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkVudmlhbW9zIHVtIGVtYWlsIGRlIGNvbmZpcm1hw6fDo28uIFBvciBmYXZvciwgdmVyaWZpcXVlIHN1YSBjYWl4YSBkZSBlbnRyYWRhIChlIHNwYW0pIGFudGVzIGRlIGZhemVyIGxvZ2luLlwiLFxyXG4gICAgICAgICAgZHVyYXRpb246IDEwMDAwXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdG9hc3QoeyBcclxuICAgICAgICAgIHRpdGxlOiBcIkNhZGFzdHJvIHJlYWxpemFkbyBjb20gc3VjZXNzbyFcIiwgXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYEJlbS12aW5kbyhhKSwgJHt1c2VyRGF0YS5uYW1lfSFgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gZGF0YS51c2VyO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm8gbm8gcmVnaXN0cm86JywgZXJyb3IpO1xyXG4gICAgICBjb25zdCBmcmllbmRseU1lc3NhZ2UgPSBnZXRFcnJvck1lc3NhZ2UoZXJyb3IpO1xyXG4gICAgICB0b2FzdCh7IFxyXG4gICAgICAgIHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgXHJcbiAgICAgICAgdGl0bGU6IFwiRXJybyBkZSBDYWRhc3Ryb1wiLCBcclxuICAgICAgICBkZXNjcmlwdGlvbjogZnJpZW5kbHlNZXNzYWdlIFxyXG4gICAgICB9KTtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sIFt0b2FzdF0pO1xyXG5cclxuICBjb25zdCBsb2dvdXQgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnW0xvZ291dF0gSW5pY2lhbmRvIGxvZ291dC4uLicpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XHJcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICAgIHRvYXN0KHsgdGl0bGU6IFwiTG9nb3V0IHJlYWxpemFkbyFcIiwgZGVzY3JpcHRpb246IFwiQXTDqSBsb2dvIVwiIH0pO1xyXG4gICAgICBjb25zb2xlLmxvZygnW0xvZ291dF0gTG9nb3V0IGNvbmNsdcOtZG8gbm8gU3VwYWJhc2UuJyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBubyBsb2dvdXQ6JywgZXJyb3IpO1xyXG4gICAgICB0b2FzdCh7IHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgdGl0bGU6IFwiRXJybyBhbyBTYWlyXCIsIGRlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgfVxyXG4gIH0sIFt0b2FzdF0pO1xyXG5cclxuICBjb25zdCB1cGRhdGVQcm9maWxlID0gdXNlQ2FsbGJhY2soYXN5bmMgKHVwZGF0ZXMpID0+IHtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICB0b2FzdCh7IHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgdGl0bGU6IFwiRXJyb1wiLCBkZXNjcmlwdGlvbjogXCJVc3XDoXJpbyBuw6NvIGF1dGVudGljYWRvLlwiIH0pO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnNvbGUubG9nKGBbdXBkYXRlUHJvZmlsZV0gQXR1YWxpemFuZG8gcGVyZmlsIHBhcmEgJHt1c2VyLmlkfTpgLCB1cGRhdGVzKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcclxuICAgICAgICAudXBkYXRlKHsgLi4udXBkYXRlcywgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pXHJcbiAgICAgICAgLmVxKCdpZCcsIHVzZXIuaWQpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgUGVyZmlsIGF0dWFsaXphZG8gbm8gREI6JywgZGF0YSk7XHJcbiAgICAgIHRvYXN0KHsgdGl0bGU6IFwiU3VjZXNzbyFcIiwgZGVzY3JpcHRpb246IFwiU2V1IHBlcmZpbCBmb2kgYXR1YWxpemFkby5cIiB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRQcm9maWxlRGF0YSA9IHtcclxuICAgICAgICAuLi5wcm9maWxlLFxyXG4gICAgICAgIC4uLmRhdGEsXHJcbiAgICAgICAgaXNQYXJ0bmVyOiBkYXRhLnByb2ZpbGVfdHlwZSA9PT0gUFJPRklMRV9UWVBFUy5QQVJUTkVSIHx8IGRhdGEucGFydG5lcl9pZCAhPSBudWxsLFxyXG4gICAgICAgIGlzUHJlbWl1bTogZGF0YS5pc19wcmVtaXVtIHx8IGZhbHNlLFxyXG4gICAgICAgIHVzZXJUeXBlOiBnZXRVc2VyVHlwZShkYXRhKSxcclxuICAgICAgICBpc1ByZW1pdW1QYXJ0bmVyOiBwcm9maWxlPy5wYXJ0bmVyX2RhdGE/LmlzX3ByZW1pdW0gPT09IHRydWVcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHNldFByb2ZpbGUodXBkYXRlZFByb2ZpbGVEYXRhKTtcclxuICAgICAgY29uc29sZS5sb2coJ+KchSBFc3RhZG8gZG8gcGVyZmlsIGF0dWFsaXphZG8gbG9jYWxtZW50ZS4nKTtcclxuICAgICAgcmV0dXJuIHVwZGF0ZWRQcm9maWxlRGF0YTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvIGFvIGF0dWFsaXphciBwZXJmaWw6JywgZXJyb3IpO1xyXG4gICAgICB0b2FzdCh7IHZhcmlhbnQ6IFwiZGVzdHJ1Y3RpdmVcIiwgdGl0bGU6IFwiRXJyb1wiLCBkZXNjcmlwdGlvbjogXCJOw6NvIGZvaSBwb3Nzw612ZWwgc2FsdmFyIGFzIGFsdGVyYcOnw7Vlcy5cIiB9KTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfSwgW3VzZXIsIHRvYXN0LCBwcm9maWxlXSk7XHJcblxyXG4gIGNvbnN0IHVwbG9hZEF2YXRhciA9IHVzZUNhbGxiYWNrKGFzeW5jIChmaWxlLCBpc0FkZGl0aW9uYWxQaG90byA9IGZhbHNlKSA9PiB7XHJcbiAgICBpZiAoIXVzZXIgfHwgIWZpbGUpIHtcclxuICAgICAgdG9hc3QoeyB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsIHRpdGxlOiBcIkVycm9cIiwgZGVzY3JpcHRpb246IFwiVXN1w6FyaW8gbsOjbyBsb2dhZG8gb3UgYXJxdWl2byBpbnbDoWxpZG8uXCIgfSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2coYFt1cGxvYWRBdmF0YXJdIEluaWNpYW5kbyB1cGxvYWQgKCR7aXNBZGRpdGlvbmFsUGhvdG8gPyAncGhvdG8nIDogJ2F2YXRhcid9KSBwYXJhICR7dXNlci5pZH1gKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGZpbGVFeHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcclxuICAgICAgY29uc3QgZmlsZU5hbWUgPSBgJHt1c2VyLmlkfS0ke2lzQWRkaXRpb25hbFBob3RvID8gJ3Bob3RvJyA6ICdhdmF0YXInfS0ke3RpbWVzdGFtcH0uJHtmaWxlRXh0fWA7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBidWNrZXQgPSBpc0FkZGl0aW9uYWxQaG90byA/ICdwaG90b3MnIDogJ2F2YXRhcnMnO1xyXG4gICAgICBjb25zdCBvcHRpb25zID0geyBcclxuICAgICAgICBjYWNoZUNvbnRyb2w6ICczNjAwJywgXHJcbiAgICAgICAgdXBzZXJ0OiB0cnVlLFxyXG4gICAgICAgIGNvbnRlbnRUeXBlOiBmaWxlLnR5cGUgfHwgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScgXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhgW3VwbG9hZEF2YXRhcl0gRW52aWFuZG8gcGFyYSBidWNrZXQgJyR7YnVja2V0fScsIGFycXVpdm8gJyR7ZmlsZU5hbWV9J2ApO1xyXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlLmZyb20oYnVja2V0KS51cGxvYWQoZmlsZU5hbWUsIGZpbGUsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgVXBsb2FkIGJlbS1zdWNlZGlkby4gUGF0aDpgLCBkYXRhPy5wYXRoKTtcclxuICAgICAgcmV0dXJuIGRhdGE/LnBhdGggPz8gbnVsbDtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJybyBkZXRhbGhhZG8gbm8gdXBsb2FkOicsIGVycm9yKTtcclxuICAgICAgdG9hc3QoeyB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsIHRpdGxlOiBcIkVycm8gbm8gVXBsb2FkXCIsIGRlc2NyaXB0aW9uOiBgTsOjbyBmb2kgcG9zc8OtdmVsIGVudmlhciBzdWEgZm90by4gRGV0YWxoZXM6ICR7ZXJyb3IubWVzc2FnZX1gIH0pO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9LCBbdXNlciwgdG9hc3RdKTtcclxuXHJcbiAgY29uc3QgdmFsdWUgPSB1c2VNZW1vKCgpID0+ICh7XHJcbiAgICB1c2VyLFxyXG4gICAgbG9hZGluZyxcclxuICAgIHByb2ZpbGUsXHJcbiAgICBsb2dpbixcclxuICAgIHJlZ2lzdGVyLFxyXG4gICAgbG9nb3V0LFxyXG4gICAgc2lnbkluV2l0aEdvb2dsZSxcclxuICAgIHNpZ25JbldpdGhBcHBsZSxcclxuICAgIHNpZ25JbldpdGhGYWNlYm9vayxcclxuICAgIHVwZGF0ZVByb2ZpbGUsXHJcbiAgICB1cGxvYWRBdmF0YXIsXHJcbiAgfSksIFt1c2VyLCBsb2FkaW5nLCBwcm9maWxlLCBsb2dpbiwgcmVnaXN0ZXIsIGxvZ291dCwgc2lnbkluV2l0aEdvb2dsZSwgc2lnbkluV2l0aEFwcGxlLCBzaWduSW5XaXRoRmFjZWJvb2ssIHVwZGF0ZVByb2ZpbGUsIHVwbG9hZEF2YXRhcl0pO1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPEF1dGhDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXt2YWx1ZX0+XHJcbiAgICAgIHtsb2FkaW5nID8gKFxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidy1zY3JlZW4gaC1zY3JlZW4gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctYmFja2dyb3VuZFwiPlxyXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJhbmltYXRlLXNwaW4gcm91bmRlZC1mdWxsIGgtMTIgdy0xMiBib3JkZXItdC0yIGJvcmRlci1iLTIgYm9yZGVyLXByaW1hcnlcIj48L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgKSA6IChcclxuICAgICAgICBjaGlsZHJlblxyXG4gICAgICApfVxyXG4gICAgPC9BdXRoQ29udGV4dC5Qcm92aWRlcj5cclxuICApO1xyXG59O1xyXG5cclxuQXV0aFByb3ZpZGVyLnByb3BUeXBlcyA9IHtcclxuICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUuaXNSZXF1aXJlZCxcclxufTsiXSwidmVyc2lvbiI6M30=