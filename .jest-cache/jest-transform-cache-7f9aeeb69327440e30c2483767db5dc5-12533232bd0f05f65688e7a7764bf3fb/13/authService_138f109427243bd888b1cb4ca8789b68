74cb350437623e531aed2d0c6bf839c8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.register = register;
exports.login = login;
exports.getCurrentUser = getCurrentUser;
exports.updateProfile = updateProfile;
exports.logout = logout;
exports.sendVerificationCode = sendVerificationCode;
exports.verifyPhone = verifyPhone;
exports.resendVerificationCode = resendVerificationCode;
exports.verifyCode = verifyCode;
exports.resendCode = resendCode;
const tslib_1 = require("tslib");
// src/services/authService.ts
const axios_1 = tslib_1.__importDefault(require("axios"));
/* -------------------------------------------------------------------------- */
/*                            CONFIGURAÇÃO DE URL                             */
/* -------------------------------------------------------------------------- */
function getApiUrl() {
    // Tenta pegar do process.env (funciona em Vite, Next, Node e Jest)
    const hasProcess = typeof process !== 'undefined' && typeof process.env !== 'undefined';
    const fromViteEnv = hasProcess && typeof process.env.VITE_API_URL === 'string'
        ? process.env.VITE_API_URL
        : undefined;
    const fromNextPublic = hasProcess && typeof process.env.NEXT_PUBLIC_API_URL === 'string'
        ? process.env.NEXT_PUBLIC_API_URL
        : undefined;
    // Fallback
    const finalUrl = fromViteEnv || fromNextPublic || 'http://localhost:4000';
    // Tira barras sobrando no final
    return finalUrl.replace(/\/+$/, '');
}
function extractAxiosMessage(err, fallback) {
    const axiosErr = err;
    const specific = axiosErr?.response?.data?.message;
    return typeof specific === 'string' ? specific : fallback;
}
/* -------------------------------------------------------------------------- */
/*                             FUNÇÕES DE AUTH BASE                           */
/* -------------------------------------------------------------------------- */
async function register(payload) {
    const API_URL = getApiUrl();
    const { data } = await axios_1.default.post(`${API_URL}/auth/register`, payload);
    return data;
}
async function login(payload) {
    const API_URL = getApiUrl();
    const { data } = await axios_1.default.post(`${API_URL}/auth/login`, payload);
    return data;
}
async function getCurrentUser(token) {
    const API_URL = getApiUrl();
    const headers = {};
    if (token) {
        headers.Authorization = `Bearer ${token}`;
    }
    const { data } = await axios_1.default.get(`${API_URL}/auth/me`, { headers });
    return data;
}
async function updateProfile(updates, token) {
    const API_URL = getApiUrl();
    const headers = {};
    if (token) {
        headers.Authorization = `Bearer ${token}`;
    }
    const { data } = await axios_1.default.put(`${API_URL}/auth/me`, updates, { headers });
    return data;
}
async function logout(token) {
    const API_URL = getApiUrl();
    const headers = {};
    if (token) {
        headers.Authorization = `Bearer ${token}`;
    }
    await axios_1.default.post(`${API_URL}/auth/logout`, {}, { headers });
}
/* -------------------------------------------------------------------------- */
/*                           FUNÇÕES DE VERIFICAÇÃO SMS                       */
/* -------------------------------------------------------------------------- */
async function sendVerificationCode({ userId, phone }) {
    const API_URL = getApiUrl();
    try {
        const { data } = await axios_1.default.post(`${API_URL}/sms/send-code`, { userId, phone });
        return data;
    }
    catch (err) {
        throw new Error(extractAxiosMessage(err, 'Erro ao enviar código'));
    }
}
async function verifyPhone({ userId, code }) {
    const API_URL = getApiUrl();
    try {
        const { data } = await axios_1.default.post(`${API_URL}/sms/verify-code`, { userId, code });
        return data;
    }
    catch (err) {
        throw new Error(extractAxiosMessage(err, 'Código inválido'));
    }
}
async function resendVerificationCode({ userId, phone }) {
    const API_URL = getApiUrl();
    try {
        const { data } = await axios_1.default.post(`${API_URL}/sms/resend-code`, { userId, phone });
        return data;
    }
    catch (err) {
        throw new Error(extractAxiosMessage(err, 'Erro ao reenviar código'));
    }
}
/* -------------------------------------------------------------------------- */
/*                          ALIAS DE COMPATIBILIDADE TESTE                    */
/* -------------------------------------------------------------------------- */
async function verifyCode(payload) {
    return verifyPhone(payload);
}
async function resendCode(payload) {
    return resendVerificationCode(payload);
}
/* -------------------------------------------------------------------------- */
/*                             EXPORTAÇÃO DEFAULT                             */
/* -------------------------------------------------------------------------- */
const authService = {
    register,
    login,
    getCurrentUser,
    updateProfile,
    logout,
    sendVerificationCode,
    verifyPhone,
    resendVerificationCode,
    verifyCode,
    resendCode
};
exports.default = authService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcYXV0aFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7QUF3RkEsNEJBSUM7QUFFRCxzQkFJQztBQUVELHdDQVFDO0FBRUQsc0NBV0M7QUFFRCx3QkFPQztBQU1ELG9EQWNDO0FBRUQsa0NBY0M7QUFFRCx3REFjQztBQU1ELGdDQUVDO0FBRUQsZ0NBRUM7O0FBbE1ELDhCQUE4QjtBQUM5QiwwREFBMEM7QUFFMUMsZ0ZBQWdGO0FBQ2hGLGdGQUFnRjtBQUNoRixnRkFBZ0Y7QUFFaEYsU0FBUyxTQUFTO0lBQ2hCLG1FQUFtRTtJQUNuRSxNQUFNLFVBQVUsR0FDZCxPQUFPLE9BQU8sS0FBSyxXQUFXLElBQUksT0FBTyxPQUFPLENBQUMsR0FBRyxLQUFLLFdBQVcsQ0FBQztJQUV2RSxNQUFNLFdBQVcsR0FDZixVQUFVLElBQUksT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksS0FBSyxRQUFRO1FBQ3hELENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVk7UUFDMUIsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUVoQixNQUFNLGNBQWMsR0FDbEIsVUFBVSxJQUFJLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsS0FBSyxRQUFRO1FBQy9ELENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQjtRQUNqQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBRWhCLFdBQVc7SUFDWCxNQUFNLFFBQVEsR0FBRyxXQUFXLElBQUksY0FBYyxJQUFJLHVCQUF1QixDQUFDO0lBRTFFLGdDQUFnQztJQUNoQyxPQUFPLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3RDLENBQUM7QUFFRCxTQUFTLG1CQUFtQixDQUFDLEdBQVksRUFBRSxRQUFnQjtJQUN6RCxNQUFNLFFBQVEsR0FBRyxHQUF1QyxDQUFDO0lBQ3pELE1BQU0sUUFBUSxHQUFHLFFBQVEsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQztJQUNuRCxPQUFPLE9BQU8sUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7QUFDNUQsQ0FBQztBQW1ERCxnRkFBZ0Y7QUFDaEYsZ0ZBQWdGO0FBQ2hGLGdGQUFnRjtBQUV6RSxLQUFLLFVBQVUsUUFBUSxDQUFDLE9BQXdCO0lBQ3JELE1BQU0sT0FBTyxHQUFHLFNBQVMsRUFBRSxDQUFDO0lBQzVCLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGVBQUssQ0FBQyxJQUFJLENBQWUsR0FBRyxPQUFPLGdCQUFnQixFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JGLE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVNLEtBQUssVUFBVSxLQUFLLENBQUMsT0FBcUI7SUFDL0MsTUFBTSxPQUFPLEdBQUcsU0FBUyxFQUFFLENBQUM7SUFDNUIsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sZUFBSyxDQUFDLElBQUksQ0FBZSxHQUFHLE9BQU8sYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2xGLE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVNLEtBQUssVUFBVSxjQUFjLENBQUMsS0FBYztJQUNqRCxNQUFNLE9BQU8sR0FBRyxTQUFTLEVBQUUsQ0FBQztJQUM1QixNQUFNLE9BQU8sR0FBMkIsRUFBRSxDQUFDO0lBQzNDLElBQUksS0FBSyxFQUFFLENBQUM7UUFDVixPQUFPLENBQUMsYUFBYSxHQUFHLFVBQVUsS0FBSyxFQUFFLENBQUM7SUFDNUMsQ0FBQztJQUNELE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGVBQUssQ0FBQyxHQUFHLENBQVcsR0FBRyxPQUFPLFVBQVUsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDOUUsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRU0sS0FBSyxVQUFVLGFBQWEsQ0FDakMsT0FBMEIsRUFDMUIsS0FBYztJQUVkLE1BQU0sT0FBTyxHQUFHLFNBQVMsRUFBRSxDQUFDO0lBQzVCLE1BQU0sT0FBTyxHQUEyQixFQUFFLENBQUM7SUFDM0MsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUNWLE9BQU8sQ0FBQyxhQUFhLEdBQUcsVUFBVSxLQUFLLEVBQUUsQ0FBQztJQUM1QyxDQUFDO0lBQ0QsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FBVyxHQUFHLE9BQU8sVUFBVSxFQUFFLE9BQU8sRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDdkYsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRU0sS0FBSyxVQUFVLE1BQU0sQ0FBQyxLQUFjO0lBQ3pDLE1BQU0sT0FBTyxHQUFHLFNBQVMsRUFBRSxDQUFDO0lBQzVCLE1BQU0sT0FBTyxHQUEyQixFQUFFLENBQUM7SUFDM0MsSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUNWLE9BQU8sQ0FBQyxhQUFhLEdBQUcsVUFBVSxLQUFLLEVBQUUsQ0FBQztJQUM1QyxDQUFDO0lBQ0QsTUFBTSxlQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsT0FBTyxjQUFjLEVBQUUsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztBQUM5RCxDQUFDO0FBRUQsZ0ZBQWdGO0FBQ2hGLGdGQUFnRjtBQUNoRixnRkFBZ0Y7QUFFekUsS0FBSyxVQUFVLG9CQUFvQixDQUFDLEVBQ3pDLE1BQU0sRUFDTixLQUFLLEVBQ21CO0lBQ3hCLE1BQU0sT0FBTyxHQUFHLFNBQVMsRUFBRSxDQUFDO0lBQzVCLElBQUksQ0FBQztRQUNILE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGVBQUssQ0FBQyxJQUFJLENBQy9CLEdBQUcsT0FBTyxnQkFBZ0IsRUFDMUIsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQ2xCLENBQUM7UUFDRixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLEVBQUUsdUJBQXVCLENBQUMsQ0FBQyxDQUFDO0lBQ3JFLENBQUM7QUFDSCxDQUFDO0FBRU0sS0FBSyxVQUFVLFdBQVcsQ0FBQyxFQUNoQyxNQUFNLEVBQ04sSUFBSSxFQUNlO0lBQ25CLE1BQU0sT0FBTyxHQUFHLFNBQVMsRUFBRSxDQUFDO0lBQzVCLElBQUksQ0FBQztRQUNILE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGVBQUssQ0FBQyxJQUFJLENBQy9CLEdBQUcsT0FBTyxrQkFBa0IsRUFDNUIsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQ2pCLENBQUM7UUFDRixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLEVBQUUsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO0lBQy9ELENBQUM7QUFDSCxDQUFDO0FBRU0sS0FBSyxVQUFVLHNCQUFzQixDQUFDLEVBQzNDLE1BQU0sRUFDTixLQUFLLEVBQ3FCO0lBQzFCLE1BQU0sT0FBTyxHQUFHLFNBQVMsRUFBRSxDQUFDO0lBQzVCLElBQUksQ0FBQztRQUNILE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLGVBQUssQ0FBQyxJQUFJLENBQy9CLEdBQUcsT0FBTyxrQkFBa0IsRUFDNUIsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQ2xCLENBQUM7UUFDRixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLEVBQUUseUJBQXlCLENBQUMsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7QUFDSCxDQUFDO0FBRUQsZ0ZBQWdGO0FBQ2hGLGdGQUFnRjtBQUNoRixnRkFBZ0Y7QUFFekUsS0FBSyxVQUFVLFVBQVUsQ0FBQyxPQUEyQjtJQUMxRCxPQUFPLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM5QixDQUFDO0FBRU0sS0FBSyxVQUFVLFVBQVUsQ0FBQyxPQUFrQztJQUNqRSxPQUFPLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3pDLENBQUM7QUFFRCxnRkFBZ0Y7QUFDaEYsZ0ZBQWdGO0FBQ2hGLGdGQUFnRjtBQUVoRixNQUFNLFdBQVcsR0FBRztJQUNsQixRQUFRO0lBQ1IsS0FBSztJQUNMLGNBQWM7SUFDZCxhQUFhO0lBQ2IsTUFBTTtJQUNOLG9CQUFvQjtJQUNwQixXQUFXO0lBQ1gsc0JBQXNCO0lBQ3RCLFVBQVU7SUFDVixVQUFVO0NBQ1gsQ0FBQztBQUVGLGtCQUFlLFdBQVcsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXHNlcnZpY2VzXFxhdXRoU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmljZXMvYXV0aFNlcnZpY2UudHNcclxuaW1wb3J0IGF4aW9zLCB7IEF4aW9zRXJyb3IgfSBmcm9tICdheGlvcyc7XHJcblxyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG4vKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDT05GSUdVUkHDh8ODTyBERSBVUkwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcblxyXG5mdW5jdGlvbiBnZXRBcGlVcmwoKTogc3RyaW5nIHtcclxuICAvLyBUZW50YSBwZWdhciBkbyBwcm9jZXNzLmVudiAoZnVuY2lvbmEgZW0gVml0ZSwgTmV4dCwgTm9kZSBlIEplc3QpXHJcbiAgY29uc3QgaGFzUHJvY2VzcyA9XHJcbiAgICB0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHByb2Nlc3MuZW52ICE9PSAndW5kZWZpbmVkJztcclxuXHJcbiAgY29uc3QgZnJvbVZpdGVFbnYgPVxyXG4gICAgaGFzUHJvY2VzcyAmJiB0eXBlb2YgcHJvY2Vzcy5lbnYuVklURV9BUElfVVJMID09PSAnc3RyaW5nJ1xyXG4gICAgICA/IHByb2Nlc3MuZW52LlZJVEVfQVBJX1VSTFxyXG4gICAgICA6IHVuZGVmaW5lZDtcclxuXHJcbiAgY29uc3QgZnJvbU5leHRQdWJsaWMgPVxyXG4gICAgaGFzUHJvY2VzcyAmJiB0eXBlb2YgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBJX1VSTCA9PT0gJ3N0cmluZydcclxuICAgICAgPyBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUElfVVJMXHJcbiAgICAgIDogdW5kZWZpbmVkO1xyXG5cclxuICAvLyBGYWxsYmFja1xyXG4gIGNvbnN0IGZpbmFsVXJsID0gZnJvbVZpdGVFbnYgfHwgZnJvbU5leHRQdWJsaWMgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6NDAwMCc7XHJcblxyXG4gIC8vIFRpcmEgYmFycmFzIHNvYnJhbmRvIG5vIGZpbmFsXHJcbiAgcmV0dXJuIGZpbmFsVXJsLnJlcGxhY2UoL1xcLyskLywgJycpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0QXhpb3NNZXNzYWdlKGVycjogdW5rbm93biwgZmFsbGJhY2s6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgYXhpb3NFcnIgPSBlcnIgYXMgQXhpb3NFcnJvcjx7IG1lc3NhZ2U/OiBzdHJpbmcgfT47XHJcbiAgY29uc3Qgc3BlY2lmaWMgPSBheGlvc0Vycj8ucmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2U7XHJcbiAgcmV0dXJuIHR5cGVvZiBzcGVjaWZpYyA9PT0gJ3N0cmluZycgPyBzcGVjaWZpYyA6IGZhbGxiYWNrO1xyXG59XHJcblxyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG4vKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFlQRVMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG5cclxuZXhwb3J0IHR5cGUgUmVnaXN0ZXJQYXlsb2FkID0ge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIHBhc3N3b3JkOiBzdHJpbmc7XHJcbiAgcGhvbmU/OiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBMb2dpblBheWxvYWQgPSB7XHJcbiAgZW1haWw6IHN0cmluZztcclxuICBwYXNzd29yZDogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgU2VuZFZlcmlmaWNhdGlvblBheWxvYWQgPSB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbiAgcGhvbmU6IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFZlcmlmeVBob25lUGF5bG9hZCA9IHtcclxuICB1c2VySWQ6IHN0cmluZztcclxuICBjb2RlOiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBSZXNlbmRWZXJpZmljYXRpb25QYXlsb2FkID0ge1xyXG4gIHVzZXJJZDogc3RyaW5nO1xyXG4gIHBob25lOiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBBdXRoVXNlciA9IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIHBob25lPzogc3RyaW5nIHwgbnVsbDtcclxuICBhdmF0YXJfdXJsPzogc3RyaW5nIHwgbnVsbDtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEF1dGhUb2tlbnMgPSB7XHJcbiAgYWNjZXNzVG9rZW46IHN0cmluZztcclxuICByZWZyZXNoVG9rZW4/OiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBBdXRoUmVzcG9uc2UgPSB7XHJcbiAgdXNlcjogQXV0aFVzZXI7XHJcbiAgdG9rZW5zPzogQXV0aFRva2VucztcclxufTtcclxuXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcbi8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGVU7Dh8OVRVMgREUgQVVUSCBCQVNFICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cclxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWdpc3RlcihwYXlsb2FkOiBSZWdpc3RlclBheWxvYWQpOiBQcm9taXNlPEF1dGhSZXNwb25zZT4ge1xyXG4gIGNvbnN0IEFQSV9VUkwgPSBnZXRBcGlVcmwoKTtcclxuICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnBvc3Q8QXV0aFJlc3BvbnNlPihgJHtBUElfVVJMfS9hdXRoL3JlZ2lzdGVyYCwgcGF5bG9hZCk7XHJcbiAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dpbihwYXlsb2FkOiBMb2dpblBheWxvYWQpOiBQcm9taXNlPEF1dGhSZXNwb25zZT4ge1xyXG4gIGNvbnN0IEFQSV9VUkwgPSBnZXRBcGlVcmwoKTtcclxuICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnBvc3Q8QXV0aFJlc3BvbnNlPihgJHtBUElfVVJMfS9hdXRoL2xvZ2luYCwgcGF5bG9hZCk7XHJcbiAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcih0b2tlbj86IHN0cmluZyk6IFByb21pc2U8QXV0aFVzZXI+IHtcclxuICBjb25zdCBBUElfVVJMID0gZ2V0QXBpVXJsKCk7XHJcbiAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xyXG4gIGlmICh0b2tlbikge1xyXG4gICAgaGVhZGVycy5BdXRob3JpemF0aW9uID0gYEJlYXJlciAke3Rva2VufWA7XHJcbiAgfVxyXG4gIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MuZ2V0PEF1dGhVc2VyPihgJHtBUElfVVJMfS9hdXRoL21lYCwgeyBoZWFkZXJzIH0pO1xyXG4gIHJldHVybiBkYXRhO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlUHJvZmlsZShcclxuICB1cGRhdGVzOiBQYXJ0aWFsPEF1dGhVc2VyPixcclxuICB0b2tlbj86IHN0cmluZ1xyXG4pOiBQcm9taXNlPEF1dGhVc2VyPiB7XHJcbiAgY29uc3QgQVBJX1VSTCA9IGdldEFwaVVybCgpO1xyXG4gIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcclxuICBpZiAodG9rZW4pIHtcclxuICAgIGhlYWRlcnMuQXV0aG9yaXphdGlvbiA9IGBCZWFyZXIgJHt0b2tlbn1gO1xyXG4gIH1cclxuICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnB1dDxBdXRoVXNlcj4oYCR7QVBJX1VSTH0vYXV0aC9tZWAsIHVwZGF0ZXMsIHsgaGVhZGVycyB9KTtcclxuICByZXR1cm4gZGF0YTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ291dCh0b2tlbj86IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gIGNvbnN0IEFQSV9VUkwgPSBnZXRBcGlVcmwoKTtcclxuICBjb25zdCBoZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XHJcbiAgaWYgKHRva2VuKSB7XHJcbiAgICBoZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgQmVhcmVyICR7dG9rZW59YDtcclxuICB9XHJcbiAgYXdhaXQgYXhpb3MucG9zdChgJHtBUElfVVJMfS9hdXRoL2xvZ291dGAsIHt9LCB7IGhlYWRlcnMgfSk7XHJcbn1cclxuXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcbi8qICAgICAgICAgICAgICAgICAgICAgICAgICAgRlVOw4fDlUVTIERFIFZFUklGSUNBw4fDg08gU01TICAgICAgICAgICAgICAgICAgICAgICAqL1xyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRWZXJpZmljYXRpb25Db2RlKHtcclxuICB1c2VySWQsXHJcbiAgcGhvbmVcclxufTogU2VuZFZlcmlmaWNhdGlvblBheWxvYWQpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZyB9PiB7XHJcbiAgY29uc3QgQVBJX1VSTCA9IGdldEFwaVVybCgpO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnBvc3Q8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nIH0+KFxyXG4gICAgICBgJHtBUElfVVJMfS9zbXMvc2VuZC1jb2RlYCxcclxuICAgICAgeyB1c2VySWQsIHBob25lIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihleHRyYWN0QXhpb3NNZXNzYWdlKGVyciwgJ0Vycm8gYW8gZW52aWFyIGPDs2RpZ28nKSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UGhvbmUoe1xyXG4gIHVzZXJJZCxcclxuICBjb2RlXHJcbn06IFZlcmlmeVBob25lUGF5bG9hZCk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nIH0+IHtcclxuICBjb25zdCBBUElfVVJMID0gZ2V0QXBpVXJsKCk7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MucG9zdDx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmcgfT4oXHJcbiAgICAgIGAke0FQSV9VUkx9L3Ntcy92ZXJpZnktY29kZWAsXHJcbiAgICAgIHsgdXNlcklkLCBjb2RlIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihleHRyYWN0QXhpb3NNZXNzYWdlKGVyciwgJ0PDs2RpZ28gaW52w6FsaWRvJykpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc2VuZFZlcmlmaWNhdGlvbkNvZGUoe1xyXG4gIHVzZXJJZCxcclxuICBwaG9uZVxyXG59OiBSZXNlbmRWZXJpZmljYXRpb25QYXlsb2FkKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmcgfT4ge1xyXG4gIGNvbnN0IEFQSV9VUkwgPSBnZXRBcGlVcmwoKTtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBheGlvcy5wb3N0PHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZyB9PihcclxuICAgICAgYCR7QVBJX1VSTH0vc21zL3Jlc2VuZC1jb2RlYCxcclxuICAgICAgeyB1c2VySWQsIHBob25lIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihleHRyYWN0QXhpb3NNZXNzYWdlKGVyciwgJ0Vycm8gYW8gcmVlbnZpYXIgY8OzZGlnbycpKTtcclxuICB9XHJcbn1cclxuXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcbi8qICAgICAgICAgICAgICAgICAgICAgICAgICBBTElBUyBERSBDT01QQVRJQklMSURBREUgVEVTVEUgICAgICAgICAgICAgICAgICAgICovXHJcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5Q29kZShwYXlsb2FkOiBWZXJpZnlQaG9uZVBheWxvYWQpIHtcclxuICByZXR1cm4gdmVyaWZ5UGhvbmUocGF5bG9hZCk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXNlbmRDb2RlKHBheWxvYWQ6IFJlc2VuZFZlcmlmaWNhdGlvblBheWxvYWQpIHtcclxuICByZXR1cm4gcmVzZW5kVmVyaWZpY2F0aW9uQ29kZShwYXlsb2FkKTtcclxufVxyXG5cclxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cclxuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVYUE9SVEHDh8ODTyBERUZBVUxUICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xyXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xyXG5cclxuY29uc3QgYXV0aFNlcnZpY2UgPSB7XHJcbiAgcmVnaXN0ZXIsXHJcbiAgbG9naW4sXHJcbiAgZ2V0Q3VycmVudFVzZXIsXHJcbiAgdXBkYXRlUHJvZmlsZSxcclxuICBsb2dvdXQsXHJcbiAgc2VuZFZlcmlmaWNhdGlvbkNvZGUsXHJcbiAgdmVyaWZ5UGhvbmUsXHJcbiAgcmVzZW5kVmVyaWZpY2F0aW9uQ29kZSxcclxuICB2ZXJpZnlDb2RlLFxyXG4gIHJlc2VuZENvZGVcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGF1dGhTZXJ2aWNlOyJdLCJ2ZXJzaW9uIjozfQ==