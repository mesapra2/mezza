e9b34f249f6f6e9b45aaaeb8f782affc
"use strict";
// src/services/EventStatusService.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => ({
    supabase: {
        from: mockFrom
    }
}));
// Mock dos outros serviços
jest.mock('./EventSecurityService', () => ({
    __esModule: true,
    default: {
        generateAndSavePassword: jest.fn(),
        lockEventEntry: jest.fn(),
    },
}));
jest.mock('./PushNotificationService', () => ({
    __esModule: true,
    default: {
        sendPasswordToHost: jest.fn(),
        sendEventStartNotificationToParticipants: jest.fn(),
    },
}));
jest.mock('./TrustScoreService', () => ({
    __esModule: true,
    default: {
        penalizeNoShowsForEvent: jest.fn(),
    },
}));
// --- 1. MOCKING DEPENDÊNCIAS (ANTES DAS IMPORTAÇÕES) ---
// Mock do Supabase
const mockFrom = jest.fn();
// --- 2. IMPORTAÇÕES (DEPOIS DOS MOCKS) ---
const EventStatusService_1 = tslib_1.__importDefault(require("./EventStatusService"));
const EventSecurityService_1 = tslib_1.__importDefault(require("./EventSecurityService"));
const PushNotificationService_1 = tslib_1.__importDefault(require("./PushNotificationService"));
const TrustScoreService_1 = tslib_1.__importDefault(require("./TrustScoreService"));
// --- 3. CONFIGURAÇÃO DOS TESTES ---
describe('EventStatusService', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        jest.useFakeTimers();
    });
    afterEach(() => {
        EventStatusService_1.default.stopAutoUpdate();
        jest.useRealTimers();
    });
    // --- 4. TESTES ---
    describe('Gerenciamento de Auto-Update', () => {
        it('should start auto-update e ser "running"', () => {
            // Mock vazio para não executar lógica real
            mockFrom.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [], error: null })
                    })
                })
            });
            const intervalId = EventStatusService_1.default.startAutoUpdate(30);
            expect(intervalId).toBeDefined();
            expect(EventStatusService_1.default.isAutoUpdateRunning()).toBe(true);
        });
        it('should stop auto-update', () => {
            mockFrom.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [], error: null })
                    })
                })
            });
            EventStatusService_1.default.startAutoUpdate(30);
            expect(EventStatusService_1.default.isAutoUpdateRunning()).toBe(true);
            EventStatusService_1.default.stopAutoUpdate();
            expect(EventStatusService_1.default.isAutoUpdateRunning()).toBe(false);
        });
    });
    describe('updateEventStatus', () => {
        it('deve chamar supabase.update com os parâmetros corretos', async () => {
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                update: mockUpdate
            });
            await EventStatusService_1.default.updateEventStatus(123, 'NovoStatus');
            expect(mockFrom).toHaveBeenCalledWith('events');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({
                status: 'NovoStatus',
            }));
            expect(mockEq).toHaveBeenCalledWith('id', 123);
        });
    });
    describe('Lógica de Status (updateAllEventStatuses)', () => {
        const now = new Date('2025-10-01T10:00:00Z');
        beforeEach(() => {
            jest.setSystemTime(now);
        });
        it('deve mudar status para "Em Andamento" quando a hora de início for atingida', async () => {
            const event = {
                id: 1,
                status: 'Aberto',
                start_time: '2025-10-01T09:59:59Z',
                end_time: '2025-10-01T12:00:00Z',
            };
            // Primeira chamada: buscar eventos
            // Segunda chamada: atualizar status
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                .mockReturnValueOnce({
                update: mockUpdate
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(mockFrom).toHaveBeenCalledWith('events');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'Em Andamento' }));
            expect(mockEq).toHaveBeenCalledWith('id', 1);
        });
        it('deve gerar senha e enviar push 1 minuto antes do evento', async () => {
            const startTime = new Date('2025-10-01T10:01:00Z');
            const event = {
                id: 2,
                status: 'Aberto',
                start_time: startTime.toISOString(),
                end_time: '2025-10-01T12:00:00Z',
                creator_id: 'host-id',
                title: 'Evento Teste',
                event_entry_password: null,
            };
            // Mock das funções dos serviços
            EventSecurityService_1.default.generateAndSavePassword.mockResolvedValue({
                success: true,
                password: 'mock-123'
            });
            PushNotificationService_1.default.sendPasswordToHost.mockResolvedValue({
                success: true
            });
            PushNotificationService_1.default.sendEventStartNotificationToParticipants.mockResolvedValue({
                success: true
            });
            mockFrom
                // 1. Buscar eventos
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                // 2. Buscar host profile
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: { username: 'Host' },
                            error: null
                        })
                    })
                })
            })
                // 3. Buscar participantes
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        eq: jest.fn().mockResolvedValue({
                            data: [{ user_id: 'part-1' }],
                            error: null
                        })
                    })
                })
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(EventSecurityService_1.default.generateAndSavePassword).toHaveBeenCalledWith(2);
            expect(PushNotificationService_1.default.sendPasswordToHost).toHaveBeenCalledWith('host-id', 2, 'mock-123', 'Evento Teste');
            expect(PushNotificationService_1.default.sendEventStartNotificationToParticipants).toHaveBeenCalledWith(['part-1'], 2, 'Evento Teste');
        });
        it('deve bloquear entrada 1 minuto antes do fim', async () => {
            const endTime = new Date('2025-10-01T10:01:00Z');
            const event = {
                id: 3,
                status: 'Em Andamento',
                start_time: '2025-10-01T09:00:00Z',
                end_time: endTime.toISOString(),
                entry_locked: false,
            };
            EventSecurityService_1.default.lockEventEntry.mockResolvedValue({
                success: true
            });
            mockFrom.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(EventSecurityService_1.default.lockEventEntry).toHaveBeenCalledWith(3);
        });
        it('deve mudar status para "Finalizado" e penalizar quem não foi', async () => {
            const endTime = new Date('2025-10-01T09:59:59Z');
            const event = {
                id: 4,
                status: 'Em Andamento',
                start_time: '2025-10-01T08:00:00Z',
                end_time: endTime.toISOString(),
            };
            TrustScoreService_1.default.penalizeNoShowsForEvent.mockResolvedValue(undefined);
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom
                // 1. Buscar eventos
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                // 2. Atualizar status
                .mockReturnValueOnce({
                update: mockUpdate
            })
                // 3. Buscar participações (para shouldAutoComplete)
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        eq: jest.fn().mockResolvedValue({ data: [], error: null })
                    })
                })
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'Finalizado' }));
            expect(TrustScoreService_1.default.penalizeNoShowsForEvent).toHaveBeenCalledWith(4);
        });
        it('deve mudar status para "Concluído" se todos avaliaram', async () => {
            const endTime = new Date('2025-10-01T09:59:59Z'); // 1 segundo atrás (evento acabou de terminar)
            const event = {
                id: 5,
                status: 'Em Andamento', // Status ANTES de finalizar
                start_time: '2025-10-01T08:00:00Z',
                end_time: endTime.toISOString(),
            };
            const participants = [
                { id: 'p1', presenca_confirmada: true, avaliacao_feita: true, status: 'aprovado' },
                { id: 'p2', presenca_confirmada: false, avaliacao_feita: false, status: 'aprovado' },
                { id: 'p3', presenca_confirmada: true, avaliacao_feita: true, status: 'aprovado' },
            ];
            TrustScoreService_1.default.penalizeNoShowsForEvent.mockResolvedValue(undefined);
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom
                // 1. Buscar eventos
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                // 2. Atualizar para "Finalizado"
                .mockReturnValueOnce({
                update: mockUpdate
            })
                // 3. Buscar participações (para shouldAutoComplete)
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        eq: jest.fn().mockResolvedValue({ data: participants, error: null })
                    })
                })
            })
                // 4. Atualizar para "Concluído"
                .mockReturnValueOnce({
                update: mockUpdate
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            // Verifica que foi chamado 2 vezes: uma para Finalizado, outra para Concluído
            expect(mockUpdate).toHaveBeenCalledTimes(2);
            expect(mockUpdate).toHaveBeenNthCalledWith(1, expect.objectContaining({ status: 'Finalizado' }));
            expect(mockUpdate).toHaveBeenNthCalledWith(2, expect.objectContaining({ status: 'Concluído' }));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRTdGF0dXNTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBLDBDQUEwQzs7O0FBTzFDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN4QyxRQUFRLEVBQUU7UUFDUixJQUFJLEVBQUUsUUFBUTtLQUNmO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFFSiwyQkFBMkI7QUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3pDLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLE9BQU8sRUFBRTtRQUNQLHVCQUF1QixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEMsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDMUI7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM1QyxVQUFVLEVBQUUsSUFBSTtJQUNoQixPQUFPLEVBQUU7UUFDUCxrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzdCLHdDQUF3QyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDcEQ7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN0QyxVQUFVLEVBQUUsSUFBSTtJQUNoQixPQUFPLEVBQUU7UUFDUCx1QkFBdUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ25DO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFqQ0osMERBQTBEO0FBRTFELG1CQUFtQjtBQUNuQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFnQzNCLDRDQUE0QztBQUU1QyxzRkFBc0Q7QUFFdEQsMEZBQTBEO0FB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RUFBRSxDQUFDLENBQ2pELENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRTdGF0dXNTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL0V2ZW50U3RhdHVzU2VydmljZS50ZXN0LnRzXHJcblxyXG4vLyAtLS0gMS4gTU9DS0lORyBERVBFTkTDik5DSUFTIChBTlRFUyBEQVMgSU1QT1JUQcOHw5VFUykgLS0tXHJcblxyXG4vLyBNb2NrIGRvIFN1cGFiYXNlXHJcbmNvbnN0IG1vY2tGcm9tID0gamVzdC5mbigpO1xyXG5cclxuamVzdC5tb2NrKCcuLi9saWIvc3VwYWJhc2VDbGllbnQnLCAoKSA9PiAoe1xyXG4gIHN1cGFiYXNlOiB7XHJcbiAgICBmcm9tOiBtb2NrRnJvbVxyXG4gIH1cclxufSkpO1xyXG5cclxuLy8gTW9jayBkb3Mgb3V0cm9zIHNlcnZpw6dvc1xyXG5qZXN0Lm1vY2soJy4vRXZlbnRTZWN1cml0eVNlcnZpY2UnLCAoKSA9PiAoe1xyXG4gIF9fZXNNb2R1bGU6IHRydWUsXHJcbiAgZGVmYXVsdDoge1xyXG4gICAgZ2VuZXJhdGVBbmRTYXZlUGFzc3dvcmQ6IGplc3QuZm4oKSxcclxuICAgIGxvY2tFdmVudEVudHJ5OiBqZXN0LmZuKCksXHJcbiAgfSxcclxufSkpO1xyXG5cclxuamVzdC5tb2NrKCcuL1B1c2hOb3RpZmljYXRpb25TZXJ2aWNlJywgKCkgPT4gKHtcclxuICBfX2VzTW9kdWxlOiB0cnVlLFxyXG4gIGRlZmF1bHQ6IHtcclxuICAgIHNlbmRQYXNzd29yZFRvSG9zdDogamVzdC5mbigpLFxyXG4gICAgc2VuZEV2ZW50U3RhcnROb3RpZmljYXRpb25Ub1BhcnRpY2lwYW50czogamVzdC5mbigpLFxyXG4gIH0sXHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnLi9UcnVzdFNjb3JlU2VydmljZScsICgpID0+ICh7XHJcbiAgX19lc01vZHVsZTogdHJ1ZSxcclxuICBkZWZhdWx0OiB7XHJcbiAgICBwZW5hbGl6ZU5vU2hvd3NGb3JFdmVudDogamVzdC5mbigpLFxyXG4gIH0sXHJcbn0pKTtcclxuXHJcbi8vIC0tLSAyLiBJTVBPUlRBw4fDlUVTIChERVBPSVMgRE9TIE1PQ0tTKSAtLS1cclxuXHJcbmltcG9ydCBFdmVudFN0YXR1c1NlcnZpY2UgZnJvbSAnLi9FdmVudFN0YXR1c1NlcnZpY2UnO1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJy4uL2xpYi9zdXBhYmFzZUNsaWVudCc7XHJcbmltcG9ydCBFdmVudFNlY3VyaXR5U2VydmljZSBmcm9tICcuL0V2ZW50U2VjdXJpdHlTZXJ2aWNlJztcclxuaW1wb3J0IFB1c2hOb3RpZmljYXRpb25TZXJ2aWNlIGZyb20gJy4vUHVzaE5vdGlmaWNhdGlvblNlcnZpY2UnO1xyXG5pbXBvcnQgVHJ1c3RTY29yZVNlcnZpY2UgZnJvbSAnLi9UcnVzdFNjb3JlU2VydmljZSc7XHJcblxyXG4vLyAtLS0gMy4gQ09ORklHVVJBw4fDg08gRE9TIFRFU1RFUyAtLS1cclxuXHJcbmRlc2NyaWJlKCdFdmVudFN0YXR1c1NlcnZpY2UnLCAoKSA9PiB7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIEV2ZW50U3RhdHVzU2VydmljZS5zdG9wQXV0b1VwZGF0ZSgpO1xyXG4gICAgamVzdC51c2VSZWFsVGltZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIC0tLSA0LiBURVNURVMgLS0tXHJcblxyXG4gIGRlc2NyaWJlKCdHZXJlbmNpYW1lbnRvIGRlIEF1dG8tVXBkYXRlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBzdGFydCBhdXRvLXVwZGF0ZSBlIHNlciBcInJ1bm5pbmdcIicsICgpID0+IHtcclxuICAgICAgLy8gTW9jayB2YXppbyBwYXJhIG7Do28gZXhlY3V0YXIgbMOzZ2ljYSByZWFsXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgaW50ZXJ2YWxJZCA9IEV2ZW50U3RhdHVzU2VydmljZS5zdGFydEF1dG9VcGRhdGUoMzApO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGludGVydmFsSWQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChFdmVudFN0YXR1c1NlcnZpY2UuaXNBdXRvVXBkYXRlUnVubmluZygpKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBzdG9wIGF1dG8tdXBkYXRlJywgKCkgPT4ge1xyXG4gICAgICBtb2NrRnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICBuZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBuZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IFtdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIEV2ZW50U3RhdHVzU2VydmljZS5zdGFydEF1dG9VcGRhdGUoMzApO1xyXG4gICAgICBleHBlY3QoRXZlbnRTdGF0dXNTZXJ2aWNlLmlzQXV0b1VwZGF0ZVJ1bm5pbmcoKSkudG9CZSh0cnVlKTtcclxuXHJcbiAgICAgIEV2ZW50U3RhdHVzU2VydmljZS5zdG9wQXV0b1VwZGF0ZSgpO1xyXG4gICAgICBleHBlY3QoRXZlbnRTdGF0dXNTZXJ2aWNlLmlzQXV0b1VwZGF0ZVJ1bm5pbmcoKSkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3VwZGF0ZUV2ZW50U3RhdHVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgY2hhbWFyIHN1cGFiYXNlLnVwZGF0ZSBjb20gb3MgcGFyw6JtZXRyb3MgY29ycmV0b3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEgfSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrRnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVwZGF0ZTogbW9ja1VwZGF0ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGF3YWl0IEV2ZW50U3RhdHVzU2VydmljZS51cGRhdGVFdmVudFN0YXR1cygxMjMsICdOb3ZvU3RhdHVzJyk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja0Zyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudHMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIHN0YXR1czogJ05vdm9TdGF0dXMnLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChtb2NrRXEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpZCcsIDEyMyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0zDs2dpY2EgZGUgU3RhdHVzICh1cGRhdGVBbGxFdmVudFN0YXR1c2VzKScsICgpID0+IHtcclxuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCcyMDI1LTEwLTAxVDEwOjAwOjAwWicpO1xyXG4gICAgXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgamVzdC5zZXRTeXN0ZW1UaW1lKG5vdyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBtdWRhciBzdGF0dXMgcGFyYSBcIkVtIEFuZGFtZW50b1wiIHF1YW5kbyBhIGhvcmEgZGUgaW7DrWNpbyBmb3IgYXRpbmdpZGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV2ZW50ID0ge1xyXG4gICAgICAgIGlkOiAxLFxyXG4gICAgICAgIHN0YXR1czogJ0FiZXJ0bycsXHJcbiAgICAgICAgc3RhcnRfdGltZTogJzIwMjUtMTAtMDFUMDk6NTk6NTlaJyxcclxuICAgICAgICBlbmRfdGltZTogJzIwMjUtMTAtMDFUMTI6MDA6MDBaJyxcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFByaW1laXJhIGNoYW1hZGE6IGJ1c2NhciBldmVudG9zXHJcbiAgICAgIC8vIFNlZ3VuZGEgY2hhbWFkYTogYXR1YWxpemFyIHN0YXR1c1xyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxIH0pO1xyXG4gICAgICBcclxuICAgICAgbW9ja0Zyb21cclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBuZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW2V2ZW50XSwgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICB1cGRhdGU6IG1vY2tVcGRhdGVcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgIGF3YWl0IEV2ZW50U3RhdHVzU2VydmljZS51cGRhdGVBbGxFdmVudFN0YXR1c2VzKCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja0Zyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudHMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgc3RhdHVzOiAnRW0gQW5kYW1lbnRvJyB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QobW9ja0VxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaWQnLCAxKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIGdlcmFyIHNlbmhhIGUgZW52aWFyIHB1c2ggMSBtaW51dG8gYW50ZXMgZG8gZXZlbnRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgnMjAyNS0xMC0wMVQxMDowMTowMFonKTtcclxuICAgICAgY29uc3QgZXZlbnQgPSB7XHJcbiAgICAgICAgaWQ6IDIsXHJcbiAgICAgICAgc3RhdHVzOiAnQWJlcnRvJyxcclxuICAgICAgICBzdGFydF90aW1lOiBzdGFydFRpbWUudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBlbmRfdGltZTogJzIwMjUtMTAtMDFUMTI6MDA6MDBaJyxcclxuICAgICAgICBjcmVhdG9yX2lkOiAnaG9zdC1pZCcsXHJcbiAgICAgICAgdGl0bGU6ICdFdmVudG8gVGVzdGUnLFxyXG4gICAgICAgIGV2ZW50X2VudHJ5X3Bhc3N3b3JkOiBudWxsLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gTW9jayBkYXMgZnVuw6fDtWVzIGRvcyBzZXJ2acOnb3NcclxuICAgICAgKEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmdlbmVyYXRlQW5kU2F2ZVBhc3N3b3JkIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgcGFzc3dvcmQ6ICdtb2NrLTEyMydcclxuICAgICAgfSk7XHJcbiAgICAgIChQdXNoTm90aWZpY2F0aW9uU2VydmljZS5zZW5kUGFzc3dvcmRUb0hvc3QgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZVxyXG4gICAgICB9KTtcclxuICAgICAgKFB1c2hOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRFdmVudFN0YXJ0Tm90aWZpY2F0aW9uVG9QYXJ0aWNpcGFudHMgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tXHJcbiAgICAgICAgLy8gMS4gQnVzY2FyIGV2ZW50b3NcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBuZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW2V2ZW50XSwgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyAyLiBCdXNjYXIgaG9zdCBwcm9maWxlXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2Uoe1xyXG4gICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IHsgdXNlcm5hbWU6ICdIb3N0JyB9LFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIDMuIEJ1c2NhciBwYXJ0aWNpcGFudGVzXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2Uoe1xyXG4gICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgZGF0YTogW3sgdXNlcl9pZDogJ3BhcnQtMScgfV0sXHJcbiAgICAgICAgICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgYXdhaXQgRXZlbnRTdGF0dXNTZXJ2aWNlLnVwZGF0ZUFsbEV2ZW50U3RhdHVzZXMoKTtcclxuXHJcbiAgICAgIGV4cGVjdChFdmVudFNlY3VyaXR5U2VydmljZS5nZW5lcmF0ZUFuZFNhdmVQYXNzd29yZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMik7XHJcbiAgICAgIGV4cGVjdChQdXNoTm90aWZpY2F0aW9uU2VydmljZS5zZW5kUGFzc3dvcmRUb0hvc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICdob3N0LWlkJyxcclxuICAgICAgICAyLFxyXG4gICAgICAgICdtb2NrLTEyMycsXHJcbiAgICAgICAgJ0V2ZW50byBUZXN0ZSdcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KFB1c2hOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRFdmVudFN0YXJ0Tm90aWZpY2F0aW9uVG9QYXJ0aWNpcGFudHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIFsncGFydC0xJ10sXHJcbiAgICAgICAgMixcclxuICAgICAgICAnRXZlbnRvIFRlc3RlJ1xyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGl0KCdkZXZlIGJsb3F1ZWFyIGVudHJhZGEgMSBtaW51dG8gYW50ZXMgZG8gZmltJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlbmRUaW1lID0gbmV3IERhdGUoJzIwMjUtMTAtMDFUMTA6MDE6MDBaJyk7XHJcbiAgICAgIGNvbnN0IGV2ZW50ID0ge1xyXG4gICAgICAgIGlkOiAzLFxyXG4gICAgICAgIHN0YXR1czogJ0VtIEFuZGFtZW50bycsXHJcbiAgICAgICAgc3RhcnRfdGltZTogJzIwMjUtMTAtMDFUMDk6MDA6MDBaJyxcclxuICAgICAgICBlbmRfdGltZTogZW5kVGltZS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIGVudHJ5X2xvY2tlZDogZmFsc2UsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAoRXZlbnRTZWN1cml0eVNlcnZpY2UubG9ja0V2ZW50RW50cnkgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW2V2ZW50XSwgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBhd2FpdCBFdmVudFN0YXR1c1NlcnZpY2UudXBkYXRlQWxsRXZlbnRTdGF0dXNlcygpO1xyXG5cclxuICAgICAgZXhwZWN0KEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmxvY2tFdmVudEVudHJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG11ZGFyIHN0YXR1cyBwYXJhIFwiRmluYWxpemFkb1wiIGUgcGVuYWxpemFyIHF1ZW0gbsOjbyBmb2knLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgnMjAyNS0xMC0wMVQwOTo1OTo1OVonKTtcclxuICAgICAgY29uc3QgZXZlbnQgPSB7XHJcbiAgICAgICAgaWQ6IDQsXHJcbiAgICAgICAgc3RhdHVzOiAnRW0gQW5kYW1lbnRvJyxcclxuICAgICAgICBzdGFydF90aW1lOiAnMjAyNS0xMC0wMVQwODowMDowMFonLFxyXG4gICAgICAgIGVuZF90aW1lOiBlbmRUaW1lLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAoVHJ1c3RTY29yZVNlcnZpY2UucGVuYWxpemVOb1Nob3dzRm9yRXZlbnQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG5cclxuICAgICAgY29uc3QgbW9ja0VxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcSB9KTtcclxuXHJcbiAgICAgIG1vY2tGcm9tXHJcbiAgICAgICAgLy8gMS4gQnVzY2FyIGV2ZW50b3NcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBuZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW2V2ZW50XSwgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyAyLiBBdHVhbGl6YXIgc3RhdHVzXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2Uoe1xyXG4gICAgICAgICAgdXBkYXRlOiBtb2NrVXBkYXRlXHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyAzLiBCdXNjYXIgcGFydGljaXBhw6fDtWVzIChwYXJhIHNob3VsZEF1dG9Db21wbGV0ZSlcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IFtdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IEV2ZW50U3RhdHVzU2VydmljZS51cGRhdGVBbGxFdmVudFN0YXR1c2VzKCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBzdGF0dXM6ICdGaW5hbGl6YWRvJyB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QoVHJ1c3RTY29yZVNlcnZpY2UucGVuYWxpemVOb1Nob3dzRm9yRXZlbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgbXVkYXIgc3RhdHVzIHBhcmEgXCJDb25jbHXDrWRvXCIgc2UgdG9kb3MgYXZhbGlhcmFtJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlbmRUaW1lID0gbmV3IERhdGUoJzIwMjUtMTAtMDFUMDk6NTk6NTlaJyk7IC8vIDEgc2VndW5kbyBhdHLDoXMgKGV2ZW50byBhY2Fib3UgZGUgdGVybWluYXIpXHJcbiAgICAgIGNvbnN0IGV2ZW50ID0ge1xyXG4gICAgICAgIGlkOiA1LFxyXG4gICAgICAgIHN0YXR1czogJ0VtIEFuZGFtZW50bycsIC8vIFN0YXR1cyBBTlRFUyBkZSBmaW5hbGl6YXJcclxuICAgICAgICBzdGFydF90aW1lOiAnMjAyNS0xMC0wMVQwODowMDowMFonLFxyXG4gICAgICAgIGVuZF90aW1lOiBlbmRUaW1lLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSBbXHJcbiAgICAgICAgeyBpZDogJ3AxJywgcHJlc2VuY2FfY29uZmlybWFkYTogdHJ1ZSwgYXZhbGlhY2FvX2ZlaXRhOiB0cnVlLCBzdGF0dXM6ICdhcHJvdmFkbycgfSxcclxuICAgICAgICB7IGlkOiAncDInLCBwcmVzZW5jYV9jb25maXJtYWRhOiBmYWxzZSwgYXZhbGlhY2FvX2ZlaXRhOiBmYWxzZSwgc3RhdHVzOiAnYXByb3ZhZG8nIH0sXHJcbiAgICAgICAgeyBpZDogJ3AzJywgcHJlc2VuY2FfY29uZmlybWFkYTogdHJ1ZSwgYXZhbGlhY2FvX2ZlaXRhOiB0cnVlLCBzdGF0dXM6ICdhcHJvdmFkbycgfSxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIChUcnVzdFNjb3JlU2VydmljZS5wZW5hbGl6ZU5vU2hvd3NGb3JFdmVudCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcblxyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb21cclxuICAgICAgICAvLyAxLiBCdXNjYXIgZXZlbnRvc1xyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBbZXZlbnRdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIDIuIEF0dWFsaXphciBwYXJhIFwiRmluYWxpemFkb1wiXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2Uoe1xyXG4gICAgICAgICAgdXBkYXRlOiBtb2NrVXBkYXRlXHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyAzLiBCdXNjYXIgcGFydGljaXBhw6fDtWVzIChwYXJhIHNob3VsZEF1dG9Db21wbGV0ZSlcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHBhcnRpY2lwYW50cywgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyA0LiBBdHVhbGl6YXIgcGFyYSBcIkNvbmNsdcOtZG9cIlxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHVwZGF0ZTogbW9ja1VwZGF0ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgYXdhaXQgRXZlbnRTdGF0dXNTZXJ2aWNlLnVwZGF0ZUFsbEV2ZW50U3RhdHVzZXMoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHF1ZSBmb2kgY2hhbWFkbyAyIHZlemVzOiB1bWEgcGFyYSBGaW5hbGl6YWRvLCBvdXRyYSBwYXJhIENvbmNsdcOtZG9cclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5OdGhDYWxsZWRXaXRoKDEsXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBzdGF0dXM6ICdGaW5hbGl6YWRvJyB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMixcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHN0YXR1czogJ0NvbmNsdcOtZG8nIH0pXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9