04e79e41f1c5b0100fe2e5e934fa33c9
"use strict";
/* eslint-disable @typescript-eslint/no-explicit-any */
/* eslint-disable @typescript-eslint/no-unsafe-assignment */
/* eslint-disable @typescript-eslint/no-unsafe-call */
/* eslint-disable @typescript-eslint/no-unsafe-member-access */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => {
    const from = jest.fn();
    return {
        supabase: {
            from
        }
    };
});
// src/services/EventSecurityService.test.ts
const EventSecurityService_1 = tslib_1.__importDefault(require("./EventSecurityService"));
const supabaseClient_1 = require("../lib/supabaseClient");
describe('EventSecurityService', () => {
    const mockedSupabase = supabaseClient_1.supabase;
    beforeEach(() => {
        jest.clearAllMocks();
        jest.useRealTimers();
    });
    describe('generatePassword', () => {
        it('gera uma senha de 4 dígitos numéricos', () => {
            const password = EventSecurityService_1.default.generatePassword();
            expect(password).toMatch(/^\d{4}$/);
            expect(password.length).toBe(4);
        });
    });
    describe('savePasswordToEvent', () => {
        it('retorna erro se a senha não tiver exatamente 4 dígitos', async () => {
            const result = await EventSecurityService_1.default.savePasswordToEvent(1, '12');
            expect(result.success).toBe(false);
            expect(result.error).toBe('Senha deve ser exatamente 4 dígitos');
            expect(mockedSupabase.from).not.toHaveBeenCalled();
        });
        it('salva a senha no evento quando for válida', async () => {
            const eq = jest.fn().mockResolvedValue({ error: null });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.savePasswordToEvent(42, '1234');
            expect(result).toEqual({ success: true, password: '1234' });
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
            expect(update).toHaveBeenCalledWith(expect.objectContaining({
                event_entry_password: '1234'
            }));
            expect(eq).toHaveBeenCalledWith('id', 42);
        });
        it('propaga erro do supabase', async () => {
            const eq = jest.fn().mockResolvedValue({ error: new Error('db error') });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.savePasswordToEvent(99, '5678');
            expect(result.success).toBe(false);
            expect(result.error).toBeInstanceOf(Error);
        });
    });
    describe('generateAndSavePassword', () => {
        it('gera e salva uma senha', async () => {
            const eq = jest.fn().mockResolvedValue({ error: null });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.generateAndSavePassword(10);
            expect(result.success).toBe(true);
            expect(result.password).toMatch(/^\d{4}$/);
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
            expect(update).toHaveBeenCalled();
            expect(eq).toHaveBeenCalledWith('id', 10);
        });
    });
    describe('isEntryTimeValid', () => {
        it('retorna "Evento não encontrado" quando não há evento', async () => {
            const single = jest.fn().mockResolvedValue({ data: null, error: null });
            const eq = jest.fn(() => ({ single }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const result = await EventSecurityService_1.default.isEntryTimeValid(123);
            expect(result.allowed).toBe(false);
            expect(result.reason).toBe('Evento não encontrado');
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
        });
        it('retorna allowed=true quando está dentro da janela de entrada e status é válido', async () => {
            // agora: 2025-11-02T15:00:00Z
            jest.useFakeTimers().setSystemTime(new Date('2025-11-02T15:00:00Z'));
            const event = {
                start_time: '2025-11-02T15:00:30Z', // começa 30s depois → já passou de 1 min antes
                end_time: '2025-11-02T16:00:00Z',
                status: 'Confirmado'
            };
            const single = jest.fn().mockResolvedValue({ data: event, error: null });
            const eq = jest.fn(() => ({ single }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const result = await EventSecurityService_1.default.isEntryTimeValid(1);
            expect(result.allowed).toBe(true);
        });
    });
    describe('validateEntryPassword', () => {
        it('nega acesso quando o timing não permite', async () => {
            const timingSpy = jest
                .spyOn(EventSecurityService_1.default, 'isEntryTimeValid')
                .mockResolvedValue({ allowed: false, reason: 'Entrada encerrada' });
            const result = await EventSecurityService_1.default.validateEntryPassword({
                eventId: 1,
                participantId: 'user-1',
                password: '1234'
            });
            expect(result.success).toBe(false);
            expect(result.message).toBe('Entrada encerrada');
            expect(timingSpy).toHaveBeenCalledWith(1);
            timingSpy.mockRestore();
        });
        it('nega acesso quando a senha está errada', async () => {
            jest
                .spyOn(EventSecurityService_1.default, 'isEntryTimeValid')
                .mockResolvedValue({ allowed: true });
            // 1ª chamada: events
            const singleEvent = jest.fn().mockResolvedValue({
                data: {
                    event_entry_password: '9999',
                    status: 'Confirmado'
                },
                error: null
            });
            const eqEvent = jest.fn(() => ({ single: singleEvent }));
            const selectEvent = jest.fn(() => ({ eq: eqEvent }));
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: selectEvent
            }));
            const result = await EventSecurityService_1.default.validateEntryPassword({
                eventId: 1,
                participantId: 'user-1',
                password: '1234'
            });
            expect(result.success).toBe(false);
            expect(result.message).toBe('Senha incorreta. Tente novamente.');
        });
        it('concede acesso e registra participação quando a senha está correta', async () => {
            jest
                .spyOn(EventSecurityService_1.default, 'isEntryTimeValid')
                .mockResolvedValue({ allowed: true });
            // 1ª chamada → events
            const singleEvent = jest.fn().mockResolvedValue({
                data: {
                    event_entry_password: '1234',
                    status: 'Confirmado'
                },
                error: null
            });
            const eqEvent = jest.fn(() => ({ single: singleEvent }));
            const selectEvent = jest.fn(() => ({ eq: eqEvent }));
            // 2ª chamada → event_participants (update com dois .eq() encadeados)
            const secondEq = jest.fn().mockResolvedValue({ error: null });
            const firstEq = jest.fn(() => ({ eq: secondEq }));
            const updateParticipant = jest.fn(() => ({ eq: firstEq }));
            mockedSupabase.from
                // chamada do events
                .mockImplementationOnce(() => ({
                select: selectEvent
            }))
                // chamada do event_participants
                .mockImplementationOnce(() => ({
                update: updateParticipant
            }));
            const result = await EventSecurityService_1.default.validateEntryPassword({
                eventId: 1,
                participantId: 'user-1',
                password: '1234'
            });
            expect(result.success).toBe(true);
            expect(result.message).toBe('✅ Acesso liberado! Bem-vindo ao evento.');
            expect(updateParticipant).toHaveBeenCalledWith(expect.objectContaining({
                com_acesso: true
            }));
            expect(firstEq).toHaveBeenCalledWith('event_id', 1);
            expect(secondEq).toHaveBeenCalledWith('user_id', 'user-1');
        });
    });
    describe('hasUserAccess', () => {
        it('retorna true quando o participante já tem acesso', async () => {
            const single = jest.fn().mockResolvedValue({
                data: {
                    com_acesso: true
                },
                error: null
            });
            const secondEq = jest.fn(() => ({ single }));
            const firstEq = jest.fn(() => ({ eq: secondEq }));
            const select = jest.fn(() => ({ eq: firstEq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const hasAccess = await EventSecurityService_1.default.hasUserAccess(1, 'user-1');
            expect(hasAccess).toBe(true);
            expect(mockedSupabase.from).toHaveBeenCalledWith('event_participants');
        });
        it('retorna false quando não encontrar o participante', async () => {
            const single = jest.fn().mockResolvedValue({
                data: null,
                error: { code: 'PGRST116' }
            });
            const secondEq = jest.fn(() => ({ single }));
            const firstEq = jest.fn(() => ({ eq: secondEq }));
            const select = jest.fn(() => ({ eq: firstEq }));
            mockedSupabase.from.mockImplementation(() => ({
                select
            }));
            const hasAccess = await EventSecurityService_1.default.hasUserAccess(1, 'user-2');
            expect(hasAccess).toBe(false);
        });
    });
    describe('lockEventEntry', () => {
        it('bloqueia a entrada no evento', async () => {
            const eq = jest.fn().mockResolvedValue({ error: null });
            const update = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation(() => ({
                update
            }));
            const result = await EventSecurityService_1.default.lockEventEntry(7);
            expect(result.success).toBe(true);
            expect(mockedSupabase.from).toHaveBeenCalledWith('events');
            expect(update).toHaveBeenCalledWith(expect.objectContaining({
                entry_locked: true
            }));
            expect(eq).toHaveBeenCalledWith('id', 7);
        });
    });
    describe('getEntryStatus', () => {
        it('retorna status formatado do evento', async () => {
            // 1ª chamada → events
            mockedSupabase.from
                .mockImplementationOnce(() => ({
                select: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        single: jest.fn().mockResolvedValue({
                            data: {
                                event_entry_password: '4321',
                                entry_locked: false,
                                entry_locked_at: null,
                                entry_opened_at: '2025-11-02T14:59:00Z'
                            },
                            error: null
                        })
                    }))
                }))
            }))
                // 2ª chamada → event_participants
                .mockImplementationOnce(() => ({
                select: jest.fn(() => ({
                    eq: jest
                        .fn()
                        // eq('event_id', ...)
                        .mockImplementationOnce(() => ({
                        eq: jest.fn().mockResolvedValue({
                            data: [
                                { com_acesso: true },
                                { com_acesso: false },
                                { com_acesso: true }
                            ],
                            error: null
                        })
                    }))
                }))
            }));
            const result = await EventSecurityService_1.default.getEntryStatus(55);
            expect(result.success).toBe(true);
            expect(result.data).toEqual({
                password: '4321',
                isLocked: false,
                lockedAt: null,
                openedAt: '2025-11-02T14:59:00Z',
                totalWithAccess: 2,
                totalParticipants: 3
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRTZWN1cml0eVNlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBLHVEQUF1RDtBQUN2RCw0REFBNEQ7QUFDNUQsc0RBQXNEO0FBQ3RELCtEQUErRDs7O0FBTS9ELElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUN2QixPQUFPO1FBQ0wsUUFBUSxFQUFFO1lBQ1IsSUFBSTtTQUNMO0tBQ0YsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBWEgsNENBQTRDO0FBQzVDLDBGQUEwRDtBQUMxRCwwREFBaUQ7QUFXakQsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxNQUFNLGNBQWMsR0FBRyx5QkFFdEIsQ0FBQztJQUVGLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1lBQy9DLE1BQU0sUUFBUSxHQUFHLDhCQUFvQixDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFekQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENBQUMsd0RBQXdELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEUs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QUNqQyxzQkFBc0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO2dCQUM3QixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO29CQUNyQixFQUFFLEVBQUUsSUFBSTt5QkFDTCxFQUFFLEVBQUU7d0JBQ0wsc0JBQXNCO3lCQUNyQixzQkFBc0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO3dCQUM3QixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDOzRCQUM5QixJQUFJLEVBQUU7Z0NBQ0osRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFO2dDQUNwQixFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUU7Z0NBQ3JCLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRTs2QkFDckI7NEJBQ0QsS0FBSyxFQUFFLElBQUk7eUJBQ1osQ0FBQztxQkFDSCxDQUFDLENBQUM7aUJBQ04sQ0FBQyxDQUFDO2FBQ0osQ0FBQyxDQUFDLENBQUM7WUFFTixNQUFNLE1BQU0sR0FBRyxNQUFNLDhCQUFvQixDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUU3RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDMUIsUUFBUSxFQUFFLE1BQU07Z0JBQ2hCLFFBQVEsRUFBRSxLQUFLO2dCQUNmLFFBQVEsRUFBRSxJQUFJO2dCQUNkLFFBQVEsRUFBRSxzQkFBc0I7Z0JBQ2hDLGVBQWUsRUFBRSxDQUFDO2dCQUNsQixpQkFBaUIsRUFBRSxDQUFDO2FBQ3JCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXHNlcnZpY2VzXFxFdmVudFNlY3VyaXR5U2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXHJcbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXNzaWdubWVudCAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWNhbGwgKi9cclxuLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzICovXHJcblxyXG4vLyBzcmMvc2VydmljZXMvRXZlbnRTZWN1cml0eVNlcnZpY2UudGVzdC50c1xyXG5pbXBvcnQgRXZlbnRTZWN1cml0eVNlcnZpY2UgZnJvbSAnLi9FdmVudFNlY3VyaXR5U2VydmljZSc7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vbGliL3N1cGFiYXNlQ2xpZW50JztcclxuXHJcbmplc3QubW9jaygnLi4vbGliL3N1cGFiYXNlQ2xpZW50JywgKCkgPT4ge1xyXG4gIGNvbnN0IGZyb20gPSBqZXN0LmZuKCk7XHJcbiAgcmV0dXJuIHtcclxuICAgIHN1cGFiYXNlOiB7XHJcbiAgICAgIGZyb21cclxuICAgIH1cclxuICB9O1xyXG59KTtcclxuXHJcbmRlc2NyaWJlKCdFdmVudFNlY3VyaXR5U2VydmljZScsICgpID0+IHtcclxuICBjb25zdCBtb2NrZWRTdXBhYmFzZSA9IHN1cGFiYXNlIGFzIHVua25vd24gYXMge1xyXG4gICAgZnJvbTogamVzdC5Nb2NrO1xyXG4gIH07XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dlbmVyYXRlUGFzc3dvcmQnLCAoKSA9PiB7XHJcbiAgICBpdCgnZ2VyYSB1bWEgc2VuaGEgZGUgNCBkw61naXRvcyBudW3DqXJpY29zJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmdlbmVyYXRlUGFzc3dvcmQoKTtcclxuXHJcbiAgICAgIGV4cGVjdChwYXNzd29yZCkudG9NYXRjaCgvXlxcZHs0fSQvKTtcclxuICAgICAgZXhwZWN0KHBhc3N3b3JkLmxlbmd0aCkudG9CZSg0KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnc2F2ZVBhc3N3b3JkVG9FdmVudCcsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGVycm8gc2UgYSBzZW5oYSBuw6NvIHRpdmVyIGV4YXRhbWVudGUgNCBkw61naXRvcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2Uuc2F2ZVBhc3N3b3JkVG9FdmVudCgxLCAnMTInKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ1NlbmhhIGRldmUgc2VyIGV4YXRhbWVudGUgNCBkw61naXRvcycpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2UuZnJvbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzYWx2YSBhIHNlbmhhIG5vIGV2ZW50byBxdWFuZG8gZm9yIHbDoWxpZGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKCkgPT4gKHsgZXEgfSkpO1xyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHVwZGF0ZVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS5zYXZlUGFzc3dvcmRUb0V2ZW50KDQyLCAnMTIzNCcpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IHN1Y2Nlc3M6IHRydWUsIHBhc3N3b3JkOiAnMTIzNCcgfSk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXZlbnRzJyk7XHJcbiAgICAgIGV4cGVjdCh1cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgIGV2ZW50X2VudHJ5X3Bhc3N3b3JkOiAnMTIzNCdcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QoZXEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpZCcsIDQyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdwcm9wYWdhIGVycm8gZG8gc3VwYWJhc2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG5ldyBFcnJvcignZGIgZXJyb3InKSB9KTtcclxuICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgdXBkYXRlXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLnNhdmVQYXNzd29yZFRvRXZlbnQoOTksICc1Njc4Jyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlSW5zdGFuY2VPZihFcnJvcik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dlbmVyYXRlQW5kU2F2ZVBhc3N3b3JkJywgKCkgPT4ge1xyXG4gICAgaXQoJ2dlcmEgZSBzYWx2YSB1bWEgc2VuaGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKCkgPT4gKHsgZXEgfSkpO1xyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHVwZGF0ZVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS5nZW5lcmF0ZUFuZFNhdmVQYXNzd29yZCgxMCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucGFzc3dvcmQpLnRvTWF0Y2goL15cXGR7NH0kLyk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5mcm9tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXZlbnRzJyk7XHJcbiAgICAgIGV4cGVjdCh1cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KGVxKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaWQnLCAxMCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2lzRW50cnlUaW1lVmFsaWQnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0b3JuYSBcIkV2ZW50byBuw6NvIGVuY29udHJhZG9cIiBxdWFuZG8gbsOjbyBow6EgZXZlbnRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCgpID0+ICh7IHNpbmdsZSB9KSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHsgZXEgfSkpO1xyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS5pc0VudHJ5VGltZVZhbGlkKDEyMyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJlYXNvbikudG9CZSgnRXZlbnRvIG7Do28gZW5jb250cmFkbycpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2UuZnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50cycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldG9ybmEgYWxsb3dlZD10cnVlIHF1YW5kbyBlc3TDoSBkZW50cm8gZGEgamFuZWxhIGRlIGVudHJhZGEgZSBzdGF0dXMgw6kgdsOhbGlkbycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gYWdvcmE6IDIwMjUtMTEtMDJUMTU6MDA6MDBaXHJcbiAgICAgIGplc3QudXNlRmFrZVRpbWVycygpLnNldFN5c3RlbVRpbWUobmV3IERhdGUoJzIwMjUtMTEtMDJUMTU6MDA6MDBaJykpO1xyXG5cclxuICAgICAgY29uc3QgZXZlbnQgPSB7XHJcbiAgICAgICAgc3RhcnRfdGltZTogJzIwMjUtMTEtMDJUMTU6MDA6MzBaJywgLy8gY29tZcOnYSAzMHMgZGVwb2lzIOKGkiBqw6EgcGFzc291IGRlIDEgbWluIGFudGVzXHJcbiAgICAgICAgZW5kX3RpbWU6ICcyMDI1LTExLTAyVDE2OjAwOjAwWicsXHJcbiAgICAgICAgc3RhdHVzOiAnQ29uZmlybWFkbydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IGV2ZW50LCBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCgpID0+ICh7IHNpbmdsZSB9KSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHsgZXEgfSkpO1xyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS5pc0VudHJ5VGltZVZhbGlkKDEpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5hbGxvd2VkKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZUVudHJ5UGFzc3dvcmQnLCAoKSA9PiB7XHJcbiAgICBpdCgnbmVnYSBhY2Vzc28gcXVhbmRvIG8gdGltaW5nIG7Do28gcGVybWl0ZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdGltaW5nU3B5ID0gamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFNlY3VyaXR5U2VydmljZSwgJ2lzRW50cnlUaW1lVmFsaWQnKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFsbG93ZWQ6IGZhbHNlLCByZWFzb246ICdFbnRyYWRhIGVuY2VycmFkYScgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFNlY3VyaXR5U2VydmljZS52YWxpZGF0ZUVudHJ5UGFzc3dvcmQoe1xyXG4gICAgICAgIGV2ZW50SWQ6IDEsXHJcbiAgICAgICAgcGFydGljaXBhbnRJZDogJ3VzZXItMScsXHJcbiAgICAgICAgcGFzc3dvcmQ6ICcxMjM0J1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9CZSgnRW50cmFkYSBlbmNlcnJhZGEnKTtcclxuICAgICAgZXhwZWN0KHRpbWluZ1NweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMSk7XHJcbiAgICAgIHRpbWluZ1NweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ25lZ2EgYWNlc3NvIHF1YW5kbyBhIHNlbmhhIGVzdMOhIGVycmFkYScsIGFzeW5jICgpID0+IHtcclxuICAgICAgamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFNlY3VyaXR5U2VydmljZSwgJ2lzRW50cnlUaW1lVmFsaWQnKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFsbG93ZWQ6IHRydWUgfSk7XHJcblxyXG4gICAgICAvLyAxwqogY2hhbWFkYTogZXZlbnRzXHJcbiAgICAgIGNvbnN0IHNpbmdsZUV2ZW50ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBldmVudF9lbnRyeV9wYXNzd29yZDogJzk5OTknLFxyXG4gICAgICAgICAgc3RhdHVzOiAnQ29uZmlybWFkbydcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBlcUV2ZW50ID0gamVzdC5mbigoKSA9PiAoeyBzaW5nbGU6IHNpbmdsZUV2ZW50IH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0RXZlbnQgPSBqZXN0LmZuKCgpID0+ICh7IGVxOiBlcUV2ZW50IH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdDogc2VsZWN0RXZlbnRcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2UudmFsaWRhdGVFbnRyeVBhc3N3b3JkKHtcclxuICAgICAgICBldmVudElkOiAxLFxyXG4gICAgICAgIHBhcnRpY2lwYW50SWQ6ICd1c2VyLTEnLFxyXG4gICAgICAgIHBhc3N3b3JkOiAnMTIzNCdcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQmUoJ1NlbmhhIGluY29ycmV0YS4gVGVudGUgbm92YW1lbnRlLicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NvbmNlZGUgYWNlc3NvIGUgcmVnaXN0cmEgcGFydGljaXBhw6fDo28gcXVhbmRvIGEgc2VuaGEgZXN0w6EgY29ycmV0YScsIGFzeW5jICgpID0+IHtcclxuICAgICAgamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFNlY3VyaXR5U2VydmljZSwgJ2lzRW50cnlUaW1lVmFsaWQnKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFsbG93ZWQ6IHRydWUgfSk7XHJcblxyXG4gICAgICAvLyAxwqogY2hhbWFkYSDihpIgZXZlbnRzXHJcbiAgICAgIGNvbnN0IHNpbmdsZUV2ZW50ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBldmVudF9lbnRyeV9wYXNzd29yZDogJzEyMzQnLFxyXG4gICAgICAgICAgc3RhdHVzOiAnQ29uZmlybWFkbydcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBlcUV2ZW50ID0gamVzdC5mbigoKSA9PiAoeyBzaW5nbGU6IHNpbmdsZUV2ZW50IH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0RXZlbnQgPSBqZXN0LmZuKCgpID0+ICh7IGVxOiBlcUV2ZW50IH0pKTtcclxuXHJcbiAgICAgIC8vIDLCqiBjaGFtYWRhIOKGkiBldmVudF9wYXJ0aWNpcGFudHMgKHVwZGF0ZSBjb20gZG9pcyAuZXEoKSBlbmNhZGVhZG9zKVxyXG4gICAgICBjb25zdCBzZWNvbmRFcSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBmaXJzdEVxID0gamVzdC5mbigoKSA9PiAoeyBlcTogc2Vjb25kRXEgfSkpO1xyXG4gICAgICBjb25zdCB1cGRhdGVQYXJ0aWNpcGFudCA9IGplc3QuZm4oKCkgPT4gKHsgZXE6IGZpcnN0RXEgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbVxyXG4gICAgICAgIC8vIGNoYW1hZGEgZG8gZXZlbnRzXHJcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICAgIHNlbGVjdDogc2VsZWN0RXZlbnRcclxuICAgICAgICB9KSlcclxuICAgICAgICAvLyBjaGFtYWRhIGRvIGV2ZW50X3BhcnRpY2lwYW50c1xyXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgICB1cGRhdGU6IHVwZGF0ZVBhcnRpY2lwYW50XHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2UudmFsaWRhdGVFbnRyeVBhc3N3b3JkKHtcclxuICAgICAgICBldmVudElkOiAxLFxyXG4gICAgICAgIHBhcnRpY2lwYW50SWQ6ICd1c2VyLTEnLFxyXG4gICAgICAgIHBhc3N3b3JkOiAnMTIzNCdcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9CZSgn4pyFIEFjZXNzbyBsaWJlcmFkbyEgQmVtLXZpbmRvIGFvIGV2ZW50by4nKTtcclxuICAgICAgZXhwZWN0KHVwZGF0ZVBhcnRpY2lwYW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICBjb21fYWNlc3NvOiB0cnVlXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KGZpcnN0RXEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudF9pZCcsIDEpO1xyXG4gICAgICBleHBlY3Qoc2Vjb25kRXEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyX2lkJywgJ3VzZXItMScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdoYXNVc2VyQWNjZXNzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldG9ybmEgdHJ1ZSBxdWFuZG8gbyBwYXJ0aWNpcGFudGUgasOhIHRlbSBhY2Vzc28nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgY29tX2FjZXNzbzogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHNlY29uZEVxID0gamVzdC5mbigoKSA9PiAoeyBzaW5nbGUgfSkpO1xyXG4gICAgICBjb25zdCBmaXJzdEVxID0gamVzdC5mbigoKSA9PiAoeyBlcTogc2Vjb25kRXEgfSkpO1xyXG4gICAgICBjb25zdCBzZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7IGVxOiBmaXJzdEVxIH0pKTtcclxuICAgICAgXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0XHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IGhhc0FjY2VzcyA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmhhc1VzZXJBY2Nlc3MoMSwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KGhhc0FjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudF9wYXJ0aWNpcGFudHMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGZhbHNlIHF1YW5kbyBuw6NvIGVuY29udHJhciBvIHBhcnRpY2lwYW50ZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIGVycm9yOiB7IGNvZGU6ICdQR1JTVDExNicgfVxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3Qgc2Vjb25kRXEgPSBqZXN0LmZuKCgpID0+ICh7IHNpbmdsZSB9KSk7XHJcbiAgICAgIGNvbnN0IGZpcnN0RXEgPSBqZXN0LmZuKCgpID0+ICh7IGVxOiBzZWNvbmRFcSB9KSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHsgZXE6IGZpcnN0RXEgfSkpO1xyXG4gICAgICBcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBzZWxlY3RcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgaGFzQWNjZXNzID0gYXdhaXQgRXZlbnRTZWN1cml0eVNlcnZpY2UuaGFzVXNlckFjY2VzcygxLCAndXNlci0yJyk7XHJcblxyXG4gICAgICBleHBlY3QoaGFzQWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnbG9ja0V2ZW50RW50cnknLCAoKSA9PiB7XHJcbiAgICBpdCgnYmxvcXVlaWEgYSBlbnRyYWRhIG5vIGV2ZW50bycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgdXBkYXRlXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmxvY2tFdmVudEVudHJ5KDcpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2UuZnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50cycpO1xyXG4gICAgICBleHBlY3QodXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICBlbnRyeV9sb2NrZWQ6IHRydWVcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QoZXEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpZCcsIDcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRFbnRyeVN0YXR1cycsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIHN0YXR1cyBmb3JtYXRhZG8gZG8gZXZlbnRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyAxwqogY2hhbWFkYSDihpIgZXZlbnRzXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb21cclxuICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICBldmVudF9lbnRyeV9wYXNzd29yZDogJzQzMjEnLFxyXG4gICAgICAgICAgICAgICAgICBlbnRyeV9sb2NrZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICBlbnRyeV9sb2NrZWRfYXQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgIGVudHJ5X29wZW5lZF9hdDogJzIwMjUtMTEtMDJUMTQ6NTk6MDBaJ1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgICB9KSlcclxuICAgICAgICAvLyAywqogY2hhbWFkYSDihpIgZXZlbnRfcGFydGljaXBhbnRzXHJcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBlcTogamVzdFxyXG4gICAgICAgICAgICAgIC5mbigpXHJcbiAgICAgICAgICAgICAgLy8gZXEoJ2V2ZW50X2lkJywgLi4uKVxyXG4gICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgZGF0YTogW1xyXG4gICAgICAgICAgICAgICAgICAgIHsgY29tX2FjZXNzbzogdHJ1ZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgY29tX2FjZXNzbzogZmFsc2UgfSxcclxuICAgICAgICAgICAgICAgICAgICB7IGNvbV9hY2Vzc286IHRydWUgfVxyXG4gICAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICB9KSlcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmdldEVudHJ5U3RhdHVzKDU1KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhKS50b0VxdWFsKHtcclxuICAgICAgICBwYXNzd29yZDogJzQzMjEnLFxyXG4gICAgICAgIGlzTG9ja2VkOiBmYWxzZSxcclxuICAgICAgICBsb2NrZWRBdDogbnVsbCxcclxuICAgICAgICBvcGVuZWRBdDogJzIwMjUtMTEtMDJUMTQ6NTk6MDBaJyxcclxuICAgICAgICB0b3RhbFdpdGhBY2Nlc3M6IDIsXHJcbiAgICAgICAgdG90YWxQYXJ0aWNpcGFudHM6IDNcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9