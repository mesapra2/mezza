479cb875a0ce0b5b0379f99a7a50f860
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
// src/pages/EditEventPagePartner.jsx
const react_1 = require("react");
const react_router_dom_1 = require("react-router-dom");
const react_helmet_async_1 = require("react-helmet-async");
const supabaseClient_1 = require("@/lib/supabaseClient");
const button_1 = require("@/features/shared/components/ui/button");
const input_1 = require("@/features/shared/components/ui/input");
const textarea_1 = require("@/features/shared/components/ui/textarea");
const use_toast_1 = require("@/features/shared/components/ui/use-toast");
const lucide_react_1 = require("lucide-react");
const AuthContext_1 = require("@/contexts/AuthContext");
const EditEventPagePartner = () => {
    const { id } = (0, react_router_dom_1.useParams)();
    const navigate = (0, react_router_dom_1.useNavigate)();
    const { user, profile } = (0, AuthContext_1.useAuth)(); // Pegar usuário e perfil
    const [eventData, setEventData] = (0, react_1.useState)(null);
    const [loading, setLoading] = (0, react_1.useState)(true);
    const [error, setError] = (0, react_1.useState)(null);
    const [isSubmitting, setIsSubmitting] = (0, react_1.useState)(false);
    const [partnerCapacity, setPartnerCapacity] = (0, react_1.useState)(10); // Capacidade
    (0, react_1.useEffect)(() => {
        const fetchEventAndCapacity = async () => {
            if (!user || !profile?.partner_id) {
                setError("Permissão negada ou perfil de parceiro não encontrado.");
                setLoading(false);
                return;
            }
            setLoading(true);
            setError(null);
            try {
                // 1. Buscar dados do evento
                const { data: event, error: eventError } = await supabaseClient_1.supabase
                    .from('events')
                    .select('*')
                    .eq('id', id)
                    .single();
                if (eventError)
                    throw eventError;
                if (!event)
                    throw new Error('Evento não encontrado');
                // 2. Verificar permissão (criador E parceiro do evento)
                if (event.creator_id !== user.id || event.partner_id !== profile.partner_id) {
                    throw new Error('Você não tem permissão para editar este evento.');
                }
                // 3. Buscar capacidade do restaurante
                const { data: partner, error: partnerError } = await supabaseClient_1.supabase
                    .from('partners')
                    .select('capacity')
                    .eq('id', profile.partner_id)
                    .single();
                if (partnerError)
                    throw partnerError;
                if (partner && partner.capacity > 0) {
                    setPartnerCapacity(partner.capacity);
                }
                setEventData(event);
            }
            catch (err) {
                setError(err.message || 'Erro ao carregar dados.');
                console.error(err);
            }
            finally {
                setLoading(false);
            }
        };
        fetchEventAndCapacity();
    }, [id, user, profile]);
    const handleChange = (e) => {
        const { name, value, type } = e.target;
        setEventData(prev => ({
            ...prev,
            [name]: type === 'number' ? parseInt(value, 10) || 0 : value
        }));
    };
    const handleSubmit = async (e) => {
        e.preventDefault();
        setIsSubmitting(true);
        setError(null);
        // Validação de vagas
        if (eventData.vagas < 1 || eventData.vagas > partnerCapacity) {
            setError(`O número de vagas deve estar entre 1 e ${partnerCapacity}`);
            setIsSubmitting(false);
            return;
        }
        // eslint-disable-next-line no-unused-vars
        const { id: eventId, created_at, creator_id, partner_id, event_type, ...updateData } = eventData;
        try {
            const { error: updateError } = await supabaseClient_1.supabase
                .from('events')
                .update({
                title: updateData.title,
                description: updateData.description,
                start_time: updateData.start_time,
                end_time: updateData.end_time,
                vagas: updateData.vagas,
                max_vagas: updateData.vagas, // Garante que max_vagas seja igual
                updated_at: new Date().toISOString()
            })
                .eq('id', eventId)
                .eq('creator_id', user.id); // Segurança
            if (updateError)
                throw updateError;
            (0, use_toast_1.toast)({ title: "✅ Evento atualizado com sucesso!" });
            navigate('/meus-eventos');
        }
        catch (err) {
            setError(err.message || 'Erro ao salvar alterações.');
            console.error(err);
            (0, use_toast_1.toast)({ variant: "destructive", title: "Erro ao salvar", description: err.message });
        }
        finally {
            setIsSubmitting(false);
        }
    };
    if (loading) {
        return ((0, jsx_runtime_1.jsx)("div", { className: "flex items-center justify-center h-[calc(100vh-10rem)]", children: (0, jsx_runtime_1.jsx)(lucide_react_1.Loader2, { className: "w-12 h-12 text-purple-500 animate-spin" }) }));
    }
    if (error) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col items-center justify-center h-[calc(100vh-10rem)] text-center", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.AlertTriangle, { className: "w-12 h-12 text-red-500 mb-4" }), (0, jsx_runtime_1.jsx)("h2", { className: "text-xl font-semibold text-white mb-2", children: error }), (0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: () => navigate('/meus-eventos'), children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-4 h-4 mr-2" }), "Voltar para Meus Eventos"] })] }));
    }
    if (!eventData) {
        return (0, jsx_runtime_1.jsx)("div", { children: "Evento n\u00E3o encontrado." });
    }
    // Converte datas para formato de input (se existirem)
    const formatDateTimeLocal = (isoString) => {
        if (!isoString)
            return '';
        try {
            return new Date(isoString).toISOString().slice(0, 16);
        }
        catch (e) {
            return '';
        }
    };
    return ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(react_helmet_async_1.Helmet, { children: (0, jsx_runtime_1.jsxs)("title", { children: ["Editar: ", eventData.title, " | Mesapra2"] }) }), (0, jsx_runtime_1.jsxs)("div", { className: "py-6 px-4 sm:px-6 lg:px-8 max-w-3xl mx-auto", children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { variant: "ghost", onClick: () => navigate('/meus-eventos'), className: "mb-4", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-4 h-4 mr-2" }), "Voltar para Meus Eventos"] }), (0, jsx_runtime_1.jsx)("h1", { className: "text-3xl font-bold text-white mb-6", children: "Editar Evento Institucional" }), (0, jsx_runtime_1.jsxs)("form", { onSubmit: handleSubmit, className: "space-y-6 glass-effect p-8 rounded-2xl border border-white/10", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "title", className: "block text-sm font-medium text-white/80 mb-1", children: "T\u00EDtulo do Evento" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "title", name: "title", value: eventData.title || '', onChange: handleChange, required: true, className: "glass-effect border-white/10" })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "description", className: "block text-sm font-medium text-white/80 mb-1", children: "Descri\u00E7\u00E3o" }), (0, jsx_runtime_1.jsx)(textarea_1.Textarea, { id: "description", name: "description", value: eventData.description || '', onChange: handleChange, rows: 4, className: "glass-effect border-white/10" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "start_time", className: "block text-sm font-medium text-white/80 mb-1", children: "Data e Hora de In\u00EDcio" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "start_time", name: "start_time", type: "datetime-local", value: formatDateTimeLocal(eventData.start_time), onChange: handleChange, className: "glass-effect border-white/10", required: true })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "end_time", className: "block text-sm font-medium text-white/80 mb-1", children: "Data e Hora de T\u00E9rmino" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "end_time", name: "end_time", type: "datetime-local", value: formatDateTimeLocal(eventData.end_time), onChange: handleChange, min: formatDateTimeLocal(eventData.start_time), className: "glass-effect border-white/10", required: true })] })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { htmlFor: "vagas", className: "block text-sm font-medium text-white/80 mb-1", children: "Vagas Dispon\u00EDveis (Lota\u00E7\u00E3o)" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "vagas", name: "vagas", type: "number", value: eventData.vagas || 0, onChange: handleChange, min: "0", max: partnerCapacity, required: true, className: "glass-effect border-white/10" }), (0, jsx_runtime_1.jsxs)("p", { className: "text-xs text-white/50 mt-1", children: ["Capacidade m\u00E1xima do seu restaurante: ", partnerCapacity, "."] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-4 pt-4 border-t border-white/10", children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { type: "submit", disabled: isSubmitting, className: "bg-gradient-to-r from-purple-500 to-pink-500", children: [isSubmitting ? (0, jsx_runtime_1.jsx)(lucide_react_1.Loader2, { className: "w-4 h-4 mr-2 animate-spin" }) : null, isSubmitting ? 'Salvando...' : 'Salvar Alterações'] }), (0, jsx_runtime_1.jsx)(button_1.Button, { type: "button", variant: "outline", onClick: () => navigate('/meus-eventos'), disabled: isSubmitting, children: "Cancelar" })] })] })] })] }));
};
exports.default = EditEventPagePartner;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xccGFydG5lclxccGFnZXNcXEVkaXRFdmVudFBhZ2VQYXJ0bmVyLmpzeCIsIm1hcHBpbmdzIjoiOzs7QUFBQSxxQ0FBcUM7QUFDckMsaUNBQTRDO0FBQzVDLHVEQUEwRDtBQUMxRCwyREFBNEM7QUFDNUMseURBQWdEO0FBQ2hELG1FQUFnRTtBQUNoRSxpRUFBOEQ7QUFDOUQsdUVBQW9FO0FBQ3BFLHlFQUFrRTtBQUNsRSwrQ0FBaUU7QUFDakUsd0RBQWlEO0FBRWpELE1BQU0sb0JBQW9CLEdBQUcsR0FBRyxFQUFFO0lBQ2hDLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxJQUFBLDRCQUFTLEdBQUUsQ0FBQztJQUMzQixNQUFNLFFBQVEsR0FBRyxJQUFBLDhCQUFXLEdBQUUsQ0FBQztJQUMvQixNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxHQUFHLElBQUEscUJBQU8sR0FBRSxDQUFDLENBQUMseUJBQXlCO0lBQzlELE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pELE1BQU0sQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsZUFBZSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hELE1BQU0sQ0FBQyxlQUFlLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhO0lBRXpFLElBQUEsaUJBQVMsRUFBQyxHQUFHLEVBQUU7UUFDYixNQUFNLHFCQUFxQixHQUFHLEtBQUssSUFBSSxFQUFFO1lBQ3ZD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Q3RCLEdBQUcsRUFBQyxHQUFHLEVBQ1AsR0FBRyxFQUFFLGVBQWUsRUFDcEIsUUFBUSxRQUNSLFNBQVMsRUFBQyw4QkFBOEIsR0FDeEMsRUFDRiwrQkFBRyxTQUFTLEVBQUMsNEJBQTRCLDREQUNBLGVBQWUsU0FDcEQsSUFDQSxFQUVOLGlDQUFLLFNBQVMsRUFBQywwQ0FBMEMsYUFDdkQsd0JBQUMsZUFBTSxJQUFDLElBQUksRUFBQyxRQUFRLEVBQUMsUUFBUSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUMsOENBQThDLGFBQ25HLFlBQVksQ0FBQyxDQUFDLENBQUMsdUJBQUMsc0JBQU8sSUFBQyxTQUFTLEVBQUMsMkJBQTJCLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUN2RSxZQUFZLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsbUJBQW1CLElBQzVDLEVBQ1QsdUJBQUMsZUFBTSxJQUFDLElBQUksRUFBQyxRQUFRLEVBQUMsT0FBTyxFQUFDLFNBQVMsRUFBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxZQUFZLHlCQUUvRixJQUNMLElBQ0QsSUFDSCxJQUNMLENBQ0osQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGtCQUFlLG9CQUFvQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcZmVhdHVyZXNcXHBhcnRuZXJcXHBhZ2VzXFxFZGl0RXZlbnRQYWdlUGFydG5lci5qc3giXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3BhZ2VzL0VkaXRFdmVudFBhZ2VQYXJ0bmVyLmpzeFxyXG5pbXBvcnQgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyB1c2VQYXJhbXMsIHVzZU5hdmlnYXRlIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XHJcbmltcG9ydCB7IEhlbG1ldCB9IGZyb20gJ3JlYWN0LWhlbG1ldC1hc3luYyc7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnQC9saWIvc3VwYWJhc2VDbGllbnQnO1xyXG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tICdAL2ZlYXR1cmVzL3NoYXJlZC9jb21wb25lbnRzL3VpL2J1dHRvbic7XHJcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS9pbnB1dCc7XHJcbmltcG9ydCB7IFRleHRhcmVhIH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS90ZXh0YXJlYSc7XHJcbmltcG9ydCB7IHRvYXN0IH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS91c2UtdG9hc3QnO1xyXG5pbXBvcnQgeyBMb2FkZXIyLCBBbGVydFRyaWFuZ2xlLCBBcnJvd0xlZnQgfSBmcm9tICdsdWNpZGUtcmVhY3QnO1xyXG5pbXBvcnQgeyB1c2VBdXRoIH0gZnJvbSAnQC9jb250ZXh0cy9BdXRoQ29udGV4dCc7XHJcblxyXG5jb25zdCBFZGl0RXZlbnRQYWdlUGFydG5lciA9ICgpID0+IHtcclxuICBjb25zdCB7IGlkIH0gPSB1c2VQYXJhbXMoKTtcclxuICBjb25zdCBuYXZpZ2F0ZSA9IHVzZU5hdmlnYXRlKCk7XHJcbiAgY29uc3QgeyB1c2VyLCBwcm9maWxlIH0gPSB1c2VBdXRoKCk7IC8vIFBlZ2FyIHVzdcOhcmlvIGUgcGVyZmlsXHJcbiAgY29uc3QgW2V2ZW50RGF0YSwgc2V0RXZlbnREYXRhXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpO1xyXG4gIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgY29uc3QgW2lzU3VibWl0dGluZywgc2V0SXNTdWJtaXR0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbcGFydG5lckNhcGFjaXR5LCBzZXRQYXJ0bmVyQ2FwYWNpdHldID0gdXNlU3RhdGUoMTApOyAvLyBDYXBhY2lkYWRlXHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBjb25zdCBmZXRjaEV2ZW50QW5kQ2FwYWNpdHkgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGlmICghdXNlciB8fCAhcHJvZmlsZT8ucGFydG5lcl9pZCkge1xyXG4gICAgICAgIHNldEVycm9yKFwiUGVybWlzc8OjbyBuZWdhZGEgb3UgcGVyZmlsIGRlIHBhcmNlaXJvIG7Do28gZW5jb250cmFkby5cIik7XHJcbiAgICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBzZXRMb2FkaW5nKHRydWUpO1xyXG4gICAgICBzZXRFcnJvcihudWxsKTtcclxuICAgICAgXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8gMS4gQnVzY2FyIGRhZG9zIGRvIGV2ZW50b1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXZlbnQsIGVycm9yOiBldmVudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ2V2ZW50cycpXHJcbiAgICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKGV2ZW50RXJyb3IpIHRocm93IGV2ZW50RXJyb3I7XHJcbiAgICAgICAgaWYgKCFldmVudCkgdGhyb3cgbmV3IEVycm9yKCdFdmVudG8gbsOjbyBlbmNvbnRyYWRvJyk7XHJcblxyXG4gICAgICAgIC8vIDIuIFZlcmlmaWNhciBwZXJtaXNzw6NvIChjcmlhZG9yIEUgcGFyY2Vpcm8gZG8gZXZlbnRvKVxyXG4gICAgICAgIGlmIChldmVudC5jcmVhdG9yX2lkICE9PSB1c2VyLmlkIHx8IGV2ZW50LnBhcnRuZXJfaWQgIT09IHByb2ZpbGUucGFydG5lcl9pZCkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWb2PDqiBuw6NvIHRlbSBwZXJtaXNzw6NvIHBhcmEgZWRpdGFyIGVzdGUgZXZlbnRvLicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gMy4gQnVzY2FyIGNhcGFjaWRhZGUgZG8gcmVzdGF1cmFudGVcclxuICAgICAgICBjb25zdCB7IGRhdGE6IHBhcnRuZXIsIGVycm9yOiBwYXJ0bmVyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbSgncGFydG5lcnMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnY2FwYWNpdHknKVxyXG4gICAgICAgICAgLmVxKCdpZCcsIHByb2ZpbGUucGFydG5lcl9pZClcclxuICAgICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgICAgaWYgKHBhcnRuZXJFcnJvcikgdGhyb3cgcGFydG5lckVycm9yO1xyXG4gICAgICAgIGlmIChwYXJ0bmVyICYmIHBhcnRuZXIuY2FwYWNpdHkgPiAwKSB7XHJcbiAgICAgICAgICBzZXRQYXJ0bmVyQ2FwYWNpdHkocGFydG5lci5jYXBhY2l0eSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRFdmVudERhdGEoZXZlbnQpO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBzZXRFcnJvcihlcnIubWVzc2FnZSB8fCAnRXJybyBhbyBjYXJyZWdhciBkYWRvcy4nKTtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZmV0Y2hFdmVudEFuZENhcGFjaXR5KCk7XHJcbiAgfSwgW2lkLCB1c2VyLCBwcm9maWxlXSk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZUNoYW5nZSA9IChlKSA9PiB7XHJcbiAgICBjb25zdCB7IG5hbWUsIHZhbHVlLCB0eXBlIH0gPSBlLnRhcmdldDtcclxuICAgIHNldEV2ZW50RGF0YShwcmV2ID0+ICh7XHJcbiAgICAgIC4uLnByZXYsXHJcbiAgICAgIFtuYW1lXTogdHlwZSA9PT0gJ251bWJlcicgPyBwYXJzZUludCh2YWx1ZSwgMTApIHx8IDAgOiB2YWx1ZVxyXG4gICAgfSkpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZVN1Ym1pdCA9IGFzeW5jIChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBzZXRJc1N1Ym1pdHRpbmcodHJ1ZSk7XHJcbiAgICBzZXRFcnJvcihudWxsKTtcclxuXHJcbiAgICAvLyBWYWxpZGHDp8OjbyBkZSB2YWdhc1xyXG4gICAgaWYgKGV2ZW50RGF0YS52YWdhcyA8IDEgfHwgZXZlbnREYXRhLnZhZ2FzID4gcGFydG5lckNhcGFjaXR5KSB7XHJcbiAgICAgIHNldEVycm9yKGBPIG7Dum1lcm8gZGUgdmFnYXMgZGV2ZSBlc3RhciBlbnRyZSAxIGUgJHtwYXJ0bmVyQ2FwYWNpdHl9YCk7XHJcbiAgICAgIHNldElzU3VibWl0dGluZyhmYWxzZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcclxuICAgIGNvbnN0IHsgaWQ6IGV2ZW50SWQsIGNyZWF0ZWRfYXQsIGNyZWF0b3JfaWQsIHBhcnRuZXJfaWQsIGV2ZW50X3R5cGUsIC4uLnVwZGF0ZURhdGEgfSA9IGV2ZW50RGF0YTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZXZlbnRzJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIHRpdGxlOiB1cGRhdGVEYXRhLnRpdGxlLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246IHVwZGF0ZURhdGEuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICBzdGFydF90aW1lOiB1cGRhdGVEYXRhLnN0YXJ0X3RpbWUsXHJcbiAgICAgICAgICBlbmRfdGltZTogdXBkYXRlRGF0YS5lbmRfdGltZSxcclxuICAgICAgICAgIHZhZ2FzOiB1cGRhdGVEYXRhLnZhZ2FzLFxyXG4gICAgICAgICAgbWF4X3ZhZ2FzOiB1cGRhdGVEYXRhLnZhZ2FzLCAvLyBHYXJhbnRlIHF1ZSBtYXhfdmFnYXMgc2VqYSBpZ3VhbFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXEoJ2lkJywgZXZlbnRJZClcclxuICAgICAgICAuZXEoJ2NyZWF0b3JfaWQnLCB1c2VyLmlkKTsgLy8gU2VndXJhbsOnYVxyXG5cclxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB0aHJvdyB1cGRhdGVFcnJvcjtcclxuXHJcbiAgICAgIHRvYXN0KHsgdGl0bGU6IFwi4pyFIEV2ZW50byBhdHVhbGl6YWRvIGNvbSBzdWNlc3NvIVwiIH0pO1xyXG4gICAgICBuYXZpZ2F0ZSgnL21ldXMtZXZlbnRvcycpO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBzZXRFcnJvcihlcnIubWVzc2FnZSB8fCAnRXJybyBhbyBzYWx2YXIgYWx0ZXJhw6fDtWVzLicpO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgIHRvYXN0KHsgdmFyaWFudDogXCJkZXN0cnVjdGl2ZVwiLCB0aXRsZTogXCJFcnJvIGFvIHNhbHZhclwiLCBkZXNjcmlwdGlvbjogZXJyLm1lc3NhZ2UgfSk7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICBzZXRJc1N1Ym1pdHRpbmcoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGlmIChsb2FkaW5nKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtW2NhbGMoMTAwdmgtMTByZW0pXVwiPlxyXG4gICAgICAgIDxMb2FkZXIyIGNsYXNzTmFtZT1cInctMTIgaC0xMiB0ZXh0LXB1cnBsZS01MDAgYW5pbWF0ZS1zcGluXCIgLz5cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtW2NhbGMoMTAwdmgtMTByZW0pXSB0ZXh0LWNlbnRlclwiPlxyXG4gICAgICAgIDxBbGVydFRyaWFuZ2xlIGNsYXNzTmFtZT1cInctMTIgaC0xMiB0ZXh0LXJlZC01MDAgbWItNFwiIC8+XHJcbiAgICAgICAgPGgyIGNsYXNzTmFtZT1cInRleHQteGwgZm9udC1zZW1pYm9sZCB0ZXh0LXdoaXRlIG1iLTJcIj57ZXJyb3J9PC9oMj5cclxuICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IG5hdmlnYXRlKCcvbWV1cy1ldmVudG9zJyl9PlxyXG4gICAgICAgICAgPEFycm93TGVmdCBjbGFzc05hbWU9XCJ3LTQgaC00IG1yLTJcIiAvPlxyXG4gICAgICAgICAgVm9sdGFyIHBhcmEgTWV1cyBFdmVudG9zXHJcbiAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGlmICghZXZlbnREYXRhKSB7XHJcbiAgICAgcmV0dXJuIDxkaXY+RXZlbnRvIG7Do28gZW5jb250cmFkby48L2Rpdj47XHJcbiAgfVxyXG4gIFxyXG4gIC8vIENvbnZlcnRlIGRhdGFzIHBhcmEgZm9ybWF0byBkZSBpbnB1dCAoc2UgZXhpc3RpcmVtKVxyXG4gIGNvbnN0IGZvcm1hdERhdGVUaW1lTG9jYWwgPSAoaXNvU3RyaW5nKSA9PiB7XHJcbiAgICBpZiAoIWlzb1N0cmluZykgcmV0dXJuICcnO1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIG5ldyBEYXRlKGlzb1N0cmluZykudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxNik7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPD5cclxuICAgICAgPEhlbG1ldD5cclxuICAgICAgICA8dGl0bGU+RWRpdGFyOiB7ZXZlbnREYXRhLnRpdGxlfSB8IE1lc2FwcmEyPC90aXRsZT5cclxuICAgICAgPC9IZWxtZXQ+XHJcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwicHktNiBweC00IHNtOnB4LTYgbGc6cHgtOCBtYXgtdy0zeGwgbXgtYXV0b1wiPlxyXG4gICAgICAgIDxCdXR0b24gdmFyaWFudD1cImdob3N0XCIgb25DbGljaz17KCkgPT4gbmF2aWdhdGUoJy9tZXVzLWV2ZW50b3MnKX0gY2xhc3NOYW1lPVwibWItNFwiPlxyXG4gICAgICAgICAgICA8QXJyb3dMZWZ0IGNsYXNzTmFtZT1cInctNCBoLTQgbXItMlwiIC8+XHJcbiAgICAgICAgICAgIFZvbHRhciBwYXJhIE1ldXMgRXZlbnRvc1xyXG4gICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgIDxoMSBjbGFzc05hbWU9XCJ0ZXh0LTN4bCBmb250LWJvbGQgdGV4dC13aGl0ZSBtYi02XCI+RWRpdGFyIEV2ZW50byBJbnN0aXR1Y2lvbmFsPC9oMT5cclxuXHJcbiAgICAgICAgPGZvcm0gb25TdWJtaXQ9e2hhbmRsZVN1Ym1pdH0gY2xhc3NOYW1lPVwic3BhY2UteS02IGdsYXNzLWVmZmVjdCBwLTggcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci13aGl0ZS8xMFwiPlxyXG4gICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJ0aXRsZVwiIGNsYXNzTmFtZT1cImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC13aGl0ZS84MCBtYi0xXCI+VMOtdHVsbyBkbyBFdmVudG88L2xhYmVsPlxyXG4gICAgICAgICAgICA8SW5wdXQgXHJcbiAgICAgICAgICAgICAgaWQ9XCJ0aXRsZVwiIFxyXG4gICAgICAgICAgICAgIG5hbWU9XCJ0aXRsZVwiIFxyXG4gICAgICAgICAgICAgIHZhbHVlPXtldmVudERhdGEudGl0bGUgfHwgJyd9IFxyXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2V9IFxyXG4gICAgICAgICAgICAgIHJlcXVpcmVkIFxyXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImdsYXNzLWVmZmVjdCBib3JkZXItd2hpdGUvMTBcIlxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJkZXNjcmlwdGlvblwiIGNsYXNzTmFtZT1cImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC13aGl0ZS84MCBtYi0xXCI+RGVzY3Jpw6fDo288L2xhYmVsPlxyXG4gICAgICAgICAgICA8VGV4dGFyZWEgXHJcbiAgICAgICAgICAgICAgaWQ9XCJkZXNjcmlwdGlvblwiIFxyXG4gICAgICAgICAgICAgIG5hbWU9XCJkZXNjcmlwdGlvblwiIFxyXG4gICAgICAgICAgICAgIHZhbHVlPXtldmVudERhdGEuZGVzY3JpcHRpb24gfHwgJyd9IFxyXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2V9IFxyXG4gICAgICAgICAgICAgIHJvd3M9ezR9XHJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiZ2xhc3MtZWZmZWN0IGJvcmRlci13aGl0ZS8xMFwiXHJcbiAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgey8qIERhdGFzICovfVxyXG4gICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNlwiPlxyXG4gICAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cInN0YXJ0X3RpbWVcIiBjbGFzc05hbWU9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtd2hpdGUvODAgbWItMVwiPkRhdGEgZSBIb3JhIGRlIEluw61jaW88L2xhYmVsPlxyXG4gICAgICAgICAgICAgICAgPElucHV0XHJcbiAgICAgICAgICAgICAgICAgIGlkPVwic3RhcnRfdGltZVwiXHJcbiAgICAgICAgICAgICAgICAgIG5hbWU9XCJzdGFydF90aW1lXCJcclxuICAgICAgICAgICAgICAgICAgdHlwZT1cImRhdGV0aW1lLWxvY2FsXCJcclxuICAgICAgICAgICAgICAgICAgdmFsdWU9e2Zvcm1hdERhdGVUaW1lTG9jYWwoZXZlbnREYXRhLnN0YXJ0X3RpbWUpfVxyXG4gICAgICAgICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlfVxyXG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJnbGFzcy1lZmZlY3QgYm9yZGVyLXdoaXRlLzEwXCJcclxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcclxuICAgICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgICAgIDxsYWJlbCBodG1sRm9yPVwiZW5kX3RpbWVcIiBjbGFzc05hbWU9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtd2hpdGUvODAgbWItMVwiPkRhdGEgZSBIb3JhIGRlIFTDqXJtaW5vPC9sYWJlbD5cclxuICAgICAgICAgICAgICAgIDxJbnB1dFxyXG4gICAgICAgICAgICAgICAgICBpZD1cImVuZF90aW1lXCJcclxuICAgICAgICAgICAgICAgICAgbmFtZT1cImVuZF90aW1lXCJcclxuICAgICAgICAgICAgICAgICAgdHlwZT1cImRhdGV0aW1lLWxvY2FsXCJcclxuICAgICAgICAgICAgICAgICAgdmFsdWU9e2Zvcm1hdERhdGVUaW1lTG9jYWwoZXZlbnREYXRhLmVuZF90aW1lKX1cclxuICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX1cclxuICAgICAgICAgICAgICAgICAgbWluPXtmb3JtYXREYXRlVGltZUxvY2FsKGV2ZW50RGF0YS5zdGFydF90aW1lKX1cclxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwiZ2xhc3MtZWZmZWN0IGJvcmRlci13aGl0ZS8xMFwiXHJcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkXHJcbiAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuXHJcbiAgICAgICAgICA8ZGl2PlxyXG4gICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cInZhZ2FzXCIgY2xhc3NOYW1lPVwiYmxvY2sgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LXdoaXRlLzgwIG1iLTFcIj5WYWdhcyBEaXNwb27DrXZlaXMgKExvdGHDp8Ojbyk8L2xhYmVsPlxyXG4gICAgICAgICAgICA8SW5wdXQgXHJcbiAgICAgICAgICAgICAgaWQ9XCJ2YWdhc1wiIFxyXG4gICAgICAgICAgICAgIG5hbWU9XCJ2YWdhc1wiIFxyXG4gICAgICAgICAgICAgIHR5cGU9XCJudW1iZXJcIiBcclxuICAgICAgICAgICAgICB2YWx1ZT17ZXZlbnREYXRhLnZhZ2FzIHx8IDB9IFxyXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2V9IFxyXG4gICAgICAgICAgICAgIG1pbj1cIjBcIlxyXG4gICAgICAgICAgICAgIG1heD17cGFydG5lckNhcGFjaXR5fVxyXG4gICAgICAgICAgICAgIHJlcXVpcmVkIFxyXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImdsYXNzLWVmZmVjdCBib3JkZXItd2hpdGUvMTBcIlxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LXhzIHRleHQtd2hpdGUvNTAgbXQtMVwiPlxyXG4gICAgICAgICAgICAgIENhcGFjaWRhZGUgbcOheGltYSBkbyBzZXUgcmVzdGF1cmFudGU6IHtwYXJ0bmVyQ2FwYWNpdHl9LlxyXG4gICAgICAgICAgICA8L3A+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuXHJcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZ2FwLTQgcHQtNCBib3JkZXItdCBib3JkZXItd2hpdGUvMTBcIj5cclxuICAgICAgICAgICAgPEJ1dHRvbiB0eXBlPVwic3VibWl0XCIgZGlzYWJsZWQ9e2lzU3VibWl0dGluZ30gY2xhc3NOYW1lPVwiYmctZ3JhZGllbnQtdG8tciBmcm9tLXB1cnBsZS01MDAgdG8tcGluay01MDBcIj5cclxuICAgICAgICAgICAgICB7aXNTdWJtaXR0aW5nID8gPExvYWRlcjIgY2xhc3NOYW1lPVwidy00IGgtNCBtci0yIGFuaW1hdGUtc3BpblwiIC8+IDogbnVsbH1cclxuICAgICAgICAgICAgICB7aXNTdWJtaXR0aW5nID8gJ1NhbHZhbmRvLi4uJyA6ICdTYWx2YXIgQWx0ZXJhw6fDtWVzJ31cclxuICAgICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgICAgIDxCdXR0b24gdHlwZT1cImJ1dHRvblwiIHZhcmlhbnQ9XCJvdXRsaW5lXCIgb25DbGljaz17KCkgPT4gbmF2aWdhdGUoJy9tZXVzLWV2ZW50b3MnKX0gZGlzYWJsZWQ9e2lzU3VibWl0dGluZ30+XHJcbiAgICAgICAgICAgICAgQ2FuY2VsYXJcclxuICAgICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Zvcm0+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC8+XHJcbiAgKTtcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEVkaXRFdmVudFBhZ2VQYXJ0bmVyOyJdLCJ2ZXJzaW9uIjozfQ==