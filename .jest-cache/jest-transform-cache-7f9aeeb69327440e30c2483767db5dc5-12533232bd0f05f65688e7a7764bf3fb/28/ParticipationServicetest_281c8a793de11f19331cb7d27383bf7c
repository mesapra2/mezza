2bad4b68edcf9fcf0c96b5205e8b4656
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
// mock do supabase
jest.mock('@/lib/supabaseClient', () => ({
    supabase: {
        from: jest.fn(() => ({
            select: jest.fn().mockReturnThis(),
            eq: jest.fn().mockReturnThis(),
            single: jest.fn().mockResolvedValue({ data: { id: 1 }, error: null }),
            maybeSingle: jest.fn().mockResolvedValue({ data: null, error: null }),
            insert: jest.fn().mockReturnThis(),
            update: jest.fn().mockReturnThis(),
            in: jest.fn().mockReturnThis(),
            gte: jest.fn().mockReturnThis(),
            lte: jest.fn().mockReturnThis(),
            order: jest.fn().mockReturnThis(),
        })),
    },
}));
// mock de serviços externos
jest.mock('@/services/NotificationService', () => ({
    createForUser: jest.fn().mockResolvedValue(true),
}));
jest.mock('@/services/WaitingListService', () => ({
    addToWaitingList: jest.fn().mockResolvedValue(true),
    processWaitingList: jest.fn().mockResolvedValue(true),
}));
jest.mock('@/services/EventSecurityService', () => ({
    validateEntryPassword: jest.fn().mockResolvedValue({
        success: true,
        message: 'Senha correta',
    }),
}));
// src/services/ParticipationService.test.ts
const ParticipationService_1 = tslib_1.__importDefault(require("./ParticipationService"));
describe('ParticipationService', () => {
    it('verifica se isEventTooClose retorna true para evento próximo', () => {
        const event = { start_time: new Date(Date.now() + 30000).toISOString() };
        const result = ParticipationService_1.default.isEventTooClose(event);
        expect(result).toBe(true);
    });
    it('verifica se userAlreadyInEvent retorna exists=false quando não há dados', async () => {
        const result = await ParticipationService_1.default.userAlreadyInEvent('1', '2');
        expect(result.exists).toBe(false);
    });
    it('testa validateApplication sem conflitos', async () => {
        const event = {
            id: 1,
            start_time: new Date().toISOString(),
            end_time: new Date(Date.now() + 3600000).toISOString(),
            status: 'Aberto',
        };
        const result = await ParticipationService_1.default.validateApplication(event, 'user123');
        expect(result.valid).toBe(true);
    });
    it('verifica se canUserCreateEvent retorna success=true quando sem eventos', async () => {
        const result = await ParticipationService_1.default.canUserCreateEvent('user123');
        expect(result.success).toBe(true);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcUGFydGljaXBhdGlvblNlcnZpY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7QUFHQSxtQkFBbUI7QUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLFFBQVEsRUFBRTtRQUNSLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDbkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDOUIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7WUFDckUsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDO1lBQ3JFLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1lBQ2xDLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1lBQ2xDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1lBQzlCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1lBQy9CLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1lBQy9CLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1NBQ2xDLENBQUMsQ0FBQztLQUNKO0NBQ0Ys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YXJ0aWNpcGF0aW9uU2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2aWNlcy9QYXJ0aWNpcGF0aW9uU2VydmljZS50ZXN0LnRzXHJcbmltcG9ydCBQYXJ0aWNpcGF0aW9uU2VydmljZSBmcm9tICcuL1BhcnRpY2lwYXRpb25TZXJ2aWNlJztcclxuXHJcbi8vIG1vY2sgZG8gc3VwYWJhc2VcclxuamVzdC5tb2NrKCdAL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+ICh7XHJcbiAgc3VwYWJhc2U6IHtcclxuICAgIGZyb206IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHsgaWQ6IDEgfSwgZXJyb3I6IG51bGwgfSksXHJcbiAgICAgIG1heWJlU2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KSxcclxuICAgICAgaW5zZXJ0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgaW46IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBndGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBsdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBvcmRlcjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICB9KSksXHJcbiAgfSxcclxufSkpO1xyXG5cclxuLy8gbW9jayBkZSBzZXJ2acOnb3MgZXh0ZXJub3NcclxuamVzdC5tb2NrKCdAL3NlcnZpY2VzL05vdGlmaWNhdGlvblNlcnZpY2UnLCAoKSA9PiAoe1xyXG4gIGNyZWF0ZUZvclVzZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcclxufSkpO1xyXG5qZXN0Lm1vY2soJ0Avc2VydmljZXMvV2FpdGluZ0xpc3RTZXJ2aWNlJywgKCkgPT4gKHtcclxuICBhZGRUb1dhaXRpbmdMaXN0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXHJcbiAgcHJvY2Vzc1dhaXRpbmdMaXN0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXHJcbn0pKTtcclxuamVzdC5tb2NrKCdAL3NlcnZpY2VzL0V2ZW50U2VjdXJpdHlTZXJ2aWNlJywgKCkgPT4gKHtcclxuICB2YWxpZGF0ZUVudHJ5UGFzc3dvcmQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgbWVzc2FnZTogJ1NlbmhhIGNvcnJldGEnLFxyXG4gIH0pLFxyXG59KSk7XHJcblxyXG5kZXNjcmliZSgnUGFydGljaXBhdGlvblNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgaXQoJ3ZlcmlmaWNhIHNlIGlzRXZlbnRUb29DbG9zZSByZXRvcm5hIHRydWUgcGFyYSBldmVudG8gcHLDs3hpbW8nLCAoKSA9PiB7XHJcbiAgICBjb25zdCBldmVudCA9IHsgc3RhcnRfdGltZTogbmV3IERhdGUoRGF0ZS5ub3coKSArIDMwXzAwMCkudG9JU09TdHJpbmcoKSB9IGFzIGFueTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IChQYXJ0aWNpcGF0aW9uU2VydmljZSBhcyBhbnkpLmlzRXZlbnRUb29DbG9zZShldmVudCk7XHJcbiAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgndmVyaWZpY2Egc2UgdXNlckFscmVhZHlJbkV2ZW50IHJldG9ybmEgZXhpc3RzPWZhbHNlIHF1YW5kbyBuw6NvIGjDoSBkYWRvcycsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBhcnRpY2lwYXRpb25TZXJ2aWNlLnVzZXJBbHJlYWR5SW5FdmVudCgnMScsICcyJyk7XHJcbiAgICBleHBlY3QocmVzdWx0LmV4aXN0cykudG9CZShmYWxzZSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCd0ZXN0YSB2YWxpZGF0ZUFwcGxpY2F0aW9uIHNlbSBjb25mbGl0b3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBldmVudCA9IHtcclxuICAgICAgaWQ6IDEsXHJcbiAgICAgIHN0YXJ0X3RpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgZW5kX3RpbWU6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzXzYwMF8wMDApLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHN0YXR1czogJ0FiZXJ0bycsXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUGFydGljaXBhdGlvblNlcnZpY2UudmFsaWRhdGVBcHBsaWNhdGlvbihldmVudCBhcyBhbnksICd1c2VyMTIzJyk7XHJcbiAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgndmVyaWZpY2Egc2UgY2FuVXNlckNyZWF0ZUV2ZW50IHJldG9ybmEgc3VjY2Vzcz10cnVlIHF1YW5kbyBzZW0gZXZlbnRvcycsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBhcnRpY2lwYXRpb25TZXJ2aWNlLmNhblVzZXJDcmVhdGVFdmVudCgndXNlcjEyMycpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9