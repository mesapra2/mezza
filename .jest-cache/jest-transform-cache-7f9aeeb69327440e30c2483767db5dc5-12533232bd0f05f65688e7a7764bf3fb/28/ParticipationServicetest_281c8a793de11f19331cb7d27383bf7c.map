{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\ParticipationService.test.ts","mappings":";;;AAGA,mBAAmB;AACnB,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,GAAG,EAAE,CAAC,CAAC;IACvC,QAAQ,EAAE;QACR,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;YACnB,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YAClC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YAC9B,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;YACrE,WAAW,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;YACrE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YAClC,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YAClC,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YAC9B,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YAC/B,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;YAC/B,KAAK,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,cAAc,EAAE;SAClC,CAAC,CAAC;KACJ;CACF,CAAC,CAAC,CAAC;AAEJ,4BAA4B;AAC5B,IAAI,CAAC,IAAI,CAAC,gCAAgC,EAAE,GAAG,EAAE,CAAC,CAAC;IACjD,aAAa,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC;CACjD,CAAC,CAAC,CAAC;AACJ,IAAI,CAAC,IAAI,CAAC,+BAA+B,EAAE,GAAG,EAAE,CAAC,CAAC;IAChD,gBAAgB,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC;IACnD,kBAAkB,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC;CACtD,CAAC,CAAC,CAAC;AACJ,IAAI,CAAC,IAAI,CAAC,iCAAiC,EAAE,GAAG,EAAE,CAAC,CAAC;IAClD,qBAAqB,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC;QACjD,OAAO,EAAE,IAAI;QACb,OAAO,EAAE,eAAe;KACzB,CAAC;CACH,CAAC,CAAC,CAAC;AAlCJ,4CAA4C;AAC5C,0FAA0D;AAmC1D,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;IACpC,EAAE,CAAC,8DAA8D,EAAE,GAAG,EAAE;QACtE,MAAM,KAAK,GAAG,EAAE,UAAU,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,KAAM,CAAC,CAAC,WAAW,EAAE,EAAS,CAAC;QACjF,MAAM,MAAM,GAAI,8BAA4B,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QACpE,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC5B,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,yEAAyE,EAAE,KAAK,IAAI,EAAE;QACvF,MAAM,MAAM,GAAG,MAAM,8BAAoB,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACvE,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE;QACvD,MAAM,KAAK,GAAG;YACZ,EAAE,EAAE,CAAC;YACL,UAAU,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;YACpC,QAAQ,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,OAAS,CAAC,CAAC,WAAW,EAAE;YACxD,MAAM,EAAE,QAAQ;SACjB,CAAC;QACF,MAAM,MAAM,GAAG,MAAM,8BAAoB,CAAC,mBAAmB,CAAC,KAAY,EAAE,SAAS,CAAC,CAAC;QACvF,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,wEAAwE,EAAE,KAAK,IAAI,EAAE;QACtF,MAAM,MAAM,GAAG,MAAM,8BAAoB,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;QACxE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\ParticipationService.test.ts"],"sourcesContent":["// src/services/ParticipationService.test.ts\r\nimport ParticipationService from './ParticipationService';\r\n\r\n// mock do supabase\r\njest.mock('@/lib/supabaseClient', () => ({\r\n  supabase: {\r\n    from: jest.fn(() => ({\r\n      select: jest.fn().mockReturnThis(),\r\n      eq: jest.fn().mockReturnThis(),\r\n      single: jest.fn().mockResolvedValue({ data: { id: 1 }, error: null }),\r\n      maybeSingle: jest.fn().mockResolvedValue({ data: null, error: null }),\r\n      insert: jest.fn().mockReturnThis(),\r\n      update: jest.fn().mockReturnThis(),\r\n      in: jest.fn().mockReturnThis(),\r\n      gte: jest.fn().mockReturnThis(),\r\n      lte: jest.fn().mockReturnThis(),\r\n      order: jest.fn().mockReturnThis(),\r\n    })),\r\n  },\r\n}));\r\n\r\n// mock de serviços externos\r\njest.mock('@/services/NotificationService', () => ({\r\n  createForUser: jest.fn().mockResolvedValue(true),\r\n}));\r\njest.mock('@/services/WaitingListService', () => ({\r\n  addToWaitingList: jest.fn().mockResolvedValue(true),\r\n  processWaitingList: jest.fn().mockResolvedValue(true),\r\n}));\r\njest.mock('@/services/EventSecurityService', () => ({\r\n  validateEntryPassword: jest.fn().mockResolvedValue({\r\n    success: true,\r\n    message: 'Senha correta',\r\n  }),\r\n}));\r\n\r\ndescribe('ParticipationService', () => {\r\n  it('verifica se isEventTooClose retorna true para evento próximo', () => {\r\n    const event = { start_time: new Date(Date.now() + 30_000).toISOString() } as any;\r\n    const result = (ParticipationService as any).isEventTooClose(event);\r\n    expect(result).toBe(true);\r\n  });\r\n\r\n  it('verifica se userAlreadyInEvent retorna exists=false quando não há dados', async () => {\r\n    const result = await ParticipationService.userAlreadyInEvent('1', '2');\r\n    expect(result.exists).toBe(false);\r\n  });\r\n\r\n  it('testa validateApplication sem conflitos', async () => {\r\n    const event = {\r\n      id: 1,\r\n      start_time: new Date().toISOString(),\r\n      end_time: new Date(Date.now() + 3_600_000).toISOString(),\r\n      status: 'Aberto',\r\n    };\r\n    const result = await ParticipationService.validateApplication(event as any, 'user123');\r\n    expect(result.valid).toBe(true);\r\n  });\r\n\r\n  it('verifica se canUserCreateEvent retorna success=true quando sem eventos', async () => {\r\n    const result = await ParticipationService.canUserCreateEvent('user123');\r\n    expect(result.success).toBe(true);\r\n  });\r\n});\r\n"],"version":3}