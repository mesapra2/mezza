{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventStatusService.test.ts","mappings":"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","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventStatusService.test.ts"],"sourcesContent":["// src/services/EventStatusService.test.ts\r\n\r\n// --- 1. MOCKING DEPENDÊNCIAS (ANTES DAS IMPORTAÇÕES) ---\r\n\r\n// Mock do Supabase\r\nconst mockFrom = jest.fn();\r\n\r\njest.mock('../lib/supabaseClient', () => ({\r\n  supabase: {\r\n    from: mockFrom\r\n  }\r\n}));\r\n\r\n// Mock dos outros serviços\r\njest.mock('./EventSecurityService', () => ({\r\n  __esModule: true,\r\n  default: {\r\n    generateAndSavePassword: jest.fn(),\r\n    lockEventEntry: jest.fn(),\r\n  },\r\n}));\r\n\r\njest.mock('./PushNotificationService', () => ({\r\n  __esModule: true,\r\n  default: {\r\n    sendPasswordToHost: jest.fn(),\r\n    sendEventStartNotificationToParticipants: jest.fn(),\r\n  },\r\n}));\r\n\r\njest.mock('./TrustScoreService', () => ({\r\n  __esModule: true,\r\n  default: {\r\n    penalizeNoShowsForEvent: jest.fn(),\r\n  },\r\n}));\r\n\r\n// --- 2. IMPORTAÇÕES (DEPOIS DOS MOCKS) ---\r\n\r\nimport EventStatusService from './EventStatusService';\r\nimport { supabase } from '../lib/supabaseClient';\r\nimport EventSecurityService from './EventSecurityService';\r\nimport PushNotificationService from './PushNotificationService';\r\nimport TrustScoreService from './TrustScoreService';\r\n\r\n// --- 3. CONFIGURAÇÃO DOS TESTES ---\r\n\r\ndescribe('EventStatusService', () => {\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    jest.useFakeTimers();\r\n  });\r\n\r\n  afterEach(() => {\r\n    EventStatusService.stopAutoUpdate();\r\n    jest.useRealTimers();\r\n  });\r\n\r\n  // --- 4. TESTES ---\r\n\r\n  describe('Gerenciamento de Auto-Update', () => {\r\n    it('should start auto-update e ser \"running\"', () => {\r\n      // Mock vazio para não executar lógica real\r\n      mockFrom.mockReturnValue({\r\n        select: jest.fn().mockReturnValue({\r\n          neq: jest.fn().mockReturnValue({\r\n            neq: jest.fn().mockResolvedValue({ data: [], error: null })\r\n          })\r\n        })\r\n      });\r\n\r\n      const intervalId = EventStatusService.startAutoUpdate(30);\r\n      \r\n      expect(intervalId).toBeDefined();\r\n      expect(EventStatusService.isAutoUpdateRunning()).toBe(true);\r\n    });\r\n\r\n    it('should stop auto-update', () => {\r\n      mockFrom.mockReturnValue({\r\n        select: jest.fn().mockReturnValue({\r\n          neq: jest.fn().mockReturnValue({\r\n            neq: jest.fn().mockResolvedValue({ data: [], error: null })\r\n          })\r\n        })\r\n      });\r\n\r\n      EventStatusService.startAutoUpdate(30);\r\n      expect(EventStatusService.isAutoUpdateRunning()).toBe(true);\r\n\r\n      EventStatusService.stopAutoUpdate();\r\n      expect(EventStatusService.isAutoUpdateRunning()).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('updateEventStatus', () => {\r\n    it('deve chamar supabase.update com os parâmetros corretos', async () => {\r\n      const mockEq = jest.fn().mockResolvedValue({ error: null });\r\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\r\n      \r\n      mockFrom.mockReturnValue({\r\n        update: mockUpdate\r\n      });\r\n\r\n      await EventStatusService.updateEventStatus(123, 'NovoStatus');\r\n\r\n      expect(mockFrom).toHaveBeenCalledWith('events');\r\n      expect(mockUpdate).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          status: 'NovoStatus',\r\n        })\r\n      );\r\n      expect(mockEq).toHaveBeenCalledWith('id', 123);\r\n    });\r\n  });\r\n\r\n  describe('Lógica de Status (updateAllEventStatuses)', () => {\r\n    const now = new Date('2025-10-01T10:00:00Z');\r\n    \r\n    beforeEach(() => {\r\n      jest.setSystemTime(now);\r\n    });\r\n\r\n    it('deve mudar status para \"Em Andamento\" quando a hora de início for atingida', async () => {\r\n      const event = {\r\n        id: 1,\r\n        status: 'Aberto',\r\n        start_time: '2025-10-01T09:59:59Z',\r\n        end_time: '2025-10-01T12:00:00Z',\r\n      };\r\n      \r\n      // Primeira chamada: buscar eventos\r\n      // Segunda chamada: atualizar status\r\n      const mockEq = jest.fn().mockResolvedValue({ error: null });\r\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\r\n      \r\n      mockFrom\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            neq: jest.fn().mockReturnValue({\r\n              neq: jest.fn().mockResolvedValue({ data: [event], error: null })\r\n            })\r\n          })\r\n        })\r\n        .mockReturnValueOnce({\r\n          update: mockUpdate\r\n        });\r\n\r\n      await EventStatusService.updateAllEventStatuses();\r\n\r\n      expect(mockFrom).toHaveBeenCalledWith('events');\r\n      expect(mockUpdate).toHaveBeenCalledWith(\r\n        expect.objectContaining({ status: 'Em Andamento' })\r\n      );\r\n      expect(mockEq).toHaveBeenCalledWith('id', 1);\r\n    });\r\n\r\n    it('deve gerar senha e enviar push 1 minuto antes do evento', async () => {\r\n      const startTime = new Date('2025-10-01T10:01:00Z');\r\n      const event = {\r\n        id: 2,\r\n        status: 'Aberto',\r\n        start_time: startTime.toISOString(),\r\n        end_time: '2025-10-01T12:00:00Z',\r\n        creator_id: 'host-id',\r\n        title: 'Evento Teste',\r\n        event_entry_password: null,\r\n      };\r\n\r\n      // Mock das funções dos serviços\r\n      (EventSecurityService.generateAndSavePassword as jest.Mock).mockResolvedValue({\r\n        success: true,\r\n        password: 'mock-123'\r\n      });\r\n      (PushNotificationService.sendPasswordToHost as jest.Mock).mockResolvedValue({\r\n        success: true\r\n      });\r\n      (PushNotificationService.sendEventStartNotificationToParticipants as jest.Mock).mockResolvedValue({\r\n        success: true\r\n      });\r\n\r\n      mockFrom\r\n        // 1. Buscar eventos\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            neq: jest.fn().mockReturnValue({\r\n              neq: jest.fn().mockResolvedValue({ data: [event], error: null })\r\n            })\r\n          })\r\n        })\r\n        // 2. Buscar host profile\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockReturnValue({\r\n              single: jest.fn().mockResolvedValue({\r\n                data: { username: 'Host' },\r\n                error: null\r\n              })\r\n            })\r\n          })\r\n        })\r\n        // 3. Buscar participantes\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockReturnValue({\r\n              eq: jest.fn().mockResolvedValue({\r\n                data: [{ user_id: 'part-1' }],\r\n                error: null\r\n              })\r\n            })\r\n          })\r\n        });\r\n\r\n      await EventStatusService.updateAllEventStatuses();\r\n\r\n      expect(EventSecurityService.generateAndSavePassword).toHaveBeenCalledWith(2);\r\n      expect(PushNotificationService.sendPasswordToHost).toHaveBeenCalledWith(\r\n        'host-id',\r\n        2,\r\n        'mock-123',\r\n        'Evento Teste'\r\n      );\r\n      expect(PushNotificationService.sendEventStartNotificationToParticipants).toHaveBeenCalledWith(\r\n        ['part-1'],\r\n        2,\r\n        'Evento Teste'\r\n      );\r\n    });\r\n    \r\n    it('deve bloquear entrada 1 minuto antes do fim', async () => {\r\n      const endTime = new Date('2025-10-01T10:01:00Z');\r\n      const event = {\r\n        id: 3,\r\n        status: 'Em Andamento',\r\n        start_time: '2025-10-01T09:00:00Z',\r\n        end_time: endTime.toISOString(),\r\n        entry_locked: false,\r\n      };\r\n\r\n      (EventSecurityService.lockEventEntry as jest.Mock).mockResolvedValue({\r\n        success: true\r\n      });\r\n\r\n      mockFrom.mockReturnValue({\r\n        select: jest.fn().mockReturnValue({\r\n          neq: jest.fn().mockReturnValue({\r\n            neq: jest.fn().mockResolvedValue({ data: [event], error: null })\r\n          })\r\n        })\r\n      });\r\n\r\n      await EventStatusService.updateAllEventStatuses();\r\n\r\n      expect(EventSecurityService.lockEventEntry).toHaveBeenCalledWith(3);\r\n    });\r\n\r\n    it('deve mudar status para \"Finalizado\" e penalizar quem não foi', async () => {\r\n      const endTime = new Date('2025-10-01T09:59:59Z');\r\n      const event = {\r\n        id: 4,\r\n        status: 'Em Andamento',\r\n        start_time: '2025-10-01T08:00:00Z',\r\n        end_time: endTime.toISOString(),\r\n      };\r\n\r\n      (TrustScoreService.penalizeNoShowsForEvent as jest.Mock).mockResolvedValue(undefined);\r\n\r\n      const mockEq = jest.fn().mockResolvedValue({ error: null });\r\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\r\n\r\n      mockFrom\r\n        // 1. Buscar eventos\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            neq: jest.fn().mockReturnValue({\r\n              neq: jest.fn().mockResolvedValue({ data: [event], error: null })\r\n            })\r\n          })\r\n        })\r\n        // 2. Atualizar status\r\n        .mockReturnValueOnce({\r\n          update: mockUpdate\r\n        })\r\n        // 3. Buscar participações (para shouldAutoComplete)\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockReturnValue({\r\n              eq: jest.fn().mockResolvedValue({ data: [], error: null })\r\n            })\r\n          })\r\n        });\r\n      \r\n      await EventStatusService.updateAllEventStatuses();\r\n      \r\n      expect(mockUpdate).toHaveBeenCalledWith(\r\n        expect.objectContaining({ status: 'Finalizado' })\r\n      );\r\n      expect(TrustScoreService.penalizeNoShowsForEvent).toHaveBeenCalledWith(4);\r\n    });\r\n\r\n    it('deve mudar status para \"Concluído\" se todos avaliaram', async () => {\r\n      const endTime = new Date('2025-10-01T09:00:00Z');\r\n      const event = {\r\n        id: 5,\r\n        status: 'Finalizado',\r\n        start_time: '2025-10-01T08:00:00Z',\r\n        end_time: endTime.toISOString(),\r\n      };\r\n\r\n      const participants = [\r\n        { id: 'p1', presenca_confirmada: true, avaliacao_feita: true, status: 'aprovado' },\r\n        { id: 'p2', presenca_confirmada: false, avaliacao_feita: false, status: 'aprovado' },\r\n        { id: 'p3', presenca_confirmada: true, avaliacao_feita: true, status: 'aprovado' },\r\n      ];\r\n\r\n      const mockEq = jest.fn().mockResolvedValue({ error: null });\r\n      const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });\r\n\r\n      mockFrom\r\n        // 1. Buscar eventos\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            neq: jest.fn().mockReturnValue({\r\n              neq: jest.fn().mockResolvedValue({ data: [event], error: null })\r\n            })\r\n          })\r\n        })\r\n        // 2. Buscar participações\r\n        .mockReturnValueOnce({\r\n          select: jest.fn().mockReturnValue({\r\n            eq: jest.fn().mockReturnValue({\r\n              eq: jest.fn().mockResolvedValue({ data: participants, error: null })\r\n            })\r\n          })\r\n        })\r\n        // 3. Atualizar para Concluído\r\n        .mockReturnValueOnce({\r\n          update: mockUpdate\r\n        });\r\n      \r\n      await EventStatusService.updateAllEventStatuses();\r\n      \r\n      expect(mockUpdate).toHaveBeenCalledWith(\r\n        expect.objectContaining({ status: 'Concluído' })\r\n      );\r\n    });\r\n  });\r\n});"],"version":3}