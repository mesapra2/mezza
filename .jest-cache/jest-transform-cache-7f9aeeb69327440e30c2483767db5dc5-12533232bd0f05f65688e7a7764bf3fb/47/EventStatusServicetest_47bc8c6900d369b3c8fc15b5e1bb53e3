e90d9cb6c6ab49deca720be0d73e8319
"use strict";
// src/services/EventStatusService.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => ({
    supabase: {
        from: mockFrom
    }
}));
// Mock dos outros serviços
jest.mock('./EventSecurityService', () => ({
    __esModule: true,
    default: {
        generateAndSavePassword: jest.fn(),
        lockEventEntry: jest.fn(),
    },
}));
jest.mock('./PushNotificationService', () => ({
    __esModule: true,
    default: {
        sendPasswordToHost: jest.fn(),
        sendEventStartNotificationToParticipants: jest.fn(),
    },
}));
jest.mock('./TrustScoreService', () => ({
    __esModule: true,
    default: {
        penalizeNoShowsForEvent: jest.fn(),
    },
}));
// --- 1. MOCKING DEPENDÊNCIAS (ANTES DAS IMPORTAÇÕES) ---
// Mock do Supabase
const mockFrom = jest.fn();
// --- 2. IMPORTAÇÕES (DEPOIS DOS MOCKS) ---
const EventStatusService_1 = tslib_1.__importDefault(require("./EventStatusService"));
const EventSecurityService_1 = tslib_1.__importDefault(require("./EventSecurityService"));
const PushNotificationService_1 = tslib_1.__importDefault(require("./PushNotificationService"));
const TrustScoreService_1 = tslib_1.__importDefault(require("./TrustScoreService"));
// --- 3. CONFIGURAÇÃO DOS TESTES ---
describe('EventStatusService', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        jest.useFakeTimers();
    });
    afterEach(() => {
        EventStatusService_1.default.stopAutoUpdate();
        jest.useRealTimers();
    });
    // --- 4. TESTES ---
    describe('Gerenciamento de Auto-Update', () => {
        it('should start auto-update e ser "running"', () => {
            // Mock vazio para não executar lógica real
            mockFrom.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [], error: null })
                    })
                })
            });
            const intervalId = EventStatusService_1.default.startAutoUpdate(30);
            expect(intervalId).toBeDefined();
            expect(EventStatusService_1.default.isAutoUpdateRunning()).toBe(true);
        });
        it('should stop auto-update', () => {
            mockFrom.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [], error: null })
                    })
                })
            });
            EventStatusService_1.default.startAutoUpdate(30);
            expect(EventStatusService_1.default.isAutoUpdateRunning()).toBe(true);
            EventStatusService_1.default.stopAutoUpdate();
            expect(EventStatusService_1.default.isAutoUpdateRunning()).toBe(false);
        });
    });
    describe('updateEventStatus', () => {
        it('deve chamar supabase.update com os parâmetros corretos', async () => {
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom.mockReturnValue({
                update: mockUpdate
            });
            await EventStatusService_1.default.updateEventStatus(123, 'NovoStatus');
            expect(mockFrom).toHaveBeenCalledWith('events');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({
                status: 'NovoStatus',
            }));
            expect(mockEq).toHaveBeenCalledWith('id', 123);
        });
    });
    describe('Lógica de Status (updateAllEventStatuses)', () => {
        const now = new Date('2025-10-01T10:00:00Z');
        beforeEach(() => {
            jest.setSystemTime(now);
        });
        it('deve mudar status para "Em Andamento" quando a hora de início for atingida', async () => {
            const event = {
                id: 1,
                status: 'Aberto',
                start_time: '2025-10-01T09:59:59Z',
                end_time: '2025-10-01T12:00:00Z',
            };
            // Primeira chamada: buscar eventos
            // Segunda chamada: atualizar status
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                .mockReturnValueOnce({
                update: mockUpdate
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(mockFrom).toHaveBeenCalledWith('events');
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'Em Andamento' }));
            expect(mockEq).toHaveBeenCalledWith('id', 1);
        });
        it('deve gerar senha e enviar push 1 minuto antes do evento', async () => {
            const startTime = new Date('2025-10-01T10:01:00Z');
            const event = {
                id: 2,
                status: 'Aberto',
                start_time: startTime.toISOString(),
                end_time: '2025-10-01T12:00:00Z',
                creator_id: 'host-id',
                title: 'Evento Teste',
                event_entry_password: null,
            };
            // Mock das funções dos serviços
            EventSecurityService_1.default.generateAndSavePassword.mockResolvedValue({
                success: true,
                password: 'mock-123'
            });
            PushNotificationService_1.default.sendPasswordToHost.mockResolvedValue({
                success: true
            });
            PushNotificationService_1.default.sendEventStartNotificationToParticipants.mockResolvedValue({
                success: true
            });
            mockFrom
                // 1. Buscar eventos
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                // 2. Buscar host profile
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: { username: 'Host' },
                            error: null
                        })
                    })
                })
            })
                // 3. Buscar participantes
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        eq: jest.fn().mockResolvedValue({
                            data: [{ user_id: 'part-1' }],
                            error: null
                        })
                    })
                })
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(EventSecurityService_1.default.generateAndSavePassword).toHaveBeenCalledWith(2);
            expect(PushNotificationService_1.default.sendPasswordToHost).toHaveBeenCalledWith('host-id', 2, 'mock-123', 'Evento Teste');
            expect(PushNotificationService_1.default.sendEventStartNotificationToParticipants).toHaveBeenCalledWith(['part-1'], 2, 'Evento Teste');
        });
        it('deve bloquear entrada 1 minuto antes do fim', async () => {
            const endTime = new Date('2025-10-01T10:01:00Z');
            const event = {
                id: 3,
                status: 'Em Andamento',
                start_time: '2025-10-01T09:00:00Z',
                end_time: endTime.toISOString(),
                entry_locked: false,
            };
            EventSecurityService_1.default.lockEventEntry.mockResolvedValue({
                success: true
            });
            mockFrom.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(EventSecurityService_1.default.lockEventEntry).toHaveBeenCalledWith(3);
        });
        it('deve mudar status para "Finalizado" e penalizar quem não foi', async () => {
            const endTime = new Date('2025-10-01T09:59:59Z');
            const event = {
                id: 4,
                status: 'Em Andamento',
                start_time: '2025-10-01T08:00:00Z',
                end_time: endTime.toISOString(),
            };
            TrustScoreService_1.default.penalizeNoShowsForEvent.mockResolvedValue(undefined);
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom
                // 1. Buscar eventos
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                // 2. Atualizar status
                .mockReturnValueOnce({
                update: mockUpdate
            })
                // 3. Buscar participações (para shouldAutoComplete)
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        eq: jest.fn().mockResolvedValue({ data: [], error: null })
                    })
                })
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'Finalizado' }));
            expect(TrustScoreService_1.default.penalizeNoShowsForEvent).toHaveBeenCalledWith(4);
        });
        it('deve mudar status para "Concluído" se todos avaliaram', async () => {
            const endTime = new Date('2025-10-01T09:00:00Z');
            const event = {
                id: 5,
                status: 'Finalizado',
                start_time: '2025-10-01T08:00:00Z',
                end_time: endTime.toISOString(),
            };
            const participants = [
                { id: 'p1', presenca_confirmada: true, avaliacao_feita: true, status: 'aprovado' },
                { id: 'p2', presenca_confirmada: false, avaliacao_feita: false, status: 'aprovado' },
                { id: 'p3', presenca_confirmada: true, avaliacao_feita: true, status: 'aprovado' },
            ];
            const mockEq = jest.fn().mockResolvedValue({ error: null });
            const mockUpdate = jest.fn().mockReturnValue({ eq: mockEq });
            mockFrom
                // 1. Buscar eventos
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    neq: jest.fn().mockReturnValue({
                        neq: jest.fn().mockResolvedValue({ data: [event], error: null })
                    })
                })
            })
                // 2. Buscar participações
                .mockReturnValueOnce({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        eq: jest.fn().mockResolvedValue({ data: participants, error: null })
                    })
                })
            })
                // 3. Atualizar para Concluído
                .mockReturnValueOnce({
                update: mockUpdate
            });
            await EventStatusService_1.default.updateAllEventStatuses();
            expect(mockUpdate).toHaveBeenCalledWith(expect.objectContaining({ status: 'Concluído' }));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRTdGF0dXNTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBLDBDQUEwQzs7O0FBTzFDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN4QyxRQUFRLEVBQUU7UUFDUixJQUFJLEVBQUUsUUFBUTtLQUNmO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFFSiwyQkFBMkI7QUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3pDLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLE9BQU8sRUFBRTtRQUNQLHVCQUF1QixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEMsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDMUI7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM1QyxVQUFVLEVBQUUsSUFBSTtJQUNoQixPQUFPLEVBQUU7UUFDUCxrQkFBa0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzdCLHdDQUF3QyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDcEQ7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN0QyxVQUFVLEVBQUUsSUFBSTtJQUNoQixPQUFPLEVBQUU7UUFDUCx1QkFBdUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ25DO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFqQ0osMERBQTBEO0FBRTFELG1CQUFtQjtBQUNuQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFnQzNCLDRDQUE0QztBQUU1QyxzRkFBc0Q7QUFFdEQsMEZBQTBEO0FBQzFELGdHQUFnRTtBQUNoRSxvRkFBb0Q7QUFFcEQscUNBQXFDO0FBRXJDLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFFbEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsNEJBQWtCLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsb0JBQW9CO0lBRXBCLFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7UUFDNUMsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtZQUNsRCwyQ0FBMkM7WUFDM0MsUUFBUSxDQUFDLGVBQWUsQ0FBQztnQkFDdkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7b0JBQ2hDLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO3dCQUM3QixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7cUJBQzVELENBQUM7aUJBQ0gsQ0FBQzthQUNILENBQUMsQ0FBQztZQUVILE1BQU0sVUFBVSxHQUFHLDRCQUFrQixDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUUxRCxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakMsTUFBTSxDQUFDLDRCQUFrQixDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO1lBQ2pDLFFBQVEsQ0FBQyxlQUFlLENBQUM7Z0JBQ3ZCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO29CQUNoQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQzt3QkFDN0IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDO3FCQUM1RCxDQUFDO2lCQUNILENBQUM7YUFDSCxDQUFDLENBQUM7WUFFSCw0QkFBa0IsQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLDRCQUFrQixDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFNUQsNEJBQWtCLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDcEMsTUFBTSxDQUFDLDRCQUFrQixDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RFLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQzVELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUU3RCxRQUFRLENBQUMsZUFBZSxDQUFDO2dCQUN2QixNQUFNLEVBQUUsVUFBVTthQUNuQixDQUFDLENBQUM7WUFFSCxNQUFNLDRCQUFrQixDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUNyQyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3RCLE1BQU0sRUFBRSxZQUFZO2FBQ3JCLENBQUMsQ0FDSCxDQUFDO1lBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtRQUN6RCxNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBRTdDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDRFQUE0RSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzFGLE1BQU0sS0FBSyxHQUFHO2dCQUNaLEVBQUUsRUFBRSxDQUFDO2dCQUNMLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixVQUFVLEVBQUUsc0JBQXNCO2dCQUNsQyxRQUFRLEVBQUUsc0JBQXNCO2FBQ2pDLENBQUM7WUFFRixtQ0FBbUM7WUFDbkMsb0NBQW9DO1lBQ3BDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQzVELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUU3RCxRQUFRO2lCQUNMLG1CQUFtQixDQUFDO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDaEMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7d0JBQzdCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7cUJBQ2pFLENBQUM7aUJBQ0gsQ0FBQzthQUNILENBQUM7aUJBQ0QsbUJBQW1CLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSxVQUFVO2FBQ25CLENBQUMsQ0FBQztZQUVMLE1BQU0sNEJBQWtCLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztZQUVsRCxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUNyQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FDcEQsQ0FBQztZQUNGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseURBQXlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkUsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUNuRCxNQUFNLEtBQUssR0FBRztnQkFDWixFQUFFLEVBQUUsQ0FBQztnQkFDTCxNQUFNLEVBQUUsUUFBUTtnQkFDaEIsVUFBVSxFQUFFLFNBQVMsQ0FBQyxXQUFXLEVBQUU7Z0JBQ25DLFFBQVEsRUFBRSxzQkFBc0I7Z0JBQ2hDLFVBQVUsRUFBRSxTQUFTO2dCQUNyQixLQUFLLEVBQUUsY0FBYztnQkFDckIsb0JBQW9CLEVBQUUsSUFBSTthQUMzQixDQUFDO1lBRUYsZ0NBQWdDO1lBQy9CLDhCQUFvQixDQUFDLHVCQUFxQyxDQUFDLGlCQUFpQixDQUFDO2dCQUM1RSxPQUFPLEVBQUUsSUFBSTtnQkFDYixRQUFRLEVBQUUsVUFBVTthQUNyQixDQUFDLENBQUM7WUFDRixpQ0FBdUIsQ0FBQyxrQkFBZ0MsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDMUUsT0FBTyxFQUFFLElBQUk7YUFDZCxDQUFDLENBQUM7WUFDRixpQ0FBdUIsQ0FBQyx3Q0FBc0QsQ0FBQyxpQkFBaUIsQ0FBQztnQkFDaEcsT0FBTyxFQUFFLElBQUk7YUFDZCxDQUFDLENBQUM7WUFFSCxRQUFRO2dCQUNOLG9CQUFvQjtpQkFDbkIsbUJBQW1CLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO29CQUNoQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQzt3QkFDN0IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztxQkFDakUsQ0FBQztpQkFDSCxDQUFDO2FBQ0gsQ0FBQztnQkFDRix5QkFBeUI7aUJBQ3hCLG1CQUFtQixDQUFDO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDaEMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7d0JBQzVCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7NEJBQ2xDLElBQUksRUFBRSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUU7NEJBQzFCLEtBQUssRUFBRSxJQUFJO3lCQUNaLENBQUM7cUJBQ0gsQ0FBQztpQkFDSCxDQUFDO2FBQ0gsQ0FBQztnQkFDRiwwQkFBMEI7aUJBQ3pCLG1CQUFtQixDQUFDO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDaEMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7d0JBQzVCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7NEJBQzlCLElBQUksRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDOzRCQUM3QixLQUFLLEVBQUUsSUFBSTt5QkFDWixDQUFDO3FCQUNILENBQUM7aUJBQ0gsQ0FBQzthQUNILENBQUMsQ0FBQztZQUVMLE1BQU0sNEJBQWtCLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztZQUVsRCxNQUFNLENBQUMsOEJBQW9CLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3RSxNQUFNLENBQUMsaUNBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxvQkFBb0IsQ0FDckUsU0FBUyxFQUNULENBQUMsRUFDRCxVQUFVLEVBQ1YsY0FBYyxDQUNmLENBQUM7WUFDRixNQUFNLENBQUMsaUNBQXVCLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxvQkFBb0IsQ0FDM0YsQ0FBQyxRQUFRLENBQUMsRUFDVixDQUFDLEVBQ0QsY0FBYyxDQUNmLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMzRCxNQUFNLE9BQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sS0FBSyxHQUFHO2dCQUNaLEVBQUUsRUFBRSxDQUFDO2dCQUNMLE1BQU0sRUFBRSxjQUFjO2dCQUN0QixVQUFVLEVBQUUsc0JBQXNCO2dCQUNsQyxRQUFRLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRTtnQkFDL0IsWUFBWSxFQUFFLEtBQUs7YUFDcEIsQ0FBQztZQUVELDhCQUFvQixDQUFDLGNBQTRCLENBQUMsaUJBQWlCLENBQUM7Z0JBQ25FLE9BQU8sRUFBRSxJQUFJO2FBQ2QsQ0FBQyxDQUFDO1lBRUgsUUFBUSxDQUFDLGVBQWUsQ0FBQztnQkFDdkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7b0JBQ2hDLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO3dCQUM3QixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDO3FCQUNqRSxDQUFDO2lCQUNILENBQUM7YUFDSCxDQUFDLENBQUM7WUFFSCxNQUFNLDRCQUFrQixDQUFDLHNCQUFzQixFQUFFLENBQUM7WUFFbEQsTUFBTSxDQUFDLDhCQUFvQixDQUFDLGNBQWMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhEQUE4RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVFLE1BQU0sT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDakQsTUFBTSxLQUFLLEdBQUc7Z0JBQ1osRUFBRSxFQUFFLENBQUM7Z0JBQ0wsTUFBTSxFQUFFLGNBQWM7Z0JBQ3RCLFVBQVUsRUFBRSxzQkFBc0I7Z0JBQ2xDLFFBQVEsRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFO2FBQ2hDLENBQUM7WUFFRCwyQkFBaUIsQ0FBQyx1QkFBcUMsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUV0RixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUM1RCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFFN0QsUUFBUTtnQkFDTixvQkFBb0I7aUJBQ25CLG1CQUFtQixDQUFDO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDaEMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7d0JBQzdCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7cUJBQ2pFLENBQUM7aUJBQ0gsQ0FBQzthQUNILENBQUM7Z0JBQ0Ysc0JBQXNCO2lCQUNyQixtQkFBbUIsQ0FBQztnQkFDbkIsTUFBTSxFQUFFLFVBQVU7YUFDbkIsQ0FBQztnQkFDRixvREFBb0Q7aUJBQ25ELG1CQUFtQixDQUFDO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDaEMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7d0JBQzVCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztxQkFDM0QsQ0FBQztpQkFDSCxDQUFDO2FBQ0gsQ0FBQyxDQUFDO1lBRUwsTUFBTSw0QkFBa0IsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBRWxELE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxvQkFBb0IsQ0FDckMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQ2xELENBQUM7WUFDRixNQUFNLENBQUMsMkJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRSxNQUFNLE9BQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sS0FBSyxHQUFHO2dCQUNaLEVBQUUsRUFBRSxDQUFDO2dCQUNMLE1BQU0sRUFBRSxZQUFZO2dCQUNwQixVQUFVLEVBQUUsc0JBQXNCO2dCQUNsQyxRQUFRLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRTthQUNoQyxDQUFDO1lBRUYsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxtQkFBbUIsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFO2dCQUNsRixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRTtnQkFDcEYsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLG1CQUFtQixFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUU7YUFDbkYsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQzVELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUU3RCxRQUFRO2dCQUNOLG9CQUFvQjtpQkFDbkIsbUJBQW1CLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO29CQUNoQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQzt3QkFDN0IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztxQkFDakUsQ0FBQztpQkFDSCxDQUFDO2FBQ0gsQ0FBQztnQkFDRiwwQkFBMEI7aUJBQ3pCLG1CQUFtQixDQUFDO2dCQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDaEMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUM7d0JBQzVCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztxQkFDckUsQ0FBQztpQkFDSCxDQUFDO2FBQ0gsQ0FBQztnQkFDRiw4QkFBOEI7aUJBQzdCLG1CQUFtQixDQUFDO2dCQUNuQixNQUFNLEVBQUUsVUFBVTthQUNuQixDQUFDLENBQUM7WUFFTCxNQUFNLDRCQUFrQixDQUFDLHNCQUFzQixFQUFFLENBQUM7WUFFbEQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUNyQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FDakQsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcREVWTWl4XFxBcHAuTWVzYXByYTIuY29tXFxzcmNcXHNlcnZpY2VzXFxFdmVudFN0YXR1c1NlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmljZXMvRXZlbnRTdGF0dXNTZXJ2aWNlLnRlc3QudHNcclxuXHJcbi8vIC0tLSAxLiBNT0NLSU5HIERFUEVORMOKTkNJQVMgKEFOVEVTIERBUyBJTVBPUlRBw4fDlUVTKSAtLS1cclxuXHJcbi8vIE1vY2sgZG8gU3VwYWJhc2VcclxuY29uc3QgbW9ja0Zyb20gPSBqZXN0LmZuKCk7XHJcblxyXG5qZXN0Lm1vY2soJy4uL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+ICh7XHJcbiAgc3VwYWJhc2U6IHtcclxuICAgIGZyb206IG1vY2tGcm9tXHJcbiAgfVxyXG59KSk7XHJcblxyXG4vLyBNb2NrIGRvcyBvdXRyb3Mgc2VydmnDp29zXHJcbmplc3QubW9jaygnLi9FdmVudFNlY3VyaXR5U2VydmljZScsICgpID0+ICh7XHJcbiAgX19lc01vZHVsZTogdHJ1ZSxcclxuICBkZWZhdWx0OiB7XHJcbiAgICBnZW5lcmF0ZUFuZFNhdmVQYXNzd29yZDogamVzdC5mbigpLFxyXG4gICAgbG9ja0V2ZW50RW50cnk6IGplc3QuZm4oKSxcclxuICB9LFxyXG59KSk7XHJcblxyXG5qZXN0Lm1vY2soJy4vUHVzaE5vdGlmaWNhdGlvblNlcnZpY2UnLCAoKSA9PiAoe1xyXG4gIF9fZXNNb2R1bGU6IHRydWUsXHJcbiAgZGVmYXVsdDoge1xyXG4gICAgc2VuZFBhc3N3b3JkVG9Ib3N0OiBqZXN0LmZuKCksXHJcbiAgICBzZW5kRXZlbnRTdGFydE5vdGlmaWNhdGlvblRvUGFydGljaXBhbnRzOiBqZXN0LmZuKCksXHJcbiAgfSxcclxufSkpO1xyXG5cclxuamVzdC5tb2NrKCcuL1RydXN0U2NvcmVTZXJ2aWNlJywgKCkgPT4gKHtcclxuICBfX2VzTW9kdWxlOiB0cnVlLFxyXG4gIGRlZmF1bHQ6IHtcclxuICAgIHBlbmFsaXplTm9TaG93c0ZvckV2ZW50OiBqZXN0LmZuKCksXHJcbiAgfSxcclxufSkpO1xyXG5cclxuLy8gLS0tIDIuIElNUE9SVEHDh8OVRVMgKERFUE9JUyBET1MgTU9DS1MpIC0tLVxyXG5cclxuaW1wb3J0IEV2ZW50U3RhdHVzU2VydmljZSBmcm9tICcuL0V2ZW50U3RhdHVzU2VydmljZSc7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vbGliL3N1cGFiYXNlQ2xpZW50JztcclxuaW1wb3J0IEV2ZW50U2VjdXJpdHlTZXJ2aWNlIGZyb20gJy4vRXZlbnRTZWN1cml0eVNlcnZpY2UnO1xyXG5pbXBvcnQgUHVzaE5vdGlmaWNhdGlvblNlcnZpY2UgZnJvbSAnLi9QdXNoTm90aWZpY2F0aW9uU2VydmljZSc7XHJcbmltcG9ydCBUcnVzdFNjb3JlU2VydmljZSBmcm9tICcuL1RydXN0U2NvcmVTZXJ2aWNlJztcclxuXHJcbi8vIC0tLSAzLiBDT05GSUdVUkHDh8ODTyBET1MgVEVTVEVTIC0tLVxyXG5cclxuZGVzY3JpYmUoJ0V2ZW50U3RhdHVzU2VydmljZScsICgpID0+IHtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgRXZlbnRTdGF0dXNTZXJ2aWNlLnN0b3BBdXRvVXBkYXRlKCk7XHJcbiAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgLy8gLS0tIDQuIFRFU1RFUyAtLS1cclxuXHJcbiAgZGVzY3JpYmUoJ0dlcmVuY2lhbWVudG8gZGUgQXV0by1VcGRhdGUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHN0YXJ0IGF1dG8tdXBkYXRlIGUgc2VyIFwicnVubmluZ1wiJywgKCkgPT4ge1xyXG4gICAgICAvLyBNb2NrIHZhemlvIHBhcmEgbsOjbyBleGVjdXRhciBsw7NnaWNhIHJlYWxcclxuICAgICAgbW9ja0Zyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBbXSwgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBpbnRlcnZhbElkID0gRXZlbnRTdGF0dXNTZXJ2aWNlLnN0YXJ0QXV0b1VwZGF0ZSgzMCk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaW50ZXJ2YWxJZCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KEV2ZW50U3RhdHVzU2VydmljZS5pc0F1dG9VcGRhdGVSdW5uaW5nKCkpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHN0b3AgYXV0by11cGRhdGUnLCAoKSA9PiB7XHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgRXZlbnRTdGF0dXNTZXJ2aWNlLnN0YXJ0QXV0b1VwZGF0ZSgzMCk7XHJcbiAgICAgIGV4cGVjdChFdmVudFN0YXR1c1NlcnZpY2UuaXNBdXRvVXBkYXRlUnVubmluZygpKS50b0JlKHRydWUpO1xyXG5cclxuICAgICAgRXZlbnRTdGF0dXNTZXJ2aWNlLnN0b3BBdXRvVXBkYXRlKCk7XHJcbiAgICAgIGV4cGVjdChFdmVudFN0YXR1c1NlcnZpY2UuaXNBdXRvVXBkYXRlUnVubmluZygpKS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBkYXRlRXZlbnRTdGF0dXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSBjaGFtYXIgc3VwYWJhc2UudXBkYXRlIGNvbSBvcyBwYXLDom1ldHJvcyBjb3JyZXRvcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0VxID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgZXE6IG1vY2tFcSB9KTtcclxuICAgICAgXHJcbiAgICAgIG1vY2tGcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgdXBkYXRlOiBtb2NrVXBkYXRlXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgYXdhaXQgRXZlbnRTdGF0dXNTZXJ2aWNlLnVwZGF0ZUV2ZW50U3RhdHVzKDEyMywgJ05vdm9TdGF0dXMnKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrRnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50cycpO1xyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgc3RhdHVzOiAnTm92b1N0YXR1cycsXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KG1vY2tFcSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2lkJywgMTIzKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnTMOzZ2ljYSBkZSBTdGF0dXMgKHVwZGF0ZUFsbEV2ZW50U3RhdHVzZXMpJywgKCkgPT4ge1xyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoJzIwMjUtMTAtMDFUMTA6MDA6MDBaJyk7XHJcbiAgICBcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBqZXN0LnNldFN5c3RlbVRpbWUobm93KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZXZlIG11ZGFyIHN0YXR1cyBwYXJhIFwiRW0gQW5kYW1lbnRvXCIgcXVhbmRvIGEgaG9yYSBkZSBpbsOtY2lvIGZvciBhdGluZ2lkYScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXZlbnQgPSB7XHJcbiAgICAgICAgaWQ6IDEsXHJcbiAgICAgICAgc3RhdHVzOiAnQWJlcnRvJyxcclxuICAgICAgICBzdGFydF90aW1lOiAnMjAyNS0xMC0wMVQwOTo1OTo1OVonLFxyXG4gICAgICAgIGVuZF90aW1lOiAnMjAyNS0xMC0wMVQxMjowMDowMFonLFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gUHJpbWVpcmEgY2hhbWFkYTogYnVzY2FyIGV2ZW50b3NcclxuICAgICAgLy8gU2VndW5kYSBjaGFtYWRhOiBhdHVhbGl6YXIgc3RhdHVzXHJcbiAgICAgIGNvbnN0IG1vY2tFcSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IGVxOiBtb2NrRXEgfSk7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrRnJvbVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBbZXZlbnRdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHVwZGF0ZTogbW9ja1VwZGF0ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgYXdhaXQgRXZlbnRTdGF0dXNTZXJ2aWNlLnVwZGF0ZUFsbEV2ZW50U3RhdHVzZXMoKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrRnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50cycpO1xyXG4gICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBzdGF0dXM6ICdFbSBBbmRhbWVudG8nIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChtb2NrRXEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdpZCcsIDEpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgZ2VyYXIgc2VuaGEgZSBlbnZpYXIgcHVzaCAxIG1pbnV0byBhbnRlcyBkbyBldmVudG8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCcyMDI1LTEwLTAxVDEwOjAxOjAwWicpO1xyXG4gICAgICBjb25zdCBldmVudCA9IHtcclxuICAgICAgICBpZDogMixcclxuICAgICAgICBzdGF0dXM6ICdBYmVydG8nLFxyXG4gICAgICAgIHN0YXJ0X3RpbWU6IHN0YXJ0VGltZS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIGVuZF90aW1lOiAnMjAyNS0xMC0wMVQxMjowMDowMFonLFxyXG4gICAgICAgIGNyZWF0b3JfaWQ6ICdob3N0LWlkJyxcclxuICAgICAgICB0aXRsZTogJ0V2ZW50byBUZXN0ZScsXHJcbiAgICAgICAgZXZlbnRfZW50cnlfcGFzc3dvcmQ6IG51bGwsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBNb2NrIGRhcyBmdW7Dp8O1ZXMgZG9zIHNlcnZpw6dvc1xyXG4gICAgICAoRXZlbnRTZWN1cml0eVNlcnZpY2UuZ2VuZXJhdGVBbmRTYXZlUGFzc3dvcmQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICBwYXNzd29yZDogJ21vY2stMTIzJ1xyXG4gICAgICB9KTtcclxuICAgICAgKFB1c2hOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRQYXNzd29yZFRvSG9zdCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlXHJcbiAgICAgIH0pO1xyXG4gICAgICAoUHVzaE5vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZEV2ZW50U3RhcnROb3RpZmljYXRpb25Ub1BhcnRpY2lwYW50cyBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb21cclxuICAgICAgICAvLyAxLiBCdXNjYXIgZXZlbnRvc1xyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBbZXZlbnRdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIDIuIEJ1c2NhciBob3N0IHByb2ZpbGVcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgZGF0YTogeyB1c2VybmFtZTogJ0hvc3QnIH0sXHJcbiAgICAgICAgICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLy8gMy4gQnVzY2FyIHBhcnRpY2lwYW50ZXNcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBbeyB1c2VyX2lkOiAncGFydC0xJyB9XSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICBhd2FpdCBFdmVudFN0YXR1c1NlcnZpY2UudXBkYXRlQWxsRXZlbnRTdGF0dXNlcygpO1xyXG5cclxuICAgICAgZXhwZWN0KEV2ZW50U2VjdXJpdHlTZXJ2aWNlLmdlbmVyYXRlQW5kU2F2ZVBhc3N3b3JkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgyKTtcclxuICAgICAgZXhwZWN0KFB1c2hOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmRQYXNzd29yZFRvSG9zdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgJ2hvc3QtaWQnLFxyXG4gICAgICAgIDIsXHJcbiAgICAgICAgJ21vY2stMTIzJyxcclxuICAgICAgICAnRXZlbnRvIFRlc3RlJ1xyXG4gICAgICApO1xyXG4gICAgICBleHBlY3QoUHVzaE5vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZEV2ZW50U3RhcnROb3RpZmljYXRpb25Ub1BhcnRpY2lwYW50cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgWydwYXJ0LTEnXSxcclxuICAgICAgICAyLFxyXG4gICAgICAgICdFdmVudG8gVGVzdGUnXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaXQoJ2RldmUgYmxvcXVlYXIgZW50cmFkYSAxIG1pbnV0byBhbnRlcyBkbyBmaW0nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgnMjAyNS0xMC0wMVQxMDowMTowMFonKTtcclxuICAgICAgY29uc3QgZXZlbnQgPSB7XHJcbiAgICAgICAgaWQ6IDMsXHJcbiAgICAgICAgc3RhdHVzOiAnRW0gQW5kYW1lbnRvJyxcclxuICAgICAgICBzdGFydF90aW1lOiAnMjAyNS0xMC0wMVQwOTowMDowMFonLFxyXG4gICAgICAgIGVuZF90aW1lOiBlbmRUaW1lLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgZW50cnlfbG9ja2VkOiBmYWxzZSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIChFdmVudFNlY3VyaXR5U2VydmljZS5sb2NrRXZlbnRFbnRyeSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBbZXZlbnRdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGF3YWl0IEV2ZW50U3RhdHVzU2VydmljZS51cGRhdGVBbGxFdmVudFN0YXR1c2VzKCk7XHJcblxyXG4gICAgICBleHBlY3QoRXZlbnRTZWN1cml0eVNlcnZpY2UubG9ja0V2ZW50RW50cnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgbXVkYXIgc3RhdHVzIHBhcmEgXCJGaW5hbGl6YWRvXCIgZSBwZW5hbGl6YXIgcXVlbSBuw6NvIGZvaScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCcyMDI1LTEwLTAxVDA5OjU5OjU5WicpO1xyXG4gICAgICBjb25zdCBldmVudCA9IHtcclxuICAgICAgICBpZDogNCxcclxuICAgICAgICBzdGF0dXM6ICdFbSBBbmRhbWVudG8nLFxyXG4gICAgICAgIHN0YXJ0X3RpbWU6ICcyMDI1LTEwLTAxVDA4OjAwOjAwWicsXHJcbiAgICAgICAgZW5kX3RpbWU6IGVuZFRpbWUudG9JU09TdHJpbmcoKSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIChUcnVzdFNjb3JlU2VydmljZS5wZW5hbGl6ZU5vU2hvd3NGb3JFdmVudCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcblxyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb21cclxuICAgICAgICAvLyAxLiBCdXNjYXIgZXZlbnRvc1xyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBbZXZlbnRdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIDIuIEF0dWFsaXphciBzdGF0dXNcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICB1cGRhdGU6IG1vY2tVcGRhdGVcclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIDMuIEJ1c2NhciBwYXJ0aWNpcGHDp8O1ZXMgKHBhcmEgc2hvdWxkQXV0b0NvbXBsZXRlKVxyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgYXdhaXQgRXZlbnRTdGF0dXNTZXJ2aWNlLnVwZGF0ZUFsbEV2ZW50U3RhdHVzZXMoKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtb2NrVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHN0YXR1czogJ0ZpbmFsaXphZG8nIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChUcnVzdFNjb3JlU2VydmljZS5wZW5hbGl6ZU5vU2hvd3NGb3JFdmVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoNCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSBtdWRhciBzdGF0dXMgcGFyYSBcIkNvbmNsdcOtZG9cIiBzZSB0b2RvcyBhdmFsaWFyYW0nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgnMjAyNS0xMC0wMVQwOTowMDowMFonKTtcclxuICAgICAgY29uc3QgZXZlbnQgPSB7XHJcbiAgICAgICAgaWQ6IDUsXHJcbiAgICAgICAgc3RhdHVzOiAnRmluYWxpemFkbycsXHJcbiAgICAgICAgc3RhcnRfdGltZTogJzIwMjUtMTAtMDFUMDg6MDA6MDBaJyxcclxuICAgICAgICBlbmRfdGltZTogZW5kVGltZS50b0lTT1N0cmluZygpLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcGFydGljaXBhbnRzID0gW1xyXG4gICAgICAgIHsgaWQ6ICdwMScsIHByZXNlbmNhX2NvbmZpcm1hZGE6IHRydWUsIGF2YWxpYWNhb19mZWl0YTogdHJ1ZSwgc3RhdHVzOiAnYXByb3ZhZG8nIH0sXHJcbiAgICAgICAgeyBpZDogJ3AyJywgcHJlc2VuY2FfY29uZmlybWFkYTogZmFsc2UsIGF2YWxpYWNhb19mZWl0YTogZmFsc2UsIHN0YXR1czogJ2Fwcm92YWRvJyB9LFxyXG4gICAgICAgIHsgaWQ6ICdwMycsIHByZXNlbmNhX2NvbmZpcm1hZGE6IHRydWUsIGF2YWxpYWNhb19mZWl0YTogdHJ1ZSwgc3RhdHVzOiAnYXByb3ZhZG8nIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBjb25zdCBtb2NrRXEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBlcTogbW9ja0VxIH0pO1xyXG5cclxuICAgICAgbW9ja0Zyb21cclxuICAgICAgICAvLyAxLiBCdXNjYXIgZXZlbnRvc1xyXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKHtcclxuICAgICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgbmVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiBbZXZlbnRdLCBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIDIuIEJ1c2NhciBwYXJ0aWNpcGHDp8O1ZXNcclxuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSh7XHJcbiAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IHBhcnRpY2lwYW50cywgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyAzLiBBdHVhbGl6YXIgcGFyYSBDb25jbHXDrWRvXHJcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2Uoe1xyXG4gICAgICAgICAgdXBkYXRlOiBtb2NrVXBkYXRlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCBFdmVudFN0YXR1c1NlcnZpY2UudXBkYXRlQWxsRXZlbnRTdGF0dXNlcygpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgc3RhdHVzOiAnQ29uY2x1w61kbycgfSlcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=