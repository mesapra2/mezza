15cdf08abedd5b8f3d3ea5e4bc0865fc
"use strict";
// src/services/EventPhotosService.test.ts
/* eslint-disable @typescript-eslint/no-explicit-any */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => {
    const from = jest.fn();
    const storageFrom = jest.fn();
    return {
        supabase: {
            from,
            storage: {
                from: storageFrom
            }
        }
    };
});
const EventPhotosService_1 = tslib_1.__importDefault(require("./EventPhotosService"));
const supabaseClient_1 = require("../lib/supabaseClient");
describe('EventPhotosService', () => {
    const mockedSupabase = supabaseClient_1.supabase;
    // helpers de narrowing SEM acessar propriedades do outro ramo
    function assertFailure(result, message) {
        if (result.success) {
            throw new Error('expected failure but got success');
        }
        expect(result.success).toBe(false);
        if (message) {
            expect(result.error).toBe(message);
        }
    }
    function assertSuccess(result) {
        expect(result.success).toBe(true);
        if (result.success) {
            expect(result.photoUrl).toBeDefined();
        }
    }
    const makeFile = (name = 'photo.jpg', size = 1024, type = 'image/jpeg') => ({
        name,
        size,
        type
    });
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('uploadEventPhoto', () => {
        it('retorna erro quando o arquivo não é imagem', async () => {
            const file = makeFile('doc.pdf', 1000, 'application/pdf');
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'Apenas imagens são permitidas');
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('retorna erro quando o arquivo tem mais de 10MB antes do resize', async () => {
            const big = makeFile('big.jpg', 10 * 1024 * 1024 + 5);
            const result = await EventPhotosService_1.default.uploadEventPhoto(2, 'user-2', big);
            assertFailure(result, 'Arquivo muito grande (máx: 10MB)');
        });
        it('faz upload de nova foto, deleta a anterior e salva no BD', async () => {
            const file = makeFile();
            const oldPhoto = {
                id: 99,
                event_id: 1,
                user_id: 'user-1',
                photo_url: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-old.jpg',
                status: 'aprovado'
            };
            const getUserSpy = jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(oldPhoto);
            const deleteSpy = jest
                .spyOn(EventPhotosService_1.default, 'deleteEventPhoto')
                .mockResolvedValue(true);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove: jest.fn()
            });
            const insert = jest.fn().mockResolvedValue({ error: null });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertSuccess(result);
            if (result.success) {
                expect(result.photoUrl).toContain('event-photos/1/user-1-');
            }
            expect(getUserSpy).toHaveBeenCalledWith(1, 'user-1');
            expect(deleteSpy).toHaveBeenCalledWith(99, 'user-1');
            getUserSpy.mockRestore();
            deleteSpy.mockRestore();
        });
        it('remove o arquivo do storage se o insert no BD falhar', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            const remove = jest.fn();
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove
            });
            const insert = jest.fn().mockResolvedValue({
                error: { message: 'db error' }
            });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'db error');
            expect(remove).toHaveBeenCalled();
        });
        it('retorna erro quando o upload no storage falha', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({
                error: { message: 'storage error' }
            });
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl: jest.fn(),
                remove: jest.fn()
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(5, 'user-5', file);
            assertFailure(result, 'storage error');
        });
    });
    describe('getEventPhotos', () => {
        it('busca fotos aprovadas do evento', async () => {
            const select = jest.fn(() => ({
                eq: jest
                    .fn()
                    .mockImplementationOnce(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: [
                                {
                                    id: 1,
                                    event_id: 10,
                                    user_id: 'u1',
                                    photo_url: 'https://example.com/p1.jpg',
                                    status: 'aprovado'
                                }
                            ],
                            error: null
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toHaveLength(1);
            expect(photos[0].photo_url).toBe('https://example.com/p1.jpg');
        });
        it('retorna array vazio em caso de erro', async () => {
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: null,
                            error: { message: 'erro' }
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toEqual([]);
        });
    });
    describe('getUserPhotoForEvent', () => {
        it('retorna a foto do usuário quando existir', async () => {
            const mockChain = {
                eq: jest.fn(function () {
                    return {
                        eq: jest.fn(function () {
                            return {
                                maybeSingle: jest.fn().mockResolvedValue({
                                    data: {
                                        id: 2,
                                        event_id: 11,
                                        user_id: 'user-1',
                                        photo_url: 'https://example.com/p2.jpg',
                                        status: 'aprovado'
                                    },
                                    error: null
                                })
                            };
                        })
                    };
                })
            };
            mockedSupabase.from.mockReturnValue({
                select: jest.fn(() => mockChain)
            });
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).not.toBeNull();
            expect(photo?.photo_url).toBe('https://example.com/p2.jpg');
        });
        it('retorna null em caso de erro', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'erro' }
            });
            const eq = jest.fn(() => ({ maybeSingle }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).toBeNull();
        });
    });
    describe('deleteEventPhoto', () => {
        it('retorna false se a foto não existir', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'not found' }
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
        });
        it('retorna false se não for o dono da foto', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 5,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/other.jpg',
                    user_id: 'outro-user'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('deleta do storage e do BD quando for o dono', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 7,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/user-1-123.jpg',
                    user_id: 'user-1'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            const deleteFn = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn().mockResolvedValue({ error: null })
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        select,
                        delete: deleteFn
                    };
                }
                return {};
            });
            const remove = jest.fn().mockResolvedValue({});
            mockedSupabase.storage.from.mockReturnValue({
                remove
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-1');
            expect(result).toBe(true);
            expect(mockedSupabase.storage.from).toHaveBeenCalledWith('event-photos');
            expect(remove).toHaveBeenCalledWith(['10/user-1-123.jpg']);
            expect(deleteFn).toHaveBeenCalled();
        });
    });
    describe('getPhotoStats', () => {
        it('retorna estatísticas calculadas', async () => {
            let callCount = 0;
            mockedSupabase.from.mockImplementation((table) => {
                callCount++;
                if (callCount === 1 && table === 'event_photos') {
                    return {
                        select: jest.fn(() => ({
                            eq: jest.fn(() => ({
                                eq: jest.fn().mockResolvedValue({
                                    count: 3,
                                    error: null
                                })
                            }))
                        }))
                    };
                }
                if (callCount === 2 && table === 'event_participants') {
                    return {
                        select: jest.fn(() => ({
                            eq: jest.fn().mockResolvedValue({
                                count: 6,
                                error: null
                            })
                        }))
                    };
                }
                return {};
            });
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            expect(stats.totalPhotos).toBe(3);
            expect(stats.totalParticipants).toBe(6);
            expect(stats.percentageWithPhotos).toBeCloseTo(50);
        });
        it('retorna tudo 0 em caso de erro', async () => {
            mockedSupabase.from.mockReturnValue({
                select: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        eq: jest.fn(() => ({
                            eq: jest.fn().mockRejectedValue(new Error('erro'))
                        }))
                    }))
                }))
            });
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            const expected = {
                totalPhotos: 0,
                totalParticipants: 0,
                percentageWithPhotos: 0
            };
            expect(stats).toEqual(expected);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRQaG90b3NTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBLDBDQUEwQztBQUMxQyx1REFBdUQ7OztBQVN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtJQUN0QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7SUFDdkIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQzlCLE9BQU87UUFDTCxRQUFRLEVBQUU7WUFDUixJQUFJO1lBQ0osT0FBTyxFQUFFO2dCQUNQLElBQUksRUFBRSxXQUFXO2FBQ2xCO1NBQ0Y7S0FDRixDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFsQkgsc0ZBSThCO0FBQzlCLDBEQUFpRDtBQWVqRCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2xDLE1BQU0sY0FBYyxHQUFHLHlCQUt0QixDQUFDO0lBRUYsOERBQThEO0lBQzlELFNBQVMsYUFBYSxDQUNwQixNQUFvQixFQUNwQixPQUFnQjtRQUVoQixJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDdEQsQ0FBQztRQUNELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25DLElBQUksT0FBTyxFQUFFLENBQUM7WUFDWixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxDQUFDO0lBQ0gsQ0FBQztJQUVELFNBQVMsYUFBYSxDQUNwQixNQUFvQjtRQUVwQixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxJQUFJLE1BQU0s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QyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDOUMsY0FBYyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7Z0JBQ2xDLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7b0JBQ3JCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7d0JBQ2pCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7NEJBQ2pCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7eUJBQ25ELENBQUMsQ0FBQztxQkFDSixDQUFDLENBQUM7aUJBQ0osQ0FBQyxDQUFDO2FBQ08sQ0FBQyxDQUFDO1lBRWQsTUFBTSxLQUFLLEdBQUcsTUFBTSw0QkFBa0IsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFekQsTUFBTSxRQUFRLEdBQWU7Z0JBQzNCLFdBQVcsRUFBRSxDQUFDO2dCQUNkLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BCLG9CQUFvQixFQUFFLENBQUM7YUFDeEIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcc2VydmljZXNcXEV2ZW50UGhvdG9zU2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2aWNlcy9FdmVudFBob3Rvc1NlcnZpY2UudGVzdC50c1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXHJcblxyXG5pbXBvcnQgRXZlbnRQaG90b3NTZXJ2aWNlLCB7XHJcbiAgdHlwZSBFdmVudFBob3RvLFxyXG4gIHR5cGUgUGhvdG9TdGF0cyxcclxuICB0eXBlIFVwbG9hZFJlc3VsdFxyXG59IGZyb20gJy4vRXZlbnRQaG90b3NTZXJ2aWNlJztcclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9saWIvc3VwYWJhc2VDbGllbnQnO1xyXG5cclxuamVzdC5tb2NrKCcuLi9saWIvc3VwYWJhc2VDbGllbnQnLCAoKSA9PiB7XHJcbiAgY29uc3QgZnJvbSA9IGplc3QuZm4oKTtcclxuICBjb25zdCBzdG9yYWdlRnJvbSA9IGplc3QuZm4oKTtcclxuICByZXR1cm4ge1xyXG4gICAgc3VwYWJhc2U6IHtcclxuICAgICAgZnJvbSxcclxuICAgICAgc3RvcmFnZToge1xyXG4gICAgICAgIGZyb206IHN0b3JhZ2VGcm9tXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG59KTtcclxuXHJcbmRlc2NyaWJlKCdFdmVudFBob3Rvc1NlcnZpY2UnLCAoKSA9PiB7XHJcbiAgY29uc3QgbW9ja2VkU3VwYWJhc2UgPSBzdXBhYmFzZSBhcyB1bmtub3duIGFzIHtcclxuICAgIGZyb206IGplc3QuTW9jaztcclxuICAgIHN0b3JhZ2U6IHtcclxuICAgICAgZnJvbTogamVzdC5Nb2NrO1xyXG4gICAgfTtcclxuICB9O1xyXG5cclxuICAvLyBoZWxwZXJzIGRlIG5hcnJvd2luZyBTRU0gYWNlc3NhciBwcm9wcmllZGFkZXMgZG8gb3V0cm8gcmFtb1xyXG4gIGZ1bmN0aW9uIGFzc2VydEZhaWx1cmUoXHJcbiAgICByZXN1bHQ6IFVwbG9hZFJlc3VsdCxcclxuICAgIG1lc3NhZ2U/OiBzdHJpbmdcclxuICApOiBhc3NlcnRzIHJlc3VsdCBpcyB7IHN1Y2Nlc3M6IGZhbHNlOyBlcnJvcjogc3RyaW5nIH0ge1xyXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignZXhwZWN0ZWQgZmFpbHVyZSBidXQgZ290IHN1Y2Nlc3MnKTtcclxuICAgIH1cclxuICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICBpZiAobWVzc2FnZSkge1xyXG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXNzZXJ0U3VjY2VzcyhcclxuICAgIHJlc3VsdDogVXBsb2FkUmVzdWx0XHJcbiAgKTogYXNzZXJ0cyByZXN1bHQgaXMgeyBzdWNjZXNzOiB0cnVlOyBwaG90b1VybDogc3RyaW5nIH0ge1xyXG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucGhvdG9VcmwpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCBtYWtlRmlsZSA9IChcclxuICAgIG5hbWUgPSAncGhvdG8uanBnJyxcclxuICAgIHNpemUgPSAxMDI0LFxyXG4gICAgdHlwZSA9ICdpbWFnZS9qcGVnJ1xyXG4gICk6IEZpbGUgPT5cclxuICAgICh7XHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIHNpemUsXHJcbiAgICAgIHR5cGVcclxuICAgIH0gYXMgdW5rbm93biBhcyBGaWxlKTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3VwbG9hZEV2ZW50UGhvdG8nLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0b3JuYSBlcnJvIHF1YW5kbyBvIGFycXVpdm8gbsOjbyDDqSBpbWFnZW0nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBtYWtlRmlsZSgnZG9jLnBkZicsIDEwMDAsICdhcHBsaWNhdGlvbi9wZGYnKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS51cGxvYWRFdmVudFBob3RvKDEsICd1c2VyLTEnLCBmaWxlKTtcclxuXHJcbiAgICAgIGFzc2VydEZhaWx1cmUocmVzdWx0LCAnQXBlbmFzIGltYWdlbnMgc8OjbyBwZXJtaXRpZGFzJyk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBlcnJvIHF1YW5kbyBvIGFycXVpdm8gdGVtIG1haXMgZGUgMTBNQiBhbnRlcyBkbyByZXNpemUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGJpZyA9IG1ha2VGaWxlKCdiaWcuanBnJywgMTAgKiAxMDI0ICogMTAyNCArIDUpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oMiwgJ3VzZXItMicsIGJpZyk7XHJcblxyXG4gICAgICBhc3NlcnRGYWlsdXJlKHJlc3VsdCwgJ0FycXVpdm8gbXVpdG8gZ3JhbmRlIChtw6F4OiAxME1CKScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2ZheiB1cGxvYWQgZGUgbm92YSBmb3RvLCBkZWxldGEgYSBhbnRlcmlvciBlIHNhbHZhIG5vIEJEJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbWFrZUZpbGUoKTtcclxuXHJcbiAgICAgIGNvbnN0IG9sZFBob3RvOiBFdmVudFBob3RvID0ge1xyXG4gICAgICAgIGlkOiA5OSxcclxuICAgICAgICBldmVudF9pZDogMSxcclxuICAgICAgICB1c2VyX2lkOiAndXNlci0xJyxcclxuICAgICAgICBwaG90b191cmw6XHJcbiAgICAgICAgICAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvZXZlbnQtcGhvdG9zLzEvdXNlci0xLW9sZC5qcGcnLFxyXG4gICAgICAgIHN0YXR1czogJ2Fwcm92YWRvJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgZ2V0VXNlclNweSA9IGplc3RcclxuICAgICAgICAuc3B5T24oRXZlbnRQaG90b3NTZXJ2aWNlLCAnZ2V0VXNlclBob3RvRm9yRXZlbnQnKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShvbGRQaG90byk7XHJcblxyXG4gICAgICBjb25zdCBkZWxldGVTcHkgPSBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50UGhvdG9zU2VydmljZSwgJ2RlbGV0ZUV2ZW50UGhvdG8nKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcclxuXHJcbiAgICAgIGNvbnN0IHVwbG9hZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xyXG4gICAgICBjb25zdCBnZXRQdWJsaWNVcmwgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgcHVibGljVXJsOlxyXG4gICAgICAgICAgICAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvZXZlbnQtcGhvdG9zLzEvdXNlci0xLTEyMy5qcGcnXHJcbiAgICAgICAgfVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1cGxvYWQsXHJcbiAgICAgICAgZ2V0UHVibGljVXJsLFxyXG4gICAgICAgIHJlbW92ZTogamVzdC5mbigpXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgaW5zZXJ0ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCh0YWJsZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKHRhYmxlID09PSAnZXZlbnRfcGhvdG9zJykge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5zZXJ0XHJcbiAgICAgICAgICB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7fSBhcyB1bmtub3duO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS51cGxvYWRFdmVudFBob3RvKDEsICd1c2VyLTEnLCBmaWxlKTtcclxuXHJcbiAgICAgIGFzc2VydFN1Y2Nlc3MocmVzdWx0KTtcclxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5waG90b1VybCkudG9Db250YWluKCdldmVudC1waG90b3MvMS91c2VyLTEtJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGV4cGVjdChnZXRVc2VyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgxLCAndXNlci0xJyk7XHJcbiAgICAgIGV4cGVjdChkZWxldGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDk5LCAndXNlci0xJyk7XHJcblxyXG4gICAgICBnZXRVc2VyU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgIGRlbGV0ZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JlbW92ZSBvIGFycXVpdm8gZG8gc3RvcmFnZSBzZSBvIGluc2VydCBubyBCRCBmYWxoYXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBtYWtlRmlsZSgpO1xyXG5cclxuICAgICAgamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFBob3Rvc1NlcnZpY2UsICdnZXRVc2VyUGhvdG9Gb3JFdmVudCcpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgY29uc3QgdXBsb2FkID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IGdldFB1YmxpY1VybCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBwdWJsaWNVcmw6XHJcbiAgICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMS91c2VyLTEtMTIzLmpwZydcclxuICAgICAgICB9XHJcbiAgICAgIH0pKTtcclxuICAgICAgY29uc3QgcmVtb3ZlID0gamVzdC5mbigpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgdXBsb2FkLFxyXG4gICAgICAgIGdldFB1YmxpY1VybCxcclxuICAgICAgICByZW1vdmVcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBpbnNlcnQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdkYiBlcnJvcicgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCh0YWJsZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKHRhYmxlID09PSAnZXZlbnRfcGhvdG9zJykge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5zZXJ0XHJcbiAgICAgICAgICB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7fSBhcyB1bmtub3duO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS51cGxvYWRFdmVudFBob3RvKDEsICd1c2VyLTEnLCBmaWxlKTtcclxuXHJcbiAgICAgIGFzc2VydEZhaWx1cmUocmVzdWx0LCAnZGIgZXJyb3InKTtcclxuICAgICAgZXhwZWN0KHJlbW92ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldG9ybmEgZXJybyBxdWFuZG8gbyB1cGxvYWQgbm8gc3RvcmFnZSBmYWxoYScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG1ha2VGaWxlKCk7XHJcblxyXG4gICAgICBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50UGhvdG9zU2VydmljZSwgJ2dldFVzZXJQaG90b0ZvckV2ZW50JylcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcblxyXG4gICAgICBjb25zdCB1cGxvYWQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdzdG9yYWdlIGVycm9yJyB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgdXBsb2FkLFxyXG4gICAgICAgIGdldFB1YmxpY1VybDogamVzdC5mbigpLFxyXG4gICAgICAgIHJlbW92ZTogamVzdC5mbigpXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oNSwgJ3VzZXItNScsIGZpbGUpO1xyXG5cclxuICAgICAgYXNzZXJ0RmFpbHVyZShyZXN1bHQsICdzdG9yYWdlIGVycm9yJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldEV2ZW50UGhvdG9zJywgKCkgPT4ge1xyXG4gICAgaXQoJ2J1c2NhIGZvdG9zIGFwcm92YWRhcyBkbyBldmVudG8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdFxyXG4gICAgICAgICAgLmZuKClcclxuICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgb3JkZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBkYXRhOiBbXHJcbiAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogMSxcclxuICAgICAgICAgICAgICAgICAgICBldmVudF9pZDogMTAsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZDogJ3UxJyxcclxuICAgICAgICAgICAgICAgICAgICBwaG90b191cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3AxLmpwZycsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnYXByb3ZhZG8nXHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgfSkpXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja0ltcGxlbWVudGF0aW9uKCh0YWJsZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKHRhYmxlID09PSAnZXZlbnRfcGhvdG9zJykge1xyXG4gICAgICAgICAgcmV0dXJuIHsgc2VsZWN0IH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcGhvdG9zID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldEV2ZW50UGhvdG9zKDEwKTtcclxuXHJcbiAgICAgIGV4cGVjdChwaG90b3MpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgZXhwZWN0KHBob3Rvc1swXS5waG90b191cmwpLnRvQmUoJ2h0dHBzOi8vZXhhbXBsZS5jb20vcDEuanBnJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBhcnJheSB2YXppbyBlbSBjYXNvIGRlIGVycm8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgb3JkZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnZXJybycgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSkpXHJcbiAgICAgICAgfSkpXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBzZWxlY3RcclxuICAgICAgfSBhcyB1bmtub3duKTtcclxuXHJcbiAgICAgIGNvbnN0IHBob3RvcyA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRFdmVudFBob3RvcygxMCk7XHJcblxyXG4gICAgICBleHBlY3QocGhvdG9zKS50b0VxdWFsKFtdKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0VXNlclBob3RvRm9yRXZlbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0b3JuYSBhIGZvdG8gZG8gdXN1w6FyaW8gcXVhbmRvIGV4aXN0aXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tDaGFpbiA9IHtcclxuICAgICAgICBlcTogamVzdC5mbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBtYXliZVNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50X2lkOiAxMSxcclxuICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOiAndXNlci0xJyxcclxuICAgICAgICAgICAgICAgICAgICBwaG90b191cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3AyLmpwZycsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnYXByb3ZhZG8nXHJcbiAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+IG1vY2tDaGFpbilcclxuICAgICAgfSBhcyB1bmtub3duKTtcclxuXHJcbiAgICAgIGNvbnN0IHBob3RvID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldFVzZXJQaG90b0ZvckV2ZW50KDExLCAndXNlci0xJyk7XHJcblxyXG4gICAgICBleHBlY3QocGhvdG8pLm5vdC50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QocGhvdG8/LnBob3RvX3VybCkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbS9wMi5qcGcnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIG51bGwgZW0gY2FzbyBkZSBlcnJvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXliZVNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnZXJybycgfVxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCgpID0+ICh7IG1heWJlU2luZ2xlIH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0XHJcbiAgICAgIH0gYXMgdW5rbm93bik7XHJcblxyXG4gICAgICBjb25zdCBwaG90byA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRVc2VyUGhvdG9Gb3JFdmVudCgxMSwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHBob3RvKS50b0JlTnVsbCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdkZWxldGVFdmVudFBob3RvJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldG9ybmEgZmFsc2Ugc2UgYSBmb3RvIG7Do28gZXhpc3RpcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWF5YmVTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ25vdCBmb3VuZCcgfVxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7IG1heWJlU2luZ2xlIH0pKVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7IHNlbGVjdCB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7fSBhcyB1bmtub3duO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5kZWxldGVFdmVudFBob3RvKDEwLCAndXNlci14Jyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGZhbHNlIHNlIG7Do28gZm9yIG8gZG9ubyBkYSBmb3RvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXliZVNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgaWQ6IDUsXHJcbiAgICAgICAgICBwaG90b191cmw6XHJcbiAgICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMTAvb3RoZXIuanBnJyxcclxuICAgICAgICAgIHVzZXJfaWQ6ICdvdXRyby11c2VyJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmRlbGV0ZUV2ZW50UGhvdG8oMTAsICd1c2VyLXgnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RlbGV0YSBkbyBzdG9yYWdlIGUgZG8gQkQgcXVhbmRvIGZvciBvIGRvbm8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1heWJlU2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBpZDogNyxcclxuICAgICAgICAgIHBob3RvX3VybDpcclxuICAgICAgICAgICAgJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL2V2ZW50LXBob3Rvcy8xMC91c2VyLTEtMTIzLmpwZycsXHJcbiAgICAgICAgICB1c2VyX2lkOiAndXNlci0xJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgZGVsZXRlRm4gPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNlbGVjdCxcclxuICAgICAgICAgICAgZGVsZXRlOiBkZWxldGVGblxyXG4gICAgICAgICAgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZW1vdmUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgcmVtb3ZlXHJcbiAgICAgIH0gYXMgdW5rbm93bik7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZGVsZXRlRXZlbnRQaG90bygxMCwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50LXBob3RvcycpO1xyXG4gICAgICBleHBlY3QocmVtb3ZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChbJzEwL3VzZXItMS0xMjMuanBnJ10pO1xyXG4gICAgICBleHBlY3QoZGVsZXRlRm4pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0UGhvdG9TdGF0cycsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGVzdGF0w61zdGljYXMgY2FsY3VsYWRhcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgbGV0IGNhbGxDb3VudCA9IDA7XHJcbiAgICAgIFxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGNhbGxDb3VudCsrO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChjYWxsQ291bnQgPT09IDEgJiYgdGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICAgIGNvdW50OiAzLFxyXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbnVsbFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICB9KSlcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChjYWxsQ291bnQgPT09IDIgJiYgdGFibGUgPT09ICdldmVudF9wYXJ0aWNpcGFudHMnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICAgIGNvdW50OiA2LFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgIH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0UGhvdG9TdGF0cyg1MCk7XHJcblxyXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxQaG90b3MpLnRvQmUoMyk7XHJcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFBhcnRpY2lwYW50cykudG9CZSg2KTtcclxuICAgICAgZXhwZWN0KHN0YXRzLnBlcmNlbnRhZ2VXaXRoUGhvdG9zKS50b0JlQ2xvc2VUbyg1MCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSB0dWRvIDAgZW0gY2FzbyBkZSBlcnJvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdlcnJvJykpXHJcbiAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgfSkpXHJcbiAgICAgICAgfSkpXHJcbiAgICAgIH0gYXMgdW5rbm93bik7XHJcblxyXG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRQaG90b1N0YXRzKDUwKTtcclxuXHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkOiBQaG90b1N0YXRzID0ge1xyXG4gICAgICAgIHRvdGFsUGhvdG9zOiAwLFxyXG4gICAgICAgIHRvdGFsUGFydGljaXBhbnRzOiAwLFxyXG4gICAgICAgIHBlcmNlbnRhZ2VXaXRoUGhvdG9zOiAwXHJcbiAgICAgIH07XHJcbiAgICAgIGV4cGVjdChzdGF0cykudG9FcXVhbChleHBlY3RlZCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9