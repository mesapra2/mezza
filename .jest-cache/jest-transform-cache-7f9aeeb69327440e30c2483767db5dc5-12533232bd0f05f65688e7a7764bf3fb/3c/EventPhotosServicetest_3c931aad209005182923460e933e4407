10e5481fdeb851d693182217f70bcf67
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => {
    const from = jest.fn();
    const storageFrom = jest.fn();
    return {
        supabase: {
            from,
            storage: {
                from: storageFrom
            }
        }
    };
});
// src/services/EventPhotosService.test.ts
/* eslint-disable @typescript-eslint/no-explicit-any */
// @ts-nocheck
const EventPhotosService_1 = tslib_1.__importDefault(require("./EventPhotosService"));
const supabaseClient_1 = require("../lib/supabaseClient");
describe('EventPhotosService', () => {
    const mockedSupabase = supabaseClient_1.supabase;
    // helpers de narrowing SEM acessar propriedades do outro ramo
    function assertFailure(result, message) {
        if (result.success) {
            throw new Error('expected failure but got success');
        }
        expect(result.success).toBe(false);
        if (message) {
            expect(result.error).toBe(message);
        }
    }
    function assertSuccess(result) {
        expect(result.success).toBe(true);
        if (result.success) {
            expect(result.photoUrl).toBeDefined();
        }
    }
    const makeFile = (name = 'photo.jpg', size = 1024, type = 'image/jpeg') => ({
        name,
        size,
        type
    });
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('uploadEventPhoto', () => {
        it('retorna erro quando o arquivo não é imagem', async () => {
            const file = makeFile('doc.pdf', 1000, 'application/pdf');
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'Apenas imagens são permitidas');
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('retorna erro quando o arquivo tem mais de 10MB antes do resize', async () => {
            const big = makeFile('big.jpg', 10 * 1024 * 1024 + 5);
            const result = await EventPhotosService_1.default.uploadEventPhoto(2, 'user-2', big);
            assertFailure(result, 'Arquivo muito grande (máx: 10MB)');
        });
        it('faz upload de nova foto, deleta a anterior e salva no BD', async () => {
            const file = makeFile();
            const oldPhoto = {
                id: 99,
                event_id: 1,
                user_id: 'user-1',
                photo_url: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-old.jpg',
                status: 'aprovado'
            };
            const getUserSpy = jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(oldPhoto);
            const deleteSpy = jest
                .spyOn(EventPhotosService_1.default, 'deleteEventPhoto')
                .mockResolvedValue(true);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove: jest.fn()
            });
            const insert = jest.fn().mockResolvedValue({ error: null });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertSuccess(result);
            if (result.success) {
                expect(result.photoUrl).toContain('event-photos/1/user-1-');
            }
            expect(getUserSpy).toHaveBeenCalledWith(1, 'user-1');
            expect(deleteSpy).toHaveBeenCalledWith(99, 'user-1');
            getUserSpy.mockRestore();
            deleteSpy.mockRestore();
        });
        it('remove o arquivo do storage se o insert no BD falhar', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            const remove = jest.fn();
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove
            });
            const insert = jest.fn().mockResolvedValue({
                error: { message: 'db error' }
            });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'db error');
            expect(remove).toHaveBeenCalled();
        });
        it('retorna erro quando o upload no storage falha', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({
                error: { message: 'storage error' }
            });
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl: jest.fn(),
                remove: jest.fn()
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(5, 'user-5', file);
            assertFailure(result, 'storage error');
        });
    });
    describe('getEventPhotos', () => {
        it('busca fotos aprovadas do evento', async () => {
            const select = jest.fn(() => ({
                eq: jest
                    .fn()
                    .mockImplementationOnce(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: [
                                {
                                    id: 1,
                                    event_id: 10,
                                    user_id: 'u1',
                                    photo_url: 'https://example.com/p1.jpg',
                                    status: 'aprovado'
                                }
                            ],
                            error: null
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toHaveLength(1);
            expect(photos[0].photo_url).toBe('https://example.com/p1.jpg');
        });
        it('retorna array vazio em caso de erro', async () => {
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: null,
                            error: { message: 'erro' }
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toEqual([]);
        });
    });
    describe('getUserPhotoForEvent', () => {
        it('retorna a foto do usuário quando existir', async () => {
            // Spy no método diretamente
            const mockPhoto = {
                id: 2,
                event_id: 11,
                user_id: 'user-1',
                photo_url: 'https://example.com/p2.jpg',
                status: 'aprovado'
            };
            jest.spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent').mockResolvedValueOnce(mockPhoto);
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).not.toBeNull();
            expect(photo?.photo_url).toBe('https://example.com/p2.jpg');
        });
        it('retorna null em caso de erro', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'erro' }
            });
            const eq = jest.fn(() => ({ maybeSingle }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).toBeNull();
        });
    });
    describe('deleteEventPhoto', () => {
        it('retorna false se a foto não existir', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'not found' }
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
        });
        it('retorna false se não for o dono da foto', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 5,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/other.jpg',
                    user_id: 'outro-user'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('deleta do storage e do BD quando for o dono', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 7,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/user-1-123.jpg',
                    user_id: 'user-1'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            const deleteFn = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn().mockResolvedValue({ error: null })
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        select,
                        delete: deleteFn
                    };
                }
                return {};
            });
            const remove = jest.fn().mockResolvedValue({});
            mockedSupabase.storage.from.mockReturnValue({
                remove
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-1');
            expect(result).toBe(true);
            expect(mockedSupabase.storage.from).toHaveBeenCalledWith('event-photos');
            expect(remove).toHaveBeenCalledWith(['10/user-1-123.jpg']);
            expect(deleteFn).toHaveBeenCalled();
        });
    });
    describe('getPhotoStats', () => {
        it('retorna estatísticas calculadas', async () => {
            let callCount = 0;
            mockedSupabase.from.mockImplementation((table) => {
                callCount++;
                if (callCount === 1 && table === 'event_photos') {
                    return {
                        select: jest.fn(() => ({
                            eq: jest.fn(() => ({
                                eq: jest.fn().mockResolvedValue({
                                    count: 3,
                                    error: null
                                })
                            }))
                        }))
                    };
                }
                if (callCount === 2 && table === 'event_participants') {
                    return {
                        select: jest.fn(() => ({
                            eq: jest.fn().mockResolvedValue({
                                count: 6,
                                error: null
                            })
                        }))
                    };
                }
                return {};
            });
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            expect(stats.totalPhotos).toBe(3);
            expect(stats.totalParticipants).toBe(6);
            expect(stats.percentageWithPhotos).toBeCloseTo(50);
        });
        it('retorna tudo 0 em caso de erro', async () => {
            mockedSupabase.from.mockReturnValue({
                select: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        eq: jest.fn(() => ({
                            eq: jest.fn().mockRejectedValue(new Error('erro'))
                        }))
                    }))
                }))
            });
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            const expected = {
                totalPhotos: 0,
                totalParticipants: 0,
                percentageWithPhotos: 0
            };
            expect(stats).toEqual(expected);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRQaG90b3NTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7O0FBVUEsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDdEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQ3ZCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUM5QixPQUFPO1FBQ0wsUUFBUSxFQUFFO1lBQ1IsSUFBSTtZQUNKLE9BQU8sRUFBRTtnQkFDUCxJQUFJLEVBQUUsV0FBVzthQUNsQjtTQUNGO0tBQ0YsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBckJILDBDQUEwQztBQUMxQyx1REFBdUQ7QUFDdkQsY0FBYztBQUNkLHNGQUk4QjtBQUM5QiwwREFBaUQ7QUFlakQsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyxNQUFNLGNBQWMsR0FBRyx5QkFLdEIsQ0FBQztJQUVGLDhEQUE4RDtJQUM5RCxTQUFTLGFBQWEsQ0FDcEIsTUFBb0IsRUFDcEIsT0FBZ0I7UUFFaEIsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDbkIsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQyxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ1osTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDckMsQ0FBQztJQUNILENBQUM7SUFFRCxTQUFTLGFBQWEsQ0FDcEIsTUFBb0I7UUFFcEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMs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QUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7d0JBQ2pCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7NEJBQ2pCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7eUJBQ25ELENBQUMsQ0FBQztxQkFDSixDQUFDLENBQUM7aUJBQ0osQ0FBQyxDQUFDO2FBQ08sQ0FBQyxDQUFDO1lBRWQsTUFBTSxLQUFLLEdBQUcsTUFBTSw0QkFBa0IsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFekQsTUFBTSxRQUFRLEdBQWU7Z0JBQzNCLFdBQVcsRUFBRSxDQUFDO2dCQUNkLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BCLG9CQUFvQixFQUFFLENBQUM7YUFDeEIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcc2VydmljZXNcXEV2ZW50UGhvdG9zU2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2aWNlcy9FdmVudFBob3Rvc1NlcnZpY2UudGVzdC50c1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXHJcbi8vIEB0cy1ub2NoZWNrXHJcbmltcG9ydCBFdmVudFBob3Rvc1NlcnZpY2UsIHtcclxuICB0eXBlIEV2ZW50UGhvdG8sXHJcbiAgdHlwZSBQaG90b1N0YXRzLFxyXG4gIHR5cGUgVXBsb2FkUmVzdWx0XHJcbn0gZnJvbSAnLi9FdmVudFBob3Rvc1NlcnZpY2UnO1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJy4uL2xpYi9zdXBhYmFzZUNsaWVudCc7XHJcblxyXG5qZXN0Lm1vY2soJy4uL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+IHtcclxuICBjb25zdCBmcm9tID0gamVzdC5mbigpO1xyXG4gIGNvbnN0IHN0b3JhZ2VGcm9tID0gamVzdC5mbigpO1xyXG4gIHJldHVybiB7XHJcbiAgICBzdXBhYmFzZToge1xyXG4gICAgICBmcm9tLFxyXG4gICAgICBzdG9yYWdlOiB7XHJcbiAgICAgICAgZnJvbTogc3RvcmFnZUZyb21cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcbn0pO1xyXG5cclxuZGVzY3JpYmUoJ0V2ZW50UGhvdG9zU2VydmljZScsICgpID0+IHtcclxuICBjb25zdCBtb2NrZWRTdXBhYmFzZSA9IHN1cGFiYXNlIGFzIHVua25vd24gYXMge1xyXG4gICAgZnJvbTogamVzdC5Nb2NrO1xyXG4gICAgc3RvcmFnZToge1xyXG4gICAgICBmcm9tOiBqZXN0Lk1vY2s7XHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gIC8vIGhlbHBlcnMgZGUgbmFycm93aW5nIFNFTSBhY2Vzc2FyIHByb3ByaWVkYWRlcyBkbyBvdXRybyByYW1vXHJcbiAgZnVuY3Rpb24gYXNzZXJ0RmFpbHVyZShcclxuICAgIHJlc3VsdDogVXBsb2FkUmVzdWx0LFxyXG4gICAgbWVzc2FnZT86IHN0cmluZ1xyXG4gICk6IGFzc2VydHMgcmVzdWx0IGlzIHsgc3VjY2VzczogZmFsc2U7IGVycm9yOiBzdHJpbmcgfSB7XHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdleHBlY3RlZCBmYWlsdXJlIGJ1dCBnb3Qgc3VjY2VzcycpO1xyXG4gICAgfVxyXG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgIGlmIChtZXNzYWdlKSB7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUobWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhc3NlcnRTdWNjZXNzKFxyXG4gICAgcmVzdWx0OiBVcGxvYWRSZXN1bHRcclxuICApOiBhc3NlcnRzIHJlc3VsdCBpcyB7IHN1Y2Nlc3M6IHRydWU7IHBob3RvVXJsOiBzdHJpbmcgfSB7XHJcbiAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5waG90b1VybCkudG9CZURlZmluZWQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IG1ha2VGaWxlID0gKFxyXG4gICAgbmFtZSA9ICdwaG90by5qcGcnLFxyXG4gICAgc2l6ZSA9IDEwMjQsXHJcbiAgICB0eXBlID0gJ2ltYWdlL2pwZWcnXHJcbiAgKTogRmlsZSA9PlxyXG4gICAgKHtcclxuICAgICAgbmFtZSxcclxuICAgICAgc2l6ZSxcclxuICAgICAgdHlwZVxyXG4gICAgfSBhcyB1bmtub3duIGFzIEZpbGUpO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBsb2FkRXZlbnRQaG90bycsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGVycm8gcXVhbmRvIG8gYXJxdWl2byBuw6NvIMOpIGltYWdlbScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG1ha2VGaWxlKCdkb2MucGRmJywgMTAwMCwgJ2FwcGxpY2F0aW9uL3BkZicpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oMSwgJ3VzZXItMScsIGZpbGUpO1xyXG5cclxuICAgICAgYXNzZXJ0RmFpbHVyZShyZXN1bHQsICdBcGVuYXMgaW1hZ2VucyBzw6NvIHBlcm1pdGlkYXMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGVycm8gcXVhbmRvIG8gYXJxdWl2byB0ZW0gbWFpcyBkZSAxME1CIGFudGVzIGRvIHJlc2l6ZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgYmlnID0gbWFrZUZpbGUoJ2JpZy5qcGcnLCAxMCAqIDEwMjQgKiAxMDI0ICsgNSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UudXBsb2FkRXZlbnRQaG90bygyLCAndXNlci0yJywgYmlnKTtcclxuXHJcbiAgICAgIGFzc2VydEZhaWx1cmUocmVzdWx0LCAnQXJxdWl2byBtdWl0byBncmFuZGUgKG3DoXg6IDEwTUIpJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZmF6IHVwbG9hZCBkZSBub3ZhIGZvdG8sIGRlbGV0YSBhIGFudGVyaW9yIGUgc2FsdmEgbm8gQkQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBtYWtlRmlsZSgpO1xyXG5cclxuICAgICAgY29uc3Qgb2xkUGhvdG86IEV2ZW50UGhvdG8gPSB7XHJcbiAgICAgICAgaWQ6IDk5LFxyXG4gICAgICAgIGV2ZW50X2lkOiAxLFxyXG4gICAgICAgIHVzZXJfaWQ6ICd1c2VyLTEnLFxyXG4gICAgICAgIHBob3RvX3VybDpcclxuICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMS91c2VyLTEtb2xkLmpwZycsXHJcbiAgICAgICAgc3RhdHVzOiAnYXByb3ZhZG8nXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBnZXRVc2VyU3B5ID0gamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFBob3Rvc1NlcnZpY2UsICdnZXRVc2VyUGhvdG9Gb3JFdmVudCcpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG9sZFBob3RvKTtcclxuXHJcbiAgICAgIGNvbnN0IGRlbGV0ZVNweSA9IGplc3RcclxuICAgICAgICAuc3B5T24oRXZlbnRQaG90b3NTZXJ2aWNlLCAnZGVsZXRlRXZlbnRQaG90bycpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xyXG5cclxuICAgICAgY29uc3QgdXBsb2FkID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IGdldFB1YmxpY1VybCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBwdWJsaWNVcmw6XHJcbiAgICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMS91c2VyLTEtMTIzLmpwZydcclxuICAgICAgICB9XHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVwbG9hZCxcclxuICAgICAgICBnZXRQdWJsaWNVcmwsXHJcbiAgICAgICAgcmVtb3ZlOiBqZXN0LmZuKClcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBpbnNlcnQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbnNlcnRcclxuICAgICAgICAgIH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oMSwgJ3VzZXItMScsIGZpbGUpO1xyXG5cclxuICAgICAgYXNzZXJ0U3VjY2VzcyhyZXN1bHQpO1xyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICBleHBlY3QocmVzdWx0LnBob3RvVXJsKS50b0NvbnRhaW4oJ2V2ZW50LXBob3Rvcy8xL3VzZXItMS0nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZXhwZWN0KGdldFVzZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDEsICd1c2VyLTEnKTtcclxuICAgICAgZXhwZWN0KGRlbGV0ZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoOTksICd1c2VyLTEnKTtcclxuXHJcbiAgICAgIGdldFVzZXJTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgZGVsZXRlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmVtb3ZlIG8gYXJxdWl2byBkbyBzdG9yYWdlIHNlIG8gaW5zZXJ0IG5vIEJEIGZhbGhhcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG1ha2VGaWxlKCk7XHJcblxyXG4gICAgICBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50UGhvdG9zU2VydmljZSwgJ2dldFVzZXJQaG90b0ZvckV2ZW50JylcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcblxyXG4gICAgICBjb25zdCB1cGxvYWQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgZ2V0UHVibGljVXJsID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHB1YmxpY1VybDpcclxuICAgICAgICAgICAgJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL2V2ZW50LXBob3Rvcy8xL3VzZXItMS0xMjMuanBnJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSkpO1xyXG4gICAgICBjb25zdCByZW1vdmUgPSBqZXN0LmZuKCk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1cGxvYWQsXHJcbiAgICAgICAgZ2V0UHVibGljVXJsLFxyXG4gICAgICAgIHJlbW92ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGluc2VydCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ2RiIGVycm9yJyB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbnNlcnRcclxuICAgICAgICAgIH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oMSwgJ3VzZXItMScsIGZpbGUpO1xyXG5cclxuICAgICAgYXNzZXJ0RmFpbHVyZShyZXN1bHQsICdkYiBlcnJvcicpO1xyXG4gICAgICBleHBlY3QocmVtb3ZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBlcnJvIHF1YW5kbyBvIHVwbG9hZCBubyBzdG9yYWdlIGZhbGhhJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbWFrZUZpbGUoKTtcclxuXHJcbiAgICAgIGplc3RcclxuICAgICAgICAuc3B5T24oRXZlbnRQaG90b3NTZXJ2aWNlLCAnZ2V0VXNlclBob3RvRm9yRXZlbnQnKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuXHJcbiAgICAgIGNvbnN0IHVwbG9hZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ3N0b3JhZ2UgZXJyb3InIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1cGxvYWQsXHJcbiAgICAgICAgZ2V0UHVibGljVXJsOiBqZXN0LmZuKCksXHJcbiAgICAgICAgcmVtb3ZlOiBqZXN0LmZuKClcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UudXBsb2FkRXZlbnRQaG90byg1LCAndXNlci01JywgZmlsZSk7XHJcblxyXG4gICAgICBhc3NlcnRGYWlsdXJlKHJlc3VsdCwgJ3N0b3JhZ2UgZXJyb3InKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0RXZlbnRQaG90b3MnLCAoKSA9PiB7XHJcbiAgICBpdCgnYnVzY2EgZm90b3MgYXByb3ZhZGFzIGRvIGV2ZW50bycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0XHJcbiAgICAgICAgICAuZm4oKVxyXG4gICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBvcmRlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IFtcclxuICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50X2lkOiAxMCxcclxuICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOiAndTEnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBob3RvX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcDEuanBnJyxcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdhcHJvdmFkbydcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzZWxlY3QgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBwaG90b3MgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0RXZlbnRQaG90b3MoMTApO1xyXG5cclxuICAgICAgZXhwZWN0KHBob3RvcykudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QocGhvdG9zWzBdLnBob3RvX3VybCkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbS9wMS5qcGcnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGFycmF5IHZhemlvIGVtIGNhc28gZGUgZXJybycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBvcmRlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdlcnJvJyB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcGhvdG9zID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldEV2ZW50UGhvdG9zKDEwKTtcclxuXHJcbiAgICAgIGV4cGVjdChwaG90b3MpLnRvRXF1YWwoW10pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRVc2VyUGhvdG9Gb3JFdmVudCcsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGEgZm90byBkbyB1c3XDoXJpbyBxdWFuZG8gZXhpc3RpcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gU3B5IG5vIG3DqXRvZG8gZGlyZXRhbWVudGVcclxuICAgICAgY29uc3QgbW9ja1Bob3RvOiBFdmVudFBob3RvID0ge1xyXG4gICAgICAgIGlkOiAyLFxyXG4gICAgICAgIGV2ZW50X2lkOiAxMSxcclxuICAgICAgICB1c2VyX2lkOiAndXNlci0xJyxcclxuICAgICAgICBwaG90b191cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3AyLmpwZycsXHJcbiAgICAgICAgc3RhdHVzOiAnYXByb3ZhZG8nXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBqZXN0LnNweU9uKEV2ZW50UGhvdG9zU2VydmljZSwgJ2dldFVzZXJQaG90b0ZvckV2ZW50JykubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tQaG90byk7XHJcblxyXG4gICAgICBjb25zdCBwaG90byA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRVc2VyUGhvdG9Gb3JFdmVudCgxMSwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHBob3RvKS5ub3QudG9CZU51bGwoKTtcclxuICAgICAgZXhwZWN0KHBob3RvPy5waG90b191cmwpLnRvQmUoJ2h0dHBzOi8vZXhhbXBsZS5jb20vcDIuanBnJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBudWxsIGVtIGNhc28gZGUgZXJybycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWF5YmVTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ2Vycm8nIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGVxID0gamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHsgZXEgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcGhvdG8gPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0VXNlclBob3RvRm9yRXZlbnQoMTEsICd1c2VyLTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChwaG90bykudG9CZU51bGwoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGVsZXRlRXZlbnRQaG90bycsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGZhbHNlIHNlIGEgZm90byBuw6NvIGV4aXN0aXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1heWJlU2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdub3QgZm91bmQnIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzZWxlY3QgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZGVsZXRlRXZlbnRQaG90bygxMCwgJ3VzZXIteCcpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBmYWxzZSBzZSBuw6NvIGZvciBvIGRvbm8gZGEgZm90bycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWF5YmVTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIGlkOiA1LFxyXG4gICAgICAgICAgcGhvdG9fdXJsOlxyXG4gICAgICAgICAgICAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvZXZlbnQtcGhvdG9zLzEwL290aGVyLmpwZycsXHJcbiAgICAgICAgICB1c2VyX2lkOiAnb3V0cm8tdXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBzZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHsgbWF5YmVTaW5nbGUgfSkpXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBzZWxlY3RcclxuICAgICAgfSBhcyB1bmtub3duKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5kZWxldGVFdmVudFBob3RvKDEwLCAndXNlci14Jyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWxldGEgZG8gc3RvcmFnZSBlIGRvIEJEIHF1YW5kbyBmb3IgbyBkb25vJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXliZVNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgaWQ6IDcsXHJcbiAgICAgICAgICBwaG90b191cmw6XHJcbiAgICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMTAvdXNlci0xLTEyMy5qcGcnLFxyXG4gICAgICAgICAgdXNlcl9pZDogJ3VzZXItMSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBzZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHsgbWF5YmVTaW5nbGUgfSkpXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IGRlbGV0ZUZuID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSlcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZWxlY3QsXHJcbiAgICAgICAgICAgIGRlbGV0ZTogZGVsZXRlRm5cclxuICAgICAgICAgIH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVtb3ZlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHJlbW92ZVxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmRlbGV0ZUV2ZW50UGhvdG8oMTAsICd1c2VyLTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdldmVudC1waG90b3MnKTtcclxuICAgICAgZXhwZWN0KHJlbW92ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoWycxMC91c2VyLTEtMTIzLmpwZyddKTtcclxuICAgICAgZXhwZWN0KGRlbGV0ZUZuKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFBob3RvU3RhdHMnLCAoKSA9PiB7XHJcbiAgICBpdCgncmV0b3JuYSBlc3RhdMOtc3RpY2FzIGNhbGN1bGFkYXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGxldCBjYWxsQ291bnQgPSAwO1xyXG4gICAgICBcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBjYWxsQ291bnQrKztcclxuICAgICAgICBcclxuICAgICAgICBpZiAoY2FsbENvdW50ID09PSAxICYmIHRhYmxlID09PSAnZXZlbnRfcGhvdG9zJykge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgICBjb3VudDogMyxcclxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAoY2FsbENvdW50ID09PSAyICYmIHRhYmxlID09PSAnZXZlbnRfcGFydGljaXBhbnRzJykge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBjb3VudDogNixcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7fSBhcyB1bmtub3duO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldFBob3RvU3RhdHMoNTApO1xyXG5cclxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUGhvdG9zKS50b0JlKDMpO1xyXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxQYXJ0aWNpcGFudHMpLnRvQmUoNik7XHJcbiAgICAgIGV4cGVjdChzdGF0cy5wZXJjZW50YWdlV2l0aFBob3RvcykudG9CZUNsb3NlVG8oNTApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldG9ybmEgdHVkbyAwIGVtIGNhc28gZGUgZXJybycsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignZXJybycpKVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0UGhvdG9TdGF0cyg1MCk7XHJcblxyXG4gICAgICBjb25zdCBleHBlY3RlZDogUGhvdG9TdGF0cyA9IHtcclxuICAgICAgICB0b3RhbFBob3RvczogMCxcclxuICAgICAgICB0b3RhbFBhcnRpY2lwYW50czogMCxcclxuICAgICAgICBwZXJjZW50YWdlV2l0aFBob3RvczogMFxyXG4gICAgICB9O1xyXG4gICAgICBleHBlY3Qoc3RhdHMpLnRvRXF1YWwoZXhwZWN0ZWQpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==