55d25944e77d8215351bae843782331c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
// src/features/shared/pages/RegisterPage.jsx
const react_1 = tslib_1.__importStar(require("react"));
const react_router_dom_1 = require("react-router-dom");
const react_helmet_async_1 = require("react-helmet-async");
const framer_motion_1 = require("framer-motion");
const lucide_react_1 = require("lucide-react");
const AuthContext_1 = require("@/contexts/AuthContext");
const button_1 = require("@/features/shared/components/ui/button");
const input_1 = require("@/features/shared/components/ui/input");
const label_1 = require("@/features/shared/components/ui/label");
const use_toast_1 = require("@/features/shared/components/ui/use-toast");
const SocialLoginButtons_1 = tslib_1.__importDefault(require("@/features/shared/components/auth/SocialLoginButtons"));
const PhoneVerification_1 = tslib_1.__importDefault(require("@/features/shared/components/auth/PhoneVerification"));
const authService_1 = tslib_1.__importDefault(require("@/services/authService"));
const RegisterPage = () => {
    const [step, setStep] = (0, react_1.useState)('register'); // 'register' ou 'verify'
    const [name, setName] = (0, react_1.useState)('');
    const [email, setEmail] = (0, react_1.useState)('');
    const [phone, setPhone] = (0, react_1.useState)('');
    const [password, setPassword] = (0, react_1.useState)('');
    const [isLoading, setIsLoading] = (0, react_1.useState)(false);
    const [userId, setUserId] = (0, react_1.useState)('');
    const { register, signInWithGoogle, signInWithApple, signInWithFacebook } = (0, AuthContext_1.useAuth)();
    const navigate = (0, react_router_dom_1.useNavigate)();
    const { toast } = (0, use_toast_1.useToast)();
    const formatPhoneInput = (value) => {
        const numbers = value.replace(/\D/g, '');
        const limited = numbers.slice(0, 13);
        if (limited.length <= 2) {
            return limited ? `+${limited}` : '';
        }
        else if (limited.length <= 4) {
            return `+${limited.slice(0, 2)} (${limited.slice(2)}`;
        }
        else if (limited.length <= 9) {
            return `+${limited.slice(0, 2)} (${limited.slice(2, 4)}) ${limited.slice(4)}`;
        }
        else {
            return `+${limited.slice(0, 2)} (${limited.slice(2, 4)}) ${limited.slice(4, 9)}-${limited.slice(9)}`;
        }
    };
    const handlePhoneChange = (e) => {
        const formatted = formatPhoneInput(e.target.value);
        setPhone(formatted);
    };
    const validatePhone = (phoneNumber) => {
        const numbers = phoneNumber.replace(/\D/g, '');
        return numbers.length === 13 && numbers.startsWith('55');
    };
    const handleSubmit = async (e) => {
        e.preventDefault();
        if (password.length < 6) {
            toast({
                variant: "destructive",
                title: "Senha inválida",
                description: "A senha deve ter pelo menos 6 caracteres.",
            });
            return;
        }
        if (!validatePhone(phone)) {
            toast({
                variant: "destructive",
                title: "Telefone inválido",
                description: "Por favor, digite um número de telefone brasileiro válido.",
            });
            return;
        }
        setIsLoading(true);
        try {
            // 1. Registra no Supabase
            const user = await register({
                name,
                email,
                password,
                profile_type: 'user'
            });
            if (!user) {
                throw new Error('Erro ao criar usuário no Supabase');
            }
            console.log('✅ Usuário criado no Supabase:', user.id);
            // 2. Envia SMS via backend
            const cleanPhone = '+' + phone.replace(/\D/g, '');
            await authService_1.default.sendVerificationCode({
                userId: user.id,
                phone: cleanPhone,
            });
            setUserId(user.id);
            setStep('verify');
            toast({
                title: "Código enviado!",
                description: "Verifique seu telefone para o código de verificação.",
            });
        }
        catch (error) {
            console.error('Erro no cadastro:', error);
            toast({
                variant: "destructive",
                title: "Erro no Cadastro",
                description: error.message || "Tente novamente.",
            });
        }
        finally {
            setIsLoading(false);
        }
    };
    const handleVerified = () => {
        toast({
            title: "Bem-vindo ao Mesapra2!",
            description: "Seu cadastro foi concluído com sucesso.",
        });
        navigate('/dashboard');
    };
    const handleBackToRegister = () => {
        setStep('register');
    };
    const handleGoogleLogin = async () => {
        try {
            await signInWithGoogle();
        }
        catch (error) {
            console.error('Erro no login Google:', error);
        }
    };
    const handleAppleLogin = async () => {
        try {
            await signInWithApple();
        }
        catch (error) {
            console.error('Erro no login Apple:', error);
        }
    };
    const handleFacebookLogin = async () => {
        try {
            await signInWithFacebook();
        }
        catch (error) {
            console.error('Erro no login Facebook:', error);
        }
    };
    return ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsxs)(react_helmet_async_1.Helmet, { children: [(0, jsx_runtime_1.jsx)("title", { children: "Cadastro - Mesapra2" }), (0, jsx_runtime_1.jsx)("meta", { name: "description", content: "Crie sua conta no Mesapra2 e comece a participar de eventos sociais." })] }), (0, jsx_runtime_1.jsx)("div", { className: "min-h-screen flex items-center justify-center p-4", children: (0, jsx_runtime_1.jsx)("div", { className: "w-full max-w-md", children: (0, jsx_runtime_1.jsx)(framer_motion_1.AnimatePresence, { mode: "wait", children: step === 'register' ? ((0, jsx_runtime_1.jsx)(framer_motion_1.motion.div, { initial: { opacity: 0, y: 20 }, animate: { opacity: 1, y: 0 }, exit: { opacity: 0, x: -20 }, children: (0, jsx_runtime_1.jsxs)("div", { className: "glass-effect rounded-2xl p-8 border border-white/10", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex justify-center mb-8", children: (0, jsx_runtime_1.jsx)("div", { className: "w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center", children: (0, jsx_runtime_1.jsx)(lucide_react_1.Calendar, { className: "w-8 h-8 text-white" }) }) }), (0, jsx_runtime_1.jsx)("h1", { className: "text-3xl font-bold text-center mb-2 gradient-text", children: "Junte-se ao Mesapra2" }), (0, jsx_runtime_1.jsx)("p", { className: "text-center text-white/60 mb-8", children: "Crie sua conta e comece a explorar" }), (0, jsx_runtime_1.jsx)(SocialLoginButtons_1.default, { onGoogleClick: handleGoogleLogin, onAppleClick: handleAppleLogin, onFacebookClick: handleFacebookLogin, loading: isLoading }), (0, jsx_runtime_1.jsxs)("div", { className: "relative my-6", children: [(0, jsx_runtime_1.jsx)("div", { className: "absolute inset-0 flex items-center", children: (0, jsx_runtime_1.jsx)("div", { className: "w-full border-t border-white/10" }) }), (0, jsx_runtime_1.jsx)("div", { className: "relative flex justify-center text-sm", children: (0, jsx_runtime_1.jsx)("span", { className: "px-4 bg-background text-white/60", children: "ou cadastre-se com email" }) })] }), (0, jsx_runtime_1.jsxs)("form", { onSubmit: handleSubmit, className: "space-y-4", children: [(0, jsx_runtime_1.jsxs)("div", { className: "space-y-2", children: [(0, jsx_runtime_1.jsx)(label_1.Label, { htmlFor: "name", children: "Nome completo" }), (0, jsx_runtime_1.jsxs)("div", { className: "relative", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.User, { className: "absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "name", type: "text", value: name, onChange: (e) => setName(e.target.value), placeholder: "Seu nome completo", className: "pl-10 glass-effect border-white/10", required: true, disabled: isLoading })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "space-y-2", children: [(0, jsx_runtime_1.jsx)(label_1.Label, { htmlFor: "email", children: "Email" }), (0, jsx_runtime_1.jsxs)("div", { className: "relative", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Mail, { className: "absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "email", type: "email", value: email, onChange: (e) => setEmail(e.target.value), placeholder: "seu@email.com", className: "pl-10 glass-effect border-white/10", required: true, disabled: isLoading })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "space-y-2", children: [(0, jsx_runtime_1.jsx)(label_1.Label, { htmlFor: "phone", children: "Telefone" }), (0, jsx_runtime_1.jsxs)("div", { className: "relative", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Phone, { className: "absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "phone", type: "tel", value: phone, onChange: handlePhoneChange, placeholder: "+55 (99) 99999-9999", className: "pl-10 glass-effect border-white/10", required: true, disabled: isLoading })] }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-white/40 mt-1", children: "Voc\u00EA receber\u00E1 um c\u00F3digo de verifica\u00E7\u00E3o via SMS" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "space-y-2", children: [(0, jsx_runtime_1.jsx)(label_1.Label, { htmlFor: "password", children: "Senha" }), (0, jsx_runtime_1.jsxs)("div", { className: "relative", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Lock, { className: "absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40" }), (0, jsx_runtime_1.jsx)(input_1.Input, { id: "password", type: "password", value: password, onChange: (e) => setPassword(e.target.value), placeholder: "M\u00EDnimo 6 caracteres", className: "pl-10 glass-effect border-white/10", required: true, disabled: isLoading })] })] }), (0, jsx_runtime_1.jsx)(button_1.Button, { type: "submit", className: "w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 h-12 text-base font-semibold", disabled: isLoading, children: isLoading ? 'Criando conta...' : 'Continuar' })] }), (0, jsx_runtime_1.jsxs)("div", { className: "mt-6 space-y-4", children: [(0, jsx_runtime_1.jsxs)("p", { className: "text-center text-white/60 text-sm", children: ["J\u00E1 tem uma conta?", ' ', (0, jsx_runtime_1.jsx)(react_router_dom_1.Link, { to: "/login", className: "text-purple-400 hover:text-purple-300 font-semibold", children: "Fa\u00E7a login" })] }), (0, jsx_runtime_1.jsxs)("p", { className: "text-center text-white/60 text-sm", children: ["\u00C9 um restaurante?", ' ', (0, jsx_runtime_1.jsx)(react_router_dom_1.Link, { to: "/partner/register", className: "text-purple-400 hover:text-purple-300 font-semibold", children: "Cadastre seu estabelecimento" })] })] })] }) }, "register")) : ((0, jsx_runtime_1.jsx)(PhoneVerification_1.default, { userId: userId, phone: phone, onVerified: handleVerified, onBack: handleBackToRegister }, "verify")) }) }) })] }));
};
exports.default = RegisterPage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxmZWF0dXJlc1xcc2hhcmVkXFxwYWdlc1xcUmVnaXN0ZXJQYWdlLmpzeCIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsNkNBQTZDO0FBQzdDLHVEQUF3QztBQUN4Qyx1REFBcUQ7QUFDckQsMkRBQTRDO0FBQzVDLGlEQUF3RDtBQUN4RCwrQ0FBaUU7QUFDakUsd0RBQWlEO0FBQ2pELG1FQUFnRTtBQUNoRSxpRUFBOEQ7QUFDOUQsaUVBQThEO0FBQzlELHlFQUFxRTtBQUNyRSxzSEFBc0Y7QUFDdEYsb0hBQW9GO0FBQ3BGLGlGQUFpRDtBQUVqRCxNQUFNLFlBQVksR0FBRyxHQUFHLEVBQUU7SUFDeEIsTUFBTSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyx5QkFBeUI7SUFDdkUsTUFBTSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDckMsTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDdkMsTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDdkMsTUFBTSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDbEQsTUFBTSxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDekMsTUFBTSxFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsa0JBQWtCLEVBQUUsR0FBRyxJQUFB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QUMsU0FBUyxFQUFDLHFEQUFxRCxnQ0FFMUUsSUFDTCxFQUVKLCtCQUFHLFNBQVMsRUFBQyxtQ0FBbUMsdUNBQzVCLEdBQUcsRUFDckIsdUJBQUMsdUJBQUksSUFBQyxFQUFFLEVBQUMsbUJBQW1CLEVBQUMsU0FBUyxFQUFDLHFEQUFxRCw2Q0FFckYsSUFDTCxJQUNBLElBQ0YsSUFySUYsVUFBVSxDQXNJSCxDQUNkLENBQUMsQ0FBQyxDQUFDLENBQ0YsdUJBQUMsMkJBQWlCLElBRWhCLE1BQU0sRUFBRSxNQUFNLEVBQ2QsS0FBSyxFQUFFLEtBQUssRUFDWixVQUFVLEVBQUUsY0FBYyxFQUMxQixNQUFNLEVBQUUsb0JBQW9CLElBSnhCLFFBQVEsQ0FLWixDQUNILEdBQ2UsR0FDZCxHQUNGLElBQ0wsQ0FDSixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsa0JBQWUsWUFBWSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcZmVhdHVyZXNcXHNoYXJlZFxccGFnZXNcXFJlZ2lzdGVyUGFnZS5qc3giXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2ZlYXR1cmVzL3NoYXJlZC9wYWdlcy9SZWdpc3RlclBhZ2UuanN4XHJcbmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgTGluaywgdXNlTmF2aWdhdGUgfSBmcm9tICdyZWFjdC1yb3V0ZXItZG9tJztcclxuaW1wb3J0IHsgSGVsbWV0IH0gZnJvbSAncmVhY3QtaGVsbWV0LWFzeW5jJztcclxuaW1wb3J0IHsgbW90aW9uLCBBbmltYXRlUHJlc2VuY2UgfSBmcm9tICdmcmFtZXItbW90aW9uJztcclxuaW1wb3J0IHsgQ2FsZW5kYXIsIE1haWwsIExvY2ssIFVzZXIsIFBob25lIH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcclxuaW1wb3J0IHsgdXNlQXV0aCB9IGZyb20gJ0AvY29udGV4dHMvQXV0aENvbnRleHQnO1xyXG5pbXBvcnQgeyBCdXR0b24gfSBmcm9tICdAL2ZlYXR1cmVzL3NoYXJlZC9jb21wb25lbnRzL3VpL2J1dHRvbic7XHJcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS9pbnB1dCc7XHJcbmltcG9ydCB7IExhYmVsIH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS9sYWJlbCc7XHJcbmltcG9ydCB7IHVzZVRvYXN0IH0gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy91aS91c2UtdG9hc3QnO1xyXG5pbXBvcnQgU29jaWFsTG9naW5CdXR0b25zIGZyb20gJ0AvZmVhdHVyZXMvc2hhcmVkL2NvbXBvbmVudHMvYXV0aC9Tb2NpYWxMb2dpbkJ1dHRvbnMnO1xyXG5pbXBvcnQgUGhvbmVWZXJpZmljYXRpb24gZnJvbSAnQC9mZWF0dXJlcy9zaGFyZWQvY29tcG9uZW50cy9hdXRoL1Bob25lVmVyaWZpY2F0aW9uJztcclxuaW1wb3J0IGF1dGhTZXJ2aWNlIGZyb20gJ0Avc2VydmljZXMvYXV0aFNlcnZpY2UnO1xyXG5cclxuY29uc3QgUmVnaXN0ZXJQYWdlID0gKCkgPT4ge1xyXG4gIGNvbnN0IFtzdGVwLCBzZXRTdGVwXSA9IHVzZVN0YXRlKCdyZWdpc3RlcicpOyAvLyAncmVnaXN0ZXInIG91ICd2ZXJpZnknXHJcbiAgY29uc3QgW25hbWUsIHNldE5hbWVdID0gdXNlU3RhdGUoJycpO1xyXG4gIGNvbnN0IFtlbWFpbCwgc2V0RW1haWxdID0gdXNlU3RhdGUoJycpO1xyXG4gIGNvbnN0IFtwaG9uZSwgc2V0UGhvbmVdID0gdXNlU3RhdGUoJycpO1xyXG4gIGNvbnN0IFtwYXNzd29yZCwgc2V0UGFzc3dvcmRdID0gdXNlU3RhdGUoJycpO1xyXG4gIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgY29uc3QgW3VzZXJJZCwgc2V0VXNlcklkXSA9IHVzZVN0YXRlKCcnKTtcclxuICBjb25zdCB7IHJlZ2lzdGVyLCBzaWduSW5XaXRoR29vZ2xlLCBzaWduSW5XaXRoQXBwbGUsIHNpZ25JbldpdGhGYWNlYm9vayB9ID0gdXNlQXV0aCgpO1xyXG4gIGNvbnN0IG5hdmlnYXRlID0gdXNlTmF2aWdhdGUoKTtcclxuICBjb25zdCB7IHRvYXN0IH0gPSB1c2VUb2FzdCgpO1xyXG5cclxuICBjb25zdCBmb3JtYXRQaG9uZUlucHV0ID0gKHZhbHVlKSA9PiB7XHJcbiAgICBjb25zdCBudW1iZXJzID0gdmFsdWUucmVwbGFjZSgvXFxEL2csICcnKTtcclxuICAgIGNvbnN0IGxpbWl0ZWQgPSBudW1iZXJzLnNsaWNlKDAsIDEzKTtcclxuICAgIFxyXG4gICAgaWYgKGxpbWl0ZWQubGVuZ3RoIDw9IDIpIHtcclxuICAgICAgcmV0dXJuIGxpbWl0ZWQgPyBgKyR7bGltaXRlZH1gIDogJyc7XHJcbiAgICB9IGVsc2UgaWYgKGxpbWl0ZWQubGVuZ3RoIDw9IDQpIHtcclxuICAgICAgcmV0dXJuIGArJHtsaW1pdGVkLnNsaWNlKDAsIDIpfSAoJHtsaW1pdGVkLnNsaWNlKDIpfWA7XHJcbiAgICB9IGVsc2UgaWYgKGxpbWl0ZWQubGVuZ3RoIDw9IDkpIHtcclxuICAgICAgcmV0dXJuIGArJHtsaW1pdGVkLnNsaWNlKDAsIDIpfSAoJHtsaW1pdGVkLnNsaWNlKDIsIDQpfSkgJHtsaW1pdGVkLnNsaWNlKDQpfWA7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gYCske2xpbWl0ZWQuc2xpY2UoMCwgMil9ICgke2xpbWl0ZWQuc2xpY2UoMiwgNCl9KSAke2xpbWl0ZWQuc2xpY2UoNCwgOSl9LSR7bGltaXRlZC5zbGljZSg5KX1gO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZVBob25lQ2hhbmdlID0gKGUpID0+IHtcclxuICAgIGNvbnN0IGZvcm1hdHRlZCA9IGZvcm1hdFBob25lSW5wdXQoZS50YXJnZXQudmFsdWUpO1xyXG4gICAgc2V0UGhvbmUoZm9ybWF0dGVkKTtcclxuICB9O1xyXG5cclxuICBjb25zdCB2YWxpZGF0ZVBob25lID0gKHBob25lTnVtYmVyKSA9PiB7XHJcbiAgICBjb25zdCBudW1iZXJzID0gcGhvbmVOdW1iZXIucmVwbGFjZSgvXFxEL2csICcnKTtcclxuICAgIHJldHVybiBudW1iZXJzLmxlbmd0aCA9PT0gMTMgJiYgbnVtYmVycy5zdGFydHNXaXRoKCc1NScpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZVN1Ym1pdCA9IGFzeW5jIChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBcclxuICAgIGlmIChwYXNzd29yZC5sZW5ndGggPCA2KSB7XHJcbiAgICAgIHRvYXN0KHtcclxuICAgICAgICB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsXHJcbiAgICAgICAgdGl0bGU6IFwiU2VuaGEgaW52w6FsaWRhXCIsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IFwiQSBzZW5oYSBkZXZlIHRlciBwZWxvIG1lbm9zIDYgY2FyYWN0ZXJlcy5cIixcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXZhbGlkYXRlUGhvbmUocGhvbmUpKSB7XHJcbiAgICAgIHRvYXN0KHtcclxuICAgICAgICB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsXHJcbiAgICAgICAgdGl0bGU6IFwiVGVsZWZvbmUgaW52w6FsaWRvXCIsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUG9yIGZhdm9yLCBkaWdpdGUgdW0gbsO6bWVybyBkZSB0ZWxlZm9uZSBicmFzaWxlaXJvIHbDoWxpZG8uXCIsXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgc2V0SXNMb2FkaW5nKHRydWUpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gMS4gUmVnaXN0cmEgbm8gU3VwYWJhc2VcclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHJlZ2lzdGVyKHtcclxuICAgICAgICBuYW1lLFxyXG4gICAgICAgIGVtYWlsLFxyXG4gICAgICAgIHBhc3N3b3JkLFxyXG4gICAgICAgIHByb2ZpbGVfdHlwZTogJ3VzZXInXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvIGFvIGNyaWFyIHVzdcOhcmlvIG5vIFN1cGFiYXNlJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgVXN1w6FyaW8gY3JpYWRvIG5vIFN1cGFiYXNlOicsIHVzZXIuaWQpO1xyXG5cclxuICAgICAgLy8gMi4gRW52aWEgU01TIHZpYSBiYWNrZW5kXHJcbiAgICAgIGNvbnN0IGNsZWFuUGhvbmUgPSAnKycgKyBwaG9uZS5yZXBsYWNlKC9cXEQvZywgJycpO1xyXG4gICAgICBcclxuICAgICAgYXdhaXQgYXV0aFNlcnZpY2Uuc2VuZFZlcmlmaWNhdGlvbkNvZGUoe1xyXG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcclxuICAgICAgICBwaG9uZTogY2xlYW5QaG9uZSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBzZXRVc2VySWQodXNlci5pZCk7XHJcbiAgICAgIHNldFN0ZXAoJ3ZlcmlmeScpO1xyXG4gICAgICBcclxuICAgICAgdG9hc3Qoe1xyXG4gICAgICAgIHRpdGxlOiBcIkPDs2RpZ28gZW52aWFkbyFcIixcclxuICAgICAgICBkZXNjcmlwdGlvbjogXCJWZXJpZmlxdWUgc2V1IHRlbGVmb25lIHBhcmEgbyBjw7NkaWdvIGRlIHZlcmlmaWNhw6fDo28uXCIsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJybyBubyBjYWRhc3RybzonLCBlcnJvcik7XHJcbiAgICAgIHRvYXN0KHtcclxuICAgICAgICB2YXJpYW50OiBcImRlc3RydWN0aXZlXCIsXHJcbiAgICAgICAgdGl0bGU6IFwiRXJybyBubyBDYWRhc3Ryb1wiLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlIHx8IFwiVGVudGUgbm92YW1lbnRlLlwiLFxyXG4gICAgICB9KTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlVmVyaWZpZWQgPSAoKSA9PiB7XHJcbiAgICB0b2FzdCh7XHJcbiAgICAgIHRpdGxlOiBcIkJlbS12aW5kbyBhbyBNZXNhcHJhMiFcIixcclxuICAgICAgZGVzY3JpcHRpb246IFwiU2V1IGNhZGFzdHJvIGZvaSBjb25jbHXDrWRvIGNvbSBzdWNlc3NvLlwiLFxyXG4gICAgfSk7XHJcbiAgICBuYXZpZ2F0ZSgnL2Rhc2hib2FyZCcpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZUJhY2tUb1JlZ2lzdGVyID0gKCkgPT4ge1xyXG4gICAgc2V0U3RlcCgncmVnaXN0ZXInKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVHb29nbGVMb2dpbiA9IGFzeW5jICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHNpZ25JbldpdGhHb29nbGUoKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm8gbm8gbG9naW4gR29vZ2xlOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVBcHBsZUxvZ2luID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgc2lnbkluV2l0aEFwcGxlKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvIG5vIGxvZ2luIEFwcGxlOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVGYWNlYm9va0xvZ2luID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgc2lnbkluV2l0aEZhY2Vib29rKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvIG5vIGxvZ2luIEZhY2Vib29rOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPD5cclxuICAgICAgPEhlbG1ldD5cclxuICAgICAgICA8dGl0bGU+Q2FkYXN0cm8gLSBNZXNhcHJhMjwvdGl0bGU+XHJcbiAgICAgICAgPG1ldGEgbmFtZT1cImRlc2NyaXB0aW9uXCIgY29udGVudD1cIkNyaWUgc3VhIGNvbnRhIG5vIE1lc2FwcmEyIGUgY29tZWNlIGEgcGFydGljaXBhciBkZSBldmVudG9zIHNvY2lhaXMuXCIgLz5cclxuICAgICAgPC9IZWxtZXQ+XHJcblxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1pbi1oLXNjcmVlbiBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBwLTRcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInctZnVsbCBtYXgtdy1tZFwiPlxyXG4gICAgICAgICAgPEFuaW1hdGVQcmVzZW5jZSBtb2RlPVwid2FpdFwiPlxyXG4gICAgICAgICAgICB7c3RlcCA9PT0gJ3JlZ2lzdGVyJyA/IChcclxuICAgICAgICAgICAgICA8bW90aW9uLmRpdlxyXG4gICAgICAgICAgICAgICAga2V5PVwicmVnaXN0ZXJcIlxyXG4gICAgICAgICAgICAgICAgaW5pdGlhbD17eyBvcGFjaXR5OiAwLCB5OiAyMCB9fVxyXG4gICAgICAgICAgICAgICAgYW5pbWF0ZT17eyBvcGFjaXR5OiAxLCB5OiAwIH19XHJcbiAgICAgICAgICAgICAgICBleGl0PXt7IG9wYWNpdHk6IDAsIHg6IC0yMCB9fVxyXG4gICAgICAgICAgICAgID5cclxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ2xhc3MtZWZmZWN0IHJvdW5kZWQtMnhsIHAtOCBib3JkZXIgYm9yZGVyLXdoaXRlLzEwXCI+XHJcbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBqdXN0aWZ5LWNlbnRlciBtYi04XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3LTE2IGgtMTYgcm91bmRlZC0yeGwgYmctZ3JhZGllbnQtdG8tYnIgZnJvbS1wdXJwbGUtNTAwIHRvLXBpbmstNTAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8Q2FsZW5kYXIgY2xhc3NOYW1lPVwidy04IGgtOCB0ZXh0LXdoaXRlXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPVwidGV4dC0zeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIG1iLTIgZ3JhZGllbnQtdGV4dFwiPlxyXG4gICAgICAgICAgICAgICAgICAgIEp1bnRlLXNlIGFvIE1lc2FwcmEyXHJcbiAgICAgICAgICAgICAgICAgIDwvaDE+XHJcbiAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtY2VudGVyIHRleHQtd2hpdGUvNjAgbWItOFwiPlxyXG4gICAgICAgICAgICAgICAgICAgIENyaWUgc3VhIGNvbnRhIGUgY29tZWNlIGEgZXhwbG9yYXJcclxuICAgICAgICAgICAgICAgICAgPC9wPlxyXG5cclxuICAgICAgICAgICAgICAgICAgPFNvY2lhbExvZ2luQnV0dG9uc1xyXG4gICAgICAgICAgICAgICAgICAgIG9uR29vZ2xlQ2xpY2s9e2hhbmRsZUdvb2dsZUxvZ2lufVxyXG4gICAgICAgICAgICAgICAgICAgIG9uQXBwbGVDbGljaz17aGFuZGxlQXBwbGVMb2dpbn1cclxuICAgICAgICAgICAgICAgICAgICBvbkZhY2Vib29rQ2xpY2s9e2hhbmRsZUZhY2Vib29rTG9naW59XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZz17aXNMb2FkaW5nfVxyXG4gICAgICAgICAgICAgICAgICAvPlxyXG5cclxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZWxhdGl2ZSBteS02XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJhYnNvbHV0ZSBpbnNldC0wIGZsZXggaXRlbXMtY2VudGVyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInctZnVsbCBib3JkZXItdCBib3JkZXItd2hpdGUvMTBcIj48L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInJlbGF0aXZlIGZsZXgganVzdGlmeS1jZW50ZXIgdGV4dC1zbVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwicHgtNCBiZy1iYWNrZ3JvdW5kIHRleHQtd2hpdGUvNjBcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgb3UgY2FkYXN0cmUtc2UgY29tIGVtYWlsXHJcbiAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgICAgICAgPGZvcm0gb25TdWJtaXQ9e2hhbmRsZVN1Ym1pdH0gY2xhc3NOYW1lPVwic3BhY2UteS00XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJzcGFjZS15LTJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCBodG1sRm9yPVwibmFtZVwiPk5vbWUgY29tcGxldG88L0xhYmVsPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZWxhdGl2ZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8VXNlciBjbGFzc05hbWU9XCJhYnNvbHV0ZSBsZWZ0LTMgdG9wLTEvMiAtdHJhbnNsYXRlLXktMS8yIHctNSBoLTUgdGV4dC13aGl0ZS80MFwiIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlkPVwibmFtZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtuYW1lfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0TmFtZShlLnRhcmdldC52YWx1ZSl9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJTZXUgbm9tZSBjb21wbGV0b1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicGwtMTAgZ2xhc3MtZWZmZWN0IGJvcmRlci13aGl0ZS8xMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17aXNMb2FkaW5nfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0yXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgaHRtbEZvcj1cImVtYWlsXCI+RW1haWw8L0xhYmVsPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZWxhdGl2ZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8TWFpbCBjbGFzc05hbWU9XCJhYnNvbHV0ZSBsZWZ0LTMgdG9wLTEvMiAtdHJhbnNsYXRlLXktMS8yIHctNSBoLTUgdGV4dC13aGl0ZS80MFwiIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxJbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlkPVwiZW1haWxcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJlbWFpbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2VtYWlsfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0RW1haWwoZS50YXJnZXQudmFsdWUpfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwic2V1QGVtYWlsLmNvbVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicGwtMTAgZ2xhc3MtZWZmZWN0IGJvcmRlci13aGl0ZS8xMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17aXNMb2FkaW5nfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0yXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgaHRtbEZvcj1cInBob25lXCI+VGVsZWZvbmU8L0xhYmVsPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJyZWxhdGl2ZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8UGhvbmUgY2xhc3NOYW1lPVwiYWJzb2x1dGUgbGVmdC0zIHRvcC0xLzIgLXRyYW5zbGF0ZS15LTEvMiB3LTUgaC01IHRleHQtd2hpdGUvNDBcIiAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBpZD1cInBob25lXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwidGVsXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17cGhvbmV9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZVBob25lQ2hhbmdlfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiKzU1ICg5OSkgOTk5OTktOTk5OVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicGwtMTAgZ2xhc3MtZWZmZWN0IGJvcmRlci13aGl0ZS8xMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17aXNMb2FkaW5nfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LXhzIHRleHQtd2hpdGUvNDAgbXQtMVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBWb2PDqiByZWNlYmVyw6EgdW0gY8OzZGlnbyBkZSB2ZXJpZmljYcOnw6NvIHZpYSBTTVNcclxuICAgICAgICAgICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJzcGFjZS15LTJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCBodG1sRm9yPVwicGFzc3dvcmRcIj5TZW5oYTwvTGFiZWw+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInJlbGF0aXZlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxMb2NrIGNsYXNzTmFtZT1cImFic29sdXRlIGxlZnQtMyB0b3AtMS8yIC10cmFuc2xhdGUteS0xLzIgdy01IGgtNSB0ZXh0LXdoaXRlLzQwXCIgLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPElucHV0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ9XCJwYXNzd29yZFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17cGFzc3dvcmR9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRQYXNzd29yZChlLnRhcmdldC52YWx1ZSl9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJNw61uaW1vIDYgY2FyYWN0ZXJlc1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwicGwtMTAgZ2xhc3MtZWZmZWN0IGJvcmRlci13aGl0ZS8xMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17aXNMb2FkaW5nfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIDxCdXR0b24gXHJcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwic3VibWl0XCIgXHJcbiAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJ3LWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLXB1cnBsZS01MDAgdG8tcGluay01MDAgaG92ZXI6ZnJvbS1wdXJwbGUtNjAwIGhvdmVyOnRvLXBpbmstNjAwIGgtMTIgdGV4dC1iYXNlIGZvbnQtc2VtaWJvbGRcIiBcclxuICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc0xvYWRpbmd9XHJcbiAgICAgICAgICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgICAgICAgICAge2lzTG9hZGluZyA/ICdDcmlhbmRvIGNvbnRhLi4uJyA6ICdDb250aW51YXInfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgICAgICAgICAgICA8L2Zvcm0+XHJcblxyXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm10LTYgc3BhY2UteS00XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXIgdGV4dC13aGl0ZS82MCB0ZXh0LXNtXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICBKw6EgdGVtIHVtYSBjb250YT97JyAnfVxyXG4gICAgICAgICAgICAgICAgICAgICAgPExpbmsgdG89XCIvbG9naW5cIiBjbGFzc05hbWU9XCJ0ZXh0LXB1cnBsZS00MDAgaG92ZXI6dGV4dC1wdXJwbGUtMzAwIGZvbnQtc2VtaWJvbGRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgRmHDp2EgbG9naW5cclxuICAgICAgICAgICAgICAgICAgICAgIDwvTGluaz5cclxuICAgICAgICAgICAgICAgICAgICA8L3A+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtY2VudGVyIHRleHQtd2hpdGUvNjAgdGV4dC1zbVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgw4kgdW0gcmVzdGF1cmFudGU/eycgJ31cclxuICAgICAgICAgICAgICAgICAgICAgIDxMaW5rIHRvPVwiL3BhcnRuZXIvcmVnaXN0ZXJcIiBjbGFzc05hbWU9XCJ0ZXh0LXB1cnBsZS00MDAgaG92ZXI6dGV4dC1wdXJwbGUtMzAwIGZvbnQtc2VtaWJvbGRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgQ2FkYXN0cmUgc2V1IGVzdGFiZWxlY2ltZW50b1xyXG4gICAgICAgICAgICAgICAgICAgICAgPC9MaW5rPlxyXG4gICAgICAgICAgICAgICAgICAgIDwvcD5cclxuICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICA8L21vdGlvbi5kaXY+XHJcbiAgICAgICAgICAgICkgOiAoXHJcbiAgICAgICAgICAgICAgPFBob25lVmVyaWZpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICBrZXk9XCJ2ZXJpZnlcIlxyXG4gICAgICAgICAgICAgICAgdXNlcklkPXt1c2VySWR9XHJcbiAgICAgICAgICAgICAgICBwaG9uZT17cGhvbmV9XHJcbiAgICAgICAgICAgICAgICBvblZlcmlmaWVkPXtoYW5kbGVWZXJpZmllZH1cclxuICAgICAgICAgICAgICAgIG9uQmFjaz17aGFuZGxlQmFja1RvUmVnaXN0ZXJ9XHJcbiAgICAgICAgICAgICAgLz5cclxuICAgICAgICAgICAgKX1cclxuICAgICAgICAgIDwvQW5pbWF0ZVByZXNlbmNlPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvPlxyXG4gICk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSZWdpc3RlclBhZ2U7Il0sInZlcnNpb24iOjN9