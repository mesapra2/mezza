0599455353e81995dbd3225f04ca995a
"use strict";
// src/services/EventPhotosService.test.ts
/* eslint-disable @typescript-eslint/no-explicit-any */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock('../lib/supabaseClient', () => {
    const from = jest.fn();
    const storageFrom = jest.fn();
    return {
        supabase: {
            from,
            storage: {
                from: storageFrom
            }
        }
    };
});
const EventPhotosService_1 = tslib_1.__importDefault(require("./EventPhotosService"));
const supabaseClient_1 = require("../lib/supabaseClient");
describe('EventPhotosService', () => {
    const mockedSupabase = supabaseClient_1.supabase;
    // helpers de narrowing SEM acessar propriedades do outro ramo
    function assertFailure(result, message) {
        if (result.success) {
            throw new Error('expected failure but got success');
        }
        expect(result.success).toBe(false);
        if (message) {
            expect(result.error).toBe(message);
        }
    }
    function assertSuccess(result) {
        expect(result.success).toBe(true);
        if (result.success) {
            expect(result.photoUrl).toBeDefined();
        }
    }
    const makeFile = (name = 'photo.jpg', size = 1024, type = 'image/jpeg') => ({
        name,
        size,
        type
    });
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('uploadEventPhoto', () => {
        it('retorna erro quando o arquivo não é imagem', async () => {
            const file = makeFile('doc.pdf', 1000, 'application/pdf');
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'Apenas imagens são permitidas');
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('retorna erro quando o arquivo tem mais de 10MB antes do resize', async () => {
            const big = makeFile('big.jpg', 10 * 1024 * 1024 + 5);
            const result = await EventPhotosService_1.default.uploadEventPhoto(2, 'user-2', big);
            assertFailure(result, 'Arquivo muito grande (máx: 10MB)');
        });
        it('faz upload de nova foto, deleta a anterior e salva no BD', async () => {
            const file = makeFile();
            const oldPhoto = {
                id: 99,
                event_id: 1,
                user_id: 'user-1',
                photo_url: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-old.jpg',
                status: 'aprovado'
            };
            const getUserSpy = jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(oldPhoto);
            const deleteSpy = jest
                .spyOn(EventPhotosService_1.default, 'deleteEventPhoto')
                .mockResolvedValue(true);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove: jest.fn()
            });
            const insert = jest.fn().mockResolvedValue({ error: null });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertSuccess(result);
            if (result.success) {
                expect(result.photoUrl).toContain('event-photos/1/user-1-');
            }
            expect(getUserSpy).toHaveBeenCalledWith(1, 'user-1');
            expect(deleteSpy).toHaveBeenCalledWith(99, 'user-1');
            getUserSpy.mockRestore();
            deleteSpy.mockRestore();
        });
        it('remove o arquivo do storage se o insert no BD falhar', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({ error: null });
            const getPublicUrl = jest.fn(() => ({
                data: {
                    publicUrl: 'https://example.com/storage/v1/object/public/event-photos/1/user-1-123.jpg'
                }
            }));
            const remove = jest.fn();
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl,
                remove
            });
            const insert = jest.fn().mockResolvedValue({
                error: { message: 'db error' }
            });
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        insert
                    };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(1, 'user-1', file);
            assertFailure(result, 'db error');
            expect(remove).toHaveBeenCalled();
        });
        it('retorna erro quando o upload no storage falha', async () => {
            const file = makeFile();
            jest
                .spyOn(EventPhotosService_1.default, 'getUserPhotoForEvent')
                .mockResolvedValue(null);
            const upload = jest.fn().mockResolvedValue({
                error: { message: 'storage error' }
            });
            mockedSupabase.storage.from.mockReturnValue({
                upload,
                getPublicUrl: jest.fn(),
                remove: jest.fn()
            });
            const result = await EventPhotosService_1.default.uploadEventPhoto(5, 'user-5', file);
            assertFailure(result, 'storage error');
        });
    });
    describe('getEventPhotos', () => {
        it('busca fotos aprovadas do evento', async () => {
            const select = jest.fn(() => ({
                eq: jest
                    .fn()
                    .mockImplementationOnce(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: [
                                {
                                    id: 1,
                                    event_id: 10,
                                    user_id: 'u1',
                                    photo_url: 'https://example.com/p1.jpg',
                                    status: 'aprovado'
                                }
                            ],
                            error: null
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toHaveLength(1);
            expect(photos[0].photo_url).toBe('https://example.com/p1.jpg');
        });
        it('retorna array vazio em caso de erro', async () => {
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        order: jest.fn().mockResolvedValue({
                            data: null,
                            error: { message: 'erro' }
                        })
                    }))
                }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photos = await EventPhotosService_1.default.getEventPhotos(10);
            expect(photos).toEqual([]);
        });
    });
    describe('getUserPhotoForEvent', () => {
        it('retorna a foto do usuário quando existir', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 2,
                    event_id: 11,
                    user_id: 'user-1',
                    photo_url: 'https://example.com/p2.jpg',
                    status: 'aprovado'
                },
                error: null
            });
            const eq = jest.fn(() => ({ eq: jest.fn(() => ({ maybeSingle })) }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).not.toBeNull();
            expect(photo?.photo_url).toBe('https://example.com/p2.jpg');
        });
        it('retorna null em caso de erro', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'erro' }
            });
            const eq = jest.fn(() => ({ maybeSingle }));
            const select = jest.fn(() => ({ eq }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const photo = await EventPhotosService_1.default.getUserPhotoForEvent(11, 'user-1');
            expect(photo).toBeNull();
        });
    });
    describe('deleteEventPhoto', () => {
        it('retorna false se a foto não existir', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: null,
                error: { message: 'not found' }
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return { select };
                }
                return {};
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
        });
        it('retorna false se não for o dono da foto', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 5,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/other.jpg',
                    user_id: 'outro-user'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            mockedSupabase.from.mockReturnValue({
                select
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-x');
            expect(result).toBe(false);
            expect(mockedSupabase.storage.from).not.toHaveBeenCalled();
        });
        it('deleta do storage e do BD quando for o dono', async () => {
            const maybeSingle = jest.fn().mockResolvedValue({
                data: {
                    id: 7,
                    photo_url: 'https://example.com/storage/v1/object/public/event-photos/10/user-1-123.jpg',
                    user_id: 'user-1'
                },
                error: null
            });
            const select = jest.fn(() => ({
                eq: jest.fn(() => ({ maybeSingle }))
            }));
            const deleteFn = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn().mockResolvedValue({ error: null })
                }))
            }));
            mockedSupabase.from.mockImplementation((table) => {
                if (table === 'event_photos') {
                    return {
                        select,
                        delete: deleteFn
                    };
                }
                return {};
            });
            const remove = jest.fn().mockResolvedValue({});
            mockedSupabase.storage.from.mockReturnValue({
                remove
            });
            const result = await EventPhotosService_1.default.deleteEventPhoto(10, 'user-1');
            expect(result).toBe(true);
            expect(mockedSupabase.storage.from).toHaveBeenCalledWith('event-photos');
            expect(remove).toHaveBeenCalledWith(['10/user-1-123.jpg']);
            expect(deleteFn).toHaveBeenCalled();
        });
    });
    describe('getPhotoStats', () => {
        it('retorna estatísticas calculadas', async () => {
            const photosSelect = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn().mockResolvedValue({
                        count: 3,
                        error: null
                    })
                }))
            }));
            const participantsSelect = jest.fn(() => ({
                eq: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        eq: jest.fn().mockResolvedValue({
                            count: 6,
                            error: null
                        })
                    }))
                }))
            }));
            mockedSupabase.from
                .mockImplementationOnce(() => ({
                select: photosSelect
            }))
                .mockImplementationOnce(() => ({
                select: participantsSelect
            }));
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            expect(stats.totalPhotos).toBe(3);
            expect(stats.totalParticipants).toBe(6);
            expect(stats.percentageWithPhotos).toBeCloseTo(50);
        });
        it('retorna tudo 0 em caso de erro', async () => {
            mockedSupabase.from.mockReturnValue({
                select: jest.fn(() => ({
                    eq: jest.fn(() => ({
                        eq: jest.fn(() => ({
                            eq: jest.fn().mockRejectedValue(new Error('erro'))
                        }))
                    }))
                }))
            });
            const stats = await EventPhotosService_1.default.getPhotoStats(50);
            const expected = {
                totalPhotos: 0,
                totalParticipants: 0,
                percentageWithPhotos: 0
            };
            expect(stats).toEqual(expected);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRQaG90b3NTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBLDBDQUEwQztBQUMxQyx1REFBdUQ7OztBQVN2RCxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtJQUN0QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7SUFDdkIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQzlCLE9BQU87UUFDTCxRQUFRLEVBQUU7WUFDUixJQUFJO1lBQ0osT0FBTyxFQUFFO2dCQUNQLElBQUksRUFBRSxXQUFXO2FBQ2xCO1NBQ0Y7S0FDRixDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFsQkgsc0ZBSThCO0FBQzlCLDBEQUFpRDtBQWVqRCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2xDLE1BQU0sY0FBYyxHQUFHLHlCQUt0QixDQUFDO0lBRUYsOERBQThEO0lBQzlELFNBQVMsYUFBYSxDQUNwQixNQUFvQixFQUNwQixPQUFnQjtRQUVoQixJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDdEQsQ0FBQztRQUNELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25DLElBQUksT0FBTyxFQUFFLENBQUM7WUFDWixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxDQUFDO0lBQ0gsQ0FBQztJQUVELFNBQVMsYUFBYSxDQUNwQixNQUFvQjtRQUVwQixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsQyxJQUFJLE1BQU0s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Q0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcRXZlbnRQaG90b3NTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL0V2ZW50UGhvdG9zU2VydmljZS50ZXN0LnRzXHJcbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi9cclxuXHJcbmltcG9ydCBFdmVudFBob3Rvc1NlcnZpY2UsIHtcclxuICB0eXBlIEV2ZW50UGhvdG8sXHJcbiAgdHlwZSBQaG90b1N0YXRzLFxyXG4gIHR5cGUgVXBsb2FkUmVzdWx0XHJcbn0gZnJvbSAnLi9FdmVudFBob3Rvc1NlcnZpY2UnO1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gJy4uL2xpYi9zdXBhYmFzZUNsaWVudCc7XHJcblxyXG5qZXN0Lm1vY2soJy4uL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+IHtcclxuICBjb25zdCBmcm9tID0gamVzdC5mbigpO1xyXG4gIGNvbnN0IHN0b3JhZ2VGcm9tID0gamVzdC5mbigpO1xyXG4gIHJldHVybiB7XHJcbiAgICBzdXBhYmFzZToge1xyXG4gICAgICBmcm9tLFxyXG4gICAgICBzdG9yYWdlOiB7XHJcbiAgICAgICAgZnJvbTogc3RvcmFnZUZyb21cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcbn0pO1xyXG5cclxuZGVzY3JpYmUoJ0V2ZW50UGhvdG9zU2VydmljZScsICgpID0+IHtcclxuICBjb25zdCBtb2NrZWRTdXBhYmFzZSA9IHN1cGFiYXNlIGFzIHVua25vd24gYXMge1xyXG4gICAgZnJvbTogamVzdC5Nb2NrO1xyXG4gICAgc3RvcmFnZToge1xyXG4gICAgICBmcm9tOiBqZXN0Lk1vY2s7XHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gIC8vIGhlbHBlcnMgZGUgbmFycm93aW5nIFNFTSBhY2Vzc2FyIHByb3ByaWVkYWRlcyBkbyBvdXRybyByYW1vXHJcbiAgZnVuY3Rpb24gYXNzZXJ0RmFpbHVyZShcclxuICAgIHJlc3VsdDogVXBsb2FkUmVzdWx0LFxyXG4gICAgbWVzc2FnZT86IHN0cmluZ1xyXG4gICk6IGFzc2VydHMgcmVzdWx0IGlzIHsgc3VjY2VzczogZmFsc2U7IGVycm9yOiBzdHJpbmcgfSB7XHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdleHBlY3RlZCBmYWlsdXJlIGJ1dCBnb3Qgc3VjY2VzcycpO1xyXG4gICAgfVxyXG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcclxuICAgIGlmIChtZXNzYWdlKSB7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUobWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhc3NlcnRTdWNjZXNzKFxyXG4gICAgcmVzdWx0OiBVcGxvYWRSZXN1bHRcclxuICApOiBhc3NlcnRzIHJlc3VsdCBpcyB7IHN1Y2Nlc3M6IHRydWU7IHBob3RvVXJsOiBzdHJpbmcgfSB7XHJcbiAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5waG90b1VybCkudG9CZURlZmluZWQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IG1ha2VGaWxlID0gKFxyXG4gICAgbmFtZSA9ICdwaG90by5qcGcnLFxyXG4gICAgc2l6ZSA9IDEwMjQsXHJcbiAgICB0eXBlID0gJ2ltYWdlL2pwZWcnXHJcbiAgKTogRmlsZSA9PlxyXG4gICAgKHtcclxuICAgICAgbmFtZSxcclxuICAgICAgc2l6ZSxcclxuICAgICAgdHlwZVxyXG4gICAgfSBhcyB1bmtub3duIGFzIEZpbGUpO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBsb2FkRXZlbnRQaG90bycsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGVycm8gcXVhbmRvIG8gYXJxdWl2byBuw6NvIMOpIGltYWdlbScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG1ha2VGaWxlKCdkb2MucGRmJywgMTAwMCwgJ2FwcGxpY2F0aW9uL3BkZicpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oMSwgJ3VzZXItMScsIGZpbGUpO1xyXG5cclxuICAgICAgYXNzZXJ0RmFpbHVyZShyZXN1bHQsICdBcGVuYXMgaW1hZ2VucyBzw6NvIHBlcm1pdGlkYXMnKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGVycm8gcXVhbmRvIG8gYXJxdWl2byB0ZW0gbWFpcyBkZSAxME1CIGFudGVzIGRvIHJlc2l6ZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgYmlnID0gbWFrZUZpbGUoJ2JpZy5qcGcnLCAxMCAqIDEwMjQgKiAxMDI0ICsgNSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UudXBsb2FkRXZlbnRQaG90bygyLCAndXNlci0yJywgYmlnKTtcclxuXHJcbiAgICAgIGFzc2VydEZhaWx1cmUocmVzdWx0LCAnQXJxdWl2byBtdWl0byBncmFuZGUgKG3DoXg6IDEwTUIpJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZmF6IHVwbG9hZCBkZSBub3ZhIGZvdG8sIGRlbGV0YSBhIGFudGVyaW9yIGUgc2FsdmEgbm8gQkQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGUgPSBtYWtlRmlsZSgpO1xyXG5cclxuICAgICAgY29uc3Qgb2xkUGhvdG86IEV2ZW50UGhvdG8gPSB7XHJcbiAgICAgICAgaWQ6IDk5LFxyXG4gICAgICAgIGV2ZW50X2lkOiAxLFxyXG4gICAgICAgIHVzZXJfaWQ6ICd1c2VyLTEnLFxyXG4gICAgICAgIHBob3RvX3VybDpcclxuICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMS91c2VyLTEtb2xkLmpwZycsXHJcbiAgICAgICAgc3RhdHVzOiAnYXByb3ZhZG8nXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBnZXRVc2VyU3B5ID0gamVzdFxyXG4gICAgICAgIC5zcHlPbihFdmVudFBob3Rvc1NlcnZpY2UsICdnZXRVc2VyUGhvdG9Gb3JFdmVudCcpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG9sZFBob3RvKTtcclxuXHJcbiAgICAgIGNvbnN0IGRlbGV0ZVNweSA9IGplc3RcclxuICAgICAgICAuc3B5T24oRXZlbnRQaG90b3NTZXJ2aWNlLCAnZGVsZXRlRXZlbnRQaG90bycpXHJcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xyXG5cclxuICAgICAgY29uc3QgdXBsb2FkID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZXJyb3I6IG51bGwgfSk7XHJcbiAgICAgIGNvbnN0IGdldFB1YmxpY1VybCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBwdWJsaWNVcmw6XHJcbiAgICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMS91c2VyLTEtMTIzLmpwZydcclxuICAgICAgICB9XHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVwbG9hZCxcclxuICAgICAgICBnZXRQdWJsaWNVcmwsXHJcbiAgICAgICAgcmVtb3ZlOiBqZXN0LmZuKClcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBpbnNlcnQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbnNlcnRcclxuICAgICAgICAgIH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oMSwgJ3VzZXItMScsIGZpbGUpO1xyXG5cclxuICAgICAgYXNzZXJ0U3VjY2VzcyhyZXN1bHQpO1xyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICBleHBlY3QocmVzdWx0LnBob3RvVXJsKS50b0NvbnRhaW4oJ2V2ZW50LXBob3Rvcy8xL3VzZXItMS0nKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZXhwZWN0KGdldFVzZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDEsICd1c2VyLTEnKTtcclxuICAgICAgZXhwZWN0KGRlbGV0ZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoOTksICd1c2VyLTEnKTtcclxuXHJcbiAgICAgIGdldFVzZXJTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgZGVsZXRlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmVtb3ZlIG8gYXJxdWl2byBkbyBzdG9yYWdlIHNlIG8gaW5zZXJ0IG5vIEJEIGZhbGhhcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZmlsZSA9IG1ha2VGaWxlKCk7XHJcblxyXG4gICAgICBqZXN0XHJcbiAgICAgICAgLnNweU9uKEV2ZW50UGhvdG9zU2VydmljZSwgJ2dldFVzZXJQaG90b0ZvckV2ZW50JylcclxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcblxyXG4gICAgICBjb25zdCB1cGxvYWQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KTtcclxuICAgICAgY29uc3QgZ2V0UHVibGljVXJsID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHB1YmxpY1VybDpcclxuICAgICAgICAgICAgJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL2V2ZW50LXBob3Rvcy8xL3VzZXItMS0xMjMuanBnJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSkpO1xyXG4gICAgICBjb25zdCByZW1vdmUgPSBqZXN0LmZuKCk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1cGxvYWQsXHJcbiAgICAgICAgZ2V0UHVibGljVXJsLFxyXG4gICAgICAgIHJlbW92ZVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGluc2VydCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ2RiIGVycm9yJyB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbnNlcnRcclxuICAgICAgICAgIH0gYXMgdW5rbm93bjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHt9IGFzIHVua25vd247XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLnVwbG9hZEV2ZW50UGhvdG8oMSwgJ3VzZXItMScsIGZpbGUpO1xyXG5cclxuICAgICAgYXNzZXJ0RmFpbHVyZShyZXN1bHQsICdkYiBlcnJvcicpO1xyXG4gICAgICBleHBlY3QocmVtb3ZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0b3JuYSBlcnJvIHF1YW5kbyBvIHVwbG9hZCBubyBzdG9yYWdlIGZhbGhhJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaWxlID0gbWFrZUZpbGUoKTtcclxuXHJcbiAgICAgIGplc3RcclxuICAgICAgICAuc3B5T24oRXZlbnRQaG90b3NTZXJ2aWNlLCAnZ2V0VXNlclBob3RvRm9yRXZlbnQnKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuXHJcbiAgICAgIGNvbnN0IHVwbG9hZCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ3N0b3JhZ2UgZXJyb3InIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5zdG9yYWdlLmZyb20ubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1cGxvYWQsXHJcbiAgICAgICAgZ2V0UHVibGljVXJsOiBqZXN0LmZuKCksXHJcbiAgICAgICAgcmVtb3ZlOiBqZXN0LmZuKClcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UudXBsb2FkRXZlbnRQaG90byg1LCAndXNlci01JywgZmlsZSk7XHJcblxyXG4gICAgICBhc3NlcnRGYWlsdXJlKHJlc3VsdCwgJ3N0b3JhZ2UgZXJyb3InKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0RXZlbnRQaG90b3MnLCAoKSA9PiB7XHJcbiAgICBpdCgnYnVzY2EgZm90b3MgYXByb3ZhZGFzIGRvIGV2ZW50bycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0XHJcbiAgICAgICAgICAuZm4oKVxyXG4gICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBvcmRlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICAgIGRhdGE6IFtcclxuICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50X2lkOiAxMCxcclxuICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOiAndTEnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBob3RvX3VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcDEuanBnJyxcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdhcHJvdmFkbydcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBpZiAodGFibGUgPT09ICdldmVudF9waG90b3MnKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzZWxlY3QgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBwaG90b3MgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0RXZlbnRQaG90b3MoMTApO1xyXG5cclxuICAgICAgZXhwZWN0KHBob3RvcykudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QocGhvdG9zWzBdLnBob3RvX3VybCkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbS9wMS5qcGcnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGFycmF5IHZhemlvIGVtIGNhc28gZGUgZXJybycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBvcmRlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgICBkYXRhOiBudWxsLFxyXG4gICAgICAgICAgICAgIGVycm9yOiB7IG1lc3NhZ2U6ICdlcnJvJyB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcGhvdG9zID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldEV2ZW50UGhvdG9zKDEwKTtcclxuXHJcbiAgICAgIGV4cGVjdChwaG90b3MpLnRvRXF1YWwoW10pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRVc2VyUGhvdG9Gb3JFdmVudCcsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGEgZm90byBkbyB1c3XDoXJpbyBxdWFuZG8gZXhpc3RpcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWF5YmVTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIGlkOiAyLFxyXG4gICAgICAgICAgZXZlbnRfaWQ6IDExLFxyXG4gICAgICAgICAgdXNlcl9pZDogJ3VzZXItMScsXHJcbiAgICAgICAgICBwaG90b191cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3AyLmpwZycsXHJcbiAgICAgICAgICBzdGF0dXM6ICdhcHJvdmFkbydcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBlcSA9IGplc3QuZm4oKCkgPT4gKHsgZXE6IGplc3QuZm4oKCkgPT4gKHsgbWF5YmVTaW5nbGUgfSkpIH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7IHNlbGVjdCB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7fSBhcyB1bmtub3duO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHBob3RvID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldFVzZXJQaG90b0ZvckV2ZW50KDExLCAndXNlci0xJyk7XHJcblxyXG4gICAgICBleHBlY3QocGhvdG8pLm5vdC50b0JlTnVsbCgpO1xyXG4gICAgICBleHBlY3QocGhvdG8/LnBob3RvX3VybCkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbS9wMi5qcGcnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIG51bGwgZW0gY2FzbyBkZSBlcnJvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXliZVNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnZXJybycgfVxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3QgZXEgPSBqZXN0LmZuKCgpID0+ICh7IG1heWJlU2luZ2xlIH0pKTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoeyBlcSB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgc2VsZWN0XHJcbiAgICAgIH0gYXMgdW5rbm93bik7XHJcblxyXG4gICAgICBjb25zdCBwaG90byA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5nZXRVc2VyUGhvdG9Gb3JFdmVudCgxMSwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHBob3RvKS50b0JlTnVsbCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdkZWxldGVFdmVudFBob3RvJywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldG9ybmEgZmFsc2Ugc2UgYSBmb3RvIG7Do28gZXhpc3RpcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbWF5YmVTaW5nbGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ25vdCBmb3VuZCcgfVxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3Qgc2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7IG1heWJlU2luZ2xlIH0pKVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7IHNlbGVjdCB9IGFzIHVua25vd247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7fSBhcyB1bmtub3duO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IEV2ZW50UGhvdG9zU2VydmljZS5kZWxldGVFdmVudFBob3RvKDEwLCAndXNlci14Jyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRvcm5hIGZhbHNlIHNlIG7Do28gZm9yIG8gZG9ubyBkYSBmb3RvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXliZVNpbmdsZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgaWQ6IDUsXHJcbiAgICAgICAgICBwaG90b191cmw6XHJcbiAgICAgICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL3N0b3JhZ2UvdjEvb2JqZWN0L3B1YmxpYy9ldmVudC1waG90b3MvMTAvb3RoZXIuanBnJyxcclxuICAgICAgICAgIHVzZXJfaWQ6ICdvdXRyby11c2VyJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdFxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmRlbGV0ZUV2ZW50UGhvdG8oMTAsICd1c2VyLXgnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RlbGV0YSBkbyBzdG9yYWdlIGUgZG8gQkQgcXVhbmRvIGZvciBvIGRvbm8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1heWJlU2luZ2xlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBpZDogNyxcclxuICAgICAgICAgIHBob3RvX3VybDpcclxuICAgICAgICAgICAgJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3RvcmFnZS92MS9vYmplY3QvcHVibGljL2V2ZW50LXBob3Rvcy8xMC91c2VyLTEtMTIzLmpwZycsXHJcbiAgICAgICAgICB1c2VyX2lkOiAndXNlci0xJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXJyb3I6IG51bGxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IHNlbGVjdCA9IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoeyBtYXliZVNpbmdsZSB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgZGVsZXRlRm4gPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBlcnJvcjogbnVsbCB9KVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBtb2NrZWRTdXBhYmFzZS5mcm9tLm1vY2tJbXBsZW1lbnRhdGlvbigodGFibGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGlmICh0YWJsZSA9PT0gJ2V2ZW50X3Bob3RvcycpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNlbGVjdCxcclxuICAgICAgICAgICAgZGVsZXRlOiBkZWxldGVGblxyXG4gICAgICAgICAgfSBhcyB1bmtub3duO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge30gYXMgdW5rbm93bjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZW1vdmUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2Uuc3RvcmFnZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgcmVtb3ZlXHJcbiAgICAgIH0gYXMgdW5rbm93bik7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZGVsZXRlRXZlbnRQaG90bygxMCwgJ3VzZXItMScpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLnN0b3JhZ2UuZnJvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2V2ZW50LXBob3RvcycpO1xyXG4gICAgICBleHBlY3QocmVtb3ZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChbJzEwL3VzZXItMS0xMjMuanBnJ10pO1xyXG4gICAgICBleHBlY3QoZGVsZXRlRm4pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0UGhvdG9TdGF0cycsICgpID0+IHtcclxuICAgIGl0KCdyZXRvcm5hIGVzdGF0w61zdGljYXMgY2FsY3VsYWRhcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcGhvdG9zU2VsZWN0ID0gamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgICAgICAgY291bnQ6IDMsXHJcbiAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCBwYXJ0aWNpcGFudHNTZWxlY3QgPSBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgICAgICAgIGNvdW50OiA2LFxyXG4gICAgICAgICAgICAgIGVycm9yOiBudWxsXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9KSlcclxuICAgICAgICB9KSlcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbVxyXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgICBzZWxlY3Q6IHBob3Rvc1NlbGVjdFxyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgICBzZWxlY3Q6IHBhcnRpY2lwYW50c1NlbGVjdFxyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgRXZlbnRQaG90b3NTZXJ2aWNlLmdldFBob3RvU3RhdHMoNTApO1xyXG5cclxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsUGhvdG9zKS50b0JlKDMpO1xyXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxQYXJ0aWNpcGFudHMpLnRvQmUoNik7XHJcbiAgICAgIGV4cGVjdChzdGF0cy5wZXJjZW50YWdlV2l0aFBob3RvcykudG9CZUNsb3NlVG8oNTApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3JldG9ybmEgdHVkbyAwIGVtIGNhc28gZGUgZXJybycsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja2VkU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignZXJybycpKVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgIH0pKVxyXG4gICAgICAgIH0pKVxyXG4gICAgICB9IGFzIHVua25vd24pO1xyXG5cclxuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBFdmVudFBob3Rvc1NlcnZpY2UuZ2V0UGhvdG9TdGF0cyg1MCk7XHJcblxyXG4gICAgICBjb25zdCBleHBlY3RlZDogUGhvdG9TdGF0cyA9IHtcclxuICAgICAgICB0b3RhbFBob3RvczogMCxcclxuICAgICAgICB0b3RhbFBhcnRpY2lwYW50czogMCxcclxuICAgICAgICBwZXJjZW50YWdlV2l0aFBob3RvczogMFxyXG4gICAgICB9O1xyXG4gICAgICBleHBlY3Qoc3RhdHMpLnRvRXF1YWwoZXhwZWN0ZWQpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==