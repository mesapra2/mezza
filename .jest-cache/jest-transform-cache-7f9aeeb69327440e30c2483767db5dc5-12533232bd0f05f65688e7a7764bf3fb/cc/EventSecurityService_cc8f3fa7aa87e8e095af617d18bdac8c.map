{"file":"C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventSecurityService.ts","mappings":";;AAAA,uCAAuC;AACvC,0DAAiD;AAqBjD;;;GAGG;AACH,MAAM,oBAAoB;IACxB;;;OAGG;IACH,MAAM,CAAC,gBAAgB;QACrB,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC;QACpE,OAAO,CAAC,GAAG,CAAC,oBAAoB,QAAQ,EAAE,CAAC,CAAC;QAC5C,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED;;;;OAIG;IACH,MAAM,CAAC,KAAK,CAAC,mBAAmB,CAAC,OAAe,EAAE,QAAgB;QAChE,IAAI,CAAC;YACH,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAClE,OAAO;oBACL,OAAO,EAAE,KAAK;oBACd,KAAK,EAAE,qCAAqC;iBAC7C,CAAC;YACJ,CAAC;YAED,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,yBAAQ;iBAC7B,IAAI,CAAC,QAAQ,CAAC;iBACd,MAAM,CAAC;gBACN,oBAAoB,EAAE,QAAQ;gBAC9B,eAAe,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;aAC1C,CAAC;iBACD,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;YAErB,IAAI,KAAK;gBAAE,MAAM,KAAK,CAAC;YAEvB,OAAO,CAAC,GAAG,CAAC,WAAW,QAAQ,oBAAoB,OAAO,EAAE,CAAC,CAAC;YAC9D,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC;QACrC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,yBAAyB,EAAE,KAAK,CAAC,CAAC;YAChD,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;QACnC,CAAC;IACH,CAAC;IAED;;;OAGG;IACH,MAAM,CAAC,KAAK,CAAC,uBAAuB,CAAC,OAAe;QAClD,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACzC,OAAO,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;QACrD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,KAAK,CAAC,CAAC;YACxD,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;QACnC,CAAC;IACH,CAAC;IAED;;;;;OAKG;IACH,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAe;QAC3C,IAAI,CAAC;YACH,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,MAAM,yBAAQ;iBACtD,IAAI,CAAC,QAAQ,CAAC;iBACd,MAAM,CAAC,8BAA8B,CAAC;iBACtC,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC;iBACjB,MAAM,EAAE,CAAC;YAEZ,IAAI,UAAU;gBAAE,MAAM,UAAU,CAAC;YACjC,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,uBAAuB,EAAE,CAAC;YAC7D,CAAC;YAED,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;YACvB,MAAM,SAAS,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAC7C,MAAM,OAAO,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YAEzC,6CAA6C;YAC7C,MAAM,iBAAiB,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;YACpE,IAAI,GAAG,GAAG,iBAAiB,EAAE,CAAC;gBAC5B,OAAO;oBACL,OAAO,EAAE,KAAK;oBACd,MAAM,EAAE,kCAAkC,iBAAiB,CAAC,kBAAkB,EAAE,EAAE;iBACnF,CAAC;YACJ,CAAC;YAED,+CAA+C;YAC/C,MAAM,eAAe,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;YACpE,IAAI,GAAG,IAAI,eAAe,EAAE,CAAC;gBAC3B,OAAO;oBACL,OAAO,EAAE,KAAK;oBACd,MAAM,EAAE,2DAA2D;iBACpE,CAAC;YACJ,CAAC;YAED,4DAA4D;YAC5D,IAAI,KAAK,CAAC,MAAM,KAAK,YAAY,IAAI,KAAK,CAAC,MAAM,KAAK,cAAc,EAAE,CAAC;gBACrE,OAAO;oBACL,OAAO,EAAE,KAAK;oBACd,MAAM,EAAE,oDAAoD,KAAK,CAAC,MAAM,GAAG;iBAC5E,CAAC;YACJ,CAAC;YAED,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC3B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,sCAAsC,EAAE,KAAK,CAAC,CAAC;YAC7D,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,wBAAwB,EAAE,CAAC;QAC9D,CAAC;IACH,CAAC;IAED;;;OAGG;IACH,MAAM,CAAC,KAAK,CAAC,qBAAqB,CAAC,MAAgC;QACjE,IAAI,CAAC;YACH,MAAM,EAAE,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,GAAG,MAAM,CAAC;YAEpD,uBAAuB;YACvB,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;YACzD,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;gBACzB,OAAO;oBACL,OAAO,EAAE,KAAK;oBACd,OAAO,EAAE,WAAW,CAAC,MAAM;iBAC5B,CAAC;YACJ,CAAC;YAED,oCAAoC;YACpC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,MAAM,yBAAQ;iBACtD,IAAI,CAAC,QAAQ,CAAC;iBACd,MAAM,CAAC,8BAA8B,CAAC;iBACtC,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC;iBACjB,MAAM,EAAE,CAAC;YAEZ,IAAI,UAAU;gBAAE,MAAM,UAAU,CAAC;YACjC,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,uBAAuB,EAAE,CAAC;YAC9D,CAAC;YAED,oBAAoB;YACpB,IAAI,QAAQ,KAAK,KAAK,CAAC,oBAAoB,EAAE,CAAC;gBAC5C,OAAO,CAAC,IAAI,CAAC,kBAAkB,aAAa,mCAAmC,OAAO,EAAE,CAAC,CAAC;gBAC1F,OAAO;oBACL,OAAO,EAAE,KAAK;oBACd,OAAO,EAAE,mCAAmC;iBAC7C,CAAC;YACJ,CAAC;YAED,uCAAuC;YACvC,OAAO,CAAC,GAAG,CAAC,kBAAkB,aAAa,sCAAsC,OAAO,EAAE,CAAC,CAAC;YAE5F,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,MAAM,yBAAQ;iBAC1C,IAAI,CAAC,oBAAoB,CAAC;iBAC1B,MAAM,CAAC;gBACN,UAAU,EAAE,IAAI;gBAChB,UAAU,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACpC,UAAU,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;aACrC,CAAC;iBACD,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC;iBACvB,EAAE,CAAC,SAAS,EAAE,aAAa,CAAC,CAAC;YAEhC,IAAI,WAAW;gBAAE,MAAM,WAAW,CAAC;YAEnC,OAAO,CAAC,GAAG,CAAC,qDAAqD,aAAa,EAAE,CAAC,CAAC;YAElF,4CAA4C;YAC5C,yDAAyD;YACzD,MAAM,eAAe,GAAG,KAAK,CAAC,MAAM,KAAK,YAAY,CAAC;YAEtD,OAAO;gBACL,OAAO,EAAE,IAAI;gBACb,OAAO,EAAE,yCAAyC;gBAClD,eAAe;aAChB,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;YACjD,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,yBAAyB,EAAE,KAAK,EAAE,CAAC;QACvE,CAAC;IACH,CAAC;IAED;;;;OAIG;IACH,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,OAAe,EAAE,aAAqB;QAC/D,IAAI,CAAC;YACH,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,KAAK,EAAE,GAAG,MAAM,yBAAQ;iBAClD,IAAI,CAAC,oBAAoB,CAAC;iBAC1B,MAAM,CAAC,YAAY,CAAC;iBACpB,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC;iBACvB,EAAE,CAAC,SAAS,EAAE,aAAa,CAAC;iBAC5B,MAAM,EAAE,CAAC;YAEZ,IAAI,KAAK,IAAI,KAAK,CAAC,IAAI,KAAK,UAAU;gBAAE,OAAO,KAAK,CAAC,CAAC,YAAY;YAClE,IAAI,KAAK;gBAAE,MAAM,KAAK,CAAC;YAEvB,OAAO,aAAa,EAAE,UAAU,KAAK,IAAI,CAAC;QAC5C,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;YACpD,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC;IAED;;;OAGG;IACH,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,OAAe;QACzC,IAAI,CAAC;YACH,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,yBAAQ;iBAC7B,IAAI,CAAC,QAAQ,CAAC;iBACd,MAAM,CAAC;gBACN,YAAY,EAAE,IAAI;gBAClB,eAAe,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;aAC1C,CAAC;iBACD,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;YAErB,IAAI,KAAK;gBAAE,MAAM,KAAK,CAAC;YAEvB,OAAO,CAAC,GAAG,CAAC,oCAAoC,OAAO,EAAE,CAAC,CAAC;YAC3D,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC3B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;YACpD,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;QACnC,CAAC;IACH,CAAC;IAED;;OAEG;IACH,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,OAAe;QAYzC,IAAI,CAAC;YACH,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,MAAM,yBAAQ;iBACtD,IAAI,CAAC,QAAQ,CAAC;iBACd,MAAM,CAAC,sEAAsE,CAAC;iBAC9E,EAAE,CAAC,IAAI,EAAE,OAAO,CAAC;iBACjB,MAAM,EAAE,CAAC;YAEZ,IAAI,UAAU;gBAAE,MAAM,UAAU,CAAC;YAEjC,MAAM,EAAE,IAAI,EAAE,cAAc,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,MAAM,yBAAQ;iBAC9D,IAAI,CAAC,oBAAoB,CAAC;iBAC1B,MAAM,CAAC,YAAY,CAAC;iBACpB,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC;iBACvB,EAAE,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;YAE5B,IAAI,SAAS;gBAAE,MAAM,SAAS,CAAC;YAE/B,MAAM,eAAe,GAAG,CAAC,cAAc,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC;YAChF,MAAM,iBAAiB,GAAG,cAAc,EAAE,MAAM,IAAI,CAAC,CAAC;YAEtD,OAAO;gBACL,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE;oBACJ,QAAQ,EAAE,KAAK,EAAE,oBAAoB,IAAI,MAAM;oBAC/C,QAAQ,EAAE,KAAK,EAAE,YAAY,IAAI,KAAK;oBACtC,QAAQ,EAAE,KAAK,EAAE,eAAe;oBAChC,QAAQ,EAAE,KAAK,EAAE,eAAe;oBAChC,eAAe;oBACf,iBAAiB;iBAClB;aACF,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,oCAAoC,EAAE,KAAK,CAAC,CAAC;YAC3D,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;QACnC,CAAC;IACH,CAAC;CACF;AAED,kBAAe,oBAAoB,CAAC","names":[],"sources":["C:\\DEVMix\\App.Mesapra2.com\\src\\services\\EventSecurityService.ts"],"sourcesContent":["// src/services/EventSecurityService.ts\r\nimport { supabase } from '../lib/supabaseClient';\r\n\r\ninterface GeneratePasswordResult {\r\n  success: boolean;\r\n  password?: string;\r\n  error?: any;\r\n}\r\n\r\ninterface ValidatePasswordResult {\r\n  success: boolean;\r\n  message?: string;\r\n  shouldAutoStart?: boolean;\r\n  error?: any;\r\n}\r\n\r\ninterface PasswordValidationParams {\r\n  eventId: number;\r\n  participantId: string;\r\n  password: string;\r\n}\r\n\r\n/**\r\n * üîê Servi√ßo de Seguran√ßa de Eventos\r\n * Gerencia senhas de entrada 4 d√≠gitos\r\n */\r\nclass EventSecurityService {\r\n  /**\r\n   * üé≤ Gera uma senha aleat√≥ria de 4 d√≠gitos\r\n   * @returns Senha no formato \"1234\"\r\n   */\r\n  static generatePassword(): string {\r\n    const password = Math.floor(1000 + Math.random() * 9000).toString();\r\n    console.log(`üé≤ Senha gerada: ${password}`);\r\n    return password;\r\n  }\r\n\r\n  /**\r\n   * üíæ Salva a senha no evento\r\n   * @param eventId - ID do evento\r\n   * @param password - Senha de 4 d√≠gitos\r\n   */\r\n  static async savePasswordToEvent(eventId: number, password: string): Promise<GeneratePasswordResult> {\r\n    try {\r\n      if (!password || password.length !== 4 || !/^\\d+$/.test(password)) {\r\n        return {\r\n          success: false,\r\n          error: 'Senha deve ser exatamente 4 d√≠gitos'\r\n        };\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('events')\r\n        .update({\r\n          event_entry_password: password,\r\n          entry_opened_at: new Date().toISOString()\r\n        })\r\n        .eq('id', eventId);\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`‚úÖ Senha ${password} salva no evento ${eventId}`);\r\n      return { success: true, password };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao salvar senha:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîë Gera e salva uma nova senha de entrada\r\n   * @param eventId - ID do evento\r\n   */\r\n  static async generateAndSavePassword(eventId: number): Promise<GeneratePasswordResult> {\r\n    try {\r\n      const password = this.generatePassword();\r\n      return this.savePasswordToEvent(eventId, password);\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao gerar e salvar senha:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üïê Verifica se est√° no hor√°rio permitido para entrada\r\n   * Regra: 1 minuto antes at√© 2 minutos antes do fim\r\n   * @param eventId - ID do evento\r\n   * @returns { allowed: boolean, reason?: string }\r\n   */\r\n  static async isEntryTimeValid(eventId: number): Promise<{ allowed: boolean; reason?: string }> {\r\n    try {\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('start_time, end_time, status')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) throw eventError;\r\n      if (!event) {\r\n        return { allowed: false, reason: 'Evento n√£o encontrado' };\r\n      }\r\n\r\n      const now = new Date();\r\n      const startTime = new Date(event.start_time);\r\n      const endTime = new Date(event.end_time);\r\n\r\n      // üïê Verificar: falta 1 minuto para come√ßar?\r\n      const oneMinBeforeStart = new Date(startTime.getTime() - 60 * 1000);\r\n      if (now < oneMinBeforeStart) {\r\n        return {\r\n          allowed: false,\r\n          reason: `Entrada dispon√≠vel a partir de ${oneMinBeforeStart.toLocaleTimeString()}`\r\n        };\r\n      }\r\n\r\n      // üïê Verificar: falta 2 minutos para terminar?\r\n      const twoMinBeforeEnd = new Date(endTime.getTime() - 1 * 20 * 1000);\r\n      if (now >= twoMinBeforeEnd) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'Entrada encerrada (faltam 2 minutos para o fim do evento)'\r\n        };\r\n      }\r\n\r\n      // üïê Verificar: evento j√° come√ßou ou ainda est√° confirmado?\r\n      if (event.status !== 'Confirmado' && event.status !== 'Em Andamento') {\r\n        return {\r\n          allowed: false,\r\n          reason: `Evento n√£o est√° dispon√≠vel para entrada (status: ${event.status})`\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao validar timing de entrada:', error);\r\n      return { allowed: false, reason: 'Erro ao validar timing' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ‚úÖ Valida a senha digitada\r\n   * @param params - { eventId, participantId, password }\r\n   */\r\n  static async validateEntryPassword(params: PasswordValidationParams): Promise<ValidatePasswordResult> {\r\n    try {\r\n      const { eventId, participantId, password } = params;\r\n\r\n      // 1Ô∏è‚É£ Verificar timing\r\n      const timingCheck = await this.isEntryTimeValid(eventId);\r\n      if (!timingCheck.allowed) {\r\n        return {\r\n          success: false,\r\n          message: timingCheck.reason\r\n        };\r\n      }\r\n\r\n      // 2Ô∏è‚É£ Buscar evento e senha correta\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('event_entry_password, status')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) throw eventError;\r\n      if (!event) {\r\n        return { success: false, message: 'Evento n√£o encontrado' };\r\n      }\r\n\r\n      // 3Ô∏è‚É£ Validar senha\r\n      if (password !== event.event_entry_password) {\r\n        console.warn(`‚ùå Participante ${participantId} digitou senha errada no evento ${eventId}`);\r\n        return {\r\n          success: false,\r\n          message: 'Senha incorreta. Tente novamente.'\r\n        };\r\n      }\r\n\r\n      // 4Ô∏è‚É£ Senha correta! Registrar entrada\r\n      console.log(`‚úÖ Participante ${participantId} digitou a senha correta do evento ${eventId}`);\r\n\r\n      const { error: updateError } = await supabase\r\n        .from('event_participants')\r\n        .update({\r\n          com_acesso: true,\r\n          entry_time: new Date().toISOString(),\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('event_id', eventId)\r\n        .eq('user_id', participantId);\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      console.log(`‚úÖ Participa√ß√£o atualizada: com_acesso = true para ${participantId}`);\r\n\r\n      // 5Ô∏è‚É£ Verificar se deve auto-iniciar evento\r\n      // (Se √© o primeiro a entrar e evento est√° em CONFIRMADO)\r\n      const shouldAutoStart = event.status === 'Confirmado';\r\n\r\n      return {\r\n        success: true,\r\n        message: '‚úÖ Acesso liberado! Bem-vindo ao evento.',\r\n        shouldAutoStart\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao validar senha:', error);\r\n      return { success: false, message: 'Erro ao validar entrada', error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîç Verifica se um participante j√° tem acesso\r\n   * @param eventId - ID do evento\r\n   * @param participantId - ID do participante\r\n   */\r\n  static async hasUserAccess(eventId: number, participantId: string): Promise<boolean> {\r\n    try {\r\n      const { data: participation, error } = await supabase\r\n        .from('event_participants')\r\n        .select('com_acesso')\r\n        .eq('event_id', eventId)\r\n        .eq('user_id', participantId)\r\n        .single();\r\n\r\n      if (error && error.code === 'PGRST116') return false; // Not found\r\n      if (error) throw error;\r\n\r\n      return participation?.com_acesso === true;\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao verificar acesso:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîí Bloqueia entrada de novos participantes (2 min antes do fim)\r\n   * @param eventId - ID do evento\r\n   */\r\n  static async lockEventEntry(eventId: number): Promise<{ success: boolean; error?: any }> {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('events')\r\n        .update({\r\n          entry_locked: true,\r\n          entry_locked_at: new Date().toISOString()\r\n        })\r\n        .eq('id', eventId);\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`üîí Entrada bloqueada para evento ${eventId}`);\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao bloquear entrada:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üìä Obt√©m status de entrada do evento\r\n   */\r\n  static async getEntryStatus(eventId: number): Promise<{\r\n    success: boolean;\r\n    data?: {\r\n      password: string;\r\n      isLocked: boolean;\r\n      lockedAt?: string;\r\n      openedAt?: string;\r\n      totalWithAccess: number;\r\n      totalParticipants: number;\r\n    };\r\n    error?: any;\r\n  }> {\r\n    try {\r\n      const { data: event, error: eventError } = await supabase\r\n        .from('events')\r\n        .select('event_entry_password, entry_locked, entry_locked_at, entry_opened_at')\r\n        .eq('id', eventId)\r\n        .single();\r\n\r\n      if (eventError) throw eventError;\r\n\r\n      const { data: participations, error: partError } = await supabase\r\n        .from('event_participants')\r\n        .select('com_acesso')\r\n        .eq('event_id', eventId)\r\n        .eq('status', 'aprovado');\r\n\r\n      if (partError) throw partError;\r\n\r\n      const totalWithAccess = (participations || []).filter(p => p.com_acesso).length;\r\n      const totalParticipants = participations?.length || 0;\r\n\r\n      return {\r\n        success: true,\r\n        data: {\r\n          password: event?.event_entry_password || '****',\r\n          isLocked: event?.entry_locked || false,\r\n          lockedAt: event?.entry_locked_at,\r\n          openedAt: event?.entry_opened_at,\r\n          totalWithAccess,\r\n          totalParticipants\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('‚ùå Erro ao obter status de entrada:', error);\r\n      return { success: false, error };\r\n    }\r\n  }\r\n}\r\n\r\nexport default EventSecurityService;"],"version":3}