8ded46663dcc62a6c9b3ef51932a897c
"use strict";
// src/services/TrustScoreService.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const globals_1 = require("@jest/globals");
globals_1.jest.mock('../lib/supabaseClient', () => ({
    supabase: mockSupabaseInstance,
}));
const supabaseClient_1 = require("../lib/supabaseClient");
const TrustScoreService_1 = tslib_1.__importDefault(require("./TrustScoreService"));
// --- 1. MOCKING DEPENDÊNCIAS ---
// Mock do Supabase
const mockSupabaseInstance = {
    from: globals_1.jest.fn(),
};
// Typecast do mock para intellisense
const mockedSupabase = supabaseClient_1.supabase;
// --- 2. CONFIGURAÇÃO DOS TESTES ---
(0, globals_1.describe)('TrustScoreService', () => {
    // Espiões para métodos privados que queremos verificar se foram chamados
    let spyLogChange;
    let spyLogBan;
    let spyLogUnban;
    let spyBanUser;
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        mockedSupabase.from.mockReset();
        // Espiamos os métodos de log (privados) e banUser
        spyLogChange = globals_1.jest.spyOn(TrustScoreService_1.default, 'logTrustScoreChange')
            .mockImplementation(() => Promise.resolve());
        spyLogBan = globals_1.jest.spyOn(TrustScoreService_1.default, 'logBanishment')
            .mockImplementation(() => Promise.resolve());
        spyLogUnban = globals_1.jest.spyOn(TrustScoreService_1.default, 'logUnbanishment')
            .mockImplementation(() => Promise.resolve());
        spyBanUser = globals_1.jest.spyOn(TrustScoreService_1.default, 'banUser')
            .mockImplementation(() => Promise.resolve({ success: true }));
    });
    (0, globals_1.afterEach)(() => {
        // Restauramos todos os espiões
        spyLogChange.mockRestore();
        spyLogBan.mockRestore();
        spyLogUnban.mockRestore();
        spyBanUser.mockRestore();
    });
    // --- 3. TESTES DOS MÉTODOS ---
    (0, globals_1.describe)('getTrustScore', () => {
        (0, globals_1.it)('deve retornar o score e o status de banido do usuário', async () => {
            const mockProfile = { trust_score: 3, is_banned: false };
            // Mock do SELECT
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockProfile, error: null })),
                    })),
                })),
            }));
            const result = await TrustScoreService_1.default.getTrustScore('user-1');
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.data?.trustScore).toBe(3);
            (0, globals_1.expect)(result.data?.isBanned).toBe(false);
            (0, globals_1.expect)(mockedSupabase.from).toHaveBeenCalledWith('profiles');
        });
        (0, globals_1.it)('deve retornar score 5 (padrão) se o usuário não tiver score', async () => {
            const mockProfile = { trust_score: null, is_banned: false }; // Sem score definido
            // Mock do SELECT
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockProfile, error: null })),
                    })),
                })),
            }));
            const result = await TrustScoreService_1.default.getTrustScore('user-1');
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.data?.trustScore).toBe(5); // Deve assumir o padrão
        });
        (0, globals_1.it)('deve retornar "Usuário não encontrado" em erro PGRST116', async () => {
            // Mock do SELECT (não encontrado)
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: null, error: { code: 'PGRST116' } })),
                    })),
                })),
            }));
            const result = await TrustScoreService_1.default.getTrustScore('user-404');
            (0, globals_1.expect)(result.success).toBe(false);
            (0, globals_1.expect)(result.error).toBe('Usuário não encontrado');
        });
    });
    (0, globals_1.describe)('penalizeNoShow', () => {
        (0, globals_1.it)('deve reduzir o score em 1 e registrar o log', async () => {
            const mockProfile = { trust_score: 4 };
            // 1. Mock do SELECT (para pegar score atual)
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockProfile, error: null })),
                    })),
                })),
            }));
            // 2. Mock do UPDATE (para salvar novo score)
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
                })),
            }));
            const result = await TrustScoreService_1.default.penalizeNoShow('user-penalize');
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.data?.newScore).toBe(3);
            (0, globals_1.expect)(result.data?.wasBanned).toBe(false);
            // Verifica se o UPDATE foi chamado com o novo score
            (0, globals_1.expect)(mockedSupabase.from('profiles').update).toHaveBeenCalledWith(globals_1.expect.objectContaining({ trust_score: 3 }));
            // Verifica se o Log foi chamado
            (0, globals_1.expect)(spyLogChange).toHaveBeenCalledWith('user-penalize', 4, 3, 'no_show');
            // Garante que NÃO baniu
            (0, globals_1.expect)(spyBanUser).not.toHaveBeenCalled();
        });
        (0, globals_1.it)('deve reduzir o score para 0 e chamar banUser', async () => {
            const mockProfile = { trust_score: 1 }; // Último ponto
            // 1. Mock do SELECT
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        single: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockProfile, error: null })),
                    })),
                })),
            }));
            // 2. Mock do UPDATE
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
                })),
            }));
            const result = await TrustScoreService_1.default.penalizeNoShow('user-banir');
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.data?.newScore).toBe(0);
            (0, globals_1.expect)(result.data?.wasBanned).toBe(true);
            // Verifica se o UPDATE foi chamado com 0
            (0, globals_1.expect)(mockedSupabase.from('profiles').update).toHaveBeenCalledWith(globals_1.expect.objectContaining({ trust_score: 0 }));
            // Verifica se o Log foi chamado
            (0, globals_1.expect)(spyLogChange).toHaveBeenCalledWith('user-banir', 1, 0, 'no_show');
            // VERIFICA SE O BANIMENTO FOI CHAMADO
            (0, globals_1.expect)(spyBanUser).toHaveBeenCalledWith('user-banir', 'Trust score atingiu 0');
        });
    });
    (0, globals_1.describe)('banUser', () => {
        (0, globals_1.it)('deve banir o usuário e registrar o log', async () => {
            // Libera o spy para testar a implementação real
            spyBanUser.mockRestore();
            // 1. Mock do UPDATE (banimento)
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
                })),
            }));
            const result = await TrustScoreService_1.default.banUser('user-banir', 'Motivo teste');
            (0, globals_1.expect)(result.success).toBe(true);
            // Verifica se o UPDATE foi chamado corretamente
            (0, globals_1.expect)(mockedSupabase.from('profiles').update).toHaveBeenCalledWith(globals_1.expect.objectContaining({ is_banned: true, trust_score: 0 }));
            // Verifica se o log de banimento foi chamado
            (0, globals_1.expect)(spyLogBan).toHaveBeenCalledWith('user-banir', 'Motivo teste');
        });
    });
    (0, globals_1.describe)('unbanUserAfterPayment', () => {
        (0, globals_1.it)('deve desbanir, resetar score, registrar pagamento e log', async () => {
            // 1. Mock do UPDATE (unban)
            mockedSupabase.from.mockImplementationOnce(() => ({
                update: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
                })),
            }));
            // 2. Mock do INSERT (payment)
            mockedSupabase.from.mockImplementationOnce(() => ({
                insert: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ error: null })),
            }));
            const result = await TrustScoreService_1.default.unbanUserAfterPayment('user-unban', 'pay-123');
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.data?.newScore).toBe(5);
            // Verifica se o UPDATE (unban) foi chamado
            (0, globals_1.expect)(mockedSupabase.from('profiles').update).toHaveBeenCalledWith(globals_1.expect.objectContaining({ is_banned: false, trust_score: 5 }));
            // Verifica se o INSERT (payment) foi chamado
            (0, globals_1.expect)(mockedSupabase.from('payments').insert).toHaveBeenCalledWith(globals_1.expect.objectContaining({ user_id: 'user-unban', stripe_payment_id: 'pay-123' }));
            // Verifica se o log de unban foi chamado
            (0, globals_1.expect)(spyLogUnban).toHaveBeenCalledWith('user-unban', 'pay-123');
        });
    });
    (0, globals_1.describe)('penalizeNoShowsForEvent', () => {
        // Espião específico para penalizeNoShow
        let spyPenalize;
        (0, globals_1.beforeEach)(() => {
            spyPenalize = globals_1.jest.spyOn(TrustScoreService_1.default, 'penalizeNoShow')
                .mockImplementation(() => Promise.resolve({ success: true }));
        });
        (0, globals_1.afterEach)(() => {
            spyPenalize.mockRestore();
        });
        (0, globals_1.it)('deve chamar penalizeNoShow para cada usuário que não compareceu', async () => {
            const mockNoShows = [
                { id: 'part-1', user_id: 'user-A' },
                { id: 'part-1', user_id: 'user-B' },
            ];
            // 1. Mock do SELECT (no-shows)
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        eq: globals_1.jest.fn(() => ({
                            eq: globals_1.jest.fn(() => ({
                                eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: mockNoShows, error: null })),
                            })),
                        })),
                    })),
                })),
            }));
            const result = await TrustScoreService_1.default.penalizeNoShowsForEvent(1);
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.data?.penalized).toBe(2);
            // Verifica se o método de penalizar foi chamado 2x
            (0, globals_1.expect)(spyPenalize).toHaveBeenCalledTimes(2);
            (0, globals_1.expect)(spyPenalize).toHaveBeenCalledWith('user-A');
            (0, globals_1.expect)(spyPenalize).toHaveBeenCalledWith('user-B');
        });
        (0, globals_1.it)('não deve fazer nada se não houver no-shows', async () => {
            // 1. Mock do SELECT (vazio)
            mockedSupabase.from.mockImplementationOnce(() => ({
                select: globals_1.jest.fn(() => ({
                    eq: globals_1.jest.fn(() => ({
                        eq: globals_1.jest.fn(() => ({
                            eq: globals_1.jest.fn(() => ({
                                eq: globals_1.jest.fn().mockImplementation(() => Promise.resolve({ data: [], error: null })),
                            })),
                        })),
                    })),
                })),
            }));
            const result = await TrustScoreService_1.default.penalizeNoShowsForEvent(1);
            (0, globals_1.expect)(result.success).toBe(true);
            (0, globals_1.expect)(result.data?.penalized).toBe(0);
            // Garante que não penalizou ninguém
            (0, globals_1.expect)(spyPenalize).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXERFVk1peFxcQXBwLk1lc2FwcmEyLmNvbVxcc3JjXFxzZXJ2aWNlc1xcVHJ1c3RTY29yZVNFcnZpY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUEseUNBQXlDOzs7QUFFekMsMkNBQWtGO0FBV2xGLGNBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN4QyxRQUFRLEVBQUUsb0JBQW9CO0NBQy9CLENBQUMsQ0FBQyxDQUFDO0FBWkosMERBQWlEO0FBQ2pELG9GQUFvRDtBQUVwRCxrQ0FBa0M7QUFFbEMsbUJBQW1CO0FBQ25CLE1BQU0sb0JBQW9CLEdBQUc7SUFDM0IsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDaEIsQ0FBQztBQU1GLHFDQUFxQztBQUNyQyxNQUFNLGNBQWMsR0FBRyx5QkFBd0MsQ0FBQztBQUVoRSxxQ0FBcUM7QUFFckMsSUFBQSxrQkFBUSxFQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUVqQyx5RUFBeUU7SUFDekUsSUFBSSxZQUFxQyxDQUFDO0lBQzFDLElBQUksU0FBa0MsQ0FBQztJQUN2QyxJQUFJLFdBQW9DLENBQUM7SUFDekMsSUFBSSxVQUFnRSxDQUFDO0lBRXJFLElBQUEsb0JBQVUsRUFBQyxHQUFHLEVBQUU7UUFDZCxjQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDcEIsY0FBYyxDQUFDLElBQWtCLENBQUMsU0FBUyxFQUFFLENBQUM7UUFFL0Msa0RBQWtEO1FBQ2xELFlBQVksR0FBRyxjQUFJLENBQUMsS0FBSyxDQUFDLDJCQUF3QixFQUFFLHFCQUFxQixDQUFDO2FBQ3ZFLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBRS9DLFNBQVMsR0FBRyxjQUFJLENBQUMsS0FBSyxDQUFDLDJCQUF3QixFQUFFLGVBQWUsQ0FBQzthQUM5RCxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENB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LEVBQUUsQ0FBQyxDQUFDO2dDQUNqQixFQUFFLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDOzZCQUNuRixDQUFDLENBQUM7eUJBQ0osQ0FBQyxDQUFDO3FCQUNKLENBQUMsQ0FBQztpQkFDSixDQUFDLENBQUM7YUFDSixDQUFDLENBQUMsQ0FBQztZQUVKLE1BQU0sTUFBTSxHQUFHLE1BQU0sMkJBQWlCLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFbEUsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXZDLG9DQUFvQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUVMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxERVZNaXhcXEFwcC5NZXNhcHJhMi5jb21cXHNyY1xcc2VydmljZXNcXFRydXN0U2NvcmVTRXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL1RydXN0U2NvcmVTZXJ2aWNlLnRlc3QudHNcclxuXHJcbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBqZXN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9saWIvc3VwYWJhc2VDbGllbnQnO1xyXG5pbXBvcnQgVHJ1c3RTY29yZVNlcnZpY2UgZnJvbSAnLi9UcnVzdFNjb3JlU2VydmljZSc7XHJcblxyXG4vLyAtLS0gMS4gTU9DS0lORyBERVBFTkTDik5DSUFTIC0tLVxyXG5cclxuLy8gTW9jayBkbyBTdXBhYmFzZVxyXG5jb25zdCBtb2NrU3VwYWJhc2VJbnN0YW5jZSA9IHtcclxuICBmcm9tOiBqZXN0LmZuKCksXHJcbn07XHJcblxyXG5qZXN0Lm1vY2soJy4uL2xpYi9zdXBhYmFzZUNsaWVudCcsICgpID0+ICh7XHJcbiAgc3VwYWJhc2U6IG1vY2tTdXBhYmFzZUluc3RhbmNlLFxyXG59KSk7XHJcblxyXG4vLyBUeXBlY2FzdCBkbyBtb2NrIHBhcmEgaW50ZWxsaXNlbnNlXHJcbmNvbnN0IG1vY2tlZFN1cGFiYXNlID0gc3VwYWJhc2UgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIHN1cGFiYXNlPjtcclxuXHJcbi8vIC0tLSAyLiBDT05GSUdVUkHDh8ODTyBET1MgVEVTVEVTIC0tLVxyXG5cclxuZGVzY3JpYmUoJ1RydXN0U2NvcmVTZXJ2aWNlJywgKCkgPT4ge1xyXG5cclxuICAvLyBFc3Bpw7VlcyBwYXJhIG3DqXRvZG9zIHByaXZhZG9zIHF1ZSBxdWVyZW1vcyB2ZXJpZmljYXIgc2UgZm9yYW0gY2hhbWFkb3NcclxuICBsZXQgc3B5TG9nQ2hhbmdlOiBqZXN0LlNwaWVkRnVuY3Rpb248YW55PjtcclxuICBsZXQgc3B5TG9nQmFuOiBqZXN0LlNwaWVkRnVuY3Rpb248YW55PjtcclxuICBsZXQgc3B5TG9nVW5iYW46IGplc3QuU3BpZWRGdW5jdGlvbjxhbnk+O1xyXG4gIGxldCBzcHlCYW5Vc2VyOiBqZXN0LlNwaWVkRnVuY3Rpb248dHlwZW9mIFRydXN0U2NvcmVTZXJ2aWNlLmJhblVzZXI+O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrUmVzZXQoKTtcclxuXHJcbiAgICAvLyBFc3BpYW1vcyBvcyBtw6l0b2RvcyBkZSBsb2cgKHByaXZhZG9zKSBlIGJhblVzZXJcclxuICAgIHNweUxvZ0NoYW5nZSA9IGplc3Quc3B5T24oVHJ1c3RTY29yZVNlcnZpY2UgYXMgYW55LCAnbG9nVHJ1c3RTY29yZUNoYW5nZScpXHJcbiAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpO1xyXG4gICAgICBcclxuICAgIHNweUxvZ0JhbiA9IGplc3Quc3B5T24oVHJ1c3RTY29yZVNlcnZpY2UgYXMgYW55LCAnbG9nQmFuaXNobWVudCcpXHJcbiAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpO1xyXG4gICAgICBcclxuICAgIHNweUxvZ1VuYmFuID0gamVzdC5zcHlPbihUcnVzdFNjb3JlU2VydmljZSBhcyBhbnksICdsb2dVbmJhbmlzaG1lbnQnKVxyXG4gICAgICAubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSgpKTtcclxuICAgICAgXHJcbiAgICBzcHlCYW5Vc2VyID0gamVzdC5zcHlPbihUcnVzdFNjb3JlU2VydmljZSwgJ2JhblVzZXInKVxyXG4gICAgICAubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IHN1Y2Nlc3M6IHRydWUgfSkpO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgLy8gUmVzdGF1cmFtb3MgdG9kb3Mgb3MgZXNwacO1ZXNcclxuICAgIHNweUxvZ0NoYW5nZS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgc3B5TG9nQmFuLm1vY2tSZXN0b3JlKCk7XHJcbiAgICBzcHlMb2dVbmJhbi5tb2NrUmVzdG9yZSgpO1xyXG4gICAgc3B5QmFuVXNlci5tb2NrUmVzdG9yZSgpO1xyXG4gIH0pO1xyXG5cclxuICAvLyAtLS0gMy4gVEVTVEVTIERPUyBNw4lUT0RPUyAtLS1cclxuXHJcbiAgZGVzY3JpYmUoJ2dldFRydXN0U2NvcmUnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBvIHNjb3JlIGUgbyBzdGF0dXMgZGUgYmFuaWRvIGRvIHVzdcOhcmlvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUHJvZmlsZSA9IHsgdHJ1c3Rfc2NvcmU6IDMsIGlzX2Jhbm5lZDogZmFsc2UgfTtcclxuXHJcbiAgICAgIC8vIE1vY2sgZG8gU0VMRUNUXHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGRhdGE6IG1vY2tQcm9maWxlLCBlcnJvcjogbnVsbCB9KSksXHJcbiAgICAgICAgICB9KSksXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUcnVzdFNjb3JlU2VydmljZS5nZXRUcnVzdFNjb3JlKCd1c2VyLTEnKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy50cnVzdFNjb3JlKS50b0JlKDMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LmlzQmFubmVkKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwcm9maWxlcycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgc2NvcmUgNSAocGFkcsOjbykgc2UgbyB1c3XDoXJpbyBuw6NvIHRpdmVyIHNjb3JlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUHJvZmlsZSA9IHsgdHJ1c3Rfc2NvcmU6IG51bGwsIGlzX2Jhbm5lZDogZmFsc2UgfTsgLy8gU2VtIHNjb3JlIGRlZmluaWRvXHJcblxyXG4gICAgICAvLyBNb2NrIGRvIFNFTEVDVFxyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiBtb2NrUHJvZmlsZSwgZXJyb3I6IG51bGwgfSkpLFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJ1c3RTY29yZVNlcnZpY2UuZ2V0VHJ1c3RTY29yZSgndXNlci0xJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy50cnVzdFNjb3JlKS50b0JlKDUpOyAvLyBEZXZlIGFzc3VtaXIgbyBwYWRyw6NvXHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBcIlVzdcOhcmlvIG7Do28gZW5jb250cmFkb1wiIGVtIGVycm8gUEdSU1QxMTYnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIE1vY2sgZG8gU0VMRUNUIChuw6NvIGVuY29udHJhZG8pXHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGRhdGE6IG51bGwsIGVycm9yOiB7IGNvZGU6ICdQR1JTVDExNicgfSB9KSksXHJcbiAgICAgICAgICB9KSksXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9KSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBUcnVzdFNjb3JlU2VydmljZS5nZXRUcnVzdFNjb3JlKCd1c2VyLTQwNCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCdVc3XDoXJpbyBuw6NvIGVuY29udHJhZG8nKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncGVuYWxpemVOb1Nob3cnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGV2ZSByZWR1emlyIG8gc2NvcmUgZW0gMSBlIHJlZ2lzdHJhciBvIGxvZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1Byb2ZpbGUgPSB7IHRydXN0X3Njb3JlOiA0IH07XHJcblxyXG4gICAgICAvLyAxLiBNb2NrIGRvIFNFTEVDVCAocGFyYSBwZWdhciBzY29yZSBhdHVhbClcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogbW9ja1Byb2ZpbGUsIGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICAgIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIC8vIDIuIE1vY2sgZG8gVVBEQVRFIChwYXJhIHNhbHZhciBub3ZvIHNjb3JlKVxyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRydXN0U2NvcmVTZXJ2aWNlLnBlbmFsaXplTm9TaG93KCd1c2VyLXBlbmFsaXplJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8ubmV3U2NvcmUpLnRvQmUoMyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8ud2FzQmFubmVkKS50b0JlKGZhbHNlKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gVVBEQVRFIGZvaSBjaGFtYWRvIGNvbSBvIG5vdm8gc2NvcmVcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHRydXN0X3Njb3JlOiAzIH0pXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIExvZyBmb2kgY2hhbWFkb1xyXG4gICAgICBleHBlY3Qoc3B5TG9nQ2hhbmdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci1wZW5hbGl6ZScsIDQsIDMsICdub19zaG93Jyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBHYXJhbnRlIHF1ZSBOw4NPIGJhbml1XHJcbiAgICAgIGV4cGVjdChzcHlCYW5Vc2VyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgcmVkdXppciBvIHNjb3JlIHBhcmEgMCBlIGNoYW1hciBiYW5Vc2VyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUHJvZmlsZSA9IHsgdHJ1c3Rfc2NvcmU6IDEgfTsgLy8gw5psdGltbyBwb250b1xyXG5cclxuICAgICAgLy8gMS4gTW9jayBkbyBTRUxFQ1RcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogbW9ja1Byb2ZpbGUsIGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICAgIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIC8vIDIuIE1vY2sgZG8gVVBEQVRFXHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZXJyb3I6IG51bGwgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJ1c3RTY29yZVNlcnZpY2UucGVuYWxpemVOb1Nob3coJ3VzZXItYmFuaXInKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy5uZXdTY29yZSkudG9CZSgwKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy53YXNCYW5uZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIFVQREFURSBmb2kgY2hhbWFkbyBjb20gMFxyXG4gICAgICBleHBlY3QobW9ja2VkU3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgdHJ1c3Rfc2NvcmU6IDAgfSlcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gTG9nIGZvaSBjaGFtYWRvXHJcbiAgICAgIGV4cGVjdChzcHlMb2dDaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd1c2VyLWJhbmlyJywgMSwgMCwgJ25vX3Nob3cnKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZFUklGSUNBIFNFIE8gQkFOSU1FTlRPIEZPSSBDSEFNQURPXHJcbiAgICAgIGV4cGVjdChzcHlCYW5Vc2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci1iYW5pcicsICdUcnVzdCBzY29yZSBhdGluZ2l1IDAnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnYmFuVXNlcicsICgpID0+IHtcclxuICAgIGl0KCdkZXZlIGJhbmlyIG8gdXN1w6FyaW8gZSByZWdpc3RyYXIgbyBsb2cnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIExpYmVyYSBvIHNweSBwYXJhIHRlc3RhciBhIGltcGxlbWVudGHDp8OjbyByZWFsXHJcbiAgICAgIHNweUJhblVzZXIubW9ja1Jlc3RvcmUoKTsgXHJcbiAgICAgIFxyXG4gICAgICAvLyAxLiBNb2NrIGRvIFVQREFURSAoYmFuaW1lbnRvKVxyXG4gICAgICAobW9ja2VkU3VwYWJhc2UuZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gKHtcclxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRydXN0U2NvcmVTZXJ2aWNlLmJhblVzZXIoJ3VzZXItYmFuaXInLCAnTW90aXZvIHRlc3RlJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIFVQREFURSBmb2kgY2hhbWFkbyBjb3JyZXRhbWVudGVcclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IGlzX2Jhbm5lZDogdHJ1ZSwgdHJ1c3Rfc2NvcmU6IDAgfSlcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gbG9nIGRlIGJhbmltZW50byBmb2kgY2hhbWFkb1xyXG4gICAgICBleHBlY3Qoc3B5TG9nQmFuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci1iYW5pcicsICdNb3Rpdm8gdGVzdGUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndW5iYW5Vc2VyQWZ0ZXJQYXltZW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ2RldmUgZGVzYmFuaXIsIHJlc2V0YXIgc2NvcmUsIHJlZ2lzdHJhciBwYWdhbWVudG8gZSBsb2cnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIDEuIE1vY2sgZG8gVVBEQVRFICh1bmJhbilcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBlcnJvcjogbnVsbCB9KSksXHJcbiAgICAgICAgfSkpLFxyXG4gICAgICB9KSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyAyLiBNb2NrIGRvIElOU0VSVCAocGF5bWVudClcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgaW5zZXJ0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJ1c3RTY29yZVNlcnZpY2UudW5iYW5Vc2VyQWZ0ZXJQYXltZW50KCd1c2VyLXVuYmFuJywgJ3BheS0xMjMnKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy5uZXdTY29yZSkudG9CZSg1KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gVVBEQVRFICh1bmJhbikgZm9pIGNoYW1hZG9cclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IGlzX2Jhbm5lZDogZmFsc2UsIHRydXN0X3Njb3JlOiA1IH0pXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZmljYSBzZSBvIElOU0VSVCAocGF5bWVudCkgZm9pIGNoYW1hZG9cclxuICAgICAgZXhwZWN0KG1vY2tlZFN1cGFiYXNlLmZyb20oJ3BheW1lbnRzJykuaW5zZXJ0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHVzZXJfaWQ6ICd1c2VyLXVuYmFuJywgc3RyaXBlX3BheW1lbnRfaWQ6ICdwYXktMTIzJyB9KVxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBsb2cgZGUgdW5iYW4gZm9pIGNoYW1hZG9cclxuICAgICAgZXhwZWN0KHNweUxvZ1VuYmFuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci11bmJhbicsICdwYXktMTIzJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3BlbmFsaXplTm9TaG93c0ZvckV2ZW50JywgKCkgPT4ge1xyXG4gICAgXHJcbiAgICAvLyBFc3Bpw6NvIGVzcGVjw61maWNvIHBhcmEgcGVuYWxpemVOb1Nob3dcclxuICAgIGxldCBzcHlQZW5hbGl6ZTogamVzdC5TcGllZEZ1bmN0aW9uPHR5cGVvZiBUcnVzdFNjb3JlU2VydmljZS5wZW5hbGl6ZU5vU2hvdz47XHJcbiAgICBcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBzcHlQZW5hbGl6ZSA9IGplc3Quc3B5T24oVHJ1c3RTY29yZVNlcnZpY2UsICdwZW5hbGl6ZU5vU2hvdycpXHJcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBzdWNjZXNzOiB0cnVlIH0pKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgICBzcHlQZW5hbGl6ZS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RldmUgY2hhbWFyIHBlbmFsaXplTm9TaG93IHBhcmEgY2FkYSB1c3XDoXJpbyBxdWUgbsOjbyBjb21wYXJlY2V1JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTm9TaG93cyA9IFtcclxuICAgICAgICB7IGlkOiAncGFydC0xJywgdXNlcl9pZDogJ3VzZXItQScgfSxcclxuICAgICAgICB7IGlkOiAncGFydC0xJywgdXNlcl9pZDogJ3VzZXItQicgfSxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIC8vIDEuIE1vY2sgZG8gU0VMRUNUIChuby1zaG93cylcclxuICAgICAgKG1vY2tlZFN1cGFiYXNlLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XHJcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgICAgICAgICAgICBlcTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiBtb2NrTm9TaG93cywgZXJyb3I6IG51bGwgfSkpLFxyXG4gICAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgICAgfSkpLFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfSkpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVHJ1c3RTY29yZVNlcnZpY2UucGVuYWxpemVOb1Nob3dzRm9yRXZlbnQoMSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YT8ucGVuYWxpemVkKS50b0JlKDIpO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBtw6l0b2RvIGRlIHBlbmFsaXphciBmb2kgY2hhbWFkbyAyeFxyXG4gICAgICBleHBlY3Qoc3B5UGVuYWxpemUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcclxuICAgICAgZXhwZWN0KHNweVBlbmFsaXplKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci1BJyk7XHJcbiAgICAgIGV4cGVjdChzcHlQZW5hbGl6ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXItQicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ27Do28gZGV2ZSBmYXplciBuYWRhIHNlIG7Do28gaG91dmVyIG5vLXNob3dzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyAxLiBNb2NrIGRvIFNFTEVDVCAodmF6aW8pXHJcbiAgICAgIChtb2NrZWRTdXBhYmFzZS5mcm9tIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAoe1xyXG4gICAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgICAgICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pKSxcclxuICAgICAgICAgICAgICB9KSksXHJcbiAgICAgICAgICAgIH0pKSxcclxuICAgICAgICAgIH0pKSxcclxuICAgICAgICB9KSksXHJcbiAgICAgIH0pKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFRydXN0U2NvcmVTZXJ2aWNlLnBlbmFsaXplTm9TaG93c0ZvckV2ZW50KDEpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LnBlbmFsaXplZCkudG9CZSgwKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdhcmFudGUgcXVlIG7Do28gcGVuYWxpem91IG5pbmd1w6ltXHJcbiAgICAgIGV4cGVjdChzcHlQZW5hbGl6ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==