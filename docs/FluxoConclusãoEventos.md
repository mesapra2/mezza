‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Evento come√ßa      ‚îÇ
‚îÇ  (Em Andamento)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Evento termina     ‚îÇ
‚îÇ  (Finalizado)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ                               ‚îÇ
      ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7 dias passaram? ‚îÇ      ‚îÇ Todos avaliaram TUDO?  ‚îÇ
‚îÇ   SIM ‚Üí Conclui  ‚îÇ      ‚îÇ SIM ‚Üí Conclui          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Evento Conclu√≠do   ‚îÇ
‚îÇ  - Chat read-only   ‚îÇ
‚îÇ  - Pode criar novo  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Ap√≥s 180 dias      ‚îÇ
‚îÇ  - Deleta mensagens ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò



üéØ Status do Evento
StatusDescri√ß√£oA√ß√µes Dispon√≠veisAbertoEvento aberto para candidaturasInscrever-seConfirmadoConfirmado, aguardando in√≠cioVisualizarEm AndamentoEvento est√° acontecendoParticipar do chatFinalizadoEncerrado, aguardando avalia√ß√µesAvaliar + ChatConclu√≠doEvento finalizado, avalia√ß√µes completasChat read-onlyCanceladoEvento canceladoN/A

üîÑ Fluxo Detalhado
1Ô∏è‚É£ Evento Termina (end_time)
javascriptEventStatusService.updateAllEventStatuses()
    ‚Üì
Checa: now >= end_time
    ‚Üì
Status: FINALIZADO
    ‚Üì
Chat continua aberto
Bot√µes aparecem para avaliar:
  - Anfitri√£o ‚≠ê
  - Participantes ‚≠ê
  - Restaurante üçΩÔ∏è

2Ô∏è‚É£ Processo de Avalia√ß√£o (OBRIGAT√ìRIO PARA CONCLUIR)
A. Estrutura de Avalia√ß√µes
typescripttype RatingType = 'host' | 'participant' | 'restaurant';

interface Rating {
  event_id: number;
  rater_id: string;      // Quem est√° avaliando
  rated_id: string;      // Quem est√° sendo avaliado
  rating_type: RatingType;
  score: number;         // 1-5 ‚≠ê
  created_at: Date;
}
B. Obriga√ß√µes por Tipo de Evento
EVENTO CONCLU√çDO quando:

‚úÖ Todos os participantes que compareceram (presenca_confirmada = true):
   1. Avaliaram o ANFITRI√ÉO (rating_type = 'host')
   2. Avaliaram os PARTICIPANTES (rating_type = 'participant')
   3. Avaliaram o RESTAURANTE (rating_type = 'restaurant')
   
   + avaliacao_feita = true para a participa√ß√£o
C. Fluxo de Avalia√ß√£o
Usuario clica em "Avaliar Restaurante"
    ‚Üì
RatingService.createRating({
  eventId: 23,
  raterId: 'user-123',
  ratedId: 'restaurant-456',  // partner_id do evento
  ratingType: 'restaurant',
  score: 5
})
    ‚Üì
updateParticipationEvaluationFlag()
    ‚Üì
Verifica se TODAS as avalia√ß√µes foram feitas:
  - hasHostRating?
  - hasParticipantRatings?
  - hasRestaurantRating?
    ‚Üì
Se SIM em TUDO: avaliacao_feita = true

3Ô∏è‚É£ Auto-Conclus√£o do Evento
A. Verifica√ß√£o Autom√°tica (a cada 60 segundos)
javascriptEventStatusService.updateAllEventStatuses()
    ‚Üì
Para cada evento em FINALIZADO:
  calculateEventStatus(event)
    ‚Üì
  shouldAutoCompleteEvent(event)
    ‚Üì
  Verifica 2 condi√ß√µes:
    1. Passou 7 dias desde end_time? ‚Üí CONCLU√çDO
    2. Todos que compareceram avaliaram TUDO? ‚Üí CONCLU√çDO
B. Verifica√ß√£o de Avalia√ß√µes Completas
typescript// RatingService.getEventRatingsStatus()
pendingRaters = participantes.filter(p => {
  const raterRatings = ratings.filter(r => r.rater_id === p.user_id);
  return (
    !raterRatings.some(r => r.rating_type === 'host') ||
    !raterRatings.some(r => r.rating_type === 'participant') ||
    !raterRatings.some(r => r.rating_type === 'restaurant')
  );
});

allRatingsComplete = pendingRaters.length === 0;

4Ô∏è‚É£ Transi√ß√£o para CONCLU√çDO
javascriptshouldAutoCompleteEvent() {
  // Condi√ß√£o 1: Passou 7 dias?
  if (daysSinceEnd >= 7) {
    return true;  // ‚úÖ CONCLU√çDO automaticamente
  }
  
  // Condi√ß√£o 2: Todos avaliaram TUDO?
  const presentParticipants = participations
    .filter(p => p.presenca_confirmada === true);
  
  const allEvaluated = presentParticipants
    .every(p => p.avaliacao_feita === true);
  
  if (allEvaluated && presentParticipants.length > 0) {
    return true;  // ‚úÖ CONCLU√çDO imediatamente
  }
  
  return false;  // ‚è≥ Ainda aguardando
}

5Ô∏è‚É£ Chat em Read-Only
Quando evento est√° CONCLU√çDO:
javascript// EventChatPage.jsx
const [eventStatus, setEventStatus] = useState('');

// Bloqueia envio de mensagens
const handleSubmit = (e) => {
  if (eventStatus === 'Conclu√≠do') {
    alert('Este evento foi conclu√≠do. O chat est√° em modo leitura.');
    return;
  }
  // ... enviar mensagem
};

// UI mostra aviso
{eventStatus === 'Conclu√≠do' && (
  <div className="p-2 rounded-lg bg-gray-700/50">
    üîí Evento conclu√≠do - Chat em modo leitura
  </div>
)}

// Input desabilitado
<Input disabled={eventStatus === 'Conclu√≠do'} />

6Ô∏è‚É£ Valida√ß√£o: M√°ximo 1 Evento por Dia
typescriptParticipationService.canUserCreateNewEvent(userId)
    ‚Üì
1. Verifica se h√° eventos n√£o conclu√≠dos:
   SELECT * FROM events
   WHERE creator_id = userId
   AND status != 'Conclu√≠do'
   
   Se houver: ‚ùå BLOQUEADO
   
2. Verifica limite di√°rio:
   SELECT COUNT(*) FROM events
   WHERE creator_id = userId
   AND DATE(created_at) = TODAY()
   
   Se >= 1: ‚ùå BLOQUEADO (volta amanh√£)
   
Resultado: { can: boolean, reason?: string }
Uso no componente:
javascriptconst permission = await ParticipationService.canUserCreateNewEvent(user.id);

if (!permission.can) {
  toast({
    variant: 'destructive',
    title: 'N√£o pode criar evento',
    description: permission.reason
  });
  return;
}

// ... criar evento

7Ô∏è‚É£ Limpeza Autom√°tica (180 dias)
typescript// ChatCleanupService.ts
ChatCleanupService.startAutoCleanup()
    ‚Üì
Executa a cada 24 horas:
  1. Busca eventos CONCLU√çDO h√° 180+ dias
  2. Deleta todas as mensagens deles
  3. Libera espa√ßo no BD
M√©todo:
typescript// Buscar eventos para limpar
const oldEvents = await supabase
  .from('events')
  .select('id')
  .eq('status', 'Conclu√≠do')
  .lt('updated_at', cutoffDate)  // 180 dias atr√°s

// Deletar mensagens em lotes
for (const event of oldEvents) {
  await supabase
    .from('event_messages')
    .delete()
    .eq('event_id', event.id);
}

üîí RatingService Estendido
A. Novo tipo suportado
typescriptexport type RatingType = 'host' | 'participant' | 'restaurant';
B. Novo m√©todo
typescript// Verifica status completo de avalia√ß√µes
getEventRatingsStatus(eventId)
    ‚Üì
Retorna:
{
  totalParticipants: 5,
  hostRatingsReceived: 3,
  participantRatingsReceived: 4,
  restaurantRatingsReceived: 2,
  allRatingsComplete: false,
  pendingRaters: [
    {
      user_id: 'user-123',
      username: 'Jo√£o',
      evaluated_host: true,
      evaluated_participants: true,
      evaluated_restaurant: false  // ‚ö†Ô∏è Falta avaliar restaurante
    }
  ]
}
C. Flag atualizado
typescriptupdateParticipationEvaluationFlag()
    ‚Üì
ANTES: Marcava avaliacao_feita se tinha rating_type = 'host'
AGORA: Marca avaliacao_feita APENAS se:
  ‚úÖ hasHostRating = true
  ‚úÖ hasParticipantRatings = true
  ‚úÖ hasRestaurantRating = true
  
Sen√£o continua com avaliacao_feita = false

üîÑ ParticipationService Estendido
Novo M√©todo
typescript// Verifica se usu√°rio pode criar novo evento
canUserCreateNewEvent(userId): Promise<{can: boolean, reason?: string}>
    ‚Üì
Regras:
1. N√£o pode ter eventos n√£o conclu√≠dos
   - Se tiver: "Voc√™ tem eventos aguardando conclus√£o"
   
2. M√°ximo 1 evento por dia
   - Se atingiu: "Voc√™ j√° criou um evento hoje"
   
3. Sen√£o: Permitido
   - { can: true }

üßπ ChatCleanupService (NOVO)
Responsabilidades

‚úÖ Deleta mensagens de eventos conclu√≠dos h√° 180+ dias
‚úÖ Executa automaticamente a cada 24 horas
‚úÖ Deleta em lotes de 100 para evitar timeouts
‚úÖ Oferece m√©todo de for√ßa imediata para testes

Inicializa√ß√£o
javascript// No App.jsx ou main.jsx
import ChatCleanupService from '@/services/ChatCleanupService';

useEffect(() => {
  const cleanupInterval = ChatCleanupService.startAutoCleanup();
  
  return () => {
    ChatCleanupService.stopAutoCleanup(cleanupInterval);
  };
}, []);

üîç Arquivo: EventStatusService.ts
Fun√ß√£o corrigida:
typescriptshouldAutoCompleteEvent(event)
    ‚Üì
Regras para AUTO-CONCLUS√ÉO:
1. Passou 7 dias desde end_time? ‚Üí true
2. Ningu√©m compareceu? ‚Üí false (aguarda 7 dias)
3. Algu√©m compareceu mas ningu√©m avaliou? ‚Üí false
4. TODOS que compareceram avaliaram TUDO? ‚Üí true
5. Sen√£o ‚Üí false (aguardando)

# üéØ GUIA DE IMPLEMENTA√á√ÉO - FLUXO DE CONCLUS√ÉO DE EVENTOS

## üì¶ ARQUIVOS CRIADOS

### 1. **MyEventsPage.jsx** 
**Localiza√ß√£o:** `src/features/shared/pages/MyEventsPage.jsx`

**Fun√ß√£o:** P√°gina "Meus Eventos" com 4 abas:
- Futuros: eventos que ainda n√£o aconteceram
- Passados: eventos que terminaram mas n√£o est√£o em Finalizado/Conclu√≠do
- **Finalizados:** eventos terminados aguardando avalia√ß√£o (bot√£o QUALIFICAR aqui)
- Conclu√≠dos: eventos completamente finalizados

**Caracter√≠sticas:**
- Bot√£o "Qualificar" aparece APENAS em eventos Finalizados para quem compareceu
- Bot√£o "Trocar Foto" aparece em Conclu√≠dos (se < 6 meses)
- Indicador visual se j√° avaliou ou n√£o
- Links para ver detalhes ou editar eventos

---

### 2. **EventDetails.jsx** (Corrigido)
**Localiza√ß√£o:** `src/features/shared/pages/EventDetails.jsx`

**Corre√ß√µes aplicadas:**
1. **Separa√ß√£o de l√≥gica Finalizado vs Conclu√≠do:**
   - `isEventFinalized`: status === 'Finalizado'
   - `isEventConcluded`: status === 'Conclu√≠do'

2. **Fluxo de avalia√ß√£o ‚Üí foto:**
   ```jsx
   // Em FINALIZADO:
   if (!hasEvaluated) {
     // Mostra EventEvaluationSection
   } else {
     // Mostra bot√£o de enviar foto
   }
   
   // Em CONCLU√çDO:
   // Mostra apenas bot√£o de trocar foto (se < 6 meses)
   ```

3. **Valida√ß√£o de upload:**
   - N√£o pode enviar foto antes de avaliar em "Finalizado"
   - Em "Conclu√≠do" pode trocar foto por at√© 6 meses

---

### 3. **ParticipantHistoryPage.jsx**
**Localiza√ß√£o:** `src/features/shared/pages/ParticipantHistoryPage.jsx`

**Fun√ß√£o:** Hist√≥rico de fotos do participante

**Caracter√≠sticas:**
- Grid com todas as fotos enviadas pelo usu√°rio
- Informa√ß√µes do evento de cada foto
- Bot√£o para ver evento
- Bot√£o para trocar foto (se evento conclu√≠do < 6 meses)
- Bot√£o para deletar foto
- Contador de fotos publicadas

---

### 4. **RestaurantDetailsPage.jsx**
**Localiza√ß√£o:** `src/features/shared/pages/RestaurantDetailsPage.jsx`

**Fun√ß√£o:** P√°gina de detalhes do restaurante com carousel de fotos

**Caracter√≠sticas:**
- Carousel com at√© 50 fotos dos eventos do restaurante
- Fotos s√£o exibidas em ordem cronol√≥gica reversa (mais recentes primeiro)
- Navega√ß√£o com setas esquerda/direita
- Thumbnails clic√°veis abaixo do carousel
- Informa√ß√µes de quem postou e data
- Lista de pr√≥ximos eventos do restaurante

**L√≥gica do Carousel:**
```javascript
// Busca fotos aprovadas de todos os eventos
// Filtra apenas as do partner_id espec√≠fico
// Limita a 50 fotos (FIFO - mais antigas saem)
// Ordena por created_at DESC
```

---

## üîß INTEGRA√á√ÉO NO PROJETO

### Passo 1: Copiar arquivos para o projeto

```bash
# Copiar arquivos da pasta /home/claude/ para o projeto
cp /home/claude/MyEventsPage.jsx src/features/shared/pages/
cp /home/claude/EventDetails.jsx src/features/shared/pages/
cp /home/claude/ParticipantHistoryPage.jsx src/features/shared/pages/
cp /home/claude/RestaurantDetailsPage.jsx src/features/shared/pages/
```

### Passo 2: Adicionar rotas

**Arquivo:** `src/App.jsx` ou `src/router.jsx`

```jsx
import MyEventsPage from '@/features/shared/pages/MyEventsPage';
import ParticipantHistoryPage from '@/features/shared/pages/ParticipantHistoryPage';
import RestaurantDetailsPage from '@/features/shared/pages/RestaurantDetailsPage';

// Adicionar rotas:
<Route path="/meus-eventos" element={<MyEventsPage />} />
<Route path="/meu-historico" element={<ParticipantHistoryPage />} />
<Route path="/restaurant/:id" element={<RestaurantDetailsPage />} />
```

### Passo 3: Atualizar RestaurantsPage.jsx

**Trocar o Link do card:**

```jsx
// ANTES:
<Link to={`/restaurant/${restaurant.id}`}>

// J√° est√° correto! Apenas certifique-se de que aponta para a rota certa
```

### Passo 4: Atualizar navega√ß√£o/menu

Adicionar links no menu principal:

```jsx
<NavLink to="/meus-eventos">Meus Eventos</NavLink>
<NavLink to="/meu-historico">Minhas Fotos</NavLink>
```

---

## üìä FLUXO COMPLETO

### Status dos Eventos:

```
1. ABERTO ‚Üí Aceitando candidaturas
2. CONFIRMADO ‚Üí Evento confirmado, pode entrar com senha
3. EM ANDAMENTO ‚Üí Acontecendo agora
4. FINALIZADO ‚Üí Terminou, aguardando avalia√ß√µes
   ‚îú‚îÄ Participante que compareceu v√™ bot√£o QUALIFICAR
   ‚îú‚îÄ Ap√≥s avaliar: aparece bot√£o ENVIAR FOTO
   ‚îî‚îÄ Quando todos avaliarem OU passar 7 dias ‚Üí CONCLU√çDO
   
5. CONCLU√çDO ‚Üí Evento finalizado
   ‚îî‚îÄ Pode TROCAR FOTO por at√© 6 meses
```

### Fluxo de Avalia√ß√£o:

```
EVENTO FINALIZADO
    ‚Üì
Participante clica em QUALIFICAR
    ‚Üì
Vai para EventDetails
    ‚Üì
V√™ se√ß√£o EventEvaluationSection
    ‚Üì
Avalia: Anfitri√£o + Participantes + Restaurante
    ‚Üì
avaliacao_feita = true
    ‚Üì
Aparece bot√£o ENVIAR FOTO
    ‚Üì
Upload da foto
    ‚Üì
Foto vai para:
  - event_photos (tabela)
  - Hist√≥rico do participante
  - Carousel do restaurante
```

### Fluxo de Fotos:

```
FOTO ENVIADA
    ‚Üì
Salva em event_photos
    ‚îú‚îÄ event_id
    ‚îú‚îÄ user_id
    ‚îú‚îÄ photo_url (Supabase Storage: event-photos bucket)
    ‚îî‚îÄ status: 'aprovado'
    ‚Üì
Aparece em:
    ‚îú‚îÄ Hist√≥rico do Participante (/meu-historico)
    ‚îî‚îÄ Carousel do Restaurante (/restaurant/:id)
         ‚îî‚îÄ Filtrado por partner_id
         ‚îî‚îÄ √öltimas 50 fotos (FIFO)
```

---

## ‚úÖ CHECKLIST DE VALIDA√á√ïES

### No EventDetails.jsx:
- [x] Separa l√≥gica Finalizado vs Conclu√≠do
- [x] Mostra avalia√ß√£o ANTES do bot√£o de foto
- [x] S√≥ libera foto ap√≥s `avaliacao_feita = true`
- [x] Em Conclu√≠do, permite trocar foto por 6 meses
- [x] Usa `differenceInMonths` para validar prazo

### No MyEventsPage.jsx:
- [x] Aba "Finalizados" filtra por `status === 'Finalizado'` + `presenca_confirmada === true`
- [x] Bot√£o "Qualificar" aparece s√≥ se `!hasEvaluated`
- [x] Bot√£o "Trocar Foto" em Conclu√≠dos se < 6 meses
- [x] Indicador visual de status de avalia√ß√£o

### No ParticipantHistoryPage.jsx:
- [x] Busca fotos do usu√°rio logado
- [x] Mostra evento de cada foto
- [x] Permite deletar foto pr√≥pria
- [x] Permite trocar foto em eventos conclu√≠dos < 6 meses

### No RestaurantDetailsPage.jsx:
- [x] Carousel com √∫ltimas 50 fotos
- [x] Filtra por `partner_id`
- [x] Navega√ß√£o esquerda/direita
- [x] Thumbnails
- [x] Info de quem postou

---

## üîç SERVI√áOS UTILIZADOS

### RatingService.ts
```typescript
// J√° funciona corretamente
- createRating()
- updateParticipationEvaluationFlag() // Marca avaliacao_feita = true
- getEventRatingsStatus()
```

### EventPhotosService.ts
```typescript
// J√° funciona corretamente
- uploadEventPhoto() // Upload com redimensionamento
- getEventPhotos() // Busca fotos de um evento
- getUserPhotoForEvent() // Busca foto do user em evento espec√≠fico
- deleteEventPhoto() // Deleta foto
- getPhotoStats() // Estat√≠sticas
```

### EventStatusService.ts
```typescript
// Auto-conclus√£o funciona
- shouldAutoCompleteEvent()
  ‚îú‚îÄ Verifica se passou 7 dias
  ‚îî‚îÄ Verifica se todos que compareceram avaliaram
```

---

## üì∏ ESTRUTURA NO SUPABASE

### Tabela: event_photos
```sql
- id (int, PK)
- event_id (int, FK ‚Üí events)
- user_id (uuid, FK ‚Üí users)
- photo_url (text) -- URL do Supabase Storage
- file_size (int)
- status (text) -- 'aprovado', 'pendente', 'rejeitado'
- created_at (timestamp)
```

### Bucket: event-photos
```
Estrutura:
event-photos/
  ‚îú‚îÄ 123/
  ‚îÇ   ‚îú‚îÄ user1-1698765432.jpg
  ‚îÇ   ‚îî‚îÄ user2-1698765433.jpg
  ‚îî‚îÄ 124/
      ‚îî‚îÄ user3-1698765434.jpg
```

---

## üé® ESTILOS E COMPONENTES

Todos os arquivos usam:
- **Tailwind CSS** para estiliza√ß√£o
- **Framer Motion** para anima√ß√µes
- **Lucide React** para √≠cones
- **shadcn/ui** componentes (Button, Input)
- **date-fns** para formata√ß√£o de datas
- Classes: `glass-effect`, `gradient-text`

---

## üöÄ PR√ìXIMOS PASSOS

1. ‚úÖ Copiar arquivos para o projeto
2. ‚úÖ Adicionar rotas
3. ‚úÖ Atualizar menu de navega√ß√£o
4. ‚úÖ Testar fluxo completo:
   - Criar evento
   - Participar
   - Entrar com senha
   - Evento finalizar
   - Avaliar (qualificar)
   - Enviar foto
   - Ver foto no hist√≥rico
   - Ver foto no carousel do restaurante

---

## üí° OBSERVA√á√ïES IMPORTANTES

### Timing de Auto-conclus√£o:
```javascript
// Em EventStatusService.ts
shouldAutoCompleteEvent() {
  // Condi√ß√£o 1: Passou 7 dias?
  if (daysSinceEnd >= 7) return true;
  
  // Condi√ß√£o 2: Todos que compareceram avaliaram?
  if (allEvaluated) return true;
  
  return false;
}
```

### Prazo de Troca de Foto:
```javascript
// Em todos os componentes
const canChangePhoto = () => {
  if (status !== 'Conclu√≠do') return false;
  const monthsSinceEnd = differenceInMonths(new Date(), eventEndTime);
  return monthsSinceEnd < 6;
};
```

### FIFO de Fotos (50 max):
```javascript
// No SQL do Supabase
.order('created_at', { ascending: false })
.limit(50)
// Fotos mais antigas automaticamente deixam de aparecer
```

---

## üêõ DEBUGGING

### Se bot√£o "Qualificar" n√£o aparecer:
1. Verificar status do evento: deve ser 'Finalizado'
2. Verificar presenca_confirmada: deve ser `true`
3. Verificar avaliacao_feita: deve ser `false`

### Se n√£o consegue enviar foto:
1. Verificar se avaliou tudo (avaliacao_feita = true)
2. Verificar bucket 'event-photos' no Supabase Storage
3. Verificar pol√≠ticas RLS da tabela event_photos

### Se foto n√£o aparece no carousel:
1. Verificar se photo.event.partner_id === restaurant.id
2. Verificar se foto tem status 'aprovado'
3. Verificar query no RestaurantDetailsPage

---

## ‚ú® FIM DO GUIA

Todos os arquivos est√£o prontos e seguem as melhores pr√°ticas do React/Next.js.
O fluxo est√° completo e test√°vel.

D√∫vidas? Revise as se√ß√µes espec√≠ficas acima! üöÄ